[{"filePath":"D:\\websites\\cab driver\\api\\sitemap.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\dev-dist\\registerSW.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\dev-dist\\sw.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\dev-dist\\workbox-5a5d9309.js","messages":[{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":69,"column":7,"endLine":69,"endColumn":63,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":436,"column":5,"endLine":436,"endColumn":61,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-member-access","message":"Definition for rule '@typescript-eslint/no-unsafe-member-access' was not found.","line":769,"column":11,"endLine":769,"endColumn":81,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-assignment","message":"Definition for rule '@typescript-eslint/no-unsafe-assignment' was not found.","line":771,"column":13,"endLine":771,"endColumn":80,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-assignment","message":"Definition for rule '@typescript-eslint/no-unsafe-assignment' was not found.","line":965,"column":11,"endLine":965,"endColumn":78,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-assignment","message":"Definition for rule '@typescript-eslint/no-unsafe-assignment' was not found.","line":981,"column":13,"endLine":981,"endColumn":80,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":1665,"column":5,"endLine":1665,"endColumn":61,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-return","message":"Definition for rule '@typescript-eslint/no-unsafe-return' was not found.","line":2793,"column":9,"endLine":2793,"endColumn":72,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-return","message":"Definition for rule '@typescript-eslint/no-unsafe-return' was not found.","line":2840,"column":9,"endLine":2840,"endColumn":72,"severity":2,"nodeType":null}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"define(['exports'], (function (exports) { 'use strict';\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:core:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Claim any currently available clients once the service worker\r\n     * becomes active. This is normally used in conjunction with `skipWaiting()`.\r\n     *\r\n     * @memberof workbox-core\r\n     */\r\n    function clientsClaim() {\r\n      self.addEventListener('activate', () => self.clients.claim());\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const logger = (() => {\r\n      // Don't overwrite this value if it's already set.\r\n      // See https://github.com/GoogleChrome/workbox/pull/2284#issuecomment-560470923\r\n      if (!('__WB_DISABLE_DEV_LOGS' in globalThis)) {\r\n        self.__WB_DISABLE_DEV_LOGS = false;\r\n      }\r\n      let inGroup = false;\r\n      const methodToColorMap = {\r\n        debug: `#7f8c8d`,\r\n        log: `#2ecc71`,\r\n        warn: `#f39c12`,\r\n        error: `#c0392b`,\r\n        groupCollapsed: `#3498db`,\r\n        groupEnd: null // No colored prefix on groupEnd\r\n      };\r\n      const print = function (method, args) {\r\n        if (self.__WB_DISABLE_DEV_LOGS) {\r\n          return;\r\n        }\r\n        if (method === 'groupCollapsed') {\r\n          // Safari doesn't print all console.groupCollapsed() arguments:\r\n          // https://bugs.webkit.org/show_bug.cgi?id=182754\r\n          if (/^((?!chrome|android).)*safari/i.test(navigator.userAgent)) {\r\n            console[method](...args);\r\n            return;\r\n          }\r\n        }\r\n        const styles = [`background: ${methodToColorMap[method]}`, `border-radius: 0.5em`, `color: white`, `font-weight: bold`, `padding: 2px 0.5em`];\r\n        // When in a group, the workbox prefix is not displayed.\r\n        const logPrefix = inGroup ? [] : ['%cworkbox', styles.join(';')];\r\n        console[method](...logPrefix, ...args);\r\n        if (method === 'groupCollapsed') {\r\n          inGroup = true;\r\n        }\r\n        if (method === 'groupEnd') {\r\n          inGroup = false;\r\n        }\r\n      };\r\n      // eslint-disable-next-line @typescript-eslint/ban-types\r\n      const api = {};\r\n      const loggerMethods = Object.keys(methodToColorMap);\r\n      for (const key of loggerMethods) {\r\n        const method = key;\r\n        api[method] = (...args) => {\r\n          print(method, args);\r\n        };\r\n      }\r\n      return api;\r\n    })();\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const messages = {\r\n      'invalid-value': ({\r\n        paramName,\r\n        validValueDescription,\r\n        value\r\n      }) => {\r\n        if (!paramName || !validValueDescription) {\r\n          throw new Error(`Unexpected input to 'invalid-value' error.`);\r\n        }\r\n        return `The '${paramName}' parameter was given a value with an ` + `unexpected value. ${validValueDescription} Received a value of ` + `${JSON.stringify(value)}.`;\r\n      },\r\n      'not-an-array': ({\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        if (!moduleName || !className || !funcName || !paramName) {\r\n          throw new Error(`Unexpected input to 'not-an-array' error.`);\r\n        }\r\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${className}.${funcName}()' must be an array.`;\r\n      },\r\n      'incorrect-type': ({\r\n        expectedType,\r\n        paramName,\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        if (!expectedType || !paramName || !moduleName || !funcName) {\r\n          throw new Error(`Unexpected input to 'incorrect-type' error.`);\r\n        }\r\n        const classNameStr = className ? `${className}.` : '';\r\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${classNameStr}` + `${funcName}()' must be of type ${expectedType}.`;\r\n      },\r\n      'incorrect-class': ({\r\n        expectedClassName,\r\n        paramName,\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        isReturnValueProblem\r\n      }) => {\r\n        if (!expectedClassName || !moduleName || !funcName) {\r\n          throw new Error(`Unexpected input to 'incorrect-class' error.`);\r\n        }\r\n        const classNameStr = className ? `${className}.` : '';\r\n        if (isReturnValueProblem) {\r\n          return `The return value from ` + `'${moduleName}.${classNameStr}${funcName}()' ` + `must be an instance of class ${expectedClassName}.`;\r\n        }\r\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${classNameStr}${funcName}()' ` + `must be an instance of class ${expectedClassName}.`;\r\n      },\r\n      'missing-a-method': ({\r\n        expectedMethod,\r\n        paramName,\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        if (!expectedMethod || !paramName || !moduleName || !className || !funcName) {\r\n          throw new Error(`Unexpected input to 'missing-a-method' error.`);\r\n        }\r\n        return `${moduleName}.${className}.${funcName}() expected the ` + `'${paramName}' parameter to expose a '${expectedMethod}' method.`;\r\n      },\r\n      'add-to-cache-list-unexpected-type': ({\r\n        entry\r\n      }) => {\r\n        return `An unexpected entry was passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' The entry ` + `'${JSON.stringify(entry)}' isn't supported. You must supply an array of ` + `strings with one or more characters, objects with a url property or ` + `Request objects.`;\r\n      },\r\n      'add-to-cache-list-conflicting-entries': ({\r\n        firstEntry,\r\n        secondEntry\r\n      }) => {\r\n        if (!firstEntry || !secondEntry) {\r\n          throw new Error(`Unexpected input to ` + `'add-to-cache-list-duplicate-entries' error.`);\r\n        }\r\n        return `Two of the entries passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` + `${firstEntry} but different revision details. Workbox is ` + `unable to cache and version the asset correctly. Please remove one ` + `of the entries.`;\r\n      },\r\n      'plugin-error-request-will-fetch': ({\r\n        thrownErrorMessage\r\n      }) => {\r\n        if (!thrownErrorMessage) {\r\n          throw new Error(`Unexpected input to ` + `'plugin-error-request-will-fetch', error.`);\r\n        }\r\n        return `An error was thrown by a plugins 'requestWillFetch()' method. ` + `The thrown error message was: '${thrownErrorMessage}'.`;\r\n      },\r\n      'invalid-cache-name': ({\r\n        cacheNameId,\r\n        value\r\n      }) => {\r\n        if (!cacheNameId) {\r\n          throw new Error(`Expected a 'cacheNameId' for error 'invalid-cache-name'`);\r\n        }\r\n        return `You must provide a name containing at least one character for ` + `setCacheDetails({${cacheNameId}: '...'}). Received a value of ` + `'${JSON.stringify(value)}'`;\r\n      },\r\n      'unregister-route-but-not-found-with-method': ({\r\n        method\r\n      }) => {\r\n        if (!method) {\r\n          throw new Error(`Unexpected input to ` + `'unregister-route-but-not-found-with-method' error.`);\r\n        }\r\n        return `The route you're trying to unregister was not  previously ` + `registered for the method type '${method}'.`;\r\n      },\r\n      'unregister-route-route-not-registered': () => {\r\n        return `The route you're trying to unregister was not previously ` + `registered.`;\r\n      },\r\n      'queue-replay-failed': ({\r\n        name\r\n      }) => {\r\n        return `Replaying the background sync queue '${name}' failed.`;\r\n      },\r\n      'duplicate-queue-name': ({\r\n        name\r\n      }) => {\r\n        return `The Queue name '${name}' is already being used. ` + `All instances of backgroundSync.Queue must be given unique names.`;\r\n      },\r\n      'expired-test-without-max-age': ({\r\n        methodName,\r\n        paramName\r\n      }) => {\r\n        return `The '${methodName}()' method can only be used when the ` + `'${paramName}' is used in the constructor.`;\r\n      },\r\n      'unsupported-route-type': ({\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        return `The supplied '${paramName}' parameter was an unsupported type. ` + `Please check the docs for ${moduleName}.${className}.${funcName} for ` + `valid input types.`;\r\n      },\r\n      'not-array-of-class': ({\r\n        value,\r\n        expectedClass,\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        return `The supplied '${paramName}' parameter must be an array of ` + `'${expectedClass}' objects. Received '${JSON.stringify(value)},'. ` + `Please check the call to ${moduleName}.${className}.${funcName}() ` + `to fix the issue.`;\r\n      },\r\n      'max-entries-or-age-required': ({\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        return `You must define either config.maxEntries or config.maxAgeSeconds` + `in ${moduleName}.${className}.${funcName}`;\r\n      },\r\n      'statuses-or-headers-required': ({\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        return `You must define either config.statuses or config.headers` + `in ${moduleName}.${className}.${funcName}`;\r\n      },\r\n      'invalid-string': ({\r\n        moduleName,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        if (!paramName || !moduleName || !funcName) {\r\n          throw new Error(`Unexpected input to 'invalid-string' error.`);\r\n        }\r\n        return `When using strings, the '${paramName}' parameter must start with ` + `'http' (for cross-origin matches) or '/' (for same-origin matches). ` + `Please see the docs for ${moduleName}.${funcName}() for ` + `more info.`;\r\n      },\r\n      'channel-name-required': () => {\r\n        return `You must provide a channelName to construct a ` + `BroadcastCacheUpdate instance.`;\r\n      },\r\n      'invalid-responses-are-same-args': () => {\r\n        return `The arguments passed into responsesAreSame() appear to be ` + `invalid. Please ensure valid Responses are used.`;\r\n      },\r\n      'expire-custom-caches-only': () => {\r\n        return `You must provide a 'cacheName' property when using the ` + `expiration plugin with a runtime caching strategy.`;\r\n      },\r\n      'unit-must-be-bytes': ({\r\n        normalizedRangeHeader\r\n      }) => {\r\n        if (!normalizedRangeHeader) {\r\n          throw new Error(`Unexpected input to 'unit-must-be-bytes' error.`);\r\n        }\r\n        return `The 'unit' portion of the Range header must be set to 'bytes'. ` + `The Range header provided was \"${normalizedRangeHeader}\"`;\r\n      },\r\n      'single-range-only': ({\r\n        normalizedRangeHeader\r\n      }) => {\r\n        if (!normalizedRangeHeader) {\r\n          throw new Error(`Unexpected input to 'single-range-only' error.`);\r\n        }\r\n        return `Multiple ranges are not supported. Please use a  single start ` + `value, and optional end value. The Range header provided was ` + `\"${normalizedRangeHeader}\"`;\r\n      },\r\n      'invalid-range-values': ({\r\n        normalizedRangeHeader\r\n      }) => {\r\n        if (!normalizedRangeHeader) {\r\n          throw new Error(`Unexpected input to 'invalid-range-values' error.`);\r\n        }\r\n        return `The Range header is missing both start and end values. At least ` + `one of those values is needed. The Range header provided was ` + `\"${normalizedRangeHeader}\"`;\r\n      },\r\n      'no-range-header': () => {\r\n        return `No Range header was found in the Request provided.`;\r\n      },\r\n      'range-not-satisfiable': ({\r\n        size,\r\n        start,\r\n        end\r\n      }) => {\r\n        return `The start (${start}) and end (${end}) values in the Range are ` + `not satisfiable by the cached response, which is ${size} bytes.`;\r\n      },\r\n      'attempt-to-cache-non-get-request': ({\r\n        url,\r\n        method\r\n      }) => {\r\n        return `Unable to cache '${url}' because it is a '${method}' request and ` + `only 'GET' requests can be cached.`;\r\n      },\r\n      'cache-put-with-no-response': ({\r\n        url\r\n      }) => {\r\n        return `There was an attempt to cache '${url}' but the response was not ` + `defined.`;\r\n      },\r\n      'no-response': ({\r\n        url,\r\n        error\r\n      }) => {\r\n        let message = `The strategy could not generate a response for '${url}'.`;\r\n        if (error) {\r\n          message += ` The underlying error is ${error}.`;\r\n        }\r\n        return message;\r\n      },\r\n      'bad-precaching-response': ({\r\n        url,\r\n        status\r\n      }) => {\r\n        return `The precaching request for '${url}' failed` + (status ? ` with an HTTP status of ${status}.` : `.`);\r\n      },\r\n      'non-precached-url': ({\r\n        url\r\n      }) => {\r\n        return `createHandlerBoundToURL('${url}') was called, but that URL is ` + `not precached. Please pass in a URL that is precached instead.`;\r\n      },\r\n      'add-to-cache-list-conflicting-integrities': ({\r\n        url\r\n      }) => {\r\n        return `Two of the entries passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` + `${url} with different integrity values. Please remove one of them.`;\r\n      },\r\n      'missing-precache-entry': ({\r\n        cacheName,\r\n        url\r\n      }) => {\r\n        return `Unable to find a precached response in ${cacheName} for ${url}.`;\r\n      },\r\n      'cross-origin-copy-response': ({\r\n        origin\r\n      }) => {\r\n        return `workbox-core.copyResponse() can only be used with same-origin ` + `responses. It was passed a response with origin ${origin}.`;\r\n      },\r\n      'opaque-streams-source': ({\r\n        type\r\n      }) => {\r\n        const message = `One of the workbox-streams sources resulted in an ` + `'${type}' response.`;\r\n        if (type === 'opaqueredirect') {\r\n          return `${message} Please do not use a navigation request that results ` + `in a redirect as a source.`;\r\n        }\r\n        return `${message} Please ensure your sources are CORS-enabled.`;\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const generatorFunction = (code, details = {}) => {\r\n      const message = messages[code];\r\n      if (!message) {\r\n        throw new Error(`Unable to find message for code '${code}'.`);\r\n      }\r\n      return message(details);\r\n    };\r\n    const messageGenerator = generatorFunction;\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Workbox errors should be thrown with this class.\r\n     * This allows use to ensure the type easily in tests,\r\n     * helps developers identify errors from workbox\r\n     * easily and allows use to optimise error\r\n     * messages correctly.\r\n     *\r\n     * @private\r\n     */\r\n    class WorkboxError extends Error {\r\n      /**\r\n       *\r\n       * @param {string} errorCode The error code that\r\n       * identifies this particular error.\r\n       * @param {Object=} details Any relevant arguments\r\n       * that will help developers identify issues should\r\n       * be added as a key on the context object.\r\n       */\r\n      constructor(errorCode, details) {\r\n        const message = messageGenerator(errorCode, details);\r\n        super(message);\r\n        this.name = errorCode;\r\n        this.details = details;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /*\r\n     * This method throws if the supplied value is not an array.\r\n     * The destructed values are required to produce a meaningful error for users.\r\n     * The destructed and restructured object is so it's clear what is\r\n     * needed.\r\n     */\r\n    const isArray = (value, details) => {\r\n      if (!Array.isArray(value)) {\r\n        throw new WorkboxError('not-an-array', details);\r\n      }\r\n    };\r\n    const hasMethod = (object, expectedMethod, details) => {\r\n      const type = typeof object[expectedMethod];\r\n      if (type !== 'function') {\r\n        details['expectedMethod'] = expectedMethod;\r\n        throw new WorkboxError('missing-a-method', details);\r\n      }\r\n    };\r\n    const isType = (object, expectedType, details) => {\r\n      if (typeof object !== expectedType) {\r\n        details['expectedType'] = expectedType;\r\n        throw new WorkboxError('incorrect-type', details);\r\n      }\r\n    };\r\n    const isInstance = (object,\r\n    // Need the general type to do the check later.\r\n    // eslint-disable-next-line @typescript-eslint/ban-types\r\n    expectedClass, details) => {\r\n      if (!(object instanceof expectedClass)) {\r\n        details['expectedClassName'] = expectedClass.name;\r\n        throw new WorkboxError('incorrect-class', details);\r\n      }\r\n    };\r\n    const isOneOf = (value, validValues, details) => {\r\n      if (!validValues.includes(value)) {\r\n        details['validValueDescription'] = `Valid values are ${JSON.stringify(validValues)}.`;\r\n        throw new WorkboxError('invalid-value', details);\r\n      }\r\n    };\r\n    const isArrayOfClass = (value,\r\n    // Need general type to do check later.\r\n    expectedClass,\r\n     \r\n    details) => {\r\n      const error = new WorkboxError('not-array-of-class', details);\r\n      if (!Array.isArray(value)) {\r\n        throw error;\r\n      }\r\n      for (const item of value) {\r\n        if (!(item instanceof expectedClass)) {\r\n          throw error;\r\n        }\r\n      }\r\n    };\r\n    const finalAssertExports = {\r\n      hasMethod,\r\n      isArray,\r\n      isInstance,\r\n      isOneOf,\r\n      isType,\r\n      isArrayOfClass\r\n    };\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:routing:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * The default HTTP method, 'GET', used when there's no specific method\r\n     * configured for a route.\r\n     *\r\n     * @type {string}\r\n     *\r\n     * @private\r\n     */\r\n    const defaultMethod = 'GET';\r\n    /**\r\n     * The list of valid HTTP methods associated with requests that could be routed.\r\n     *\r\n     * @type {Array<string>}\r\n     *\r\n     * @private\r\n     */\r\n    const validMethods = ['DELETE', 'GET', 'HEAD', 'PATCH', 'POST', 'PUT'];\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * @param {function()|Object} handler Either a function, or an object with a\r\n     * 'handle' method.\r\n     * @return {Object} An object with a handle method.\r\n     *\r\n     * @private\r\n     */\r\n    const normalizeHandler = handler => {\r\n      if (handler && typeof handler === 'object') {\r\n        {\r\n          finalAssertExports.hasMethod(handler, 'handle', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Route',\r\n            funcName: 'constructor',\r\n            paramName: 'handler'\r\n          });\r\n        }\r\n        return handler;\r\n      } else {\r\n        {\r\n          finalAssertExports.isType(handler, 'function', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Route',\r\n            funcName: 'constructor',\r\n            paramName: 'handler'\r\n          });\r\n        }\r\n        return {\r\n          handle: handler\r\n        };\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A `Route` consists of a pair of callback functions, \"match\" and \"handler\".\r\n     * The \"match\" callback determine if a route should be used to \"handle\" a\r\n     * request by returning a non-falsy value if it can. The \"handler\" callback\r\n     * is called when there is a match and should return a Promise that resolves\r\n     * to a `Response`.\r\n     *\r\n     * @memberof workbox-routing\r\n     */\r\n    class Route {\r\n      /**\r\n       * Constructor for Route class.\r\n       *\r\n       * @param {workbox-routing~matchCallback} match\r\n       * A callback function that determines whether the route matches a given\r\n       * `fetch` event by returning a non-falsy value.\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resolving to a Response.\r\n       * @param {string} [method='GET'] The HTTP method to match the Route\r\n       * against.\r\n       */\r\n      constructor(match, handler, method = defaultMethod) {\r\n        {\r\n          finalAssertExports.isType(match, 'function', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Route',\r\n            funcName: 'constructor',\r\n            paramName: 'match'\r\n          });\r\n          if (method) {\r\n            finalAssertExports.isOneOf(method, validMethods, {\r\n              paramName: 'method'\r\n            });\r\n          }\r\n        }\r\n        // These values are referenced directly by Router so cannot be\r\n        // altered by minificaton.\r\n        this.handler = normalizeHandler(handler);\r\n        this.match = match;\r\n        this.method = method;\r\n      }\r\n      /**\r\n       *\r\n       * @param {workbox-routing-handlerCallback} handler A callback\r\n       * function that returns a Promise resolving to a Response\r\n       */\r\n      setCatchHandler(handler) {\r\n        this.catchHandler = normalizeHandler(handler);\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * RegExpRoute makes it easy to create a regular expression based\r\n     * {@link workbox-routing.Route}.\r\n     *\r\n     * For same-origin requests the RegExp only needs to match part of the URL. For\r\n     * requests against third-party servers, you must define a RegExp that matches\r\n     * the start of the URL.\r\n     *\r\n     * @memberof workbox-routing\r\n     * @extends workbox-routing.Route\r\n     */\r\n    class RegExpRoute extends Route {\r\n      /**\r\n       * If the regular expression contains\r\n       * [capture groups]{@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp#grouping-back-references},\r\n       * the captured values will be passed to the\r\n       * {@link workbox-routing~handlerCallback} `params`\r\n       * argument.\r\n       *\r\n       * @param {RegExp} regExp The regular expression to match against URLs.\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resulting in a Response.\r\n       * @param {string} [method='GET'] The HTTP method to match the Route\r\n       * against.\r\n       */\r\n      constructor(regExp, handler, method) {\r\n        {\r\n          finalAssertExports.isInstance(regExp, RegExp, {\r\n            moduleName: 'workbox-routing',\r\n            className: 'RegExpRoute',\r\n            funcName: 'constructor',\r\n            paramName: 'pattern'\r\n          });\r\n        }\r\n        const match = ({\r\n          url\r\n        }) => {\r\n          const result = regExp.exec(url.href);\r\n          // Return immediately if there's no match.\r\n          if (!result) {\r\n            return;\r\n          }\r\n          // Require that the match start at the first character in the URL string\r\n          // if it's a cross-origin request.\r\n          // See https://github.com/GoogleChrome/workbox/issues/281 for the context\r\n          // behind this behavior.\r\n          if (url.origin !== location.origin && result.index !== 0) {\r\n            {\r\n              logger.debug(`The regular expression '${regExp.toString()}' only partially matched ` + `against the cross-origin URL '${url.toString()}'. RegExpRoute's will only ` + `handle cross-origin requests if they match the entire URL.`);\r\n            }\r\n            return;\r\n          }\r\n          // If the route matches, but there aren't any capture groups defined, then\r\n          // this will return [], which is truthy and therefore sufficient to\r\n          // indicate a match.\r\n          // If there are capture groups, then it will return their values.\r\n          return result.slice(1);\r\n        };\r\n        super(match, handler, method);\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const getFriendlyURL = url => {\r\n      const urlObj = new URL(String(url), location.href);\r\n      // See https://github.com/GoogleChrome/workbox/issues/2323\r\n      // We want to include everything, except for the origin if it's same-origin.\r\n      return urlObj.href.replace(new RegExp(`^${location.origin}`), '');\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * The Router can be used to process a `FetchEvent` using one or more\r\n     * {@link workbox-routing.Route}, responding with a `Response` if\r\n     * a matching route exists.\r\n     *\r\n     * If no route matches a given a request, the Router will use a \"default\"\r\n     * handler if one is defined.\r\n     *\r\n     * Should the matching Route throw an error, the Router will use a \"catch\"\r\n     * handler if one is defined to gracefully deal with issues and respond with a\r\n     * Request.\r\n     *\r\n     * If a request matches multiple routes, the **earliest** registered route will\r\n     * be used to respond to the request.\r\n     *\r\n     * @memberof workbox-routing\r\n     */\r\n    class Router {\r\n      /**\r\n       * Initializes a new Router.\r\n       */\r\n      constructor() {\r\n        this._routes = new Map();\r\n        this._defaultHandlerMap = new Map();\r\n      }\r\n      /**\r\n       * @return {Map<string, Array<workbox-routing.Route>>} routes A `Map` of HTTP\r\n       * method name ('GET', etc.) to an array of all the corresponding `Route`\r\n       * instances that are registered.\r\n       */\r\n      get routes() {\r\n        return this._routes;\r\n      }\r\n      /**\r\n       * Adds a fetch event listener to respond to events when a route matches\r\n       * the event's request.\r\n       */\r\n      addFetchListener() {\r\n        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\r\n        self.addEventListener('fetch', event => {\r\n          const {\r\n            request\r\n          } = event;\r\n          const responsePromise = this.handleRequest({\r\n            request,\r\n            event\r\n          });\r\n          if (responsePromise) {\r\n            event.respondWith(responsePromise);\r\n          }\r\n        });\r\n      }\r\n      /**\r\n       * Adds a message event listener for URLs to cache from the window.\r\n       * This is useful to cache resources loaded on the page prior to when the\r\n       * service worker started controlling it.\r\n       *\r\n       * The format of the message data sent from the window should be as follows.\r\n       * Where the `urlsToCache` array may consist of URL strings or an array of\r\n       * URL string + `requestInit` object (the same as you'd pass to `fetch()`).\r\n       *\r\n       * ```\r\n       * {\r\n       *   type: 'CACHE_URLS',\r\n       *   payload: {\r\n       *     urlsToCache: [\r\n       *       './script1.js',\r\n       *       './script2.js',\r\n       *       ['./script3.js', {mode: 'no-cors'}],\r\n       *     ],\r\n       *   },\r\n       * }\r\n       * ```\r\n       */\r\n      addCacheListener() {\r\n        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\r\n        self.addEventListener('message', event => {\r\n          // event.data is type 'any'\r\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\r\n          if (event.data && event.data.type === 'CACHE_URLS') {\r\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\r\n            const {\r\n              payload\r\n            } = event.data;\r\n            {\r\n              logger.debug(`Caching URLs from the window`, payload.urlsToCache);\r\n            }\r\n            const requestPromises = Promise.all(payload.urlsToCache.map(entry => {\r\n              if (typeof entry === 'string') {\r\n                entry = [entry];\r\n              }\r\n              const request = new Request(...entry);\r\n              return this.handleRequest({\r\n                request,\r\n                event\r\n              });\r\n              // TODO(philipwalton): TypeScript errors without this typecast for\r\n              // some reason (probably a bug). The real type here should work but\r\n              // doesn't: `Array<Promise<Response> | undefined>`.\r\n            })); // TypeScript\r\n            event.waitUntil(requestPromises);\r\n            // If a MessageChannel was used, reply to the message on success.\r\n            if (event.ports && event.ports[0]) {\r\n              void requestPromises.then(() => event.ports[0].postMessage(true));\r\n            }\r\n          }\r\n        });\r\n      }\r\n      /**\r\n       * Apply the routing rules to a FetchEvent object to get a Response from an\r\n       * appropriate Route's handler.\r\n       *\r\n       * @param {Object} options\r\n       * @param {Request} options.request The request to handle.\r\n       * @param {ExtendableEvent} options.event The event that triggered the\r\n       *     request.\r\n       * @return {Promise<Response>|undefined} A promise is returned if a\r\n       *     registered route can handle the request. If there is no matching\r\n       *     route and there's no `defaultHandler`, `undefined` is returned.\r\n       */\r\n      handleRequest({\r\n        request,\r\n        event\r\n      }) {\r\n        {\r\n          finalAssertExports.isInstance(request, Request, {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'handleRequest',\r\n            paramName: 'options.request'\r\n          });\r\n        }\r\n        const url = new URL(request.url, location.href);\r\n        if (!url.protocol.startsWith('http')) {\r\n          {\r\n            logger.debug(`Workbox Router only supports URLs that start with 'http'.`);\r\n          }\r\n          return;\r\n        }\r\n        const sameOrigin = url.origin === location.origin;\r\n        const {\r\n          params,\r\n          route\r\n        } = this.findMatchingRoute({\r\n          event,\r\n          request,\r\n          sameOrigin,\r\n          url\r\n        });\r\n        let handler = route && route.handler;\r\n        const debugMessages = [];\r\n        {\r\n          if (handler) {\r\n            debugMessages.push([`Found a route to handle this request:`, route]);\r\n            if (params) {\r\n              debugMessages.push([`Passing the following params to the route's handler:`, params]);\r\n            }\r\n          }\r\n        }\r\n        // If we don't have a handler because there was no matching route, then\r\n        // fall back to defaultHandler if that's defined.\r\n        const method = request.method;\r\n        if (!handler && this._defaultHandlerMap.has(method)) {\r\n          {\r\n            debugMessages.push(`Failed to find a matching route. Falling ` + `back to the default handler for ${method}.`);\r\n          }\r\n          handler = this._defaultHandlerMap.get(method);\r\n        }\r\n        if (!handler) {\r\n          {\r\n            // No handler so Workbox will do nothing. If logs is set of debug\r\n            // i.e. verbose, we should print out this information.\r\n            logger.debug(`No route found for: ${getFriendlyURL(url)}`);\r\n          }\r\n          return;\r\n        }\r\n        {\r\n          // We have a handler, meaning Workbox is going to handle the route.\r\n          // print the routing details to the console.\r\n          logger.groupCollapsed(`Router is responding to: ${getFriendlyURL(url)}`);\r\n          debugMessages.forEach(msg => {\r\n            if (Array.isArray(msg)) {\r\n              logger.log(...msg);\r\n            } else {\r\n              logger.log(msg);\r\n            }\r\n          });\r\n          logger.groupEnd();\r\n        }\r\n        // Wrap in try and catch in case the handle method throws a synchronous\r\n        // error. It should still callback to the catch handler.\r\n        let responsePromise;\r\n        try {\r\n          responsePromise = handler.handle({\r\n            url,\r\n            request,\r\n            event,\r\n            params\r\n          });\r\n        } catch (err) {\r\n          responsePromise = Promise.reject(err);\r\n        }\r\n        // Get route's catch handler, if it exists\r\n        const catchHandler = route && route.catchHandler;\r\n        if (responsePromise instanceof Promise && (this._catchHandler || catchHandler)) {\r\n          responsePromise = responsePromise.catch(async err => {\r\n            // If there's a route catch handler, process that first\r\n            if (catchHandler) {\r\n              {\r\n                // Still include URL here as it will be async from the console group\r\n                // and may not make sense without the URL\r\n                logger.groupCollapsed(`Error thrown when responding to: ` + ` ${getFriendlyURL(url)}. Falling back to route's Catch Handler.`);\r\n                logger.error(`Error thrown by:`, route);\r\n                logger.error(err);\r\n                logger.groupEnd();\r\n              }\r\n              try {\r\n                return await catchHandler.handle({\r\n                  url,\r\n                  request,\r\n                  event,\r\n                  params\r\n                });\r\n              } catch (catchErr) {\r\n                if (catchErr instanceof Error) {\r\n                  err = catchErr;\r\n                }\r\n              }\r\n            }\r\n            if (this._catchHandler) {\r\n              {\r\n                // Still include URL here as it will be async from the console group\r\n                // and may not make sense without the URL\r\n                logger.groupCollapsed(`Error thrown when responding to: ` + ` ${getFriendlyURL(url)}. Falling back to global Catch Handler.`);\r\n                logger.error(`Error thrown by:`, route);\r\n                logger.error(err);\r\n                logger.groupEnd();\r\n              }\r\n              return this._catchHandler.handle({\r\n                url,\r\n                request,\r\n                event\r\n              });\r\n            }\r\n            throw err;\r\n          });\r\n        }\r\n        return responsePromise;\r\n      }\r\n      /**\r\n       * Checks a request and URL (and optionally an event) against the list of\r\n       * registered routes, and if there's a match, returns the corresponding\r\n       * route along with any params generated by the match.\r\n       *\r\n       * @param {Object} options\r\n       * @param {URL} options.url\r\n       * @param {boolean} options.sameOrigin The result of comparing `url.origin`\r\n       *     against the current origin.\r\n       * @param {Request} options.request The request to match.\r\n       * @param {Event} options.event The corresponding event.\r\n       * @return {Object} An object with `route` and `params` properties.\r\n       *     They are populated if a matching route was found or `undefined`\r\n       *     otherwise.\r\n       */\r\n      findMatchingRoute({\r\n        url,\r\n        sameOrigin,\r\n        request,\r\n        event\r\n      }) {\r\n        const routes = this._routes.get(request.method) || [];\r\n        for (const route of routes) {\r\n          let params;\r\n          // route.match returns type any, not possible to change right now.\r\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\r\n          const matchResult = route.match({\r\n            url,\r\n            sameOrigin,\r\n            request,\r\n            event\r\n          });\r\n          if (matchResult) {\r\n            {\r\n              // Warn developers that using an async matchCallback is almost always\r\n              // not the right thing to do.\r\n              if (matchResult instanceof Promise) {\r\n                logger.warn(`While routing ${getFriendlyURL(url)}, an async ` + `matchCallback function was used. Please convert the ` + `following route to use a synchronous matchCallback function:`, route);\r\n              }\r\n            }\r\n            // See https://github.com/GoogleChrome/workbox/issues/2079\r\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\r\n            params = matchResult;\r\n            if (Array.isArray(params) && params.length === 0) {\r\n              // Instead of passing an empty array in as params, use undefined.\r\n              params = undefined;\r\n            } else if (matchResult.constructor === Object &&\r\n             \r\n            Object.keys(matchResult).length === 0) {\r\n              // Instead of passing an empty object in as params, use undefined.\r\n              params = undefined;\r\n            } else if (typeof matchResult === 'boolean') {\r\n              // For the boolean value true (rather than just something truth-y),\r\n              // don't set params.\r\n              // See https://github.com/GoogleChrome/workbox/pull/2134#issuecomment-513924353\r\n              params = undefined;\r\n            }\r\n            // Return early if have a match.\r\n            return {\r\n              route,\r\n              params\r\n            };\r\n          }\r\n        }\r\n        // If no match was found above, return and empty object.\r\n        return {};\r\n      }\r\n      /**\r\n       * Define a default `handler` that's called when no routes explicitly\r\n       * match the incoming request.\r\n       *\r\n       * Each HTTP method ('GET', 'POST', etc.) gets its own default handler.\r\n       *\r\n       * Without a default handler, unmatched requests will go against the\r\n       * network as if there were no service worker present.\r\n       *\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resulting in a Response.\r\n       * @param {string} [method='GET'] The HTTP method to associate with this\r\n       * default handler. Each method has its own default.\r\n       */\r\n      setDefaultHandler(handler, method = defaultMethod) {\r\n        this._defaultHandlerMap.set(method, normalizeHandler(handler));\r\n      }\r\n      /**\r\n       * If a Route throws an error while handling a request, this `handler`\r\n       * will be called and given a chance to provide a response.\r\n       *\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resulting in a Response.\r\n       */\r\n      setCatchHandler(handler) {\r\n        this._catchHandler = normalizeHandler(handler);\r\n      }\r\n      /**\r\n       * Registers a route with the router.\r\n       *\r\n       * @param {workbox-routing.Route} route The route to register.\r\n       */\r\n      registerRoute(route) {\r\n        {\r\n          finalAssertExports.isType(route, 'object', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route'\r\n          });\r\n          finalAssertExports.hasMethod(route, 'match', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route'\r\n          });\r\n          finalAssertExports.isType(route.handler, 'object', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route'\r\n          });\r\n          finalAssertExports.hasMethod(route.handler, 'handle', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route.handler'\r\n          });\r\n          finalAssertExports.isType(route.method, 'string', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route.method'\r\n          });\r\n        }\r\n        if (!this._routes.has(route.method)) {\r\n          this._routes.set(route.method, []);\r\n        }\r\n        // Give precedence to all of the earlier routes by adding this additional\r\n        // route to the end of the array.\r\n        this._routes.get(route.method).push(route);\r\n      }\r\n      /**\r\n       * Unregisters a route with the router.\r\n       *\r\n       * @param {workbox-routing.Route} route The route to unregister.\r\n       */\r\n      unregisterRoute(route) {\r\n        if (!this._routes.has(route.method)) {\r\n          throw new WorkboxError('unregister-route-but-not-found-with-method', {\r\n            method: route.method\r\n          });\r\n        }\r\n        const routeIndex = this._routes.get(route.method).indexOf(route);\r\n        if (routeIndex > -1) {\r\n          this._routes.get(route.method).splice(routeIndex, 1);\r\n        } else {\r\n          throw new WorkboxError('unregister-route-route-not-registered');\r\n        }\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    let defaultRouter;\r\n    /**\r\n     * Creates a new, singleton Router instance if one does not exist. If one\r\n     * does already exist, that instance is returned.\r\n     *\r\n     * @private\r\n     * @return {Router}\r\n     */\r\n    const getOrCreateDefaultRouter = () => {\r\n      if (!defaultRouter) {\r\n        defaultRouter = new Router();\r\n        // The helpers that use the default Router assume these listeners exist.\r\n        defaultRouter.addFetchListener();\r\n        defaultRouter.addCacheListener();\r\n      }\r\n      return defaultRouter;\r\n    };\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Easily register a RegExp, string, or function with a caching\r\n     * strategy to a singleton Router instance.\r\n     *\r\n     * This method will generate a Route for you if needed and\r\n     * call {@link workbox-routing.Router#registerRoute}.\r\n     *\r\n     * @param {RegExp|string|workbox-routing.Route~matchCallback|workbox-routing.Route} capture\r\n     * If the capture param is a `Route`, all other arguments will be ignored.\r\n     * @param {workbox-routing~handlerCallback} [handler] A callback\r\n     * function that returns a Promise resulting in a Response. This parameter\r\n     * is required if `capture` is not a `Route` object.\r\n     * @param {string} [method='GET'] The HTTP method to match the Route\r\n     * against.\r\n     * @return {workbox-routing.Route} The generated `Route`.\r\n     *\r\n     * @memberof workbox-routing\r\n     */\r\n    function registerRoute(capture, handler, method) {\r\n      let route;\r\n      if (typeof capture === 'string') {\r\n        const captureUrl = new URL(capture, location.href);\r\n        {\r\n          if (!(capture.startsWith('/') || capture.startsWith('http'))) {\r\n            throw new WorkboxError('invalid-string', {\r\n              moduleName: 'workbox-routing',\r\n              funcName: 'registerRoute',\r\n              paramName: 'capture'\r\n            });\r\n          }\r\n          // We want to check if Express-style wildcards are in the pathname only.\r\n          // TODO: Remove this log message in v4.\r\n          const valueToCheck = capture.startsWith('http') ? captureUrl.pathname : capture;\r\n          // See https://github.com/pillarjs/path-to-regexp#parameters\r\n          const wildcards = '[*:?+]';\r\n          if (new RegExp(`${wildcards}`).exec(valueToCheck)) {\r\n            logger.debug(`The '$capture' parameter contains an Express-style wildcard ` + `character (${wildcards}). Strings are now always interpreted as ` + `exact matches; use a RegExp for partial or wildcard matches.`);\r\n          }\r\n        }\r\n        const matchCallback = ({\r\n          url\r\n        }) => {\r\n          {\r\n            if (url.pathname === captureUrl.pathname && url.origin !== captureUrl.origin) {\r\n              logger.debug(`${capture} only partially matches the cross-origin URL ` + `${url.toString()}. This route will only handle cross-origin requests ` + `if they match the entire URL.`);\r\n            }\r\n          }\r\n          return url.href === captureUrl.href;\r\n        };\r\n        // If `capture` is a string then `handler` and `method` must be present.\r\n        route = new Route(matchCallback, handler, method);\r\n      } else if (capture instanceof RegExp) {\r\n        // If `capture` is a `RegExp` then `handler` and `method` must be present.\r\n        route = new RegExpRoute(capture, handler, method);\r\n      } else if (typeof capture === 'function') {\r\n        // If `capture` is a function then `handler` and `method` must be present.\r\n        route = new Route(capture, handler, method);\r\n      } else if (capture instanceof Route) {\r\n        route = capture;\r\n      } else {\r\n        throw new WorkboxError('unsupported-route-type', {\r\n          moduleName: 'workbox-routing',\r\n          funcName: 'registerRoute',\r\n          paramName: 'capture'\r\n        });\r\n      }\r\n      const defaultRouter = getOrCreateDefaultRouter();\r\n      defaultRouter.registerRoute(route);\r\n      return route;\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const _cacheNameDetails = {\r\n      googleAnalytics: 'googleAnalytics',\r\n      precache: 'precache-v2',\r\n      prefix: 'workbox',\r\n      runtime: 'runtime',\r\n      suffix: typeof registration !== 'undefined' ? registration.scope : ''\r\n    };\r\n    const _createCacheName = cacheName => {\r\n      return [_cacheNameDetails.prefix, cacheName, _cacheNameDetails.suffix].filter(value => value && value.length > 0).join('-');\r\n    };\r\n    const eachCacheNameDetail = fn => {\r\n      for (const key of Object.keys(_cacheNameDetails)) {\r\n        fn(key);\r\n      }\r\n    };\r\n    const cacheNames = {\r\n      updateDetails: details => {\r\n        eachCacheNameDetail(key => {\r\n          if (typeof details[key] === 'string') {\r\n            _cacheNameDetails[key] = details[key];\r\n          }\r\n        });\r\n      },\r\n      getGoogleAnalyticsName: userCacheName => {\r\n        return userCacheName || _createCacheName(_cacheNameDetails.googleAnalytics);\r\n      },\r\n      getPrecacheName: userCacheName => {\r\n        return userCacheName || _createCacheName(_cacheNameDetails.precache);\r\n      },\r\n      getPrefix: () => {\r\n        return _cacheNameDetails.prefix;\r\n      },\r\n      getRuntimeName: userCacheName => {\r\n        return userCacheName || _createCacheName(_cacheNameDetails.runtime);\r\n      },\r\n      getSuffix: () => {\r\n        return _cacheNameDetails.suffix;\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A utility method that makes it easier to use `event.waitUntil` with\r\n     * async functions and return the result.\r\n     *\r\n     * @param {ExtendableEvent} event\r\n     * @param {Function} asyncFn\r\n     * @return {Function}\r\n     * @private\r\n     */\r\n    function waitUntil(event, asyncFn) {\r\n      const returnPromise = asyncFn();\r\n      event.waitUntil(returnPromise);\r\n      return returnPromise;\r\n    }\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:precaching:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    // Name of the search parameter used to store revision info.\r\n    const REVISION_SEARCH_PARAM = '__WB_REVISION__';\r\n    /**\r\n     * Converts a manifest entry into a versioned URL suitable for precaching.\r\n     *\r\n     * @param {Object|string} entry\r\n     * @return {string} A URL with versioning info.\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function createCacheKey(entry) {\r\n      if (!entry) {\r\n        throw new WorkboxError('add-to-cache-list-unexpected-type', {\r\n          entry\r\n        });\r\n      }\r\n      // If a precache manifest entry is a string, it's assumed to be a versioned\r\n      // URL, like '/app.abcd1234.js'. Return as-is.\r\n      if (typeof entry === 'string') {\r\n        const urlObject = new URL(entry, location.href);\r\n        return {\r\n          cacheKey: urlObject.href,\r\n          url: urlObject.href\r\n        };\r\n      }\r\n      const {\r\n        revision,\r\n        url\r\n      } = entry;\r\n      if (!url) {\r\n        throw new WorkboxError('add-to-cache-list-unexpected-type', {\r\n          entry\r\n        });\r\n      }\r\n      // If there's just a URL and no revision, then it's also assumed to be a\r\n      // versioned URL.\r\n      if (!revision) {\r\n        const urlObject = new URL(url, location.href);\r\n        return {\r\n          cacheKey: urlObject.href,\r\n          url: urlObject.href\r\n        };\r\n      }\r\n      // Otherwise, construct a properly versioned URL using the custom Workbox\r\n      // search parameter along with the revision info.\r\n      const cacheKeyURL = new URL(url, location.href);\r\n      const originalURL = new URL(url, location.href);\r\n      cacheKeyURL.searchParams.set(REVISION_SEARCH_PARAM, revision);\r\n      return {\r\n        cacheKey: cacheKeyURL.href,\r\n        url: originalURL.href\r\n      };\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A plugin, designed to be used with PrecacheController, to determine the\r\n     * of assets that were updated (or not updated) during the install event.\r\n     *\r\n     * @private\r\n     */\r\n    class PrecacheInstallReportPlugin {\r\n      constructor() {\r\n        this.updatedURLs = [];\r\n        this.notUpdatedURLs = [];\r\n        this.handlerWillStart = async ({\r\n          request,\r\n          state\r\n        }) => {\r\n          // TODO: `state` should never be undefined...\r\n          if (state) {\r\n            state.originalRequest = request;\r\n          }\r\n        };\r\n        this.cachedResponseWillBeUsed = async ({\r\n          event,\r\n          state,\r\n          cachedResponse\r\n        }) => {\r\n          if (event.type === 'install') {\r\n            if (state && state.originalRequest && state.originalRequest instanceof Request) {\r\n              // TODO: `state` should never be undefined...\r\n              const url = state.originalRequest.url;\r\n              if (cachedResponse) {\r\n                this.notUpdatedURLs.push(url);\r\n              } else {\r\n                this.updatedURLs.push(url);\r\n              }\r\n            }\r\n          }\r\n          return cachedResponse;\r\n        };\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A plugin, designed to be used with PrecacheController, to translate URLs into\r\n     * the corresponding cache key, based on the current revision info.\r\n     *\r\n     * @private\r\n     */\r\n    class PrecacheCacheKeyPlugin {\r\n      constructor({\r\n        precacheController\r\n      }) {\r\n        this.cacheKeyWillBeUsed = async ({\r\n          request,\r\n          params\r\n        }) => {\r\n          // Params is type any, can't change right now.\r\n           \r\n          const cacheKey = (params === null || params === void 0 ? void 0 : params.cacheKey) || this._precacheController.getCacheKeyForURL(request.url);\r\n           \r\n          return cacheKey ? new Request(cacheKey, {\r\n            headers: request.headers\r\n          }) : request;\r\n        };\r\n        this._precacheController = precacheController;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * @param {string} groupTitle\r\n     * @param {Array<string>} deletedURLs\r\n     *\r\n     * @private\r\n     */\r\n    const logGroup = (groupTitle, deletedURLs) => {\r\n      logger.groupCollapsed(groupTitle);\r\n      for (const url of deletedURLs) {\r\n        logger.log(url);\r\n      }\r\n      logger.groupEnd();\r\n    };\r\n    /**\r\n     * @param {Array<string>} deletedURLs\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function printCleanupDetails(deletedURLs) {\r\n      const deletionCount = deletedURLs.length;\r\n      if (deletionCount > 0) {\r\n        logger.groupCollapsed(`During precaching cleanup, ` + `${deletionCount} cached ` + `request${deletionCount === 1 ? ' was' : 's were'} deleted.`);\r\n        logGroup('Deleted Cache Requests', deletedURLs);\r\n        logger.groupEnd();\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * @param {string} groupTitle\r\n     * @param {Array<string>} urls\r\n     *\r\n     * @private\r\n     */\r\n    function _nestedGroup(groupTitle, urls) {\r\n      if (urls.length === 0) {\r\n        return;\r\n      }\r\n      logger.groupCollapsed(groupTitle);\r\n      for (const url of urls) {\r\n        logger.log(url);\r\n      }\r\n      logger.groupEnd();\r\n    }\r\n    /**\r\n     * @param {Array<string>} urlsToPrecache\r\n     * @param {Array<string>} urlsAlreadyPrecached\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function printInstallDetails(urlsToPrecache, urlsAlreadyPrecached) {\r\n      const precachedCount = urlsToPrecache.length;\r\n      const alreadyPrecachedCount = urlsAlreadyPrecached.length;\r\n      if (precachedCount || alreadyPrecachedCount) {\r\n        let message = `Precaching ${precachedCount} file${precachedCount === 1 ? '' : 's'}.`;\r\n        if (alreadyPrecachedCount > 0) {\r\n          message += ` ${alreadyPrecachedCount} ` + `file${alreadyPrecachedCount === 1 ? ' is' : 's are'} already cached.`;\r\n        }\r\n        logger.groupCollapsed(message);\r\n        _nestedGroup(`View newly precached URLs.`, urlsToPrecache);\r\n        _nestedGroup(`View previously precached URLs.`, urlsAlreadyPrecached);\r\n        logger.groupEnd();\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    let supportStatus;\r\n    /**\r\n     * A utility function that determines whether the current browser supports\r\n     * constructing a new `Response` from a `response.body` stream.\r\n     *\r\n     * @return {boolean} `true`, if the current browser can successfully\r\n     *     construct a `Response` from a `response.body` stream, `false` otherwise.\r\n     *\r\n     * @private\r\n     */\r\n    function canConstructResponseFromBodyStream() {\r\n      if (supportStatus === undefined) {\r\n        const testResponse = new Response('');\r\n        if ('body' in testResponse) {\r\n          try {\r\n            new Response(testResponse.body);\r\n            supportStatus = true;\r\n          } catch (error) {\r\n            supportStatus = false;\r\n          }\r\n        }\r\n        supportStatus = false;\r\n      }\r\n      return supportStatus;\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Allows developers to copy a response and modify its `headers`, `status`,\r\n     * or `statusText` values (the values settable via a\r\n     * [`ResponseInit`]{@link https://developer.mozilla.org/en-US/docs/Web/API/Response/Response#Syntax}\r\n     * object in the constructor).\r\n     * To modify these values, pass a function as the second argument. That\r\n     * function will be invoked with a single object with the response properties\r\n     * `{headers, status, statusText}`. The return value of this function will\r\n     * be used as the `ResponseInit` for the new `Response`. To change the values\r\n     * either modify the passed parameter(s) and return it, or return a totally\r\n     * new object.\r\n     *\r\n     * This method is intentionally limited to same-origin responses, regardless of\r\n     * whether CORS was used or not.\r\n     *\r\n     * @param {Response} response\r\n     * @param {Function} modifier\r\n     * @memberof workbox-core\r\n     */\r\n    async function copyResponse(response, modifier) {\r\n      let origin = null;\r\n      // If response.url isn't set, assume it's cross-origin and keep origin null.\r\n      if (response.url) {\r\n        const responseURL = new URL(response.url);\r\n        origin = responseURL.origin;\r\n      }\r\n      if (origin !== self.location.origin) {\r\n        throw new WorkboxError('cross-origin-copy-response', {\r\n          origin\r\n        });\r\n      }\r\n      const clonedResponse = response.clone();\r\n      // Create a fresh `ResponseInit` object by cloning the headers.\r\n      const responseInit = {\r\n        headers: new Headers(clonedResponse.headers),\r\n        status: clonedResponse.status,\r\n        statusText: clonedResponse.statusText\r\n      };\r\n      // Apply any user modifications.\r\n      const modifiedResponseInit = modifier ? modifier(responseInit) : responseInit;\r\n      // Create the new response from the body stream and `ResponseInit`\r\n      // modifications. Note: not all browsers support the Response.body stream,\r\n      // so fall back to reading the entire body into memory as a blob.\r\n      const body = canConstructResponseFromBodyStream() ? clonedResponse.body : await clonedResponse.blob();\r\n      return new Response(body, modifiedResponseInit);\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    function stripParams(fullURL, ignoreParams) {\r\n      const strippedURL = new URL(fullURL);\r\n      for (const param of ignoreParams) {\r\n        strippedURL.searchParams.delete(param);\r\n      }\r\n      return strippedURL.href;\r\n    }\r\n    /**\r\n     * Matches an item in the cache, ignoring specific URL params. This is similar\r\n     * to the `ignoreSearch` option, but it allows you to ignore just specific\r\n     * params (while continuing to match on the others).\r\n     *\r\n     * @private\r\n     * @param {Cache} cache\r\n     * @param {Request} request\r\n     * @param {Object} matchOptions\r\n     * @param {Array<string>} ignoreParams\r\n     * @return {Promise<Response|undefined>}\r\n     */\r\n    async function cacheMatchIgnoreParams(cache, request, ignoreParams, matchOptions) {\r\n      const strippedRequestURL = stripParams(request.url, ignoreParams);\r\n      // If the request doesn't include any ignored params, match as normal.\r\n      if (request.url === strippedRequestURL) {\r\n        return cache.match(request, matchOptions);\r\n      }\r\n      // Otherwise, match by comparing keys\r\n      const keysOptions = Object.assign(Object.assign({}, matchOptions), {\r\n        ignoreSearch: true\r\n      });\r\n      const cacheKeys = await cache.keys(request, keysOptions);\r\n      for (const cacheKey of cacheKeys) {\r\n        const strippedCacheKeyURL = stripParams(cacheKey.url, ignoreParams);\r\n        if (strippedRequestURL === strippedCacheKeyURL) {\r\n          return cache.match(cacheKey, matchOptions);\r\n        }\r\n      }\r\n      return;\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * The Deferred class composes Promises in a way that allows for them to be\r\n     * resolved or rejected from outside the constructor. In most cases promises\r\n     * should be used directly, but Deferreds can be necessary when the logic to\r\n     * resolve a promise must be separate.\r\n     *\r\n     * @private\r\n     */\r\n    class Deferred {\r\n      /**\r\n       * Creates a promise and exposes its resolve and reject functions as methods.\r\n       */\r\n      constructor() {\r\n        this.promise = new Promise((resolve, reject) => {\r\n          this.resolve = resolve;\r\n          this.reject = reject;\r\n        });\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    // Callbacks to be executed whenever there's a quota error.\r\n    // Can't change Function type right now.\r\n    // eslint-disable-next-line @typescript-eslint/ban-types\r\n    const quotaErrorCallbacks = new Set();\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Runs all of the callback functions, one at a time sequentially, in the order\r\n     * in which they were registered.\r\n     *\r\n     * @memberof workbox-core\r\n     * @private\r\n     */\r\n    async function executeQuotaErrorCallbacks() {\r\n      {\r\n        logger.log(`About to run ${quotaErrorCallbacks.size} ` + `callbacks to clean up caches.`);\r\n      }\r\n      for (const callback of quotaErrorCallbacks) {\r\n        await callback();\r\n        {\r\n          logger.log(callback, 'is complete.');\r\n        }\r\n      }\r\n      {\r\n        logger.log('Finished running callbacks.');\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Returns a promise that resolves and the passed number of milliseconds.\r\n     * This utility is an async/await-friendly version of `setTimeout`.\r\n     *\r\n     * @param {number} ms\r\n     * @return {Promise}\r\n     * @private\r\n     */\r\n    function timeout(ms) {\r\n      return new Promise(resolve => setTimeout(resolve, ms));\r\n    }\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:strategies:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    function toRequest(input) {\r\n      return typeof input === 'string' ? new Request(input) : input;\r\n    }\r\n    /**\r\n     * A class created every time a Strategy instance calls\r\n     * {@link workbox-strategies.Strategy~handle} or\r\n     * {@link workbox-strategies.Strategy~handleAll} that wraps all fetch and\r\n     * cache actions around plugin callbacks and keeps track of when the strategy\r\n     * is \"done\" (i.e. all added `event.waitUntil()` promises have resolved).\r\n     *\r\n     * @memberof workbox-strategies\r\n     */\r\n    class StrategyHandler {\r\n      /**\r\n       * Creates a new instance associated with the passed strategy and event\r\n       * that's handling the request.\r\n       *\r\n       * The constructor also initializes the state that will be passed to each of\r\n       * the plugins handling this request.\r\n       *\r\n       * @param {workbox-strategies.Strategy} strategy\r\n       * @param {Object} options\r\n       * @param {Request|string} options.request A request to run this strategy for.\r\n       * @param {ExtendableEvent} options.event The event associated with the\r\n       *     request.\r\n       * @param {URL} [options.url]\r\n       * @param {*} [options.params] The return value from the\r\n       *     {@link workbox-routing~matchCallback} (if applicable).\r\n       */\r\n      constructor(strategy, options) {\r\n        this._cacheKeys = {};\r\n        /**\r\n         * The request the strategy is performing (passed to the strategy's\r\n         * `handle()` or `handleAll()` method).\r\n         * @name request\r\n         * @instance\r\n         * @type {Request}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        /**\r\n         * The event associated with this request.\r\n         * @name event\r\n         * @instance\r\n         * @type {ExtendableEvent}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        /**\r\n         * A `URL` instance of `request.url` (if passed to the strategy's\r\n         * `handle()` or `handleAll()` method).\r\n         * Note: the `url` param will be present if the strategy was invoked\r\n         * from a workbox `Route` object.\r\n         * @name url\r\n         * @instance\r\n         * @type {URL|undefined}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        /**\r\n         * A `param` value (if passed to the strategy's\r\n         * `handle()` or `handleAll()` method).\r\n         * Note: the `param` param will be present if the strategy was invoked\r\n         * from a workbox `Route` object and the\r\n         * {@link workbox-routing~matchCallback} returned\r\n         * a truthy value (it will be that value).\r\n         * @name params\r\n         * @instance\r\n         * @type {*|undefined}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        {\r\n          finalAssertExports.isInstance(options.event, ExtendableEvent, {\r\n            moduleName: 'workbox-strategies',\r\n            className: 'StrategyHandler',\r\n            funcName: 'constructor',\r\n            paramName: 'options.event'\r\n          });\r\n        }\r\n        Object.assign(this, options);\r\n        this.event = options.event;\r\n        this._strategy = strategy;\r\n        this._handlerDeferred = new Deferred();\r\n        this._extendLifetimePromises = [];\r\n        // Copy the plugins list (since it's mutable on the strategy),\r\n        // so any mutations don't affect this handler instance.\r\n        this._plugins = [...strategy.plugins];\r\n        this._pluginStateMap = new Map();\r\n        for (const plugin of this._plugins) {\r\n          this._pluginStateMap.set(plugin, {});\r\n        }\r\n        this.event.waitUntil(this._handlerDeferred.promise);\r\n      }\r\n      /**\r\n       * Fetches a given request (and invokes any applicable plugin callback\r\n       * methods) using the `fetchOptions` (for non-navigation requests) and\r\n       * `plugins` defined on the `Strategy` object.\r\n       *\r\n       * The following plugin lifecycle methods are invoked when using this method:\r\n       * - `requestWillFetch()`\r\n       * - `fetchDidSucceed()`\r\n       * - `fetchDidFail()`\r\n       *\r\n       * @param {Request|string} input The URL or request to fetch.\r\n       * @return {Promise<Response>}\r\n       */\r\n      async fetch(input) {\r\n        const {\r\n          event\r\n        } = this;\r\n        let request = toRequest(input);\r\n        if (request.mode === 'navigate' && event instanceof FetchEvent && event.preloadResponse) {\r\n          const possiblePreloadResponse = await event.preloadResponse;\r\n          if (possiblePreloadResponse) {\r\n            {\r\n              logger.log(`Using a preloaded navigation response for ` + `'${getFriendlyURL(request.url)}'`);\r\n            }\r\n            return possiblePreloadResponse;\r\n          }\r\n        }\r\n        // If there is a fetchDidFail plugin, we need to save a clone of the\r\n        // original request before it's either modified by a requestWillFetch\r\n        // plugin or before the original request's body is consumed via fetch().\r\n        const originalRequest = this.hasCallback('fetchDidFail') ? request.clone() : null;\r\n        try {\r\n          for (const cb of this.iterateCallbacks('requestWillFetch')) {\r\n            request = await cb({\r\n              request: request.clone(),\r\n              event\r\n            });\r\n          }\r\n        } catch (err) {\r\n          if (err instanceof Error) {\r\n            throw new WorkboxError('plugin-error-request-will-fetch', {\r\n              thrownErrorMessage: err.message\r\n            });\r\n          }\r\n        }\r\n        // The request can be altered by plugins with `requestWillFetch` making\r\n        // the original request (most likely from a `fetch` event) different\r\n        // from the Request we make. Pass both to `fetchDidFail` to aid debugging.\r\n        const pluginFilteredRequest = request.clone();\r\n        try {\r\n          let fetchResponse;\r\n          // See https://github.com/GoogleChrome/workbox/issues/1796\r\n          fetchResponse = await fetch(request, request.mode === 'navigate' ? undefined : this._strategy.fetchOptions);\r\n          if (\"development\" !== 'production') {\r\n            logger.debug(`Network request for ` + `'${getFriendlyURL(request.url)}' returned a response with ` + `status '${fetchResponse.status}'.`);\r\n          }\r\n          for (const callback of this.iterateCallbacks('fetchDidSucceed')) {\r\n            fetchResponse = await callback({\r\n              event,\r\n              request: pluginFilteredRequest,\r\n              response: fetchResponse\r\n            });\r\n          }\r\n          return fetchResponse;\r\n        } catch (error) {\r\n          {\r\n            logger.log(`Network request for ` + `'${getFriendlyURL(request.url)}' threw an error.`, error);\r\n          }\r\n          // `originalRequest` will only exist if a `fetchDidFail` callback\r\n          // is being used (see above).\r\n          if (originalRequest) {\r\n            await this.runCallbacks('fetchDidFail', {\r\n              error: error,\r\n              event,\r\n              originalRequest: originalRequest.clone(),\r\n              request: pluginFilteredRequest.clone()\r\n            });\r\n          }\r\n          throw error;\r\n        }\r\n      }\r\n      /**\r\n       * Calls `this.fetch()` and (in the background) runs `this.cachePut()` on\r\n       * the response generated by `this.fetch()`.\r\n       *\r\n       * The call to `this.cachePut()` automatically invokes `this.waitUntil()`,\r\n       * so you do not have to manually call `waitUntil()` on the event.\r\n       *\r\n       * @param {Request|string} input The request or URL to fetch and cache.\r\n       * @return {Promise<Response>}\r\n       */\r\n      async fetchAndCachePut(input) {\r\n        const response = await this.fetch(input);\r\n        const responseClone = response.clone();\r\n        void this.waitUntil(this.cachePut(input, responseClone));\r\n        return response;\r\n      }\r\n      /**\r\n       * Matches a request from the cache (and invokes any applicable plugin\r\n       * callback methods) using the `cacheName`, `matchOptions`, and `plugins`\r\n       * defined on the strategy object.\r\n       *\r\n       * The following plugin lifecycle methods are invoked when using this method:\r\n       * - cacheKeyWillBeUsed()\r\n       * - cachedResponseWillBeUsed()\r\n       *\r\n       * @param {Request|string} key The Request or URL to use as the cache key.\r\n       * @return {Promise<Response|undefined>} A matching response, if found.\r\n       */\r\n      async cacheMatch(key) {\r\n        const request = toRequest(key);\r\n        let cachedResponse;\r\n        const {\r\n          cacheName,\r\n          matchOptions\r\n        } = this._strategy;\r\n        const effectiveRequest = await this.getCacheKey(request, 'read');\r\n        const multiMatchOptions = Object.assign(Object.assign({}, matchOptions), {\r\n          cacheName\r\n        });\r\n        cachedResponse = await caches.match(effectiveRequest, multiMatchOptions);\r\n        {\r\n          if (cachedResponse) {\r\n            logger.debug(`Found a cached response in '${cacheName}'.`);\r\n          } else {\r\n            logger.debug(`No cached response found in '${cacheName}'.`);\r\n          }\r\n        }\r\n        for (const callback of this.iterateCallbacks('cachedResponseWillBeUsed')) {\r\n          cachedResponse = (await callback({\r\n            cacheName,\r\n            matchOptions,\r\n            cachedResponse,\r\n            request: effectiveRequest,\r\n            event: this.event\r\n          })) || undefined;\r\n        }\r\n        return cachedResponse;\r\n      }\r\n      /**\r\n       * Puts a request/response pair in the cache (and invokes any applicable\r\n       * plugin callback methods) using the `cacheName` and `plugins` defined on\r\n       * the strategy object.\r\n       *\r\n       * The following plugin lifecycle methods are invoked when using this method:\r\n       * - cacheKeyWillBeUsed()\r\n       * - cacheWillUpdate()\r\n       * - cacheDidUpdate()\r\n       *\r\n       * @param {Request|string} key The request or URL to use as the cache key.\r\n       * @param {Response} response The response to cache.\r\n       * @return {Promise<boolean>} `false` if a cacheWillUpdate caused the response\r\n       * not be cached, and `true` otherwise.\r\n       */\r\n      async cachePut(key, response) {\r\n        const request = toRequest(key);\r\n        // Run in the next task to avoid blocking other cache reads.\r\n        // https://github.com/w3c/ServiceWorker/issues/1397\r\n        await timeout(0);\r\n        const effectiveRequest = await this.getCacheKey(request, 'write');\r\n        {\r\n          if (effectiveRequest.method && effectiveRequest.method !== 'GET') {\r\n            throw new WorkboxError('attempt-to-cache-non-get-request', {\r\n              url: getFriendlyURL(effectiveRequest.url),\r\n              method: effectiveRequest.method\r\n            });\r\n          }\r\n          // See https://github.com/GoogleChrome/workbox/issues/2818\r\n          const vary = response.headers.get('Vary');\r\n          if (vary) {\r\n            logger.debug(`The response for ${getFriendlyURL(effectiveRequest.url)} ` + `has a 'Vary: ${vary}' header. ` + `Consider setting the {ignoreVary: true} option on your strategy ` + `to ensure cache matching and deletion works as expected.`);\r\n          }\r\n        }\r\n        if (!response) {\r\n          {\r\n            logger.error(`Cannot cache non-existent response for ` + `'${getFriendlyURL(effectiveRequest.url)}'.`);\r\n          }\r\n          throw new WorkboxError('cache-put-with-no-response', {\r\n            url: getFriendlyURL(effectiveRequest.url)\r\n          });\r\n        }\r\n        const responseToCache = await this._ensureResponseSafeToCache(response);\r\n        if (!responseToCache) {\r\n          {\r\n            logger.debug(`Response '${getFriendlyURL(effectiveRequest.url)}' ` + `will not be cached.`, responseToCache);\r\n          }\r\n          return false;\r\n        }\r\n        const {\r\n          cacheName,\r\n          matchOptions\r\n        } = this._strategy;\r\n        const cache = await self.caches.open(cacheName);\r\n        const hasCacheUpdateCallback = this.hasCallback('cacheDidUpdate');\r\n        const oldResponse = hasCacheUpdateCallback ? await cacheMatchIgnoreParams(\r\n        // TODO(philipwalton): the `__WB_REVISION__` param is a precaching\r\n        // feature. Consider into ways to only add this behavior if using\r\n        // precaching.\r\n        cache, effectiveRequest.clone(), ['__WB_REVISION__'], matchOptions) : null;\r\n        {\r\n          logger.debug(`Updating the '${cacheName}' cache with a new Response ` + `for ${getFriendlyURL(effectiveRequest.url)}.`);\r\n        }\r\n        try {\r\n          await cache.put(effectiveRequest, hasCacheUpdateCallback ? responseToCache.clone() : responseToCache);\r\n        } catch (error) {\r\n          if (error instanceof Error) {\r\n            // See https://developer.mozilla.org/en-US/docs/Web/API/DOMException#exception-QuotaExceededError\r\n            if (error.name === 'QuotaExceededError') {\r\n              await executeQuotaErrorCallbacks();\r\n            }\r\n            throw error;\r\n          }\r\n        }\r\n        for (const callback of this.iterateCallbacks('cacheDidUpdate')) {\r\n          await callback({\r\n            cacheName,\r\n            oldResponse,\r\n            newResponse: responseToCache.clone(),\r\n            request: effectiveRequest,\r\n            event: this.event\r\n          });\r\n        }\r\n        return true;\r\n      }\r\n      /**\r\n       * Checks the list of plugins for the `cacheKeyWillBeUsed` callback, and\r\n       * executes any of those callbacks found in sequence. The final `Request`\r\n       * object returned by the last plugin is treated as the cache key for cache\r\n       * reads and/or writes. If no `cacheKeyWillBeUsed` plugin callbacks have\r\n       * been registered, the passed request is returned unmodified\r\n       *\r\n       * @param {Request} request\r\n       * @param {string} mode\r\n       * @return {Promise<Request>}\r\n       */\r\n      async getCacheKey(request, mode) {\r\n        const key = `${request.url} | ${mode}`;\r\n        if (!this._cacheKeys[key]) {\r\n          let effectiveRequest = request;\r\n          for (const callback of this.iterateCallbacks('cacheKeyWillBeUsed')) {\r\n            effectiveRequest = toRequest(await callback({\r\n              mode,\r\n              request: effectiveRequest,\r\n              event: this.event,\r\n              // params has a type any can't change right now.\r\n              params: this.params  \r\n            }));\r\n          }\r\n          this._cacheKeys[key] = effectiveRequest;\r\n        }\r\n        return this._cacheKeys[key];\r\n      }\r\n      /**\r\n       * Returns true if the strategy has at least one plugin with the given\r\n       * callback.\r\n       *\r\n       * @param {string} name The name of the callback to check for.\r\n       * @return {boolean}\r\n       */\r\n      hasCallback(name) {\r\n        for (const plugin of this._strategy.plugins) {\r\n          if (name in plugin) {\r\n            return true;\r\n          }\r\n        }\r\n        return false;\r\n      }\r\n      /**\r\n       * Runs all plugin callbacks matching the given name, in order, passing the\r\n       * given param object (merged ith the current plugin state) as the only\r\n       * argument.\r\n       *\r\n       * Note: since this method runs all plugins, it's not suitable for cases\r\n       * where the return value of a callback needs to be applied prior to calling\r\n       * the next callback. See\r\n       * {@link workbox-strategies.StrategyHandler#iterateCallbacks}\r\n       * below for how to handle that case.\r\n       *\r\n       * @param {string} name The name of the callback to run within each plugin.\r\n       * @param {Object} param The object to pass as the first (and only) param\r\n       *     when executing each callback. This object will be merged with the\r\n       *     current plugin state prior to callback execution.\r\n       */\r\n      async runCallbacks(name, param) {\r\n        for (const callback of this.iterateCallbacks(name)) {\r\n          // TODO(philipwalton): not sure why `any` is needed. It seems like\r\n          // this should work with `as WorkboxPluginCallbackParam[C]`.\r\n          await callback(param);\r\n        }\r\n      }\r\n      /**\r\n       * Accepts a callback and returns an iterable of matching plugin callbacks,\r\n       * where each callback is wrapped with the current handler state (i.e. when\r\n       * you call each callback, whatever object parameter you pass it will\r\n       * be merged with the plugin's current state).\r\n       *\r\n       * @param {string} name The name fo the callback to run\r\n       * @return {Array<Function>}\r\n       */\r\n      *iterateCallbacks(name) {\r\n        for (const plugin of this._strategy.plugins) {\r\n          if (typeof plugin[name] === 'function') {\r\n            const state = this._pluginStateMap.get(plugin);\r\n            const statefulCallback = param => {\r\n              const statefulParam = Object.assign(Object.assign({}, param), {\r\n                state\r\n              });\r\n              // TODO(philipwalton): not sure why `any` is needed. It seems like\r\n              // this should work with `as WorkboxPluginCallbackParam[C]`.\r\n              return plugin[name](statefulParam);\r\n            };\r\n            yield statefulCallback;\r\n          }\r\n        }\r\n      }\r\n      /**\r\n       * Adds a promise to the\r\n       * [extend lifetime promises]{@link https://w3c.github.io/ServiceWorker/#extendableevent-extend-lifetime-promises}\r\n       * of the event associated with the request being handled (usually a\r\n       * `FetchEvent`).\r\n       *\r\n       * Note: you can await\r\n       * {@link workbox-strategies.StrategyHandler~doneWaiting}\r\n       * to know when all added promises have settled.\r\n       *\r\n       * @param {Promise} promise A promise to add to the extend lifetime promises\r\n       *     of the event that triggered the request.\r\n       */\r\n      waitUntil(promise) {\r\n        this._extendLifetimePromises.push(promise);\r\n        return promise;\r\n      }\r\n      /**\r\n       * Returns a promise that resolves once all promises passed to\r\n       * {@link workbox-strategies.StrategyHandler~waitUntil}\r\n       * have settled.\r\n       *\r\n       * Note: any work done after `doneWaiting()` settles should be manually\r\n       * passed to an event's `waitUntil()` method (not this handler's\r\n       * `waitUntil()` method), otherwise the service worker thread may be killed\r\n       * prior to your work completing.\r\n       */\r\n      async doneWaiting() {\r\n        while (this._extendLifetimePromises.length) {\r\n          const promises = this._extendLifetimePromises.splice(0);\r\n          const result = await Promise.allSettled(promises);\r\n          const firstRejection = result.find(i => i.status === 'rejected');\r\n          if (firstRejection) {\r\n            throw firstRejection.reason;\r\n          }\r\n        }\r\n      }\r\n      /**\r\n       * Stops running the strategy and immediately resolves any pending\r\n       * `waitUntil()` promises.\r\n       */\r\n      destroy() {\r\n        this._handlerDeferred.resolve(null);\r\n      }\r\n      /**\r\n       * This method will call cacheWillUpdate on the available plugins (or use\r\n       * status === 200) to determine if the Response is safe and valid to cache.\r\n       *\r\n       * @param {Request} options.request\r\n       * @param {Response} options.response\r\n       * @return {Promise<Response|undefined>}\r\n       *\r\n       * @private\r\n       */\r\n      async _ensureResponseSafeToCache(response) {\r\n        let responseToCache = response;\r\n        let pluginsUsed = false;\r\n        for (const callback of this.iterateCallbacks('cacheWillUpdate')) {\r\n          responseToCache = (await callback({\r\n            request: this.request,\r\n            response: responseToCache,\r\n            event: this.event\r\n          })) || undefined;\r\n          pluginsUsed = true;\r\n          if (!responseToCache) {\r\n            break;\r\n          }\r\n        }\r\n        if (!pluginsUsed) {\r\n          if (responseToCache && responseToCache.status !== 200) {\r\n            responseToCache = undefined;\r\n          }\r\n          {\r\n            if (responseToCache) {\r\n              if (responseToCache.status !== 200) {\r\n                if (responseToCache.status === 0) {\r\n                  logger.warn(`The response for '${this.request.url}' ` + `is an opaque response. The caching strategy that you're ` + `using will not cache opaque responses by default.`);\r\n                } else {\r\n                  logger.debug(`The response for '${this.request.url}' ` + `returned a status code of '${response.status}' and won't ` + `be cached as a result.`);\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n        return responseToCache;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * An abstract base class that all other strategy classes must extend from:\r\n     *\r\n     * @memberof workbox-strategies\r\n     */\r\n    class Strategy {\r\n      /**\r\n       * Creates a new instance of the strategy and sets all documented option\r\n       * properties as public instance properties.\r\n       *\r\n       * Note: if a custom strategy class extends the base Strategy class and does\r\n       * not need more than these properties, it does not need to define its own\r\n       * constructor.\r\n       *\r\n       * @param {Object} [options]\r\n       * @param {string} [options.cacheName] Cache name to store and retrieve\r\n       * requests. Defaults to the cache names provided by\r\n       * {@link workbox-core.cacheNames}.\r\n       * @param {Array<Object>} [options.plugins] [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\r\n       * to use in conjunction with this caching strategy.\r\n       * @param {Object} [options.fetchOptions] Values passed along to the\r\n       * [`init`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters)\r\n       * of [non-navigation](https://github.com/GoogleChrome/workbox/issues/1796)\r\n       * `fetch()` requests made by this strategy.\r\n       * @param {Object} [options.matchOptions] The\r\n       * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}\r\n       * for any `cache.match()` or `cache.put()` calls made by this strategy.\r\n       */\r\n      constructor(options = {}) {\r\n        /**\r\n         * Cache name to store and retrieve\r\n         * requests. Defaults to the cache names provided by\r\n         * {@link workbox-core.cacheNames}.\r\n         *\r\n         * @type {string}\r\n         */\r\n        this.cacheName = cacheNames.getRuntimeName(options.cacheName);\r\n        /**\r\n         * The list\r\n         * [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\r\n         * used by this strategy.\r\n         *\r\n         * @type {Array<Object>}\r\n         */\r\n        this.plugins = options.plugins || [];\r\n        /**\r\n         * Values passed along to the\r\n         * [`init`]{@link https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters}\r\n         * of all fetch() requests made by this strategy.\r\n         *\r\n         * @type {Object}\r\n         */\r\n        this.fetchOptions = options.fetchOptions;\r\n        /**\r\n         * The\r\n         * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}\r\n         * for any `cache.match()` or `cache.put()` calls made by this strategy.\r\n         *\r\n         * @type {Object}\r\n         */\r\n        this.matchOptions = options.matchOptions;\r\n      }\r\n      /**\r\n       * Perform a request strategy and returns a `Promise` that will resolve with\r\n       * a `Response`, invoking all relevant plugin callbacks.\r\n       *\r\n       * When a strategy instance is registered with a Workbox\r\n       * {@link workbox-routing.Route}, this method is automatically\r\n       * called when the route matches.\r\n       *\r\n       * Alternatively, this method can be used in a standalone `FetchEvent`\r\n       * listener by passing it to `event.respondWith()`.\r\n       *\r\n       * @param {FetchEvent|Object} options A `FetchEvent` or an object with the\r\n       *     properties listed below.\r\n       * @param {Request|string} options.request A request to run this strategy for.\r\n       * @param {ExtendableEvent} options.event The event associated with the\r\n       *     request.\r\n       * @param {URL} [options.url]\r\n       * @param {*} [options.params]\r\n       */\r\n      handle(options) {\r\n        const [responseDone] = this.handleAll(options);\r\n        return responseDone;\r\n      }\r\n      /**\r\n       * Similar to {@link workbox-strategies.Strategy~handle}, but\r\n       * instead of just returning a `Promise` that resolves to a `Response` it\r\n       * it will return an tuple of `[response, done]` promises, where the former\r\n       * (`response`) is equivalent to what `handle()` returns, and the latter is a\r\n       * Promise that will resolve once any promises that were added to\r\n       * `event.waitUntil()` as part of performing the strategy have completed.\r\n       *\r\n       * You can await the `done` promise to ensure any extra work performed by\r\n       * the strategy (usually caching responses) completes successfully.\r\n       *\r\n       * @param {FetchEvent|Object} options A `FetchEvent` or an object with the\r\n       *     properties listed below.\r\n       * @param {Request|string} options.request A request to run this strategy for.\r\n       * @param {ExtendableEvent} options.event The event associated with the\r\n       *     request.\r\n       * @param {URL} [options.url]\r\n       * @param {*} [options.params]\r\n       * @return {Array<Promise>} A tuple of [response, done]\r\n       *     promises that can be used to determine when the response resolves as\r\n       *     well as when the handler has completed all its work.\r\n       */\r\n      handleAll(options) {\r\n        // Allow for flexible options to be passed.\r\n        if (options instanceof FetchEvent) {\r\n          options = {\r\n            event: options,\r\n            request: options.request\r\n          };\r\n        }\r\n        const event = options.event;\r\n        const request = typeof options.request === 'string' ? new Request(options.request) : options.request;\r\n        const params = 'params' in options ? options.params : undefined;\r\n        const handler = new StrategyHandler(this, {\r\n          event,\r\n          request,\r\n          params\r\n        });\r\n        const responseDone = this._getResponse(handler, request, event);\r\n        const handlerDone = this._awaitComplete(responseDone, handler, request, event);\r\n        // Return an array of promises, suitable for use with Promise.all().\r\n        return [responseDone, handlerDone];\r\n      }\r\n      async _getResponse(handler, request, event) {\r\n        await handler.runCallbacks('handlerWillStart', {\r\n          event,\r\n          request\r\n        });\r\n        let response = undefined;\r\n        try {\r\n          response = await this._handle(request, handler);\r\n          // The \"official\" Strategy subclasses all throw this error automatically,\r\n          // but in case a third-party Strategy doesn't, ensure that we have a\r\n          // consistent failure when there's no response or an error response.\r\n          if (!response || response.type === 'error') {\r\n            throw new WorkboxError('no-response', {\r\n              url: request.url\r\n            });\r\n          }\r\n        } catch (error) {\r\n          if (error instanceof Error) {\r\n            for (const callback of handler.iterateCallbacks('handlerDidError')) {\r\n              response = await callback({\r\n                error,\r\n                event,\r\n                request\r\n              });\r\n              if (response) {\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          if (!response) {\r\n            throw error;\r\n          } else {\r\n            logger.log(`While responding to '${getFriendlyURL(request.url)}', ` + `an ${error instanceof Error ? error.toString() : ''} error occurred. Using a fallback response provided by ` + `a handlerDidError plugin.`);\r\n          }\r\n        }\r\n        for (const callback of handler.iterateCallbacks('handlerWillRespond')) {\r\n          response = await callback({\r\n            event,\r\n            request,\r\n            response\r\n          });\r\n        }\r\n        return response;\r\n      }\r\n      async _awaitComplete(responseDone, handler, request, event) {\r\n        let response;\r\n        let error;\r\n        try {\r\n          response = await responseDone;\r\n        } catch (error) {\r\n          // Ignore errors, as response errors should be caught via the `response`\r\n          // promise above. The `done` promise will only throw for errors in\r\n          // promises passed to `handler.waitUntil()`.\r\n        }\r\n        try {\r\n          await handler.runCallbacks('handlerDidRespond', {\r\n            event,\r\n            request,\r\n            response\r\n          });\r\n          await handler.doneWaiting();\r\n        } catch (waitUntilError) {\r\n          if (waitUntilError instanceof Error) {\r\n            error = waitUntilError;\r\n          }\r\n        }\r\n        await handler.runCallbacks('handlerDidComplete', {\r\n          event,\r\n          request,\r\n          response,\r\n          error: error\r\n        });\r\n        handler.destroy();\r\n        if (error) {\r\n          throw error;\r\n        }\r\n      }\r\n    }\r\n    /**\r\n     * Classes extending the `Strategy` based class should implement this method,\r\n     * and leverage the {@link workbox-strategies.StrategyHandler}\r\n     * arg to perform all fetching and cache logic, which will ensure all relevant\r\n     * cache, cache options, fetch options and plugins are used (per the current\r\n     * strategy instance).\r\n     *\r\n     * @name _handle\r\n     * @instance\r\n     * @abstract\r\n     * @function\r\n     * @param {Request} request\r\n     * @param {workbox-strategies.StrategyHandler} handler\r\n     * @return {Promise<Response>}\r\n     *\r\n     * @memberof workbox-strategies.Strategy\r\n     */\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A {@link workbox-strategies.Strategy} implementation\r\n     * specifically designed to work with\r\n     * {@link workbox-precaching.PrecacheController}\r\n     * to both cache and fetch precached assets.\r\n     *\r\n     * Note: an instance of this class is created automatically when creating a\r\n     * `PrecacheController`; it's generally not necessary to create this yourself.\r\n     *\r\n     * @extends workbox-strategies.Strategy\r\n     * @memberof workbox-precaching\r\n     */\r\n    class PrecacheStrategy extends Strategy {\r\n      /**\r\n       *\r\n       * @param {Object} [options]\r\n       * @param {string} [options.cacheName] Cache name to store and retrieve\r\n       * requests. Defaults to the cache names provided by\r\n       * {@link workbox-core.cacheNames}.\r\n       * @param {Array<Object>} [options.plugins] {@link https://developers.google.com/web/tools/workbox/guides/using-plugins|Plugins}\r\n       * to use in conjunction with this caching strategy.\r\n       * @param {Object} [options.fetchOptions] Values passed along to the\r\n       * {@link https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters|init}\r\n       * of all fetch() requests made by this strategy.\r\n       * @param {Object} [options.matchOptions] The\r\n       * {@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions|CacheQueryOptions}\r\n       * for any `cache.match()` or `cache.put()` calls made by this strategy.\r\n       * @param {boolean} [options.fallbackToNetwork=true] Whether to attempt to\r\n       * get the response from the network if there's a precache miss.\r\n       */\r\n      constructor(options = {}) {\r\n        options.cacheName = cacheNames.getPrecacheName(options.cacheName);\r\n        super(options);\r\n        this._fallbackToNetwork = options.fallbackToNetwork === false ? false : true;\r\n        // Redirected responses cannot be used to satisfy a navigation request, so\r\n        // any redirected response must be \"copied\" rather than cloned, so the new\r\n        // response doesn't contain the `redirected` flag. See:\r\n        // https://bugs.chromium.org/p/chromium/issues/detail?id=669363&desc=2#c1\r\n        this.plugins.push(PrecacheStrategy.copyRedirectedCacheableResponsesPlugin);\r\n      }\r\n      /**\r\n       * @private\r\n       * @param {Request|string} request A request to run this strategy for.\r\n       * @param {workbox-strategies.StrategyHandler} handler The event that\r\n       *     triggered the request.\r\n       * @return {Promise<Response>}\r\n       */\r\n      async _handle(request, handler) {\r\n        const response = await handler.cacheMatch(request);\r\n        if (response) {\r\n          return response;\r\n        }\r\n        // If this is an `install` event for an entry that isn't already cached,\r\n        // then populate the cache.\r\n        if (handler.event && handler.event.type === 'install') {\r\n          return await this._handleInstall(request, handler);\r\n        }\r\n        // Getting here means something went wrong. An entry that should have been\r\n        // precached wasn't found in the cache.\r\n        return await this._handleFetch(request, handler);\r\n      }\r\n      async _handleFetch(request, handler) {\r\n        let response;\r\n        const params = handler.params || {};\r\n        // Fall back to the network if we're configured to do so.\r\n        if (this._fallbackToNetwork) {\r\n          {\r\n            logger.warn(`The precached response for ` + `${getFriendlyURL(request.url)} in ${this.cacheName} was not ` + `found. Falling back to the network.`);\r\n          }\r\n          const integrityInManifest = params.integrity;\r\n          const integrityInRequest = request.integrity;\r\n          const noIntegrityConflict = !integrityInRequest || integrityInRequest === integrityInManifest;\r\n          // Do not add integrity if the original request is no-cors\r\n          // See https://github.com/GoogleChrome/workbox/issues/3096\r\n          response = await handler.fetch(new Request(request, {\r\n            integrity: request.mode !== 'no-cors' ? integrityInRequest || integrityInManifest : undefined\r\n          }));\r\n          // It's only \"safe\" to repair the cache if we're using SRI to guarantee\r\n          // that the response matches the precache manifest's expectations,\r\n          // and there's either a) no integrity property in the incoming request\r\n          // or b) there is an integrity, and it matches the precache manifest.\r\n          // See https://github.com/GoogleChrome/workbox/issues/2858\r\n          // Also if the original request users no-cors we don't use integrity.\r\n          // See https://github.com/GoogleChrome/workbox/issues/3096\r\n          if (integrityInManifest && noIntegrityConflict && request.mode !== 'no-cors') {\r\n            this._useDefaultCacheabilityPluginIfNeeded();\r\n            const wasCached = await handler.cachePut(request, response.clone());\r\n            {\r\n              if (wasCached) {\r\n                logger.log(`A response for ${getFriendlyURL(request.url)} ` + `was used to \"repair\" the precache.`);\r\n              }\r\n            }\r\n          }\r\n        } else {\r\n          // This shouldn't normally happen, but there are edge cases:\r\n          // https://github.com/GoogleChrome/workbox/issues/1441\r\n          throw new WorkboxError('missing-precache-entry', {\r\n            cacheName: this.cacheName,\r\n            url: request.url\r\n          });\r\n        }\r\n        {\r\n          const cacheKey = params.cacheKey || (await handler.getCacheKey(request, 'read'));\r\n          // Workbox is going to handle the route.\r\n          // print the routing details to the console.\r\n          logger.groupCollapsed(`Precaching is responding to: ` + getFriendlyURL(request.url));\r\n          logger.log(`Serving the precached url: ${getFriendlyURL(cacheKey instanceof Request ? cacheKey.url : cacheKey)}`);\r\n          logger.groupCollapsed(`View request details here.`);\r\n          logger.log(request);\r\n          logger.groupEnd();\r\n          logger.groupCollapsed(`View response details here.`);\r\n          logger.log(response);\r\n          logger.groupEnd();\r\n          logger.groupEnd();\r\n        }\r\n        return response;\r\n      }\r\n      async _handleInstall(request, handler) {\r\n        this._useDefaultCacheabilityPluginIfNeeded();\r\n        const response = await handler.fetch(request);\r\n        // Make sure we defer cachePut() until after we know the response\r\n        // should be cached; see https://github.com/GoogleChrome/workbox/issues/2737\r\n        const wasCached = await handler.cachePut(request, response.clone());\r\n        if (!wasCached) {\r\n          // Throwing here will lead to the `install` handler failing, which\r\n          // we want to do if *any* of the responses aren't safe to cache.\r\n          throw new WorkboxError('bad-precaching-response', {\r\n            url: request.url,\r\n            status: response.status\r\n          });\r\n        }\r\n        return response;\r\n      }\r\n      /**\r\n       * This method is complex, as there a number of things to account for:\r\n       *\r\n       * The `plugins` array can be set at construction, and/or it might be added to\r\n       * to at any time before the strategy is used.\r\n       *\r\n       * At the time the strategy is used (i.e. during an `install` event), there\r\n       * needs to be at least one plugin that implements `cacheWillUpdate` in the\r\n       * array, other than `copyRedirectedCacheableResponsesPlugin`.\r\n       *\r\n       * - If this method is called and there are no suitable `cacheWillUpdate`\r\n       * plugins, we need to add `defaultPrecacheCacheabilityPlugin`.\r\n       *\r\n       * - If this method is called and there is exactly one `cacheWillUpdate`, then\r\n       * we don't have to do anything (this might be a previously added\r\n       * `defaultPrecacheCacheabilityPlugin`, or it might be a custom plugin).\r\n       *\r\n       * - If this method is called and there is more than one `cacheWillUpdate`,\r\n       * then we need to check if one is `defaultPrecacheCacheabilityPlugin`. If so,\r\n       * we need to remove it. (This situation is unlikely, but it could happen if\r\n       * the strategy is used multiple times, the first without a `cacheWillUpdate`,\r\n       * and then later on after manually adding a custom `cacheWillUpdate`.)\r\n       *\r\n       * See https://github.com/GoogleChrome/workbox/issues/2737 for more context.\r\n       *\r\n       * @private\r\n       */\r\n      _useDefaultCacheabilityPluginIfNeeded() {\r\n        let defaultPluginIndex = null;\r\n        let cacheWillUpdatePluginCount = 0;\r\n        for (const [index, plugin] of this.plugins.entries()) {\r\n          // Ignore the copy redirected plugin when determining what to do.\r\n          if (plugin === PrecacheStrategy.copyRedirectedCacheableResponsesPlugin) {\r\n            continue;\r\n          }\r\n          // Save the default plugin's index, in case it needs to be removed.\r\n          if (plugin === PrecacheStrategy.defaultPrecacheCacheabilityPlugin) {\r\n            defaultPluginIndex = index;\r\n          }\r\n          if (plugin.cacheWillUpdate) {\r\n            cacheWillUpdatePluginCount++;\r\n          }\r\n        }\r\n        if (cacheWillUpdatePluginCount === 0) {\r\n          this.plugins.push(PrecacheStrategy.defaultPrecacheCacheabilityPlugin);\r\n        } else if (cacheWillUpdatePluginCount > 1 && defaultPluginIndex !== null) {\r\n          // Only remove the default plugin; multiple custom plugins are allowed.\r\n          this.plugins.splice(defaultPluginIndex, 1);\r\n        }\r\n        // Nothing needs to be done if cacheWillUpdatePluginCount is 1\r\n      }\r\n    }\r\n    PrecacheStrategy.defaultPrecacheCacheabilityPlugin = {\r\n      async cacheWillUpdate({\r\n        response\r\n      }) {\r\n        if (!response || response.status >= 400) {\r\n          return null;\r\n        }\r\n        return response;\r\n      }\r\n    };\r\n    PrecacheStrategy.copyRedirectedCacheableResponsesPlugin = {\r\n      async cacheWillUpdate({\r\n        response\r\n      }) {\r\n        return response.redirected ? await copyResponse(response) : response;\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Performs efficient precaching of assets.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    class PrecacheController {\r\n      /**\r\n       * Create a new PrecacheController.\r\n       *\r\n       * @param {Object} [options]\r\n       * @param {string} [options.cacheName] The cache to use for precaching.\r\n       * @param {string} [options.plugins] Plugins to use when precaching as well\r\n       * as responding to fetch events for precached assets.\r\n       * @param {boolean} [options.fallbackToNetwork=true] Whether to attempt to\r\n       * get the response from the network if there's a precache miss.\r\n       */\r\n      constructor({\r\n        cacheName,\r\n        plugins = [],\r\n        fallbackToNetwork = true\r\n      } = {}) {\r\n        this._urlsToCacheKeys = new Map();\r\n        this._urlsToCacheModes = new Map();\r\n        this._cacheKeysToIntegrities = new Map();\r\n        this._strategy = new PrecacheStrategy({\r\n          cacheName: cacheNames.getPrecacheName(cacheName),\r\n          plugins: [...plugins, new PrecacheCacheKeyPlugin({\r\n            precacheController: this\r\n          })],\r\n          fallbackToNetwork\r\n        });\r\n        // Bind the install and activate methods to the instance.\r\n        this.install = this.install.bind(this);\r\n        this.activate = this.activate.bind(this);\r\n      }\r\n      /**\r\n       * @type {workbox-precaching.PrecacheStrategy} The strategy created by this controller and\r\n       * used to cache assets and respond to fetch events.\r\n       */\r\n      get strategy() {\r\n        return this._strategy;\r\n      }\r\n      /**\r\n       * Adds items to the precache list, removing any duplicates and\r\n       * stores the files in the\r\n       * {@link workbox-core.cacheNames|\"precache cache\"} when the service\r\n       * worker installs.\r\n       *\r\n       * This method can be called multiple times.\r\n       *\r\n       * @param {Array<Object|string>} [entries=[]] Array of entries to precache.\r\n       */\r\n      precache(entries) {\r\n        this.addToCacheList(entries);\r\n        if (!this._installAndActiveListenersAdded) {\r\n          self.addEventListener('install', this.install);\r\n          self.addEventListener('activate', this.activate);\r\n          this._installAndActiveListenersAdded = true;\r\n        }\r\n      }\r\n      /**\r\n       * This method will add items to the precache list, removing duplicates\r\n       * and ensuring the information is valid.\r\n       *\r\n       * @param {Array<workbox-precaching.PrecacheController.PrecacheEntry|string>} entries\r\n       *     Array of entries to precache.\r\n       */\r\n      addToCacheList(entries) {\r\n        {\r\n          finalAssertExports.isArray(entries, {\r\n            moduleName: 'workbox-precaching',\r\n            className: 'PrecacheController',\r\n            funcName: 'addToCacheList',\r\n            paramName: 'entries'\r\n          });\r\n        }\r\n        const urlsToWarnAbout = [];\r\n        for (const entry of entries) {\r\n          // See https://github.com/GoogleChrome/workbox/issues/2259\r\n          if (typeof entry === 'string') {\r\n            urlsToWarnAbout.push(entry);\r\n          } else if (entry && entry.revision === undefined) {\r\n            urlsToWarnAbout.push(entry.url);\r\n          }\r\n          const {\r\n            cacheKey,\r\n            url\r\n          } = createCacheKey(entry);\r\n          const cacheMode = typeof entry !== 'string' && entry.revision ? 'reload' : 'default';\r\n          if (this._urlsToCacheKeys.has(url) && this._urlsToCacheKeys.get(url) !== cacheKey) {\r\n            throw new WorkboxError('add-to-cache-list-conflicting-entries', {\r\n              firstEntry: this._urlsToCacheKeys.get(url),\r\n              secondEntry: cacheKey\r\n            });\r\n          }\r\n          if (typeof entry !== 'string' && entry.integrity) {\r\n            if (this._cacheKeysToIntegrities.has(cacheKey) && this._cacheKeysToIntegrities.get(cacheKey) !== entry.integrity) {\r\n              throw new WorkboxError('add-to-cache-list-conflicting-integrities', {\r\n                url\r\n              });\r\n            }\r\n            this._cacheKeysToIntegrities.set(cacheKey, entry.integrity);\r\n          }\r\n          this._urlsToCacheKeys.set(url, cacheKey);\r\n          this._urlsToCacheModes.set(url, cacheMode);\r\n          if (urlsToWarnAbout.length > 0) {\r\n            const warningMessage = `Workbox is precaching URLs without revision ` + `info: ${urlsToWarnAbout.join(', ')}\\nThis is generally NOT safe. ` + `Learn more at https://bit.ly/wb-precache`;\r\n            {\r\n              logger.warn(warningMessage);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      /**\r\n       * Precaches new and updated assets. Call this method from the service worker\r\n       * install event.\r\n       *\r\n       * Note: this method calls `event.waitUntil()` for you, so you do not need\r\n       * to call it yourself in your event handlers.\r\n       *\r\n       * @param {ExtendableEvent} event\r\n       * @return {Promise<workbox-precaching.InstallResult>}\r\n       */\r\n      install(event) {\r\n        // waitUntil returns Promise<any>\r\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\r\n        return waitUntil(event, async () => {\r\n          const installReportPlugin = new PrecacheInstallReportPlugin();\r\n          this.strategy.plugins.push(installReportPlugin);\r\n          // Cache entries one at a time.\r\n          // See https://github.com/GoogleChrome/workbox/issues/2528\r\n          for (const [url, cacheKey] of this._urlsToCacheKeys) {\r\n            const integrity = this._cacheKeysToIntegrities.get(cacheKey);\r\n            const cacheMode = this._urlsToCacheModes.get(url);\r\n            const request = new Request(url, {\r\n              integrity,\r\n              cache: cacheMode,\r\n              credentials: 'same-origin'\r\n            });\r\n            await Promise.all(this.strategy.handleAll({\r\n              params: {\r\n                cacheKey\r\n              },\r\n              request,\r\n              event\r\n            }));\r\n          }\r\n          const {\r\n            updatedURLs,\r\n            notUpdatedURLs\r\n          } = installReportPlugin;\r\n          {\r\n            printInstallDetails(updatedURLs, notUpdatedURLs);\r\n          }\r\n          return {\r\n            updatedURLs,\r\n            notUpdatedURLs\r\n          };\r\n        });\r\n      }\r\n      /**\r\n       * Deletes assets that are no longer present in the current precache manifest.\r\n       * Call this method from the service worker activate event.\r\n       *\r\n       * Note: this method calls `event.waitUntil()` for you, so you do not need\r\n       * to call it yourself in your event handlers.\r\n       *\r\n       * @param {ExtendableEvent} event\r\n       * @return {Promise<workbox-precaching.CleanupResult>}\r\n       */\r\n      activate(event) {\r\n        // waitUntil returns Promise<any>\r\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\r\n        return waitUntil(event, async () => {\r\n          const cache = await self.caches.open(this.strategy.cacheName);\r\n          const currentlyCachedRequests = await cache.keys();\r\n          const expectedCacheKeys = new Set(this._urlsToCacheKeys.values());\r\n          const deletedURLs = [];\r\n          for (const request of currentlyCachedRequests) {\r\n            if (!expectedCacheKeys.has(request.url)) {\r\n              await cache.delete(request);\r\n              deletedURLs.push(request.url);\r\n            }\r\n          }\r\n          {\r\n            printCleanupDetails(deletedURLs);\r\n          }\r\n          return {\r\n            deletedURLs\r\n          };\r\n        });\r\n      }\r\n      /**\r\n       * Returns a mapping of a precached URL to the corresponding cache key, taking\r\n       * into account the revision information for the URL.\r\n       *\r\n       * @return {Map<string, string>} A URL to cache key mapping.\r\n       */\r\n      getURLsToCacheKeys() {\r\n        return this._urlsToCacheKeys;\r\n      }\r\n      /**\r\n       * Returns a list of all the URLs that have been precached by the current\r\n       * service worker.\r\n       *\r\n       * @return {Array<string>} The precached URLs.\r\n       */\r\n      getCachedURLs() {\r\n        return [...this._urlsToCacheKeys.keys()];\r\n      }\r\n      /**\r\n       * Returns the cache key used for storing a given URL. If that URL is\r\n       * unversioned, like `/index.html', then the cache key will be the original\r\n       * URL with a search parameter appended to it.\r\n       *\r\n       * @param {string} url A URL whose cache key you want to look up.\r\n       * @return {string} The versioned URL that corresponds to a cache key\r\n       * for the original URL, or undefined if that URL isn't precached.\r\n       */\r\n      getCacheKeyForURL(url) {\r\n        const urlObject = new URL(url, location.href);\r\n        return this._urlsToCacheKeys.get(urlObject.href);\r\n      }\r\n      /**\r\n       * @param {string} url A cache key whose SRI you want to look up.\r\n       * @return {string} The subresource integrity associated with the cache key,\r\n       * or undefined if it's not set.\r\n       */\r\n      getIntegrityForCacheKey(cacheKey) {\r\n        return this._cacheKeysToIntegrities.get(cacheKey);\r\n      }\r\n      /**\r\n       * This acts as a drop-in replacement for\r\n       * [`cache.match()`](https://developer.mozilla.org/en-US/docs/Web/API/Cache/match)\r\n       * with the following differences:\r\n       *\r\n       * - It knows what the name of the precache is, and only checks in that cache.\r\n       * - It allows you to pass in an \"original\" URL without versioning parameters,\r\n       * and it will automatically look up the correct cache key for the currently\r\n       * active revision of that URL.\r\n       *\r\n       * E.g., `matchPrecache('index.html')` will find the correct precached\r\n       * response for the currently active service worker, even if the actual cache\r\n       * key is `'/index.html?__WB_REVISION__=1234abcd'`.\r\n       *\r\n       * @param {string|Request} request The key (without revisioning parameters)\r\n       * to look up in the precache.\r\n       * @return {Promise<Response|undefined>}\r\n       */\r\n      async matchPrecache(request) {\r\n        const url = request instanceof Request ? request.url : request;\r\n        const cacheKey = this.getCacheKeyForURL(url);\r\n        if (cacheKey) {\r\n          const cache = await self.caches.open(this.strategy.cacheName);\r\n          return cache.match(cacheKey);\r\n        }\r\n        return undefined;\r\n      }\r\n      /**\r\n       * Returns a function that looks up `url` in the precache (taking into\r\n       * account revision information), and returns the corresponding `Response`.\r\n       *\r\n       * @param {string} url The precached URL which will be used to lookup the\r\n       * `Response`.\r\n       * @return {workbox-routing~handlerCallback}\r\n       */\r\n      createHandlerBoundToURL(url) {\r\n        const cacheKey = this.getCacheKeyForURL(url);\r\n        if (!cacheKey) {\r\n          throw new WorkboxError('non-precached-url', {\r\n            url\r\n          });\r\n        }\r\n        return options => {\r\n          options.request = new Request(url);\r\n          options.params = Object.assign({\r\n            cacheKey\r\n          }, options.params);\r\n          return this.strategy.handle(options);\r\n        };\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    let precacheController;\r\n    /**\r\n     * @return {PrecacheController}\r\n     * @private\r\n     */\r\n    const getOrCreatePrecacheController = () => {\r\n      if (!precacheController) {\r\n        precacheController = new PrecacheController();\r\n      }\r\n      return precacheController;\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Removes any URL search parameters that should be ignored.\r\n     *\r\n     * @param {URL} urlObject The original URL.\r\n     * @param {Array<RegExp>} ignoreURLParametersMatching RegExps to test against\r\n     * each search parameter name. Matches mean that the search parameter should be\r\n     * ignored.\r\n     * @return {URL} The URL with any ignored search parameters removed.\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function removeIgnoredSearchParams(urlObject, ignoreURLParametersMatching = []) {\r\n      // Convert the iterable into an array at the start of the loop to make sure\r\n      // deletion doesn't mess up iteration.\r\n      for (const paramName of [...urlObject.searchParams.keys()]) {\r\n        if (ignoreURLParametersMatching.some(regExp => regExp.test(paramName))) {\r\n          urlObject.searchParams.delete(paramName);\r\n        }\r\n      }\r\n      return urlObject;\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Generator function that yields possible variations on the original URL to\r\n     * check, one at a time.\r\n     *\r\n     * @param {string} url\r\n     * @param {Object} options\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function* generateURLVariations(url, {\r\n      ignoreURLParametersMatching = [/^utm_/, /^fbclid$/],\r\n      directoryIndex = 'index.html',\r\n      cleanURLs = true,\r\n      urlManipulation\r\n    } = {}) {\r\n      const urlObject = new URL(url, location.href);\r\n      urlObject.hash = '';\r\n      yield urlObject.href;\r\n      const urlWithoutIgnoredParams = removeIgnoredSearchParams(urlObject, ignoreURLParametersMatching);\r\n      yield urlWithoutIgnoredParams.href;\r\n      if (directoryIndex && urlWithoutIgnoredParams.pathname.endsWith('/')) {\r\n        const directoryURL = new URL(urlWithoutIgnoredParams.href);\r\n        directoryURL.pathname += directoryIndex;\r\n        yield directoryURL.href;\r\n      }\r\n      if (cleanURLs) {\r\n        const cleanURL = new URL(urlWithoutIgnoredParams.href);\r\n        cleanURL.pathname += '.html';\r\n        yield cleanURL.href;\r\n      }\r\n      if (urlManipulation) {\r\n        const additionalURLs = urlManipulation({\r\n          url: urlObject\r\n        });\r\n        for (const urlToAttempt of additionalURLs) {\r\n          yield urlToAttempt.href;\r\n        }\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A subclass of {@link workbox-routing.Route} that takes a\r\n     * {@link workbox-precaching.PrecacheController}\r\n     * instance and uses it to match incoming requests and handle fetching\r\n     * responses from the precache.\r\n     *\r\n     * @memberof workbox-precaching\r\n     * @extends workbox-routing.Route\r\n     */\r\n    class PrecacheRoute extends Route {\r\n      /**\r\n       * @param {PrecacheController} precacheController A `PrecacheController`\r\n       * instance used to both match requests and respond to fetch events.\r\n       * @param {Object} [options] Options to control how requests are matched\r\n       * against the list of precached URLs.\r\n       * @param {string} [options.directoryIndex=index.html] The `directoryIndex` will\r\n       * check cache entries for a URLs ending with '/' to see if there is a hit when\r\n       * appending the `directoryIndex` value.\r\n       * @param {Array<RegExp>} [options.ignoreURLParametersMatching=[/^utm_/, /^fbclid$/]] An\r\n       * array of regex's to remove search params when looking for a cache match.\r\n       * @param {boolean} [options.cleanURLs=true] The `cleanURLs` option will\r\n       * check the cache for the URL with a `.html` added to the end of the end.\r\n       * @param {workbox-precaching~urlManipulation} [options.urlManipulation]\r\n       * This is a function that should take a URL and return an array of\r\n       * alternative URLs that should be checked for precache matches.\r\n       */\r\n      constructor(precacheController, options) {\r\n        const match = ({\r\n          request\r\n        }) => {\r\n          const urlsToCacheKeys = precacheController.getURLsToCacheKeys();\r\n          for (const possibleURL of generateURLVariations(request.url, options)) {\r\n            const cacheKey = urlsToCacheKeys.get(possibleURL);\r\n            if (cacheKey) {\r\n              const integrity = precacheController.getIntegrityForCacheKey(cacheKey);\r\n              return {\r\n                cacheKey,\r\n                integrity\r\n              };\r\n            }\r\n          }\r\n          {\r\n            logger.debug(`Precaching did not find a match for ` + getFriendlyURL(request.url));\r\n          }\r\n          return;\r\n        };\r\n        super(match, precacheController.strategy);\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Add a `fetch` listener to the service worker that will\r\n     * respond to\r\n     * [network requests]{@link https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers#Custom_responses_to_requests}\r\n     * with precached assets.\r\n     *\r\n     * Requests for assets that aren't precached, the `FetchEvent` will not be\r\n     * responded to, allowing the event to fall through to other `fetch` event\r\n     * listeners.\r\n     *\r\n     * @param {Object} [options] See the {@link workbox-precaching.PrecacheRoute}\r\n     * options.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function addRoute(options) {\r\n      const precacheController = getOrCreatePrecacheController();\r\n      const precacheRoute = new PrecacheRoute(precacheController, options);\r\n      registerRoute(precacheRoute);\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Adds items to the precache list, removing any duplicates and\r\n     * stores the files in the\r\n     * {@link workbox-core.cacheNames|\"precache cache\"} when the service\r\n     * worker installs.\r\n     *\r\n     * This method can be called multiple times.\r\n     *\r\n     * Please note: This method **will not** serve any of the cached files for you.\r\n     * It only precaches files. To respond to a network request you call\r\n     * {@link workbox-precaching.addRoute}.\r\n     *\r\n     * If you have a single array of files to precache, you can just call\r\n     * {@link workbox-precaching.precacheAndRoute}.\r\n     *\r\n     * @param {Array<Object|string>} [entries=[]] Array of entries to precache.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function precache(entries) {\r\n      const precacheController = getOrCreatePrecacheController();\r\n      precacheController.precache(entries);\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * This method will add entries to the precache list and add a route to\r\n     * respond to fetch events.\r\n     *\r\n     * This is a convenience method that will call\r\n     * {@link workbox-precaching.precache} and\r\n     * {@link workbox-precaching.addRoute} in a single call.\r\n     *\r\n     * @param {Array<Object|string>} entries Array of entries to precache.\r\n     * @param {Object} [options] See the\r\n     * {@link workbox-precaching.PrecacheRoute} options.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function precacheAndRoute(entries, options) {\r\n      precache(entries);\r\n      addRoute(options);\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const SUBSTRING_TO_FIND = '-precache-';\r\n    /**\r\n     * Cleans up incompatible precaches that were created by older versions of\r\n     * Workbox, by a service worker registered under the current scope.\r\n     *\r\n     * This is meant to be called as part of the `activate` event.\r\n     *\r\n     * This should be safe to use as long as you don't include `substringToFind`\r\n     * (defaulting to `-precache-`) in your non-precache cache names.\r\n     *\r\n     * @param {string} currentPrecacheName The cache name currently in use for\r\n     * precaching. This cache won't be deleted.\r\n     * @param {string} [substringToFind='-precache-'] Cache names which include this\r\n     * substring will be deleted (excluding `currentPrecacheName`).\r\n     * @return {Array<string>} A list of all the cache names that were deleted.\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    const deleteOutdatedCaches = async (currentPrecacheName, substringToFind = SUBSTRING_TO_FIND) => {\r\n      const cacheNames = await self.caches.keys();\r\n      const cacheNamesToDelete = cacheNames.filter(cacheName => {\r\n        return cacheName.includes(substringToFind) && cacheName.includes(self.registration.scope) && cacheName !== currentPrecacheName;\r\n      });\r\n      await Promise.all(cacheNamesToDelete.map(cacheName => self.caches.delete(cacheName)));\r\n      return cacheNamesToDelete;\r\n    };\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Adds an `activate` event listener which will clean up incompatible\r\n     * precaches that were created by older versions of Workbox.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function cleanupOutdatedCaches() {\r\n      // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\r\n      self.addEventListener('activate', event => {\r\n        const cacheName = cacheNames.getPrecacheName();\r\n        event.waitUntil(deleteOutdatedCaches(cacheName).then(cachesDeleted => {\r\n          {\r\n            if (cachesDeleted.length > 0) {\r\n              logger.log(`The following out-of-date precaches were cleaned up ` + `automatically:`, cachesDeleted);\r\n            }\r\n          }\r\n        }));\r\n      });\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * NavigationRoute makes it easy to create a\r\n     * {@link workbox-routing.Route} that matches for browser\r\n     * [navigation requests]{@link https://developers.google.com/web/fundamentals/primers/service-workers/high-performance-loading#first_what_are_navigation_requests}.\r\n     *\r\n     * It will only match incoming Requests whose\r\n     * {@link https://fetch.spec.whatwg.org/#concept-request-mode|mode}\r\n     * is set to `navigate`.\r\n     *\r\n     * You can optionally only apply this route to a subset of navigation requests\r\n     * by using one or both of the `denylist` and `allowlist` parameters.\r\n     *\r\n     * @memberof workbox-routing\r\n     * @extends workbox-routing.Route\r\n     */\r\n    class NavigationRoute extends Route {\r\n      /**\r\n       * If both `denylist` and `allowlist` are provided, the `denylist` will\r\n       * take precedence and the request will not match this route.\r\n       *\r\n       * The regular expressions in `allowlist` and `denylist`\r\n       * are matched against the concatenated\r\n       * [`pathname`]{@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLHyperlinkElementUtils/pathname}\r\n       * and [`search`]{@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLHyperlinkElementUtils/search}\r\n       * portions of the requested URL.\r\n       *\r\n       * *Note*: These RegExps may be evaluated against every destination URL during\r\n       * a navigation. Avoid using\r\n       * [complex RegExps](https://github.com/GoogleChrome/workbox/issues/3077),\r\n       * or else your users may see delays when navigating your site.\r\n       *\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resulting in a Response.\r\n       * @param {Object} options\r\n       * @param {Array<RegExp>} [options.denylist] If any of these patterns match,\r\n       * the route will not handle the request (even if a allowlist RegExp matches).\r\n       * @param {Array<RegExp>} [options.allowlist=[/./]] If any of these patterns\r\n       * match the URL's pathname and search parameter, the route will handle the\r\n       * request (assuming the denylist doesn't match).\r\n       */\r\n      constructor(handler, {\r\n        allowlist = [/./],\r\n        denylist = []\r\n      } = {}) {\r\n        {\r\n          finalAssertExports.isArrayOfClass(allowlist, RegExp, {\r\n            moduleName: 'workbox-routing',\r\n            className: 'NavigationRoute',\r\n            funcName: 'constructor',\r\n            paramName: 'options.allowlist'\r\n          });\r\n          finalAssertExports.isArrayOfClass(denylist, RegExp, {\r\n            moduleName: 'workbox-routing',\r\n            className: 'NavigationRoute',\r\n            funcName: 'constructor',\r\n            paramName: 'options.denylist'\r\n          });\r\n        }\r\n        super(options => this._match(options), handler);\r\n        this._allowlist = allowlist;\r\n        this._denylist = denylist;\r\n      }\r\n      /**\r\n       * Routes match handler.\r\n       *\r\n       * @param {Object} options\r\n       * @param {URL} options.url\r\n       * @param {Request} options.request\r\n       * @return {boolean}\r\n       *\r\n       * @private\r\n       */\r\n      _match({\r\n        url,\r\n        request\r\n      }) {\r\n        if (request && request.mode !== 'navigate') {\r\n          return false;\r\n        }\r\n        const pathnameAndSearch = url.pathname + url.search;\r\n        for (const regExp of this._denylist) {\r\n          if (regExp.test(pathnameAndSearch)) {\r\n            {\r\n              logger.log(`The navigation route ${pathnameAndSearch} is not ` + `being used, since the URL matches this denylist pattern: ` + `${regExp.toString()}`);\r\n            }\r\n            return false;\r\n          }\r\n        }\r\n        if (this._allowlist.some(regExp => regExp.test(pathnameAndSearch))) {\r\n          {\r\n            logger.debug(`The navigation route ${pathnameAndSearch} ` + `is being used.`);\r\n          }\r\n          return true;\r\n        }\r\n        {\r\n          logger.log(`The navigation route ${pathnameAndSearch} is not ` + `being used, since the URL being navigated to doesn't ` + `match the allowlist.`);\r\n        }\r\n        return false;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Helper function that calls\r\n     * {@link PrecacheController#createHandlerBoundToURL} on the default\r\n     * {@link PrecacheController} instance.\r\n     *\r\n     * If you are creating your own {@link PrecacheController}, then call the\r\n     * {@link PrecacheController#createHandlerBoundToURL} on that instance,\r\n     * instead of using this function.\r\n     *\r\n     * @param {string} url The precached URL which will be used to lookup the\r\n     * `Response`.\r\n     * @param {boolean} [fallbackToNetwork=true] Whether to attempt to get the\r\n     * response from the network if there's a precache miss.\r\n     * @return {workbox-routing~handlerCallback}\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function createHandlerBoundToURL(url) {\r\n      const precacheController = getOrCreatePrecacheController();\r\n      return precacheController.createHandlerBoundToURL(url);\r\n    }\r\n\r\n    exports.NavigationRoute = NavigationRoute;\r\n    exports.cleanupOutdatedCaches = cleanupOutdatedCaches;\r\n    exports.clientsClaim = clientsClaim;\r\n    exports.createHandlerBoundToURL = createHandlerBoundToURL;\r\n    exports.precacheAndRoute = precacheAndRoute;\r\n    exports.registerRoute = registerRoute;\r\n\r\n}));\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\dev-dist\\workbox-7a5e81cd.js","messages":[{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":52,"column":7,"endLine":52,"endColumn":63,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":419,"column":5,"endLine":419,"endColumn":61,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-member-access","message":"Definition for rule '@typescript-eslint/no-unsafe-member-access' was not found.","line":752,"column":11,"endLine":752,"endColumn":81,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-assignment","message":"Definition for rule '@typescript-eslint/no-unsafe-assignment' was not found.","line":754,"column":13,"endLine":754,"endColumn":80,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-assignment","message":"Definition for rule '@typescript-eslint/no-unsafe-assignment' was not found.","line":948,"column":11,"endLine":948,"endColumn":78,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-assignment","message":"Definition for rule '@typescript-eslint/no-unsafe-assignment' was not found.","line":964,"column":13,"endLine":964,"endColumn":80,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":1648,"column":5,"endLine":1648,"endColumn":61,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-return","message":"Definition for rule '@typescript-eslint/no-unsafe-return' was not found.","line":2776,"column":9,"endLine":2776,"endColumn":72,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-return","message":"Definition for rule '@typescript-eslint/no-unsafe-return' was not found.","line":2823,"column":9,"endLine":2823,"endColumn":72,"severity":2,"nodeType":null}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"define(['exports'], (function (exports) { 'use strict';\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:core:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const logger = (() => {\r\n      // Don't overwrite this value if it's already set.\r\n      // See https://github.com/GoogleChrome/workbox/pull/2284#issuecomment-560470923\r\n      if (!('__WB_DISABLE_DEV_LOGS' in globalThis)) {\r\n        self.__WB_DISABLE_DEV_LOGS = false;\r\n      }\r\n      let inGroup = false;\r\n      const methodToColorMap = {\r\n        debug: `#7f8c8d`,\r\n        log: `#2ecc71`,\r\n        warn: `#f39c12`,\r\n        error: `#c0392b`,\r\n        groupCollapsed: `#3498db`,\r\n        groupEnd: null // No colored prefix on groupEnd\r\n      };\r\n      const print = function (method, args) {\r\n        if (self.__WB_DISABLE_DEV_LOGS) {\r\n          return;\r\n        }\r\n        if (method === 'groupCollapsed') {\r\n          // Safari doesn't print all console.groupCollapsed() arguments:\r\n          // https://bugs.webkit.org/show_bug.cgi?id=182754\r\n          if (/^((?!chrome|android).)*safari/i.test(navigator.userAgent)) {\r\n            console[method](...args);\r\n            return;\r\n          }\r\n        }\r\n        const styles = [`background: ${methodToColorMap[method]}`, `border-radius: 0.5em`, `color: white`, `font-weight: bold`, `padding: 2px 0.5em`];\r\n        // When in a group, the workbox prefix is not displayed.\r\n        const logPrefix = inGroup ? [] : ['%cworkbox', styles.join(';')];\r\n        console[method](...logPrefix, ...args);\r\n        if (method === 'groupCollapsed') {\r\n          inGroup = true;\r\n        }\r\n        if (method === 'groupEnd') {\r\n          inGroup = false;\r\n        }\r\n      };\r\n      // eslint-disable-next-line @typescript-eslint/ban-types\r\n      const api = {};\r\n      const loggerMethods = Object.keys(methodToColorMap);\r\n      for (const key of loggerMethods) {\r\n        const method = key;\r\n        api[method] = (...args) => {\r\n          print(method, args);\r\n        };\r\n      }\r\n      return api;\r\n    })();\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const messages = {\r\n      'invalid-value': ({\r\n        paramName,\r\n        validValueDescription,\r\n        value\r\n      }) => {\r\n        if (!paramName || !validValueDescription) {\r\n          throw new Error(`Unexpected input to 'invalid-value' error.`);\r\n        }\r\n        return `The '${paramName}' parameter was given a value with an ` + `unexpected value. ${validValueDescription} Received a value of ` + `${JSON.stringify(value)}.`;\r\n      },\r\n      'not-an-array': ({\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        if (!moduleName || !className || !funcName || !paramName) {\r\n          throw new Error(`Unexpected input to 'not-an-array' error.`);\r\n        }\r\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${className}.${funcName}()' must be an array.`;\r\n      },\r\n      'incorrect-type': ({\r\n        expectedType,\r\n        paramName,\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        if (!expectedType || !paramName || !moduleName || !funcName) {\r\n          throw new Error(`Unexpected input to 'incorrect-type' error.`);\r\n        }\r\n        const classNameStr = className ? `${className}.` : '';\r\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${classNameStr}` + `${funcName}()' must be of type ${expectedType}.`;\r\n      },\r\n      'incorrect-class': ({\r\n        expectedClassName,\r\n        paramName,\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        isReturnValueProblem\r\n      }) => {\r\n        if (!expectedClassName || !moduleName || !funcName) {\r\n          throw new Error(`Unexpected input to 'incorrect-class' error.`);\r\n        }\r\n        const classNameStr = className ? `${className}.` : '';\r\n        if (isReturnValueProblem) {\r\n          return `The return value from ` + `'${moduleName}.${classNameStr}${funcName}()' ` + `must be an instance of class ${expectedClassName}.`;\r\n        }\r\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${classNameStr}${funcName}()' ` + `must be an instance of class ${expectedClassName}.`;\r\n      },\r\n      'missing-a-method': ({\r\n        expectedMethod,\r\n        paramName,\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        if (!expectedMethod || !paramName || !moduleName || !className || !funcName) {\r\n          throw new Error(`Unexpected input to 'missing-a-method' error.`);\r\n        }\r\n        return `${moduleName}.${className}.${funcName}() expected the ` + `'${paramName}' parameter to expose a '${expectedMethod}' method.`;\r\n      },\r\n      'add-to-cache-list-unexpected-type': ({\r\n        entry\r\n      }) => {\r\n        return `An unexpected entry was passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' The entry ` + `'${JSON.stringify(entry)}' isn't supported. You must supply an array of ` + `strings with one or more characters, objects with a url property or ` + `Request objects.`;\r\n      },\r\n      'add-to-cache-list-conflicting-entries': ({\r\n        firstEntry,\r\n        secondEntry\r\n      }) => {\r\n        if (!firstEntry || !secondEntry) {\r\n          throw new Error(`Unexpected input to ` + `'add-to-cache-list-duplicate-entries' error.`);\r\n        }\r\n        return `Two of the entries passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` + `${firstEntry} but different revision details. Workbox is ` + `unable to cache and version the asset correctly. Please remove one ` + `of the entries.`;\r\n      },\r\n      'plugin-error-request-will-fetch': ({\r\n        thrownErrorMessage\r\n      }) => {\r\n        if (!thrownErrorMessage) {\r\n          throw new Error(`Unexpected input to ` + `'plugin-error-request-will-fetch', error.`);\r\n        }\r\n        return `An error was thrown by a plugins 'requestWillFetch()' method. ` + `The thrown error message was: '${thrownErrorMessage}'.`;\r\n      },\r\n      'invalid-cache-name': ({\r\n        cacheNameId,\r\n        value\r\n      }) => {\r\n        if (!cacheNameId) {\r\n          throw new Error(`Expected a 'cacheNameId' for error 'invalid-cache-name'`);\r\n        }\r\n        return `You must provide a name containing at least one character for ` + `setCacheDetails({${cacheNameId}: '...'}). Received a value of ` + `'${JSON.stringify(value)}'`;\r\n      },\r\n      'unregister-route-but-not-found-with-method': ({\r\n        method\r\n      }) => {\r\n        if (!method) {\r\n          throw new Error(`Unexpected input to ` + `'unregister-route-but-not-found-with-method' error.`);\r\n        }\r\n        return `The route you're trying to unregister was not  previously ` + `registered for the method type '${method}'.`;\r\n      },\r\n      'unregister-route-route-not-registered': () => {\r\n        return `The route you're trying to unregister was not previously ` + `registered.`;\r\n      },\r\n      'queue-replay-failed': ({\r\n        name\r\n      }) => {\r\n        return `Replaying the background sync queue '${name}' failed.`;\r\n      },\r\n      'duplicate-queue-name': ({\r\n        name\r\n      }) => {\r\n        return `The Queue name '${name}' is already being used. ` + `All instances of backgroundSync.Queue must be given unique names.`;\r\n      },\r\n      'expired-test-without-max-age': ({\r\n        methodName,\r\n        paramName\r\n      }) => {\r\n        return `The '${methodName}()' method can only be used when the ` + `'${paramName}' is used in the constructor.`;\r\n      },\r\n      'unsupported-route-type': ({\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        return `The supplied '${paramName}' parameter was an unsupported type. ` + `Please check the docs for ${moduleName}.${className}.${funcName} for ` + `valid input types.`;\r\n      },\r\n      'not-array-of-class': ({\r\n        value,\r\n        expectedClass,\r\n        moduleName,\r\n        className,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        return `The supplied '${paramName}' parameter must be an array of ` + `'${expectedClass}' objects. Received '${JSON.stringify(value)},'. ` + `Please check the call to ${moduleName}.${className}.${funcName}() ` + `to fix the issue.`;\r\n      },\r\n      'max-entries-or-age-required': ({\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        return `You must define either config.maxEntries or config.maxAgeSeconds` + `in ${moduleName}.${className}.${funcName}`;\r\n      },\r\n      'statuses-or-headers-required': ({\r\n        moduleName,\r\n        className,\r\n        funcName\r\n      }) => {\r\n        return `You must define either config.statuses or config.headers` + `in ${moduleName}.${className}.${funcName}`;\r\n      },\r\n      'invalid-string': ({\r\n        moduleName,\r\n        funcName,\r\n        paramName\r\n      }) => {\r\n        if (!paramName || !moduleName || !funcName) {\r\n          throw new Error(`Unexpected input to 'invalid-string' error.`);\r\n        }\r\n        return `When using strings, the '${paramName}' parameter must start with ` + `'http' (for cross-origin matches) or '/' (for same-origin matches). ` + `Please see the docs for ${moduleName}.${funcName}() for ` + `more info.`;\r\n      },\r\n      'channel-name-required': () => {\r\n        return `You must provide a channelName to construct a ` + `BroadcastCacheUpdate instance.`;\r\n      },\r\n      'invalid-responses-are-same-args': () => {\r\n        return `The arguments passed into responsesAreSame() appear to be ` + `invalid. Please ensure valid Responses are used.`;\r\n      },\r\n      'expire-custom-caches-only': () => {\r\n        return `You must provide a 'cacheName' property when using the ` + `expiration plugin with a runtime caching strategy.`;\r\n      },\r\n      'unit-must-be-bytes': ({\r\n        normalizedRangeHeader\r\n      }) => {\r\n        if (!normalizedRangeHeader) {\r\n          throw new Error(`Unexpected input to 'unit-must-be-bytes' error.`);\r\n        }\r\n        return `The 'unit' portion of the Range header must be set to 'bytes'. ` + `The Range header provided was \"${normalizedRangeHeader}\"`;\r\n      },\r\n      'single-range-only': ({\r\n        normalizedRangeHeader\r\n      }) => {\r\n        if (!normalizedRangeHeader) {\r\n          throw new Error(`Unexpected input to 'single-range-only' error.`);\r\n        }\r\n        return `Multiple ranges are not supported. Please use a  single start ` + `value, and optional end value. The Range header provided was ` + `\"${normalizedRangeHeader}\"`;\r\n      },\r\n      'invalid-range-values': ({\r\n        normalizedRangeHeader\r\n      }) => {\r\n        if (!normalizedRangeHeader) {\r\n          throw new Error(`Unexpected input to 'invalid-range-values' error.`);\r\n        }\r\n        return `The Range header is missing both start and end values. At least ` + `one of those values is needed. The Range header provided was ` + `\"${normalizedRangeHeader}\"`;\r\n      },\r\n      'no-range-header': () => {\r\n        return `No Range header was found in the Request provided.`;\r\n      },\r\n      'range-not-satisfiable': ({\r\n        size,\r\n        start,\r\n        end\r\n      }) => {\r\n        return `The start (${start}) and end (${end}) values in the Range are ` + `not satisfiable by the cached response, which is ${size} bytes.`;\r\n      },\r\n      'attempt-to-cache-non-get-request': ({\r\n        url,\r\n        method\r\n      }) => {\r\n        return `Unable to cache '${url}' because it is a '${method}' request and ` + `only 'GET' requests can be cached.`;\r\n      },\r\n      'cache-put-with-no-response': ({\r\n        url\r\n      }) => {\r\n        return `There was an attempt to cache '${url}' but the response was not ` + `defined.`;\r\n      },\r\n      'no-response': ({\r\n        url,\r\n        error\r\n      }) => {\r\n        let message = `The strategy could not generate a response for '${url}'.`;\r\n        if (error) {\r\n          message += ` The underlying error is ${error}.`;\r\n        }\r\n        return message;\r\n      },\r\n      'bad-precaching-response': ({\r\n        url,\r\n        status\r\n      }) => {\r\n        return `The precaching request for '${url}' failed` + (status ? ` with an HTTP status of ${status}.` : `.`);\r\n      },\r\n      'non-precached-url': ({\r\n        url\r\n      }) => {\r\n        return `createHandlerBoundToURL('${url}') was called, but that URL is ` + `not precached. Please pass in a URL that is precached instead.`;\r\n      },\r\n      'add-to-cache-list-conflicting-integrities': ({\r\n        url\r\n      }) => {\r\n        return `Two of the entries passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` + `${url} with different integrity values. Please remove one of them.`;\r\n      },\r\n      'missing-precache-entry': ({\r\n        cacheName,\r\n        url\r\n      }) => {\r\n        return `Unable to find a precached response in ${cacheName} for ${url}.`;\r\n      },\r\n      'cross-origin-copy-response': ({\r\n        origin\r\n      }) => {\r\n        return `workbox-core.copyResponse() can only be used with same-origin ` + `responses. It was passed a response with origin ${origin}.`;\r\n      },\r\n      'opaque-streams-source': ({\r\n        type\r\n      }) => {\r\n        const message = `One of the workbox-streams sources resulted in an ` + `'${type}' response.`;\r\n        if (type === 'opaqueredirect') {\r\n          return `${message} Please do not use a navigation request that results ` + `in a redirect as a source.`;\r\n        }\r\n        return `${message} Please ensure your sources are CORS-enabled.`;\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const generatorFunction = (code, details = {}) => {\r\n      const message = messages[code];\r\n      if (!message) {\r\n        throw new Error(`Unable to find message for code '${code}'.`);\r\n      }\r\n      return message(details);\r\n    };\r\n    const messageGenerator = generatorFunction;\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Workbox errors should be thrown with this class.\r\n     * This allows use to ensure the type easily in tests,\r\n     * helps developers identify errors from workbox\r\n     * easily and allows use to optimise error\r\n     * messages correctly.\r\n     *\r\n     * @private\r\n     */\r\n    class WorkboxError extends Error {\r\n      /**\r\n       *\r\n       * @param {string} errorCode The error code that\r\n       * identifies this particular error.\r\n       * @param {Object=} details Any relevant arguments\r\n       * that will help developers identify issues should\r\n       * be added as a key on the context object.\r\n       */\r\n      constructor(errorCode, details) {\r\n        const message = messageGenerator(errorCode, details);\r\n        super(message);\r\n        this.name = errorCode;\r\n        this.details = details;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /*\r\n     * This method throws if the supplied value is not an array.\r\n     * The destructed values are required to produce a meaningful error for users.\r\n     * The destructed and restructured object is so it's clear what is\r\n     * needed.\r\n     */\r\n    const isArray = (value, details) => {\r\n      if (!Array.isArray(value)) {\r\n        throw new WorkboxError('not-an-array', details);\r\n      }\r\n    };\r\n    const hasMethod = (object, expectedMethod, details) => {\r\n      const type = typeof object[expectedMethod];\r\n      if (type !== 'function') {\r\n        details['expectedMethod'] = expectedMethod;\r\n        throw new WorkboxError('missing-a-method', details);\r\n      }\r\n    };\r\n    const isType = (object, expectedType, details) => {\r\n      if (typeof object !== expectedType) {\r\n        details['expectedType'] = expectedType;\r\n        throw new WorkboxError('incorrect-type', details);\r\n      }\r\n    };\r\n    const isInstance = (object,\r\n    // Need the general type to do the check later.\r\n    // eslint-disable-next-line @typescript-eslint/ban-types\r\n    expectedClass, details) => {\r\n      if (!(object instanceof expectedClass)) {\r\n        details['expectedClassName'] = expectedClass.name;\r\n        throw new WorkboxError('incorrect-class', details);\r\n      }\r\n    };\r\n    const isOneOf = (value, validValues, details) => {\r\n      if (!validValues.includes(value)) {\r\n        details['validValueDescription'] = `Valid values are ${JSON.stringify(validValues)}.`;\r\n        throw new WorkboxError('invalid-value', details);\r\n      }\r\n    };\r\n    const isArrayOfClass = (value,\r\n    // Need general type to do check later.\r\n    expectedClass,\r\n     \r\n    details) => {\r\n      const error = new WorkboxError('not-array-of-class', details);\r\n      if (!Array.isArray(value)) {\r\n        throw error;\r\n      }\r\n      for (const item of value) {\r\n        if (!(item instanceof expectedClass)) {\r\n          throw error;\r\n        }\r\n      }\r\n    };\r\n    const finalAssertExports = {\r\n      hasMethod,\r\n      isArray,\r\n      isInstance,\r\n      isOneOf,\r\n      isType,\r\n      isArrayOfClass\r\n    };\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:routing:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * The default HTTP method, 'GET', used when there's no specific method\r\n     * configured for a route.\r\n     *\r\n     * @type {string}\r\n     *\r\n     * @private\r\n     */\r\n    const defaultMethod = 'GET';\r\n    /**\r\n     * The list of valid HTTP methods associated with requests that could be routed.\r\n     *\r\n     * @type {Array<string>}\r\n     *\r\n     * @private\r\n     */\r\n    const validMethods = ['DELETE', 'GET', 'HEAD', 'PATCH', 'POST', 'PUT'];\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * @param {function()|Object} handler Either a function, or an object with a\r\n     * 'handle' method.\r\n     * @return {Object} An object with a handle method.\r\n     *\r\n     * @private\r\n     */\r\n    const normalizeHandler = handler => {\r\n      if (handler && typeof handler === 'object') {\r\n        {\r\n          finalAssertExports.hasMethod(handler, 'handle', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Route',\r\n            funcName: 'constructor',\r\n            paramName: 'handler'\r\n          });\r\n        }\r\n        return handler;\r\n      } else {\r\n        {\r\n          finalAssertExports.isType(handler, 'function', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Route',\r\n            funcName: 'constructor',\r\n            paramName: 'handler'\r\n          });\r\n        }\r\n        return {\r\n          handle: handler\r\n        };\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A `Route` consists of a pair of callback functions, \"match\" and \"handler\".\r\n     * The \"match\" callback determine if a route should be used to \"handle\" a\r\n     * request by returning a non-falsy value if it can. The \"handler\" callback\r\n     * is called when there is a match and should return a Promise that resolves\r\n     * to a `Response`.\r\n     *\r\n     * @memberof workbox-routing\r\n     */\r\n    class Route {\r\n      /**\r\n       * Constructor for Route class.\r\n       *\r\n       * @param {workbox-routing~matchCallback} match\r\n       * A callback function that determines whether the route matches a given\r\n       * `fetch` event by returning a non-falsy value.\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resolving to a Response.\r\n       * @param {string} [method='GET'] The HTTP method to match the Route\r\n       * against.\r\n       */\r\n      constructor(match, handler, method = defaultMethod) {\r\n        {\r\n          finalAssertExports.isType(match, 'function', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Route',\r\n            funcName: 'constructor',\r\n            paramName: 'match'\r\n          });\r\n          if (method) {\r\n            finalAssertExports.isOneOf(method, validMethods, {\r\n              paramName: 'method'\r\n            });\r\n          }\r\n        }\r\n        // These values are referenced directly by Router so cannot be\r\n        // altered by minificaton.\r\n        this.handler = normalizeHandler(handler);\r\n        this.match = match;\r\n        this.method = method;\r\n      }\r\n      /**\r\n       *\r\n       * @param {workbox-routing-handlerCallback} handler A callback\r\n       * function that returns a Promise resolving to a Response\r\n       */\r\n      setCatchHandler(handler) {\r\n        this.catchHandler = normalizeHandler(handler);\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * RegExpRoute makes it easy to create a regular expression based\r\n     * {@link workbox-routing.Route}.\r\n     *\r\n     * For same-origin requests the RegExp only needs to match part of the URL. For\r\n     * requests against third-party servers, you must define a RegExp that matches\r\n     * the start of the URL.\r\n     *\r\n     * @memberof workbox-routing\r\n     * @extends workbox-routing.Route\r\n     */\r\n    class RegExpRoute extends Route {\r\n      /**\r\n       * If the regular expression contains\r\n       * [capture groups]{@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp#grouping-back-references},\r\n       * the captured values will be passed to the\r\n       * {@link workbox-routing~handlerCallback} `params`\r\n       * argument.\r\n       *\r\n       * @param {RegExp} regExp The regular expression to match against URLs.\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resulting in a Response.\r\n       * @param {string} [method='GET'] The HTTP method to match the Route\r\n       * against.\r\n       */\r\n      constructor(regExp, handler, method) {\r\n        {\r\n          finalAssertExports.isInstance(regExp, RegExp, {\r\n            moduleName: 'workbox-routing',\r\n            className: 'RegExpRoute',\r\n            funcName: 'constructor',\r\n            paramName: 'pattern'\r\n          });\r\n        }\r\n        const match = ({\r\n          url\r\n        }) => {\r\n          const result = regExp.exec(url.href);\r\n          // Return immediately if there's no match.\r\n          if (!result) {\r\n            return;\r\n          }\r\n          // Require that the match start at the first character in the URL string\r\n          // if it's a cross-origin request.\r\n          // See https://github.com/GoogleChrome/workbox/issues/281 for the context\r\n          // behind this behavior.\r\n          if (url.origin !== location.origin && result.index !== 0) {\r\n            {\r\n              logger.debug(`The regular expression '${regExp.toString()}' only partially matched ` + `against the cross-origin URL '${url.toString()}'. RegExpRoute's will only ` + `handle cross-origin requests if they match the entire URL.`);\r\n            }\r\n            return;\r\n          }\r\n          // If the route matches, but there aren't any capture groups defined, then\r\n          // this will return [], which is truthy and therefore sufficient to\r\n          // indicate a match.\r\n          // If there are capture groups, then it will return their values.\r\n          return result.slice(1);\r\n        };\r\n        super(match, handler, method);\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const getFriendlyURL = url => {\r\n      const urlObj = new URL(String(url), location.href);\r\n      // See https://github.com/GoogleChrome/workbox/issues/2323\r\n      // We want to include everything, except for the origin if it's same-origin.\r\n      return urlObj.href.replace(new RegExp(`^${location.origin}`), '');\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * The Router can be used to process a `FetchEvent` using one or more\r\n     * {@link workbox-routing.Route}, responding with a `Response` if\r\n     * a matching route exists.\r\n     *\r\n     * If no route matches a given a request, the Router will use a \"default\"\r\n     * handler if one is defined.\r\n     *\r\n     * Should the matching Route throw an error, the Router will use a \"catch\"\r\n     * handler if one is defined to gracefully deal with issues and respond with a\r\n     * Request.\r\n     *\r\n     * If a request matches multiple routes, the **earliest** registered route will\r\n     * be used to respond to the request.\r\n     *\r\n     * @memberof workbox-routing\r\n     */\r\n    class Router {\r\n      /**\r\n       * Initializes a new Router.\r\n       */\r\n      constructor() {\r\n        this._routes = new Map();\r\n        this._defaultHandlerMap = new Map();\r\n      }\r\n      /**\r\n       * @return {Map<string, Array<workbox-routing.Route>>} routes A `Map` of HTTP\r\n       * method name ('GET', etc.) to an array of all the corresponding `Route`\r\n       * instances that are registered.\r\n       */\r\n      get routes() {\r\n        return this._routes;\r\n      }\r\n      /**\r\n       * Adds a fetch event listener to respond to events when a route matches\r\n       * the event's request.\r\n       */\r\n      addFetchListener() {\r\n        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\r\n        self.addEventListener('fetch', event => {\r\n          const {\r\n            request\r\n          } = event;\r\n          const responsePromise = this.handleRequest({\r\n            request,\r\n            event\r\n          });\r\n          if (responsePromise) {\r\n            event.respondWith(responsePromise);\r\n          }\r\n        });\r\n      }\r\n      /**\r\n       * Adds a message event listener for URLs to cache from the window.\r\n       * This is useful to cache resources loaded on the page prior to when the\r\n       * service worker started controlling it.\r\n       *\r\n       * The format of the message data sent from the window should be as follows.\r\n       * Where the `urlsToCache` array may consist of URL strings or an array of\r\n       * URL string + `requestInit` object (the same as you'd pass to `fetch()`).\r\n       *\r\n       * ```\r\n       * {\r\n       *   type: 'CACHE_URLS',\r\n       *   payload: {\r\n       *     urlsToCache: [\r\n       *       './script1.js',\r\n       *       './script2.js',\r\n       *       ['./script3.js', {mode: 'no-cors'}],\r\n       *     ],\r\n       *   },\r\n       * }\r\n       * ```\r\n       */\r\n      addCacheListener() {\r\n        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\r\n        self.addEventListener('message', event => {\r\n          // event.data is type 'any'\r\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\r\n          if (event.data && event.data.type === 'CACHE_URLS') {\r\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\r\n            const {\r\n              payload\r\n            } = event.data;\r\n            {\r\n              logger.debug(`Caching URLs from the window`, payload.urlsToCache);\r\n            }\r\n            const requestPromises = Promise.all(payload.urlsToCache.map(entry => {\r\n              if (typeof entry === 'string') {\r\n                entry = [entry];\r\n              }\r\n              const request = new Request(...entry);\r\n              return this.handleRequest({\r\n                request,\r\n                event\r\n              });\r\n              // TODO(philipwalton): TypeScript errors without this typecast for\r\n              // some reason (probably a bug). The real type here should work but\r\n              // doesn't: `Array<Promise<Response> | undefined>`.\r\n            })); // TypeScript\r\n            event.waitUntil(requestPromises);\r\n            // If a MessageChannel was used, reply to the message on success.\r\n            if (event.ports && event.ports[0]) {\r\n              void requestPromises.then(() => event.ports[0].postMessage(true));\r\n            }\r\n          }\r\n        });\r\n      }\r\n      /**\r\n       * Apply the routing rules to a FetchEvent object to get a Response from an\r\n       * appropriate Route's handler.\r\n       *\r\n       * @param {Object} options\r\n       * @param {Request} options.request The request to handle.\r\n       * @param {ExtendableEvent} options.event The event that triggered the\r\n       *     request.\r\n       * @return {Promise<Response>|undefined} A promise is returned if a\r\n       *     registered route can handle the request. If there is no matching\r\n       *     route and there's no `defaultHandler`, `undefined` is returned.\r\n       */\r\n      handleRequest({\r\n        request,\r\n        event\r\n      }) {\r\n        {\r\n          finalAssertExports.isInstance(request, Request, {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'handleRequest',\r\n            paramName: 'options.request'\r\n          });\r\n        }\r\n        const url = new URL(request.url, location.href);\r\n        if (!url.protocol.startsWith('http')) {\r\n          {\r\n            logger.debug(`Workbox Router only supports URLs that start with 'http'.`);\r\n          }\r\n          return;\r\n        }\r\n        const sameOrigin = url.origin === location.origin;\r\n        const {\r\n          params,\r\n          route\r\n        } = this.findMatchingRoute({\r\n          event,\r\n          request,\r\n          sameOrigin,\r\n          url\r\n        });\r\n        let handler = route && route.handler;\r\n        const debugMessages = [];\r\n        {\r\n          if (handler) {\r\n            debugMessages.push([`Found a route to handle this request:`, route]);\r\n            if (params) {\r\n              debugMessages.push([`Passing the following params to the route's handler:`, params]);\r\n            }\r\n          }\r\n        }\r\n        // If we don't have a handler because there was no matching route, then\r\n        // fall back to defaultHandler if that's defined.\r\n        const method = request.method;\r\n        if (!handler && this._defaultHandlerMap.has(method)) {\r\n          {\r\n            debugMessages.push(`Failed to find a matching route. Falling ` + `back to the default handler for ${method}.`);\r\n          }\r\n          handler = this._defaultHandlerMap.get(method);\r\n        }\r\n        if (!handler) {\r\n          {\r\n            // No handler so Workbox will do nothing. If logs is set of debug\r\n            // i.e. verbose, we should print out this information.\r\n            logger.debug(`No route found for: ${getFriendlyURL(url)}`);\r\n          }\r\n          return;\r\n        }\r\n        {\r\n          // We have a handler, meaning Workbox is going to handle the route.\r\n          // print the routing details to the console.\r\n          logger.groupCollapsed(`Router is responding to: ${getFriendlyURL(url)}`);\r\n          debugMessages.forEach(msg => {\r\n            if (Array.isArray(msg)) {\r\n              logger.log(...msg);\r\n            } else {\r\n              logger.log(msg);\r\n            }\r\n          });\r\n          logger.groupEnd();\r\n        }\r\n        // Wrap in try and catch in case the handle method throws a synchronous\r\n        // error. It should still callback to the catch handler.\r\n        let responsePromise;\r\n        try {\r\n          responsePromise = handler.handle({\r\n            url,\r\n            request,\r\n            event,\r\n            params\r\n          });\r\n        } catch (err) {\r\n          responsePromise = Promise.reject(err);\r\n        }\r\n        // Get route's catch handler, if it exists\r\n        const catchHandler = route && route.catchHandler;\r\n        if (responsePromise instanceof Promise && (this._catchHandler || catchHandler)) {\r\n          responsePromise = responsePromise.catch(async err => {\r\n            // If there's a route catch handler, process that first\r\n            if (catchHandler) {\r\n              {\r\n                // Still include URL here as it will be async from the console group\r\n                // and may not make sense without the URL\r\n                logger.groupCollapsed(`Error thrown when responding to: ` + ` ${getFriendlyURL(url)}. Falling back to route's Catch Handler.`);\r\n                logger.error(`Error thrown by:`, route);\r\n                logger.error(err);\r\n                logger.groupEnd();\r\n              }\r\n              try {\r\n                return await catchHandler.handle({\r\n                  url,\r\n                  request,\r\n                  event,\r\n                  params\r\n                });\r\n              } catch (catchErr) {\r\n                if (catchErr instanceof Error) {\r\n                  err = catchErr;\r\n                }\r\n              }\r\n            }\r\n            if (this._catchHandler) {\r\n              {\r\n                // Still include URL here as it will be async from the console group\r\n                // and may not make sense without the URL\r\n                logger.groupCollapsed(`Error thrown when responding to: ` + ` ${getFriendlyURL(url)}. Falling back to global Catch Handler.`);\r\n                logger.error(`Error thrown by:`, route);\r\n                logger.error(err);\r\n                logger.groupEnd();\r\n              }\r\n              return this._catchHandler.handle({\r\n                url,\r\n                request,\r\n                event\r\n              });\r\n            }\r\n            throw err;\r\n          });\r\n        }\r\n        return responsePromise;\r\n      }\r\n      /**\r\n       * Checks a request and URL (and optionally an event) against the list of\r\n       * registered routes, and if there's a match, returns the corresponding\r\n       * route along with any params generated by the match.\r\n       *\r\n       * @param {Object} options\r\n       * @param {URL} options.url\r\n       * @param {boolean} options.sameOrigin The result of comparing `url.origin`\r\n       *     against the current origin.\r\n       * @param {Request} options.request The request to match.\r\n       * @param {Event} options.event The corresponding event.\r\n       * @return {Object} An object with `route` and `params` properties.\r\n       *     They are populated if a matching route was found or `undefined`\r\n       *     otherwise.\r\n       */\r\n      findMatchingRoute({\r\n        url,\r\n        sameOrigin,\r\n        request,\r\n        event\r\n      }) {\r\n        const routes = this._routes.get(request.method) || [];\r\n        for (const route of routes) {\r\n          let params;\r\n          // route.match returns type any, not possible to change right now.\r\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\r\n          const matchResult = route.match({\r\n            url,\r\n            sameOrigin,\r\n            request,\r\n            event\r\n          });\r\n          if (matchResult) {\r\n            {\r\n              // Warn developers that using an async matchCallback is almost always\r\n              // not the right thing to do.\r\n              if (matchResult instanceof Promise) {\r\n                logger.warn(`While routing ${getFriendlyURL(url)}, an async ` + `matchCallback function was used. Please convert the ` + `following route to use a synchronous matchCallback function:`, route);\r\n              }\r\n            }\r\n            // See https://github.com/GoogleChrome/workbox/issues/2079\r\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\r\n            params = matchResult;\r\n            if (Array.isArray(params) && params.length === 0) {\r\n              // Instead of passing an empty array in as params, use undefined.\r\n              params = undefined;\r\n            } else if (matchResult.constructor === Object &&\r\n             \r\n            Object.keys(matchResult).length === 0) {\r\n              // Instead of passing an empty object in as params, use undefined.\r\n              params = undefined;\r\n            } else if (typeof matchResult === 'boolean') {\r\n              // For the boolean value true (rather than just something truth-y),\r\n              // don't set params.\r\n              // See https://github.com/GoogleChrome/workbox/pull/2134#issuecomment-513924353\r\n              params = undefined;\r\n            }\r\n            // Return early if have a match.\r\n            return {\r\n              route,\r\n              params\r\n            };\r\n          }\r\n        }\r\n        // If no match was found above, return and empty object.\r\n        return {};\r\n      }\r\n      /**\r\n       * Define a default `handler` that's called when no routes explicitly\r\n       * match the incoming request.\r\n       *\r\n       * Each HTTP method ('GET', 'POST', etc.) gets its own default handler.\r\n       *\r\n       * Without a default handler, unmatched requests will go against the\r\n       * network as if there were no service worker present.\r\n       *\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resulting in a Response.\r\n       * @param {string} [method='GET'] The HTTP method to associate with this\r\n       * default handler. Each method has its own default.\r\n       */\r\n      setDefaultHandler(handler, method = defaultMethod) {\r\n        this._defaultHandlerMap.set(method, normalizeHandler(handler));\r\n      }\r\n      /**\r\n       * If a Route throws an error while handling a request, this `handler`\r\n       * will be called and given a chance to provide a response.\r\n       *\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resulting in a Response.\r\n       */\r\n      setCatchHandler(handler) {\r\n        this._catchHandler = normalizeHandler(handler);\r\n      }\r\n      /**\r\n       * Registers a route with the router.\r\n       *\r\n       * @param {workbox-routing.Route} route The route to register.\r\n       */\r\n      registerRoute(route) {\r\n        {\r\n          finalAssertExports.isType(route, 'object', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route'\r\n          });\r\n          finalAssertExports.hasMethod(route, 'match', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route'\r\n          });\r\n          finalAssertExports.isType(route.handler, 'object', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route'\r\n          });\r\n          finalAssertExports.hasMethod(route.handler, 'handle', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route.handler'\r\n          });\r\n          finalAssertExports.isType(route.method, 'string', {\r\n            moduleName: 'workbox-routing',\r\n            className: 'Router',\r\n            funcName: 'registerRoute',\r\n            paramName: 'route.method'\r\n          });\r\n        }\r\n        if (!this._routes.has(route.method)) {\r\n          this._routes.set(route.method, []);\r\n        }\r\n        // Give precedence to all of the earlier routes by adding this additional\r\n        // route to the end of the array.\r\n        this._routes.get(route.method).push(route);\r\n      }\r\n      /**\r\n       * Unregisters a route with the router.\r\n       *\r\n       * @param {workbox-routing.Route} route The route to unregister.\r\n       */\r\n      unregisterRoute(route) {\r\n        if (!this._routes.has(route.method)) {\r\n          throw new WorkboxError('unregister-route-but-not-found-with-method', {\r\n            method: route.method\r\n          });\r\n        }\r\n        const routeIndex = this._routes.get(route.method).indexOf(route);\r\n        if (routeIndex > -1) {\r\n          this._routes.get(route.method).splice(routeIndex, 1);\r\n        } else {\r\n          throw new WorkboxError('unregister-route-route-not-registered');\r\n        }\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    let defaultRouter;\r\n    /**\r\n     * Creates a new, singleton Router instance if one does not exist. If one\r\n     * does already exist, that instance is returned.\r\n     *\r\n     * @private\r\n     * @return {Router}\r\n     */\r\n    const getOrCreateDefaultRouter = () => {\r\n      if (!defaultRouter) {\r\n        defaultRouter = new Router();\r\n        // The helpers that use the default Router assume these listeners exist.\r\n        defaultRouter.addFetchListener();\r\n        defaultRouter.addCacheListener();\r\n      }\r\n      return defaultRouter;\r\n    };\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Easily register a RegExp, string, or function with a caching\r\n     * strategy to a singleton Router instance.\r\n     *\r\n     * This method will generate a Route for you if needed and\r\n     * call {@link workbox-routing.Router#registerRoute}.\r\n     *\r\n     * @param {RegExp|string|workbox-routing.Route~matchCallback|workbox-routing.Route} capture\r\n     * If the capture param is a `Route`, all other arguments will be ignored.\r\n     * @param {workbox-routing~handlerCallback} [handler] A callback\r\n     * function that returns a Promise resulting in a Response. This parameter\r\n     * is required if `capture` is not a `Route` object.\r\n     * @param {string} [method='GET'] The HTTP method to match the Route\r\n     * against.\r\n     * @return {workbox-routing.Route} The generated `Route`.\r\n     *\r\n     * @memberof workbox-routing\r\n     */\r\n    function registerRoute(capture, handler, method) {\r\n      let route;\r\n      if (typeof capture === 'string') {\r\n        const captureUrl = new URL(capture, location.href);\r\n        {\r\n          if (!(capture.startsWith('/') || capture.startsWith('http'))) {\r\n            throw new WorkboxError('invalid-string', {\r\n              moduleName: 'workbox-routing',\r\n              funcName: 'registerRoute',\r\n              paramName: 'capture'\r\n            });\r\n          }\r\n          // We want to check if Express-style wildcards are in the pathname only.\r\n          // TODO: Remove this log message in v4.\r\n          const valueToCheck = capture.startsWith('http') ? captureUrl.pathname : capture;\r\n          // See https://github.com/pillarjs/path-to-regexp#parameters\r\n          const wildcards = '[*:?+]';\r\n          if (new RegExp(`${wildcards}`).exec(valueToCheck)) {\r\n            logger.debug(`The '$capture' parameter contains an Express-style wildcard ` + `character (${wildcards}). Strings are now always interpreted as ` + `exact matches; use a RegExp for partial or wildcard matches.`);\r\n          }\r\n        }\r\n        const matchCallback = ({\r\n          url\r\n        }) => {\r\n          {\r\n            if (url.pathname === captureUrl.pathname && url.origin !== captureUrl.origin) {\r\n              logger.debug(`${capture} only partially matches the cross-origin URL ` + `${url.toString()}. This route will only handle cross-origin requests ` + `if they match the entire URL.`);\r\n            }\r\n          }\r\n          return url.href === captureUrl.href;\r\n        };\r\n        // If `capture` is a string then `handler` and `method` must be present.\r\n        route = new Route(matchCallback, handler, method);\r\n      } else if (capture instanceof RegExp) {\r\n        // If `capture` is a `RegExp` then `handler` and `method` must be present.\r\n        route = new RegExpRoute(capture, handler, method);\r\n      } else if (typeof capture === 'function') {\r\n        // If `capture` is a function then `handler` and `method` must be present.\r\n        route = new Route(capture, handler, method);\r\n      } else if (capture instanceof Route) {\r\n        route = capture;\r\n      } else {\r\n        throw new WorkboxError('unsupported-route-type', {\r\n          moduleName: 'workbox-routing',\r\n          funcName: 'registerRoute',\r\n          paramName: 'capture'\r\n        });\r\n      }\r\n      const defaultRouter = getOrCreateDefaultRouter();\r\n      defaultRouter.registerRoute(route);\r\n      return route;\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const _cacheNameDetails = {\r\n      googleAnalytics: 'googleAnalytics',\r\n      precache: 'precache-v2',\r\n      prefix: 'workbox',\r\n      runtime: 'runtime',\r\n      suffix: typeof registration !== 'undefined' ? registration.scope : ''\r\n    };\r\n    const _createCacheName = cacheName => {\r\n      return [_cacheNameDetails.prefix, cacheName, _cacheNameDetails.suffix].filter(value => value && value.length > 0).join('-');\r\n    };\r\n    const eachCacheNameDetail = fn => {\r\n      for (const key of Object.keys(_cacheNameDetails)) {\r\n        fn(key);\r\n      }\r\n    };\r\n    const cacheNames = {\r\n      updateDetails: details => {\r\n        eachCacheNameDetail(key => {\r\n          if (typeof details[key] === 'string') {\r\n            _cacheNameDetails[key] = details[key];\r\n          }\r\n        });\r\n      },\r\n      getGoogleAnalyticsName: userCacheName => {\r\n        return userCacheName || _createCacheName(_cacheNameDetails.googleAnalytics);\r\n      },\r\n      getPrecacheName: userCacheName => {\r\n        return userCacheName || _createCacheName(_cacheNameDetails.precache);\r\n      },\r\n      getPrefix: () => {\r\n        return _cacheNameDetails.prefix;\r\n      },\r\n      getRuntimeName: userCacheName => {\r\n        return userCacheName || _createCacheName(_cacheNameDetails.runtime);\r\n      },\r\n      getSuffix: () => {\r\n        return _cacheNameDetails.suffix;\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A utility method that makes it easier to use `event.waitUntil` with\r\n     * async functions and return the result.\r\n     *\r\n     * @param {ExtendableEvent} event\r\n     * @param {Function} asyncFn\r\n     * @return {Function}\r\n     * @private\r\n     */\r\n    function waitUntil(event, asyncFn) {\r\n      const returnPromise = asyncFn();\r\n      event.waitUntil(returnPromise);\r\n      return returnPromise;\r\n    }\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:precaching:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    // Name of the search parameter used to store revision info.\r\n    const REVISION_SEARCH_PARAM = '__WB_REVISION__';\r\n    /**\r\n     * Converts a manifest entry into a versioned URL suitable for precaching.\r\n     *\r\n     * @param {Object|string} entry\r\n     * @return {string} A URL with versioning info.\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function createCacheKey(entry) {\r\n      if (!entry) {\r\n        throw new WorkboxError('add-to-cache-list-unexpected-type', {\r\n          entry\r\n        });\r\n      }\r\n      // If a precache manifest entry is a string, it's assumed to be a versioned\r\n      // URL, like '/app.abcd1234.js'. Return as-is.\r\n      if (typeof entry === 'string') {\r\n        const urlObject = new URL(entry, location.href);\r\n        return {\r\n          cacheKey: urlObject.href,\r\n          url: urlObject.href\r\n        };\r\n      }\r\n      const {\r\n        revision,\r\n        url\r\n      } = entry;\r\n      if (!url) {\r\n        throw new WorkboxError('add-to-cache-list-unexpected-type', {\r\n          entry\r\n        });\r\n      }\r\n      // If there's just a URL and no revision, then it's also assumed to be a\r\n      // versioned URL.\r\n      if (!revision) {\r\n        const urlObject = new URL(url, location.href);\r\n        return {\r\n          cacheKey: urlObject.href,\r\n          url: urlObject.href\r\n        };\r\n      }\r\n      // Otherwise, construct a properly versioned URL using the custom Workbox\r\n      // search parameter along with the revision info.\r\n      const cacheKeyURL = new URL(url, location.href);\r\n      const originalURL = new URL(url, location.href);\r\n      cacheKeyURL.searchParams.set(REVISION_SEARCH_PARAM, revision);\r\n      return {\r\n        cacheKey: cacheKeyURL.href,\r\n        url: originalURL.href\r\n      };\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A plugin, designed to be used with PrecacheController, to determine the\r\n     * of assets that were updated (or not updated) during the install event.\r\n     *\r\n     * @private\r\n     */\r\n    class PrecacheInstallReportPlugin {\r\n      constructor() {\r\n        this.updatedURLs = [];\r\n        this.notUpdatedURLs = [];\r\n        this.handlerWillStart = async ({\r\n          request,\r\n          state\r\n        }) => {\r\n          // TODO: `state` should never be undefined...\r\n          if (state) {\r\n            state.originalRequest = request;\r\n          }\r\n        };\r\n        this.cachedResponseWillBeUsed = async ({\r\n          event,\r\n          state,\r\n          cachedResponse\r\n        }) => {\r\n          if (event.type === 'install') {\r\n            if (state && state.originalRequest && state.originalRequest instanceof Request) {\r\n              // TODO: `state` should never be undefined...\r\n              const url = state.originalRequest.url;\r\n              if (cachedResponse) {\r\n                this.notUpdatedURLs.push(url);\r\n              } else {\r\n                this.updatedURLs.push(url);\r\n              }\r\n            }\r\n          }\r\n          return cachedResponse;\r\n        };\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A plugin, designed to be used with PrecacheController, to translate URLs into\r\n     * the corresponding cache key, based on the current revision info.\r\n     *\r\n     * @private\r\n     */\r\n    class PrecacheCacheKeyPlugin {\r\n      constructor({\r\n        precacheController\r\n      }) {\r\n        this.cacheKeyWillBeUsed = async ({\r\n          request,\r\n          params\r\n        }) => {\r\n          // Params is type any, can't change right now.\r\n           \r\n          const cacheKey = (params === null || params === void 0 ? void 0 : params.cacheKey) || this._precacheController.getCacheKeyForURL(request.url);\r\n           \r\n          return cacheKey ? new Request(cacheKey, {\r\n            headers: request.headers\r\n          }) : request;\r\n        };\r\n        this._precacheController = precacheController;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * @param {string} groupTitle\r\n     * @param {Array<string>} deletedURLs\r\n     *\r\n     * @private\r\n     */\r\n    const logGroup = (groupTitle, deletedURLs) => {\r\n      logger.groupCollapsed(groupTitle);\r\n      for (const url of deletedURLs) {\r\n        logger.log(url);\r\n      }\r\n      logger.groupEnd();\r\n    };\r\n    /**\r\n     * @param {Array<string>} deletedURLs\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function printCleanupDetails(deletedURLs) {\r\n      const deletionCount = deletedURLs.length;\r\n      if (deletionCount > 0) {\r\n        logger.groupCollapsed(`During precaching cleanup, ` + `${deletionCount} cached ` + `request${deletionCount === 1 ? ' was' : 's were'} deleted.`);\r\n        logGroup('Deleted Cache Requests', deletedURLs);\r\n        logger.groupEnd();\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * @param {string} groupTitle\r\n     * @param {Array<string>} urls\r\n     *\r\n     * @private\r\n     */\r\n    function _nestedGroup(groupTitle, urls) {\r\n      if (urls.length === 0) {\r\n        return;\r\n      }\r\n      logger.groupCollapsed(groupTitle);\r\n      for (const url of urls) {\r\n        logger.log(url);\r\n      }\r\n      logger.groupEnd();\r\n    }\r\n    /**\r\n     * @param {Array<string>} urlsToPrecache\r\n     * @param {Array<string>} urlsAlreadyPrecached\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function printInstallDetails(urlsToPrecache, urlsAlreadyPrecached) {\r\n      const precachedCount = urlsToPrecache.length;\r\n      const alreadyPrecachedCount = urlsAlreadyPrecached.length;\r\n      if (precachedCount || alreadyPrecachedCount) {\r\n        let message = `Precaching ${precachedCount} file${precachedCount === 1 ? '' : 's'}.`;\r\n        if (alreadyPrecachedCount > 0) {\r\n          message += ` ${alreadyPrecachedCount} ` + `file${alreadyPrecachedCount === 1 ? ' is' : 's are'} already cached.`;\r\n        }\r\n        logger.groupCollapsed(message);\r\n        _nestedGroup(`View newly precached URLs.`, urlsToPrecache);\r\n        _nestedGroup(`View previously precached URLs.`, urlsAlreadyPrecached);\r\n        logger.groupEnd();\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    let supportStatus;\r\n    /**\r\n     * A utility function that determines whether the current browser supports\r\n     * constructing a new `Response` from a `response.body` stream.\r\n     *\r\n     * @return {boolean} `true`, if the current browser can successfully\r\n     *     construct a `Response` from a `response.body` stream, `false` otherwise.\r\n     *\r\n     * @private\r\n     */\r\n    function canConstructResponseFromBodyStream() {\r\n      if (supportStatus === undefined) {\r\n        const testResponse = new Response('');\r\n        if ('body' in testResponse) {\r\n          try {\r\n            new Response(testResponse.body);\r\n            supportStatus = true;\r\n          } catch (error) {\r\n            supportStatus = false;\r\n          }\r\n        }\r\n        supportStatus = false;\r\n      }\r\n      return supportStatus;\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Allows developers to copy a response and modify its `headers`, `status`,\r\n     * or `statusText` values (the values settable via a\r\n     * [`ResponseInit`]{@link https://developer.mozilla.org/en-US/docs/Web/API/Response/Response#Syntax}\r\n     * object in the constructor).\r\n     * To modify these values, pass a function as the second argument. That\r\n     * function will be invoked with a single object with the response properties\r\n     * `{headers, status, statusText}`. The return value of this function will\r\n     * be used as the `ResponseInit` for the new `Response`. To change the values\r\n     * either modify the passed parameter(s) and return it, or return a totally\r\n     * new object.\r\n     *\r\n     * This method is intentionally limited to same-origin responses, regardless of\r\n     * whether CORS was used or not.\r\n     *\r\n     * @param {Response} response\r\n     * @param {Function} modifier\r\n     * @memberof workbox-core\r\n     */\r\n    async function copyResponse(response, modifier) {\r\n      let origin = null;\r\n      // If response.url isn't set, assume it's cross-origin and keep origin null.\r\n      if (response.url) {\r\n        const responseURL = new URL(response.url);\r\n        origin = responseURL.origin;\r\n      }\r\n      if (origin !== self.location.origin) {\r\n        throw new WorkboxError('cross-origin-copy-response', {\r\n          origin\r\n        });\r\n      }\r\n      const clonedResponse = response.clone();\r\n      // Create a fresh `ResponseInit` object by cloning the headers.\r\n      const responseInit = {\r\n        headers: new Headers(clonedResponse.headers),\r\n        status: clonedResponse.status,\r\n        statusText: clonedResponse.statusText\r\n      };\r\n      // Apply any user modifications.\r\n      const modifiedResponseInit = modifier ? modifier(responseInit) : responseInit;\r\n      // Create the new response from the body stream and `ResponseInit`\r\n      // modifications. Note: not all browsers support the Response.body stream,\r\n      // so fall back to reading the entire body into memory as a blob.\r\n      const body = canConstructResponseFromBodyStream() ? clonedResponse.body : await clonedResponse.blob();\r\n      return new Response(body, modifiedResponseInit);\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    function stripParams(fullURL, ignoreParams) {\r\n      const strippedURL = new URL(fullURL);\r\n      for (const param of ignoreParams) {\r\n        strippedURL.searchParams.delete(param);\r\n      }\r\n      return strippedURL.href;\r\n    }\r\n    /**\r\n     * Matches an item in the cache, ignoring specific URL params. This is similar\r\n     * to the `ignoreSearch` option, but it allows you to ignore just specific\r\n     * params (while continuing to match on the others).\r\n     *\r\n     * @private\r\n     * @param {Cache} cache\r\n     * @param {Request} request\r\n     * @param {Object} matchOptions\r\n     * @param {Array<string>} ignoreParams\r\n     * @return {Promise<Response|undefined>}\r\n     */\r\n    async function cacheMatchIgnoreParams(cache, request, ignoreParams, matchOptions) {\r\n      const strippedRequestURL = stripParams(request.url, ignoreParams);\r\n      // If the request doesn't include any ignored params, match as normal.\r\n      if (request.url === strippedRequestURL) {\r\n        return cache.match(request, matchOptions);\r\n      }\r\n      // Otherwise, match by comparing keys\r\n      const keysOptions = Object.assign(Object.assign({}, matchOptions), {\r\n        ignoreSearch: true\r\n      });\r\n      const cacheKeys = await cache.keys(request, keysOptions);\r\n      for (const cacheKey of cacheKeys) {\r\n        const strippedCacheKeyURL = stripParams(cacheKey.url, ignoreParams);\r\n        if (strippedRequestURL === strippedCacheKeyURL) {\r\n          return cache.match(cacheKey, matchOptions);\r\n        }\r\n      }\r\n      return;\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * The Deferred class composes Promises in a way that allows for them to be\r\n     * resolved or rejected from outside the constructor. In most cases promises\r\n     * should be used directly, but Deferreds can be necessary when the logic to\r\n     * resolve a promise must be separate.\r\n     *\r\n     * @private\r\n     */\r\n    class Deferred {\r\n      /**\r\n       * Creates a promise and exposes its resolve and reject functions as methods.\r\n       */\r\n      constructor() {\r\n        this.promise = new Promise((resolve, reject) => {\r\n          this.resolve = resolve;\r\n          this.reject = reject;\r\n        });\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    // Callbacks to be executed whenever there's a quota error.\r\n    // Can't change Function type right now.\r\n    // eslint-disable-next-line @typescript-eslint/ban-types\r\n    const quotaErrorCallbacks = new Set();\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Runs all of the callback functions, one at a time sequentially, in the order\r\n     * in which they were registered.\r\n     *\r\n     * @memberof workbox-core\r\n     * @private\r\n     */\r\n    async function executeQuotaErrorCallbacks() {\r\n      {\r\n        logger.log(`About to run ${quotaErrorCallbacks.size} ` + `callbacks to clean up caches.`);\r\n      }\r\n      for (const callback of quotaErrorCallbacks) {\r\n        await callback();\r\n        {\r\n          logger.log(callback, 'is complete.');\r\n        }\r\n      }\r\n      {\r\n        logger.log('Finished running callbacks.');\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Returns a promise that resolves and the passed number of milliseconds.\r\n     * This utility is an async/await-friendly version of `setTimeout`.\r\n     *\r\n     * @param {number} ms\r\n     * @return {Promise}\r\n     * @private\r\n     */\r\n    function timeout(ms) {\r\n      return new Promise(resolve => setTimeout(resolve, ms));\r\n    }\r\n\r\n    // @ts-ignore\r\n    try {\r\n      self['workbox:strategies:7.3.0'] && _();\r\n    } catch (e) {}\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    function toRequest(input) {\r\n      return typeof input === 'string' ? new Request(input) : input;\r\n    }\r\n    /**\r\n     * A class created every time a Strategy instance calls\r\n     * {@link workbox-strategies.Strategy~handle} or\r\n     * {@link workbox-strategies.Strategy~handleAll} that wraps all fetch and\r\n     * cache actions around plugin callbacks and keeps track of when the strategy\r\n     * is \"done\" (i.e. all added `event.waitUntil()` promises have resolved).\r\n     *\r\n     * @memberof workbox-strategies\r\n     */\r\n    class StrategyHandler {\r\n      /**\r\n       * Creates a new instance associated with the passed strategy and event\r\n       * that's handling the request.\r\n       *\r\n       * The constructor also initializes the state that will be passed to each of\r\n       * the plugins handling this request.\r\n       *\r\n       * @param {workbox-strategies.Strategy} strategy\r\n       * @param {Object} options\r\n       * @param {Request|string} options.request A request to run this strategy for.\r\n       * @param {ExtendableEvent} options.event The event associated with the\r\n       *     request.\r\n       * @param {URL} [options.url]\r\n       * @param {*} [options.params] The return value from the\r\n       *     {@link workbox-routing~matchCallback} (if applicable).\r\n       */\r\n      constructor(strategy, options) {\r\n        this._cacheKeys = {};\r\n        /**\r\n         * The request the strategy is performing (passed to the strategy's\r\n         * `handle()` or `handleAll()` method).\r\n         * @name request\r\n         * @instance\r\n         * @type {Request}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        /**\r\n         * The event associated with this request.\r\n         * @name event\r\n         * @instance\r\n         * @type {ExtendableEvent}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        /**\r\n         * A `URL` instance of `request.url` (if passed to the strategy's\r\n         * `handle()` or `handleAll()` method).\r\n         * Note: the `url` param will be present if the strategy was invoked\r\n         * from a workbox `Route` object.\r\n         * @name url\r\n         * @instance\r\n         * @type {URL|undefined}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        /**\r\n         * A `param` value (if passed to the strategy's\r\n         * `handle()` or `handleAll()` method).\r\n         * Note: the `param` param will be present if the strategy was invoked\r\n         * from a workbox `Route` object and the\r\n         * {@link workbox-routing~matchCallback} returned\r\n         * a truthy value (it will be that value).\r\n         * @name params\r\n         * @instance\r\n         * @type {*|undefined}\r\n         * @memberof workbox-strategies.StrategyHandler\r\n         */\r\n        {\r\n          finalAssertExports.isInstance(options.event, ExtendableEvent, {\r\n            moduleName: 'workbox-strategies',\r\n            className: 'StrategyHandler',\r\n            funcName: 'constructor',\r\n            paramName: 'options.event'\r\n          });\r\n        }\r\n        Object.assign(this, options);\r\n        this.event = options.event;\r\n        this._strategy = strategy;\r\n        this._handlerDeferred = new Deferred();\r\n        this._extendLifetimePromises = [];\r\n        // Copy the plugins list (since it's mutable on the strategy),\r\n        // so any mutations don't affect this handler instance.\r\n        this._plugins = [...strategy.plugins];\r\n        this._pluginStateMap = new Map();\r\n        for (const plugin of this._plugins) {\r\n          this._pluginStateMap.set(plugin, {});\r\n        }\r\n        this.event.waitUntil(this._handlerDeferred.promise);\r\n      }\r\n      /**\r\n       * Fetches a given request (and invokes any applicable plugin callback\r\n       * methods) using the `fetchOptions` (for non-navigation requests) and\r\n       * `plugins` defined on the `Strategy` object.\r\n       *\r\n       * The following plugin lifecycle methods are invoked when using this method:\r\n       * - `requestWillFetch()`\r\n       * - `fetchDidSucceed()`\r\n       * - `fetchDidFail()`\r\n       *\r\n       * @param {Request|string} input The URL or request to fetch.\r\n       * @return {Promise<Response>}\r\n       */\r\n      async fetch(input) {\r\n        const {\r\n          event\r\n        } = this;\r\n        let request = toRequest(input);\r\n        if (request.mode === 'navigate' && event instanceof FetchEvent && event.preloadResponse) {\r\n          const possiblePreloadResponse = await event.preloadResponse;\r\n          if (possiblePreloadResponse) {\r\n            {\r\n              logger.log(`Using a preloaded navigation response for ` + `'${getFriendlyURL(request.url)}'`);\r\n            }\r\n            return possiblePreloadResponse;\r\n          }\r\n        }\r\n        // If there is a fetchDidFail plugin, we need to save a clone of the\r\n        // original request before it's either modified by a requestWillFetch\r\n        // plugin or before the original request's body is consumed via fetch().\r\n        const originalRequest = this.hasCallback('fetchDidFail') ? request.clone() : null;\r\n        try {\r\n          for (const cb of this.iterateCallbacks('requestWillFetch')) {\r\n            request = await cb({\r\n              request: request.clone(),\r\n              event\r\n            });\r\n          }\r\n        } catch (err) {\r\n          if (err instanceof Error) {\r\n            throw new WorkboxError('plugin-error-request-will-fetch', {\r\n              thrownErrorMessage: err.message\r\n            });\r\n          }\r\n        }\r\n        // The request can be altered by plugins with `requestWillFetch` making\r\n        // the original request (most likely from a `fetch` event) different\r\n        // from the Request we make. Pass both to `fetchDidFail` to aid debugging.\r\n        const pluginFilteredRequest = request.clone();\r\n        try {\r\n          let fetchResponse;\r\n          // See https://github.com/GoogleChrome/workbox/issues/1796\r\n          fetchResponse = await fetch(request, request.mode === 'navigate' ? undefined : this._strategy.fetchOptions);\r\n          if (\"development\" !== 'production') {\r\n            logger.debug(`Network request for ` + `'${getFriendlyURL(request.url)}' returned a response with ` + `status '${fetchResponse.status}'.`);\r\n          }\r\n          for (const callback of this.iterateCallbacks('fetchDidSucceed')) {\r\n            fetchResponse = await callback({\r\n              event,\r\n              request: pluginFilteredRequest,\r\n              response: fetchResponse\r\n            });\r\n          }\r\n          return fetchResponse;\r\n        } catch (error) {\r\n          {\r\n            logger.log(`Network request for ` + `'${getFriendlyURL(request.url)}' threw an error.`, error);\r\n          }\r\n          // `originalRequest` will only exist if a `fetchDidFail` callback\r\n          // is being used (see above).\r\n          if (originalRequest) {\r\n            await this.runCallbacks('fetchDidFail', {\r\n              error: error,\r\n              event,\r\n              originalRequest: originalRequest.clone(),\r\n              request: pluginFilteredRequest.clone()\r\n            });\r\n          }\r\n          throw error;\r\n        }\r\n      }\r\n      /**\r\n       * Calls `this.fetch()` and (in the background) runs `this.cachePut()` on\r\n       * the response generated by `this.fetch()`.\r\n       *\r\n       * The call to `this.cachePut()` automatically invokes `this.waitUntil()`,\r\n       * so you do not have to manually call `waitUntil()` on the event.\r\n       *\r\n       * @param {Request|string} input The request or URL to fetch and cache.\r\n       * @return {Promise<Response>}\r\n       */\r\n      async fetchAndCachePut(input) {\r\n        const response = await this.fetch(input);\r\n        const responseClone = response.clone();\r\n        void this.waitUntil(this.cachePut(input, responseClone));\r\n        return response;\r\n      }\r\n      /**\r\n       * Matches a request from the cache (and invokes any applicable plugin\r\n       * callback methods) using the `cacheName`, `matchOptions`, and `plugins`\r\n       * defined on the strategy object.\r\n       *\r\n       * The following plugin lifecycle methods are invoked when using this method:\r\n       * - cacheKeyWillBeUsed()\r\n       * - cachedResponseWillBeUsed()\r\n       *\r\n       * @param {Request|string} key The Request or URL to use as the cache key.\r\n       * @return {Promise<Response|undefined>} A matching response, if found.\r\n       */\r\n      async cacheMatch(key) {\r\n        const request = toRequest(key);\r\n        let cachedResponse;\r\n        const {\r\n          cacheName,\r\n          matchOptions\r\n        } = this._strategy;\r\n        const effectiveRequest = await this.getCacheKey(request, 'read');\r\n        const multiMatchOptions = Object.assign(Object.assign({}, matchOptions), {\r\n          cacheName\r\n        });\r\n        cachedResponse = await caches.match(effectiveRequest, multiMatchOptions);\r\n        {\r\n          if (cachedResponse) {\r\n            logger.debug(`Found a cached response in '${cacheName}'.`);\r\n          } else {\r\n            logger.debug(`No cached response found in '${cacheName}'.`);\r\n          }\r\n        }\r\n        for (const callback of this.iterateCallbacks('cachedResponseWillBeUsed')) {\r\n          cachedResponse = (await callback({\r\n            cacheName,\r\n            matchOptions,\r\n            cachedResponse,\r\n            request: effectiveRequest,\r\n            event: this.event\r\n          })) || undefined;\r\n        }\r\n        return cachedResponse;\r\n      }\r\n      /**\r\n       * Puts a request/response pair in the cache (and invokes any applicable\r\n       * plugin callback methods) using the `cacheName` and `plugins` defined on\r\n       * the strategy object.\r\n       *\r\n       * The following plugin lifecycle methods are invoked when using this method:\r\n       * - cacheKeyWillBeUsed()\r\n       * - cacheWillUpdate()\r\n       * - cacheDidUpdate()\r\n       *\r\n       * @param {Request|string} key The request or URL to use as the cache key.\r\n       * @param {Response} response The response to cache.\r\n       * @return {Promise<boolean>} `false` if a cacheWillUpdate caused the response\r\n       * not be cached, and `true` otherwise.\r\n       */\r\n      async cachePut(key, response) {\r\n        const request = toRequest(key);\r\n        // Run in the next task to avoid blocking other cache reads.\r\n        // https://github.com/w3c/ServiceWorker/issues/1397\r\n        await timeout(0);\r\n        const effectiveRequest = await this.getCacheKey(request, 'write');\r\n        {\r\n          if (effectiveRequest.method && effectiveRequest.method !== 'GET') {\r\n            throw new WorkboxError('attempt-to-cache-non-get-request', {\r\n              url: getFriendlyURL(effectiveRequest.url),\r\n              method: effectiveRequest.method\r\n            });\r\n          }\r\n          // See https://github.com/GoogleChrome/workbox/issues/2818\r\n          const vary = response.headers.get('Vary');\r\n          if (vary) {\r\n            logger.debug(`The response for ${getFriendlyURL(effectiveRequest.url)} ` + `has a 'Vary: ${vary}' header. ` + `Consider setting the {ignoreVary: true} option on your strategy ` + `to ensure cache matching and deletion works as expected.`);\r\n          }\r\n        }\r\n        if (!response) {\r\n          {\r\n            logger.error(`Cannot cache non-existent response for ` + `'${getFriendlyURL(effectiveRequest.url)}'.`);\r\n          }\r\n          throw new WorkboxError('cache-put-with-no-response', {\r\n            url: getFriendlyURL(effectiveRequest.url)\r\n          });\r\n        }\r\n        const responseToCache = await this._ensureResponseSafeToCache(response);\r\n        if (!responseToCache) {\r\n          {\r\n            logger.debug(`Response '${getFriendlyURL(effectiveRequest.url)}' ` + `will not be cached.`, responseToCache);\r\n          }\r\n          return false;\r\n        }\r\n        const {\r\n          cacheName,\r\n          matchOptions\r\n        } = this._strategy;\r\n        const cache = await self.caches.open(cacheName);\r\n        const hasCacheUpdateCallback = this.hasCallback('cacheDidUpdate');\r\n        const oldResponse = hasCacheUpdateCallback ? await cacheMatchIgnoreParams(\r\n        // TODO(philipwalton): the `__WB_REVISION__` param is a precaching\r\n        // feature. Consider into ways to only add this behavior if using\r\n        // precaching.\r\n        cache, effectiveRequest.clone(), ['__WB_REVISION__'], matchOptions) : null;\r\n        {\r\n          logger.debug(`Updating the '${cacheName}' cache with a new Response ` + `for ${getFriendlyURL(effectiveRequest.url)}.`);\r\n        }\r\n        try {\r\n          await cache.put(effectiveRequest, hasCacheUpdateCallback ? responseToCache.clone() : responseToCache);\r\n        } catch (error) {\r\n          if (error instanceof Error) {\r\n            // See https://developer.mozilla.org/en-US/docs/Web/API/DOMException#exception-QuotaExceededError\r\n            if (error.name === 'QuotaExceededError') {\r\n              await executeQuotaErrorCallbacks();\r\n            }\r\n            throw error;\r\n          }\r\n        }\r\n        for (const callback of this.iterateCallbacks('cacheDidUpdate')) {\r\n          await callback({\r\n            cacheName,\r\n            oldResponse,\r\n            newResponse: responseToCache.clone(),\r\n            request: effectiveRequest,\r\n            event: this.event\r\n          });\r\n        }\r\n        return true;\r\n      }\r\n      /**\r\n       * Checks the list of plugins for the `cacheKeyWillBeUsed` callback, and\r\n       * executes any of those callbacks found in sequence. The final `Request`\r\n       * object returned by the last plugin is treated as the cache key for cache\r\n       * reads and/or writes. If no `cacheKeyWillBeUsed` plugin callbacks have\r\n       * been registered, the passed request is returned unmodified\r\n       *\r\n       * @param {Request} request\r\n       * @param {string} mode\r\n       * @return {Promise<Request>}\r\n       */\r\n      async getCacheKey(request, mode) {\r\n        const key = `${request.url} | ${mode}`;\r\n        if (!this._cacheKeys[key]) {\r\n          let effectiveRequest = request;\r\n          for (const callback of this.iterateCallbacks('cacheKeyWillBeUsed')) {\r\n            effectiveRequest = toRequest(await callback({\r\n              mode,\r\n              request: effectiveRequest,\r\n              event: this.event,\r\n              // params has a type any can't change right now.\r\n              params: this.params  \r\n            }));\r\n          }\r\n          this._cacheKeys[key] = effectiveRequest;\r\n        }\r\n        return this._cacheKeys[key];\r\n      }\r\n      /**\r\n       * Returns true if the strategy has at least one plugin with the given\r\n       * callback.\r\n       *\r\n       * @param {string} name The name of the callback to check for.\r\n       * @return {boolean}\r\n       */\r\n      hasCallback(name) {\r\n        for (const plugin of this._strategy.plugins) {\r\n          if (name in plugin) {\r\n            return true;\r\n          }\r\n        }\r\n        return false;\r\n      }\r\n      /**\r\n       * Runs all plugin callbacks matching the given name, in order, passing the\r\n       * given param object (merged ith the current plugin state) as the only\r\n       * argument.\r\n       *\r\n       * Note: since this method runs all plugins, it's not suitable for cases\r\n       * where the return value of a callback needs to be applied prior to calling\r\n       * the next callback. See\r\n       * {@link workbox-strategies.StrategyHandler#iterateCallbacks}\r\n       * below for how to handle that case.\r\n       *\r\n       * @param {string} name The name of the callback to run within each plugin.\r\n       * @param {Object} param The object to pass as the first (and only) param\r\n       *     when executing each callback. This object will be merged with the\r\n       *     current plugin state prior to callback execution.\r\n       */\r\n      async runCallbacks(name, param) {\r\n        for (const callback of this.iterateCallbacks(name)) {\r\n          // TODO(philipwalton): not sure why `any` is needed. It seems like\r\n          // this should work with `as WorkboxPluginCallbackParam[C]`.\r\n          await callback(param);\r\n        }\r\n      }\r\n      /**\r\n       * Accepts a callback and returns an iterable of matching plugin callbacks,\r\n       * where each callback is wrapped with the current handler state (i.e. when\r\n       * you call each callback, whatever object parameter you pass it will\r\n       * be merged with the plugin's current state).\r\n       *\r\n       * @param {string} name The name fo the callback to run\r\n       * @return {Array<Function>}\r\n       */\r\n      *iterateCallbacks(name) {\r\n        for (const plugin of this._strategy.plugins) {\r\n          if (typeof plugin[name] === 'function') {\r\n            const state = this._pluginStateMap.get(plugin);\r\n            const statefulCallback = param => {\r\n              const statefulParam = Object.assign(Object.assign({}, param), {\r\n                state\r\n              });\r\n              // TODO(philipwalton): not sure why `any` is needed. It seems like\r\n              // this should work with `as WorkboxPluginCallbackParam[C]`.\r\n              return plugin[name](statefulParam);\r\n            };\r\n            yield statefulCallback;\r\n          }\r\n        }\r\n      }\r\n      /**\r\n       * Adds a promise to the\r\n       * [extend lifetime promises]{@link https://w3c.github.io/ServiceWorker/#extendableevent-extend-lifetime-promises}\r\n       * of the event associated with the request being handled (usually a\r\n       * `FetchEvent`).\r\n       *\r\n       * Note: you can await\r\n       * {@link workbox-strategies.StrategyHandler~doneWaiting}\r\n       * to know when all added promises have settled.\r\n       *\r\n       * @param {Promise} promise A promise to add to the extend lifetime promises\r\n       *     of the event that triggered the request.\r\n       */\r\n      waitUntil(promise) {\r\n        this._extendLifetimePromises.push(promise);\r\n        return promise;\r\n      }\r\n      /**\r\n       * Returns a promise that resolves once all promises passed to\r\n       * {@link workbox-strategies.StrategyHandler~waitUntil}\r\n       * have settled.\r\n       *\r\n       * Note: any work done after `doneWaiting()` settles should be manually\r\n       * passed to an event's `waitUntil()` method (not this handler's\r\n       * `waitUntil()` method), otherwise the service worker thread may be killed\r\n       * prior to your work completing.\r\n       */\r\n      async doneWaiting() {\r\n        while (this._extendLifetimePromises.length) {\r\n          const promises = this._extendLifetimePromises.splice(0);\r\n          const result = await Promise.allSettled(promises);\r\n          const firstRejection = result.find(i => i.status === 'rejected');\r\n          if (firstRejection) {\r\n            throw firstRejection.reason;\r\n          }\r\n        }\r\n      }\r\n      /**\r\n       * Stops running the strategy and immediately resolves any pending\r\n       * `waitUntil()` promises.\r\n       */\r\n      destroy() {\r\n        this._handlerDeferred.resolve(null);\r\n      }\r\n      /**\r\n       * This method will call cacheWillUpdate on the available plugins (or use\r\n       * status === 200) to determine if the Response is safe and valid to cache.\r\n       *\r\n       * @param {Request} options.request\r\n       * @param {Response} options.response\r\n       * @return {Promise<Response|undefined>}\r\n       *\r\n       * @private\r\n       */\r\n      async _ensureResponseSafeToCache(response) {\r\n        let responseToCache = response;\r\n        let pluginsUsed = false;\r\n        for (const callback of this.iterateCallbacks('cacheWillUpdate')) {\r\n          responseToCache = (await callback({\r\n            request: this.request,\r\n            response: responseToCache,\r\n            event: this.event\r\n          })) || undefined;\r\n          pluginsUsed = true;\r\n          if (!responseToCache) {\r\n            break;\r\n          }\r\n        }\r\n        if (!pluginsUsed) {\r\n          if (responseToCache && responseToCache.status !== 200) {\r\n            responseToCache = undefined;\r\n          }\r\n          {\r\n            if (responseToCache) {\r\n              if (responseToCache.status !== 200) {\r\n                if (responseToCache.status === 0) {\r\n                  logger.warn(`The response for '${this.request.url}' ` + `is an opaque response. The caching strategy that you're ` + `using will not cache opaque responses by default.`);\r\n                } else {\r\n                  logger.debug(`The response for '${this.request.url}' ` + `returned a status code of '${response.status}' and won't ` + `be cached as a result.`);\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n        return responseToCache;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * An abstract base class that all other strategy classes must extend from:\r\n     *\r\n     * @memberof workbox-strategies\r\n     */\r\n    class Strategy {\r\n      /**\r\n       * Creates a new instance of the strategy and sets all documented option\r\n       * properties as public instance properties.\r\n       *\r\n       * Note: if a custom strategy class extends the base Strategy class and does\r\n       * not need more than these properties, it does not need to define its own\r\n       * constructor.\r\n       *\r\n       * @param {Object} [options]\r\n       * @param {string} [options.cacheName] Cache name to store and retrieve\r\n       * requests. Defaults to the cache names provided by\r\n       * {@link workbox-core.cacheNames}.\r\n       * @param {Array<Object>} [options.plugins] [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\r\n       * to use in conjunction with this caching strategy.\r\n       * @param {Object} [options.fetchOptions] Values passed along to the\r\n       * [`init`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters)\r\n       * of [non-navigation](https://github.com/GoogleChrome/workbox/issues/1796)\r\n       * `fetch()` requests made by this strategy.\r\n       * @param {Object} [options.matchOptions] The\r\n       * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}\r\n       * for any `cache.match()` or `cache.put()` calls made by this strategy.\r\n       */\r\n      constructor(options = {}) {\r\n        /**\r\n         * Cache name to store and retrieve\r\n         * requests. Defaults to the cache names provided by\r\n         * {@link workbox-core.cacheNames}.\r\n         *\r\n         * @type {string}\r\n         */\r\n        this.cacheName = cacheNames.getRuntimeName(options.cacheName);\r\n        /**\r\n         * The list\r\n         * [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\r\n         * used by this strategy.\r\n         *\r\n         * @type {Array<Object>}\r\n         */\r\n        this.plugins = options.plugins || [];\r\n        /**\r\n         * Values passed along to the\r\n         * [`init`]{@link https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters}\r\n         * of all fetch() requests made by this strategy.\r\n         *\r\n         * @type {Object}\r\n         */\r\n        this.fetchOptions = options.fetchOptions;\r\n        /**\r\n         * The\r\n         * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}\r\n         * for any `cache.match()` or `cache.put()` calls made by this strategy.\r\n         *\r\n         * @type {Object}\r\n         */\r\n        this.matchOptions = options.matchOptions;\r\n      }\r\n      /**\r\n       * Perform a request strategy and returns a `Promise` that will resolve with\r\n       * a `Response`, invoking all relevant plugin callbacks.\r\n       *\r\n       * When a strategy instance is registered with a Workbox\r\n       * {@link workbox-routing.Route}, this method is automatically\r\n       * called when the route matches.\r\n       *\r\n       * Alternatively, this method can be used in a standalone `FetchEvent`\r\n       * listener by passing it to `event.respondWith()`.\r\n       *\r\n       * @param {FetchEvent|Object} options A `FetchEvent` or an object with the\r\n       *     properties listed below.\r\n       * @param {Request|string} options.request A request to run this strategy for.\r\n       * @param {ExtendableEvent} options.event The event associated with the\r\n       *     request.\r\n       * @param {URL} [options.url]\r\n       * @param {*} [options.params]\r\n       */\r\n      handle(options) {\r\n        const [responseDone] = this.handleAll(options);\r\n        return responseDone;\r\n      }\r\n      /**\r\n       * Similar to {@link workbox-strategies.Strategy~handle}, but\r\n       * instead of just returning a `Promise` that resolves to a `Response` it\r\n       * it will return an tuple of `[response, done]` promises, where the former\r\n       * (`response`) is equivalent to what `handle()` returns, and the latter is a\r\n       * Promise that will resolve once any promises that were added to\r\n       * `event.waitUntil()` as part of performing the strategy have completed.\r\n       *\r\n       * You can await the `done` promise to ensure any extra work performed by\r\n       * the strategy (usually caching responses) completes successfully.\r\n       *\r\n       * @param {FetchEvent|Object} options A `FetchEvent` or an object with the\r\n       *     properties listed below.\r\n       * @param {Request|string} options.request A request to run this strategy for.\r\n       * @param {ExtendableEvent} options.event The event associated with the\r\n       *     request.\r\n       * @param {URL} [options.url]\r\n       * @param {*} [options.params]\r\n       * @return {Array<Promise>} A tuple of [response, done]\r\n       *     promises that can be used to determine when the response resolves as\r\n       *     well as when the handler has completed all its work.\r\n       */\r\n      handleAll(options) {\r\n        // Allow for flexible options to be passed.\r\n        if (options instanceof FetchEvent) {\r\n          options = {\r\n            event: options,\r\n            request: options.request\r\n          };\r\n        }\r\n        const event = options.event;\r\n        const request = typeof options.request === 'string' ? new Request(options.request) : options.request;\r\n        const params = 'params' in options ? options.params : undefined;\r\n        const handler = new StrategyHandler(this, {\r\n          event,\r\n          request,\r\n          params\r\n        });\r\n        const responseDone = this._getResponse(handler, request, event);\r\n        const handlerDone = this._awaitComplete(responseDone, handler, request, event);\r\n        // Return an array of promises, suitable for use with Promise.all().\r\n        return [responseDone, handlerDone];\r\n      }\r\n      async _getResponse(handler, request, event) {\r\n        await handler.runCallbacks('handlerWillStart', {\r\n          event,\r\n          request\r\n        });\r\n        let response = undefined;\r\n        try {\r\n          response = await this._handle(request, handler);\r\n          // The \"official\" Strategy subclasses all throw this error automatically,\r\n          // but in case a third-party Strategy doesn't, ensure that we have a\r\n          // consistent failure when there's no response or an error response.\r\n          if (!response || response.type === 'error') {\r\n            throw new WorkboxError('no-response', {\r\n              url: request.url\r\n            });\r\n          }\r\n        } catch (error) {\r\n          if (error instanceof Error) {\r\n            for (const callback of handler.iterateCallbacks('handlerDidError')) {\r\n              response = await callback({\r\n                error,\r\n                event,\r\n                request\r\n              });\r\n              if (response) {\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          if (!response) {\r\n            throw error;\r\n          } else {\r\n            logger.log(`While responding to '${getFriendlyURL(request.url)}', ` + `an ${error instanceof Error ? error.toString() : ''} error occurred. Using a fallback response provided by ` + `a handlerDidError plugin.`);\r\n          }\r\n        }\r\n        for (const callback of handler.iterateCallbacks('handlerWillRespond')) {\r\n          response = await callback({\r\n            event,\r\n            request,\r\n            response\r\n          });\r\n        }\r\n        return response;\r\n      }\r\n      async _awaitComplete(responseDone, handler, request, event) {\r\n        let response;\r\n        let error;\r\n        try {\r\n          response = await responseDone;\r\n        } catch (error) {\r\n          // Ignore errors, as response errors should be caught via the `response`\r\n          // promise above. The `done` promise will only throw for errors in\r\n          // promises passed to `handler.waitUntil()`.\r\n        }\r\n        try {\r\n          await handler.runCallbacks('handlerDidRespond', {\r\n            event,\r\n            request,\r\n            response\r\n          });\r\n          await handler.doneWaiting();\r\n        } catch (waitUntilError) {\r\n          if (waitUntilError instanceof Error) {\r\n            error = waitUntilError;\r\n          }\r\n        }\r\n        await handler.runCallbacks('handlerDidComplete', {\r\n          event,\r\n          request,\r\n          response,\r\n          error: error\r\n        });\r\n        handler.destroy();\r\n        if (error) {\r\n          throw error;\r\n        }\r\n      }\r\n    }\r\n    /**\r\n     * Classes extending the `Strategy` based class should implement this method,\r\n     * and leverage the {@link workbox-strategies.StrategyHandler}\r\n     * arg to perform all fetching and cache logic, which will ensure all relevant\r\n     * cache, cache options, fetch options and plugins are used (per the current\r\n     * strategy instance).\r\n     *\r\n     * @name _handle\r\n     * @instance\r\n     * @abstract\r\n     * @function\r\n     * @param {Request} request\r\n     * @param {workbox-strategies.StrategyHandler} handler\r\n     * @return {Promise<Response>}\r\n     *\r\n     * @memberof workbox-strategies.Strategy\r\n     */\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A {@link workbox-strategies.Strategy} implementation\r\n     * specifically designed to work with\r\n     * {@link workbox-precaching.PrecacheController}\r\n     * to both cache and fetch precached assets.\r\n     *\r\n     * Note: an instance of this class is created automatically when creating a\r\n     * `PrecacheController`; it's generally not necessary to create this yourself.\r\n     *\r\n     * @extends workbox-strategies.Strategy\r\n     * @memberof workbox-precaching\r\n     */\r\n    class PrecacheStrategy extends Strategy {\r\n      /**\r\n       *\r\n       * @param {Object} [options]\r\n       * @param {string} [options.cacheName] Cache name to store and retrieve\r\n       * requests. Defaults to the cache names provided by\r\n       * {@link workbox-core.cacheNames}.\r\n       * @param {Array<Object>} [options.plugins] {@link https://developers.google.com/web/tools/workbox/guides/using-plugins|Plugins}\r\n       * to use in conjunction with this caching strategy.\r\n       * @param {Object} [options.fetchOptions] Values passed along to the\r\n       * {@link https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters|init}\r\n       * of all fetch() requests made by this strategy.\r\n       * @param {Object} [options.matchOptions] The\r\n       * {@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions|CacheQueryOptions}\r\n       * for any `cache.match()` or `cache.put()` calls made by this strategy.\r\n       * @param {boolean} [options.fallbackToNetwork=true] Whether to attempt to\r\n       * get the response from the network if there's a precache miss.\r\n       */\r\n      constructor(options = {}) {\r\n        options.cacheName = cacheNames.getPrecacheName(options.cacheName);\r\n        super(options);\r\n        this._fallbackToNetwork = options.fallbackToNetwork === false ? false : true;\r\n        // Redirected responses cannot be used to satisfy a navigation request, so\r\n        // any redirected response must be \"copied\" rather than cloned, so the new\r\n        // response doesn't contain the `redirected` flag. See:\r\n        // https://bugs.chromium.org/p/chromium/issues/detail?id=669363&desc=2#c1\r\n        this.plugins.push(PrecacheStrategy.copyRedirectedCacheableResponsesPlugin);\r\n      }\r\n      /**\r\n       * @private\r\n       * @param {Request|string} request A request to run this strategy for.\r\n       * @param {workbox-strategies.StrategyHandler} handler The event that\r\n       *     triggered the request.\r\n       * @return {Promise<Response>}\r\n       */\r\n      async _handle(request, handler) {\r\n        const response = await handler.cacheMatch(request);\r\n        if (response) {\r\n          return response;\r\n        }\r\n        // If this is an `install` event for an entry that isn't already cached,\r\n        // then populate the cache.\r\n        if (handler.event && handler.event.type === 'install') {\r\n          return await this._handleInstall(request, handler);\r\n        }\r\n        // Getting here means something went wrong. An entry that should have been\r\n        // precached wasn't found in the cache.\r\n        return await this._handleFetch(request, handler);\r\n      }\r\n      async _handleFetch(request, handler) {\r\n        let response;\r\n        const params = handler.params || {};\r\n        // Fall back to the network if we're configured to do so.\r\n        if (this._fallbackToNetwork) {\r\n          {\r\n            logger.warn(`The precached response for ` + `${getFriendlyURL(request.url)} in ${this.cacheName} was not ` + `found. Falling back to the network.`);\r\n          }\r\n          const integrityInManifest = params.integrity;\r\n          const integrityInRequest = request.integrity;\r\n          const noIntegrityConflict = !integrityInRequest || integrityInRequest === integrityInManifest;\r\n          // Do not add integrity if the original request is no-cors\r\n          // See https://github.com/GoogleChrome/workbox/issues/3096\r\n          response = await handler.fetch(new Request(request, {\r\n            integrity: request.mode !== 'no-cors' ? integrityInRequest || integrityInManifest : undefined\r\n          }));\r\n          // It's only \"safe\" to repair the cache if we're using SRI to guarantee\r\n          // that the response matches the precache manifest's expectations,\r\n          // and there's either a) no integrity property in the incoming request\r\n          // or b) there is an integrity, and it matches the precache manifest.\r\n          // See https://github.com/GoogleChrome/workbox/issues/2858\r\n          // Also if the original request users no-cors we don't use integrity.\r\n          // See https://github.com/GoogleChrome/workbox/issues/3096\r\n          if (integrityInManifest && noIntegrityConflict && request.mode !== 'no-cors') {\r\n            this._useDefaultCacheabilityPluginIfNeeded();\r\n            const wasCached = await handler.cachePut(request, response.clone());\r\n            {\r\n              if (wasCached) {\r\n                logger.log(`A response for ${getFriendlyURL(request.url)} ` + `was used to \"repair\" the precache.`);\r\n              }\r\n            }\r\n          }\r\n        } else {\r\n          // This shouldn't normally happen, but there are edge cases:\r\n          // https://github.com/GoogleChrome/workbox/issues/1441\r\n          throw new WorkboxError('missing-precache-entry', {\r\n            cacheName: this.cacheName,\r\n            url: request.url\r\n          });\r\n        }\r\n        {\r\n          const cacheKey = params.cacheKey || (await handler.getCacheKey(request, 'read'));\r\n          // Workbox is going to handle the route.\r\n          // print the routing details to the console.\r\n          logger.groupCollapsed(`Precaching is responding to: ` + getFriendlyURL(request.url));\r\n          logger.log(`Serving the precached url: ${getFriendlyURL(cacheKey instanceof Request ? cacheKey.url : cacheKey)}`);\r\n          logger.groupCollapsed(`View request details here.`);\r\n          logger.log(request);\r\n          logger.groupEnd();\r\n          logger.groupCollapsed(`View response details here.`);\r\n          logger.log(response);\r\n          logger.groupEnd();\r\n          logger.groupEnd();\r\n        }\r\n        return response;\r\n      }\r\n      async _handleInstall(request, handler) {\r\n        this._useDefaultCacheabilityPluginIfNeeded();\r\n        const response = await handler.fetch(request);\r\n        // Make sure we defer cachePut() until after we know the response\r\n        // should be cached; see https://github.com/GoogleChrome/workbox/issues/2737\r\n        const wasCached = await handler.cachePut(request, response.clone());\r\n        if (!wasCached) {\r\n          // Throwing here will lead to the `install` handler failing, which\r\n          // we want to do if *any* of the responses aren't safe to cache.\r\n          throw new WorkboxError('bad-precaching-response', {\r\n            url: request.url,\r\n            status: response.status\r\n          });\r\n        }\r\n        return response;\r\n      }\r\n      /**\r\n       * This method is complex, as there a number of things to account for:\r\n       *\r\n       * The `plugins` array can be set at construction, and/or it might be added to\r\n       * to at any time before the strategy is used.\r\n       *\r\n       * At the time the strategy is used (i.e. during an `install` event), there\r\n       * needs to be at least one plugin that implements `cacheWillUpdate` in the\r\n       * array, other than `copyRedirectedCacheableResponsesPlugin`.\r\n       *\r\n       * - If this method is called and there are no suitable `cacheWillUpdate`\r\n       * plugins, we need to add `defaultPrecacheCacheabilityPlugin`.\r\n       *\r\n       * - If this method is called and there is exactly one `cacheWillUpdate`, then\r\n       * we don't have to do anything (this might be a previously added\r\n       * `defaultPrecacheCacheabilityPlugin`, or it might be a custom plugin).\r\n       *\r\n       * - If this method is called and there is more than one `cacheWillUpdate`,\r\n       * then we need to check if one is `defaultPrecacheCacheabilityPlugin`. If so,\r\n       * we need to remove it. (This situation is unlikely, but it could happen if\r\n       * the strategy is used multiple times, the first without a `cacheWillUpdate`,\r\n       * and then later on after manually adding a custom `cacheWillUpdate`.)\r\n       *\r\n       * See https://github.com/GoogleChrome/workbox/issues/2737 for more context.\r\n       *\r\n       * @private\r\n       */\r\n      _useDefaultCacheabilityPluginIfNeeded() {\r\n        let defaultPluginIndex = null;\r\n        let cacheWillUpdatePluginCount = 0;\r\n        for (const [index, plugin] of this.plugins.entries()) {\r\n          // Ignore the copy redirected plugin when determining what to do.\r\n          if (plugin === PrecacheStrategy.copyRedirectedCacheableResponsesPlugin) {\r\n            continue;\r\n          }\r\n          // Save the default plugin's index, in case it needs to be removed.\r\n          if (plugin === PrecacheStrategy.defaultPrecacheCacheabilityPlugin) {\r\n            defaultPluginIndex = index;\r\n          }\r\n          if (plugin.cacheWillUpdate) {\r\n            cacheWillUpdatePluginCount++;\r\n          }\r\n        }\r\n        if (cacheWillUpdatePluginCount === 0) {\r\n          this.plugins.push(PrecacheStrategy.defaultPrecacheCacheabilityPlugin);\r\n        } else if (cacheWillUpdatePluginCount > 1 && defaultPluginIndex !== null) {\r\n          // Only remove the default plugin; multiple custom plugins are allowed.\r\n          this.plugins.splice(defaultPluginIndex, 1);\r\n        }\r\n        // Nothing needs to be done if cacheWillUpdatePluginCount is 1\r\n      }\r\n    }\r\n    PrecacheStrategy.defaultPrecacheCacheabilityPlugin = {\r\n      async cacheWillUpdate({\r\n        response\r\n      }) {\r\n        if (!response || response.status >= 400) {\r\n          return null;\r\n        }\r\n        return response;\r\n      }\r\n    };\r\n    PrecacheStrategy.copyRedirectedCacheableResponsesPlugin = {\r\n      async cacheWillUpdate({\r\n        response\r\n      }) {\r\n        return response.redirected ? await copyResponse(response) : response;\r\n      }\r\n    };\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Performs efficient precaching of assets.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    class PrecacheController {\r\n      /**\r\n       * Create a new PrecacheController.\r\n       *\r\n       * @param {Object} [options]\r\n       * @param {string} [options.cacheName] The cache to use for precaching.\r\n       * @param {string} [options.plugins] Plugins to use when precaching as well\r\n       * as responding to fetch events for precached assets.\r\n       * @param {boolean} [options.fallbackToNetwork=true] Whether to attempt to\r\n       * get the response from the network if there's a precache miss.\r\n       */\r\n      constructor({\r\n        cacheName,\r\n        plugins = [],\r\n        fallbackToNetwork = true\r\n      } = {}) {\r\n        this._urlsToCacheKeys = new Map();\r\n        this._urlsToCacheModes = new Map();\r\n        this._cacheKeysToIntegrities = new Map();\r\n        this._strategy = new PrecacheStrategy({\r\n          cacheName: cacheNames.getPrecacheName(cacheName),\r\n          plugins: [...plugins, new PrecacheCacheKeyPlugin({\r\n            precacheController: this\r\n          })],\r\n          fallbackToNetwork\r\n        });\r\n        // Bind the install and activate methods to the instance.\r\n        this.install = this.install.bind(this);\r\n        this.activate = this.activate.bind(this);\r\n      }\r\n      /**\r\n       * @type {workbox-precaching.PrecacheStrategy} The strategy created by this controller and\r\n       * used to cache assets and respond to fetch events.\r\n       */\r\n      get strategy() {\r\n        return this._strategy;\r\n      }\r\n      /**\r\n       * Adds items to the precache list, removing any duplicates and\r\n       * stores the files in the\r\n       * {@link workbox-core.cacheNames|\"precache cache\"} when the service\r\n       * worker installs.\r\n       *\r\n       * This method can be called multiple times.\r\n       *\r\n       * @param {Array<Object|string>} [entries=[]] Array of entries to precache.\r\n       */\r\n      precache(entries) {\r\n        this.addToCacheList(entries);\r\n        if (!this._installAndActiveListenersAdded) {\r\n          self.addEventListener('install', this.install);\r\n          self.addEventListener('activate', this.activate);\r\n          this._installAndActiveListenersAdded = true;\r\n        }\r\n      }\r\n      /**\r\n       * This method will add items to the precache list, removing duplicates\r\n       * and ensuring the information is valid.\r\n       *\r\n       * @param {Array<workbox-precaching.PrecacheController.PrecacheEntry|string>} entries\r\n       *     Array of entries to precache.\r\n       */\r\n      addToCacheList(entries) {\r\n        {\r\n          finalAssertExports.isArray(entries, {\r\n            moduleName: 'workbox-precaching',\r\n            className: 'PrecacheController',\r\n            funcName: 'addToCacheList',\r\n            paramName: 'entries'\r\n          });\r\n        }\r\n        const urlsToWarnAbout = [];\r\n        for (const entry of entries) {\r\n          // See https://github.com/GoogleChrome/workbox/issues/2259\r\n          if (typeof entry === 'string') {\r\n            urlsToWarnAbout.push(entry);\r\n          } else if (entry && entry.revision === undefined) {\r\n            urlsToWarnAbout.push(entry.url);\r\n          }\r\n          const {\r\n            cacheKey,\r\n            url\r\n          } = createCacheKey(entry);\r\n          const cacheMode = typeof entry !== 'string' && entry.revision ? 'reload' : 'default';\r\n          if (this._urlsToCacheKeys.has(url) && this._urlsToCacheKeys.get(url) !== cacheKey) {\r\n            throw new WorkboxError('add-to-cache-list-conflicting-entries', {\r\n              firstEntry: this._urlsToCacheKeys.get(url),\r\n              secondEntry: cacheKey\r\n            });\r\n          }\r\n          if (typeof entry !== 'string' && entry.integrity) {\r\n            if (this._cacheKeysToIntegrities.has(cacheKey) && this._cacheKeysToIntegrities.get(cacheKey) !== entry.integrity) {\r\n              throw new WorkboxError('add-to-cache-list-conflicting-integrities', {\r\n                url\r\n              });\r\n            }\r\n            this._cacheKeysToIntegrities.set(cacheKey, entry.integrity);\r\n          }\r\n          this._urlsToCacheKeys.set(url, cacheKey);\r\n          this._urlsToCacheModes.set(url, cacheMode);\r\n          if (urlsToWarnAbout.length > 0) {\r\n            const warningMessage = `Workbox is precaching URLs without revision ` + `info: ${urlsToWarnAbout.join(', ')}\\nThis is generally NOT safe. ` + `Learn more at https://bit.ly/wb-precache`;\r\n            {\r\n              logger.warn(warningMessage);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      /**\r\n       * Precaches new and updated assets. Call this method from the service worker\r\n       * install event.\r\n       *\r\n       * Note: this method calls `event.waitUntil()` for you, so you do not need\r\n       * to call it yourself in your event handlers.\r\n       *\r\n       * @param {ExtendableEvent} event\r\n       * @return {Promise<workbox-precaching.InstallResult>}\r\n       */\r\n      install(event) {\r\n        // waitUntil returns Promise<any>\r\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\r\n        return waitUntil(event, async () => {\r\n          const installReportPlugin = new PrecacheInstallReportPlugin();\r\n          this.strategy.plugins.push(installReportPlugin);\r\n          // Cache entries one at a time.\r\n          // See https://github.com/GoogleChrome/workbox/issues/2528\r\n          for (const [url, cacheKey] of this._urlsToCacheKeys) {\r\n            const integrity = this._cacheKeysToIntegrities.get(cacheKey);\r\n            const cacheMode = this._urlsToCacheModes.get(url);\r\n            const request = new Request(url, {\r\n              integrity,\r\n              cache: cacheMode,\r\n              credentials: 'same-origin'\r\n            });\r\n            await Promise.all(this.strategy.handleAll({\r\n              params: {\r\n                cacheKey\r\n              },\r\n              request,\r\n              event\r\n            }));\r\n          }\r\n          const {\r\n            updatedURLs,\r\n            notUpdatedURLs\r\n          } = installReportPlugin;\r\n          {\r\n            printInstallDetails(updatedURLs, notUpdatedURLs);\r\n          }\r\n          return {\r\n            updatedURLs,\r\n            notUpdatedURLs\r\n          };\r\n        });\r\n      }\r\n      /**\r\n       * Deletes assets that are no longer present in the current precache manifest.\r\n       * Call this method from the service worker activate event.\r\n       *\r\n       * Note: this method calls `event.waitUntil()` for you, so you do not need\r\n       * to call it yourself in your event handlers.\r\n       *\r\n       * @param {ExtendableEvent} event\r\n       * @return {Promise<workbox-precaching.CleanupResult>}\r\n       */\r\n      activate(event) {\r\n        // waitUntil returns Promise<any>\r\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\r\n        return waitUntil(event, async () => {\r\n          const cache = await self.caches.open(this.strategy.cacheName);\r\n          const currentlyCachedRequests = await cache.keys();\r\n          const expectedCacheKeys = new Set(this._urlsToCacheKeys.values());\r\n          const deletedURLs = [];\r\n          for (const request of currentlyCachedRequests) {\r\n            if (!expectedCacheKeys.has(request.url)) {\r\n              await cache.delete(request);\r\n              deletedURLs.push(request.url);\r\n            }\r\n          }\r\n          {\r\n            printCleanupDetails(deletedURLs);\r\n          }\r\n          return {\r\n            deletedURLs\r\n          };\r\n        });\r\n      }\r\n      /**\r\n       * Returns a mapping of a precached URL to the corresponding cache key, taking\r\n       * into account the revision information for the URL.\r\n       *\r\n       * @return {Map<string, string>} A URL to cache key mapping.\r\n       */\r\n      getURLsToCacheKeys() {\r\n        return this._urlsToCacheKeys;\r\n      }\r\n      /**\r\n       * Returns a list of all the URLs that have been precached by the current\r\n       * service worker.\r\n       *\r\n       * @return {Array<string>} The precached URLs.\r\n       */\r\n      getCachedURLs() {\r\n        return [...this._urlsToCacheKeys.keys()];\r\n      }\r\n      /**\r\n       * Returns the cache key used for storing a given URL. If that URL is\r\n       * unversioned, like `/index.html', then the cache key will be the original\r\n       * URL with a search parameter appended to it.\r\n       *\r\n       * @param {string} url A URL whose cache key you want to look up.\r\n       * @return {string} The versioned URL that corresponds to a cache key\r\n       * for the original URL, or undefined if that URL isn't precached.\r\n       */\r\n      getCacheKeyForURL(url) {\r\n        const urlObject = new URL(url, location.href);\r\n        return this._urlsToCacheKeys.get(urlObject.href);\r\n      }\r\n      /**\r\n       * @param {string} url A cache key whose SRI you want to look up.\r\n       * @return {string} The subresource integrity associated with the cache key,\r\n       * or undefined if it's not set.\r\n       */\r\n      getIntegrityForCacheKey(cacheKey) {\r\n        return this._cacheKeysToIntegrities.get(cacheKey);\r\n      }\r\n      /**\r\n       * This acts as a drop-in replacement for\r\n       * [`cache.match()`](https://developer.mozilla.org/en-US/docs/Web/API/Cache/match)\r\n       * with the following differences:\r\n       *\r\n       * - It knows what the name of the precache is, and only checks in that cache.\r\n       * - It allows you to pass in an \"original\" URL without versioning parameters,\r\n       * and it will automatically look up the correct cache key for the currently\r\n       * active revision of that URL.\r\n       *\r\n       * E.g., `matchPrecache('index.html')` will find the correct precached\r\n       * response for the currently active service worker, even if the actual cache\r\n       * key is `'/index.html?__WB_REVISION__=1234abcd'`.\r\n       *\r\n       * @param {string|Request} request The key (without revisioning parameters)\r\n       * to look up in the precache.\r\n       * @return {Promise<Response|undefined>}\r\n       */\r\n      async matchPrecache(request) {\r\n        const url = request instanceof Request ? request.url : request;\r\n        const cacheKey = this.getCacheKeyForURL(url);\r\n        if (cacheKey) {\r\n          const cache = await self.caches.open(this.strategy.cacheName);\r\n          return cache.match(cacheKey);\r\n        }\r\n        return undefined;\r\n      }\r\n      /**\r\n       * Returns a function that looks up `url` in the precache (taking into\r\n       * account revision information), and returns the corresponding `Response`.\r\n       *\r\n       * @param {string} url The precached URL which will be used to lookup the\r\n       * `Response`.\r\n       * @return {workbox-routing~handlerCallback}\r\n       */\r\n      createHandlerBoundToURL(url) {\r\n        const cacheKey = this.getCacheKeyForURL(url);\r\n        if (!cacheKey) {\r\n          throw new WorkboxError('non-precached-url', {\r\n            url\r\n          });\r\n        }\r\n        return options => {\r\n          options.request = new Request(url);\r\n          options.params = Object.assign({\r\n            cacheKey\r\n          }, options.params);\r\n          return this.strategy.handle(options);\r\n        };\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    let precacheController;\r\n    /**\r\n     * @return {PrecacheController}\r\n     * @private\r\n     */\r\n    const getOrCreatePrecacheController = () => {\r\n      if (!precacheController) {\r\n        precacheController = new PrecacheController();\r\n      }\r\n      return precacheController;\r\n    };\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Removes any URL search parameters that should be ignored.\r\n     *\r\n     * @param {URL} urlObject The original URL.\r\n     * @param {Array<RegExp>} ignoreURLParametersMatching RegExps to test against\r\n     * each search parameter name. Matches mean that the search parameter should be\r\n     * ignored.\r\n     * @return {URL} The URL with any ignored search parameters removed.\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function removeIgnoredSearchParams(urlObject, ignoreURLParametersMatching = []) {\r\n      // Convert the iterable into an array at the start of the loop to make sure\r\n      // deletion doesn't mess up iteration.\r\n      for (const paramName of [...urlObject.searchParams.keys()]) {\r\n        if (ignoreURLParametersMatching.some(regExp => regExp.test(paramName))) {\r\n          urlObject.searchParams.delete(paramName);\r\n        }\r\n      }\r\n      return urlObject;\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Generator function that yields possible variations on the original URL to\r\n     * check, one at a time.\r\n     *\r\n     * @param {string} url\r\n     * @param {Object} options\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    function* generateURLVariations(url, {\r\n      ignoreURLParametersMatching = [/^utm_/, /^fbclid$/],\r\n      directoryIndex = 'index.html',\r\n      cleanURLs = true,\r\n      urlManipulation\r\n    } = {}) {\r\n      const urlObject = new URL(url, location.href);\r\n      urlObject.hash = '';\r\n      yield urlObject.href;\r\n      const urlWithoutIgnoredParams = removeIgnoredSearchParams(urlObject, ignoreURLParametersMatching);\r\n      yield urlWithoutIgnoredParams.href;\r\n      if (directoryIndex && urlWithoutIgnoredParams.pathname.endsWith('/')) {\r\n        const directoryURL = new URL(urlWithoutIgnoredParams.href);\r\n        directoryURL.pathname += directoryIndex;\r\n        yield directoryURL.href;\r\n      }\r\n      if (cleanURLs) {\r\n        const cleanURL = new URL(urlWithoutIgnoredParams.href);\r\n        cleanURL.pathname += '.html';\r\n        yield cleanURL.href;\r\n      }\r\n      if (urlManipulation) {\r\n        const additionalURLs = urlManipulation({\r\n          url: urlObject\r\n        });\r\n        for (const urlToAttempt of additionalURLs) {\r\n          yield urlToAttempt.href;\r\n        }\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2020 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * A subclass of {@link workbox-routing.Route} that takes a\r\n     * {@link workbox-precaching.PrecacheController}\r\n     * instance and uses it to match incoming requests and handle fetching\r\n     * responses from the precache.\r\n     *\r\n     * @memberof workbox-precaching\r\n     * @extends workbox-routing.Route\r\n     */\r\n    class PrecacheRoute extends Route {\r\n      /**\r\n       * @param {PrecacheController} precacheController A `PrecacheController`\r\n       * instance used to both match requests and respond to fetch events.\r\n       * @param {Object} [options] Options to control how requests are matched\r\n       * against the list of precached URLs.\r\n       * @param {string} [options.directoryIndex=index.html] The `directoryIndex` will\r\n       * check cache entries for a URLs ending with '/' to see if there is a hit when\r\n       * appending the `directoryIndex` value.\r\n       * @param {Array<RegExp>} [options.ignoreURLParametersMatching=[/^utm_/, /^fbclid$/]] An\r\n       * array of regex's to remove search params when looking for a cache match.\r\n       * @param {boolean} [options.cleanURLs=true] The `cleanURLs` option will\r\n       * check the cache for the URL with a `.html` added to the end of the end.\r\n       * @param {workbox-precaching~urlManipulation} [options.urlManipulation]\r\n       * This is a function that should take a URL and return an array of\r\n       * alternative URLs that should be checked for precache matches.\r\n       */\r\n      constructor(precacheController, options) {\r\n        const match = ({\r\n          request\r\n        }) => {\r\n          const urlsToCacheKeys = precacheController.getURLsToCacheKeys();\r\n          for (const possibleURL of generateURLVariations(request.url, options)) {\r\n            const cacheKey = urlsToCacheKeys.get(possibleURL);\r\n            if (cacheKey) {\r\n              const integrity = precacheController.getIntegrityForCacheKey(cacheKey);\r\n              return {\r\n                cacheKey,\r\n                integrity\r\n              };\r\n            }\r\n          }\r\n          {\r\n            logger.debug(`Precaching did not find a match for ` + getFriendlyURL(request.url));\r\n          }\r\n          return;\r\n        };\r\n        super(match, precacheController.strategy);\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Add a `fetch` listener to the service worker that will\r\n     * respond to\r\n     * [network requests]{@link https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers#Custom_responses_to_requests}\r\n     * with precached assets.\r\n     *\r\n     * Requests for assets that aren't precached, the `FetchEvent` will not be\r\n     * responded to, allowing the event to fall through to other `fetch` event\r\n     * listeners.\r\n     *\r\n     * @param {Object} [options] See the {@link workbox-precaching.PrecacheRoute}\r\n     * options.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function addRoute(options) {\r\n      const precacheController = getOrCreatePrecacheController();\r\n      const precacheRoute = new PrecacheRoute(precacheController, options);\r\n      registerRoute(precacheRoute);\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Adds items to the precache list, removing any duplicates and\r\n     * stores the files in the\r\n     * {@link workbox-core.cacheNames|\"precache cache\"} when the service\r\n     * worker installs.\r\n     *\r\n     * This method can be called multiple times.\r\n     *\r\n     * Please note: This method **will not** serve any of the cached files for you.\r\n     * It only precaches files. To respond to a network request you call\r\n     * {@link workbox-precaching.addRoute}.\r\n     *\r\n     * If you have a single array of files to precache, you can just call\r\n     * {@link workbox-precaching.precacheAndRoute}.\r\n     *\r\n     * @param {Array<Object|string>} [entries=[]] Array of entries to precache.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function precache(entries) {\r\n      const precacheController = getOrCreatePrecacheController();\r\n      precacheController.precache(entries);\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * This method will add entries to the precache list and add a route to\r\n     * respond to fetch events.\r\n     *\r\n     * This is a convenience method that will call\r\n     * {@link workbox-precaching.precache} and\r\n     * {@link workbox-precaching.addRoute} in a single call.\r\n     *\r\n     * @param {Array<Object|string>} entries Array of entries to precache.\r\n     * @param {Object} [options] See the\r\n     * {@link workbox-precaching.PrecacheRoute} options.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function precacheAndRoute(entries, options) {\r\n      precache(entries);\r\n      addRoute(options);\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    const SUBSTRING_TO_FIND = '-precache-';\r\n    /**\r\n     * Cleans up incompatible precaches that were created by older versions of\r\n     * Workbox, by a service worker registered under the current scope.\r\n     *\r\n     * This is meant to be called as part of the `activate` event.\r\n     *\r\n     * This should be safe to use as long as you don't include `substringToFind`\r\n     * (defaulting to `-precache-`) in your non-precache cache names.\r\n     *\r\n     * @param {string} currentPrecacheName The cache name currently in use for\r\n     * precaching. This cache won't be deleted.\r\n     * @param {string} [substringToFind='-precache-'] Cache names which include this\r\n     * substring will be deleted (excluding `currentPrecacheName`).\r\n     * @return {Array<string>} A list of all the cache names that were deleted.\r\n     *\r\n     * @private\r\n     * @memberof workbox-precaching\r\n     */\r\n    const deleteOutdatedCaches = async (currentPrecacheName, substringToFind = SUBSTRING_TO_FIND) => {\r\n      const cacheNames = await self.caches.keys();\r\n      const cacheNamesToDelete = cacheNames.filter(cacheName => {\r\n        return cacheName.includes(substringToFind) && cacheName.includes(self.registration.scope) && cacheName !== currentPrecacheName;\r\n      });\r\n      await Promise.all(cacheNamesToDelete.map(cacheName => self.caches.delete(cacheName)));\r\n      return cacheNamesToDelete;\r\n    };\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Adds an `activate` event listener which will clean up incompatible\r\n     * precaches that were created by older versions of Workbox.\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function cleanupOutdatedCaches() {\r\n      // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\r\n      self.addEventListener('activate', event => {\r\n        const cacheName = cacheNames.getPrecacheName();\r\n        event.waitUntil(deleteOutdatedCaches(cacheName).then(cachesDeleted => {\r\n          {\r\n            if (cachesDeleted.length > 0) {\r\n              logger.log(`The following out-of-date precaches were cleaned up ` + `automatically:`, cachesDeleted);\r\n            }\r\n          }\r\n        }));\r\n      });\r\n    }\r\n\r\n    /*\r\n      Copyright 2018 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * NavigationRoute makes it easy to create a\r\n     * {@link workbox-routing.Route} that matches for browser\r\n     * [navigation requests]{@link https://developers.google.com/web/fundamentals/primers/service-workers/high-performance-loading#first_what_are_navigation_requests}.\r\n     *\r\n     * It will only match incoming Requests whose\r\n     * {@link https://fetch.spec.whatwg.org/#concept-request-mode|mode}\r\n     * is set to `navigate`.\r\n     *\r\n     * You can optionally only apply this route to a subset of navigation requests\r\n     * by using one or both of the `denylist` and `allowlist` parameters.\r\n     *\r\n     * @memberof workbox-routing\r\n     * @extends workbox-routing.Route\r\n     */\r\n    class NavigationRoute extends Route {\r\n      /**\r\n       * If both `denylist` and `allowlist` are provided, the `denylist` will\r\n       * take precedence and the request will not match this route.\r\n       *\r\n       * The regular expressions in `allowlist` and `denylist`\r\n       * are matched against the concatenated\r\n       * [`pathname`]{@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLHyperlinkElementUtils/pathname}\r\n       * and [`search`]{@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLHyperlinkElementUtils/search}\r\n       * portions of the requested URL.\r\n       *\r\n       * *Note*: These RegExps may be evaluated against every destination URL during\r\n       * a navigation. Avoid using\r\n       * [complex RegExps](https://github.com/GoogleChrome/workbox/issues/3077),\r\n       * or else your users may see delays when navigating your site.\r\n       *\r\n       * @param {workbox-routing~handlerCallback} handler A callback\r\n       * function that returns a Promise resulting in a Response.\r\n       * @param {Object} options\r\n       * @param {Array<RegExp>} [options.denylist] If any of these patterns match,\r\n       * the route will not handle the request (even if a allowlist RegExp matches).\r\n       * @param {Array<RegExp>} [options.allowlist=[/./]] If any of these patterns\r\n       * match the URL's pathname and search parameter, the route will handle the\r\n       * request (assuming the denylist doesn't match).\r\n       */\r\n      constructor(handler, {\r\n        allowlist = [/./],\r\n        denylist = []\r\n      } = {}) {\r\n        {\r\n          finalAssertExports.isArrayOfClass(allowlist, RegExp, {\r\n            moduleName: 'workbox-routing',\r\n            className: 'NavigationRoute',\r\n            funcName: 'constructor',\r\n            paramName: 'options.allowlist'\r\n          });\r\n          finalAssertExports.isArrayOfClass(denylist, RegExp, {\r\n            moduleName: 'workbox-routing',\r\n            className: 'NavigationRoute',\r\n            funcName: 'constructor',\r\n            paramName: 'options.denylist'\r\n          });\r\n        }\r\n        super(options => this._match(options), handler);\r\n        this._allowlist = allowlist;\r\n        this._denylist = denylist;\r\n      }\r\n      /**\r\n       * Routes match handler.\r\n       *\r\n       * @param {Object} options\r\n       * @param {URL} options.url\r\n       * @param {Request} options.request\r\n       * @return {boolean}\r\n       *\r\n       * @private\r\n       */\r\n      _match({\r\n        url,\r\n        request\r\n      }) {\r\n        if (request && request.mode !== 'navigate') {\r\n          return false;\r\n        }\r\n        const pathnameAndSearch = url.pathname + url.search;\r\n        for (const regExp of this._denylist) {\r\n          if (regExp.test(pathnameAndSearch)) {\r\n            {\r\n              logger.log(`The navigation route ${pathnameAndSearch} is not ` + `being used, since the URL matches this denylist pattern: ` + `${regExp.toString()}`);\r\n            }\r\n            return false;\r\n          }\r\n        }\r\n        if (this._allowlist.some(regExp => regExp.test(pathnameAndSearch))) {\r\n          {\r\n            logger.debug(`The navigation route ${pathnameAndSearch} ` + `is being used.`);\r\n          }\r\n          return true;\r\n        }\r\n        {\r\n          logger.log(`The navigation route ${pathnameAndSearch} is not ` + `being used, since the URL being navigated to doesn't ` + `match the allowlist.`);\r\n        }\r\n        return false;\r\n      }\r\n    }\r\n\r\n    /*\r\n      Copyright 2019 Google LLC\r\n\r\n      Use of this source code is governed by an MIT-style\r\n      license that can be found in the LICENSE file or at\r\n      https://opensource.org/licenses/MIT.\r\n    */\r\n    /**\r\n     * Helper function that calls\r\n     * {@link PrecacheController#createHandlerBoundToURL} on the default\r\n     * {@link PrecacheController} instance.\r\n     *\r\n     * If you are creating your own {@link PrecacheController}, then call the\r\n     * {@link PrecacheController#createHandlerBoundToURL} on that instance,\r\n     * instead of using this function.\r\n     *\r\n     * @param {string} url The precached URL which will be used to lookup the\r\n     * `Response`.\r\n     * @param {boolean} [fallbackToNetwork=true] Whether to attempt to get the\r\n     * response from the network if there's a precache miss.\r\n     * @return {workbox-routing~handlerCallback}\r\n     *\r\n     * @memberof workbox-precaching\r\n     */\r\n    function createHandlerBoundToURL(url) {\r\n      const precacheController = getOrCreatePrecacheController();\r\n      return precacheController.createHandlerBoundToURL(url);\r\n    }\r\n\r\n    exports.NavigationRoute = NavigationRoute;\r\n    exports.cleanupOutdatedCaches = cleanupOutdatedCaches;\r\n    exports.createHandlerBoundToURL = createHandlerBoundToURL;\r\n    exports.precacheAndRoute = precacheAndRoute;\r\n    exports.registerRoute = registerRoute;\r\n\r\n}));\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\dev-dist\\workbox-fa6cb374.js","messages":[{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":52,"column":7,"endLine":52,"endColumn":63,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":419,"column":5,"endLine":419,"endColumn":61,"severity":2,"nodeType":null},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported).","line":435,"column":5,"severity":1,"nodeType":null,"fix":{"range":[16918,16940],"text":" "}},{"ruleId":"@typescript-eslint/no-unsafe-member-access","message":"Definition for rule '@typescript-eslint/no-unsafe-member-access' was not found.","line":752,"column":11,"endLine":752,"endColumn":81,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-assignment","message":"Definition for rule '@typescript-eslint/no-unsafe-assignment' was not found.","line":754,"column":13,"endLine":754,"endColumn":80,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-assignment","message":"Definition for rule '@typescript-eslint/no-unsafe-assignment' was not found.","line":948,"column":11,"endLine":948,"endColumn":78,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-assignment","message":"Definition for rule '@typescript-eslint/no-unsafe-assignment' was not found.","line":964,"column":13,"endLine":964,"endColumn":80,"severity":2,"nodeType":null},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported).","line":970,"column":13,"severity":1,"nodeType":null,"fix":{"range":[36116,36138],"text":" "}},{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":1257,"column":5,"endLine":1257,"endColumn":61,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/ban-types","message":"Definition for rule '@typescript-eslint/ban-types' was not found.","line":1275,"column":5,"endLine":1275,"endColumn":61,"severity":2,"nodeType":null},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported).","line":2768,"column":35,"severity":1,"nodeType":null,"fix":{"range":[106393,106415],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported).","line":3569,"column":11,"severity":1,"nodeType":null,"fix":{"range":[135589,135609],"text":" "}},{"ruleId":"@typescript-eslint/no-unsafe-return","message":"Definition for rule '@typescript-eslint/no-unsafe-return' was not found.","line":4089,"column":9,"endLine":4089,"endColumn":72,"severity":2,"nodeType":null},{"ruleId":"@typescript-eslint/no-unsafe-return","message":"Definition for rule '@typescript-eslint/no-unsafe-return' was not found.","line":4136,"column":9,"endLine":4136,"endColumn":72,"severity":2,"nodeType":null}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":4,"source":"define(['exports'], (function (exports) { 'use strict';\n\n    // @ts-ignore\n    try {\n      self['workbox:core:7.3.0'] && _();\n    } catch (e) {}\n\n    /*\n      Copyright 2019 Google LLC\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    const logger = (() => {\n      // Don't overwrite this value if it's already set.\n      // See https://github.com/GoogleChrome/workbox/pull/2284#issuecomment-560470923\n      if (!('__WB_DISABLE_DEV_LOGS' in globalThis)) {\n        self.__WB_DISABLE_DEV_LOGS = false;\n      }\n      let inGroup = false;\n      const methodToColorMap = {\n        debug: `#7f8c8d`,\n        log: `#2ecc71`,\n        warn: `#f39c12`,\n        error: `#c0392b`,\n        groupCollapsed: `#3498db`,\n        groupEnd: null // No colored prefix on groupEnd\n      };\n      const print = function (method, args) {\n        if (self.__WB_DISABLE_DEV_LOGS) {\n          return;\n        }\n        if (method === 'groupCollapsed') {\n          // Safari doesn't print all console.groupCollapsed() arguments:\n          // https://bugs.webkit.org/show_bug.cgi?id=182754\n          if (/^((?!chrome|android).)*safari/i.test(navigator.userAgent)) {\n            console[method](...args);\n            return;\n          }\n        }\n        const styles = [`background: ${methodToColorMap[method]}`, `border-radius: 0.5em`, `color: white`, `font-weight: bold`, `padding: 2px 0.5em`];\n        // When in a group, the workbox prefix is not displayed.\n        const logPrefix = inGroup ? [] : ['%cworkbox', styles.join(';')];\n        console[method](...logPrefix, ...args);\n        if (method === 'groupCollapsed') {\n          inGroup = true;\n        }\n        if (method === 'groupEnd') {\n          inGroup = false;\n        }\n      };\n      // eslint-disable-next-line @typescript-eslint/ban-types\n      const api = {};\n      const loggerMethods = Object.keys(methodToColorMap);\n      for (const key of loggerMethods) {\n        const method = key;\n        api[method] = (...args) => {\n          print(method, args);\n        };\n      }\n      return api;\n    })();\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    const messages$1 = {\n      'invalid-value': ({\n        paramName,\n        validValueDescription,\n        value\n      }) => {\n        if (!paramName || !validValueDescription) {\n          throw new Error(`Unexpected input to 'invalid-value' error.`);\n        }\n        return `The '${paramName}' parameter was given a value with an ` + `unexpected value. ${validValueDescription} Received a value of ` + `${JSON.stringify(value)}.`;\n      },\n      'not-an-array': ({\n        moduleName,\n        className,\n        funcName,\n        paramName\n      }) => {\n        if (!moduleName || !className || !funcName || !paramName) {\n          throw new Error(`Unexpected input to 'not-an-array' error.`);\n        }\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${className}.${funcName}()' must be an array.`;\n      },\n      'incorrect-type': ({\n        expectedType,\n        paramName,\n        moduleName,\n        className,\n        funcName\n      }) => {\n        if (!expectedType || !paramName || !moduleName || !funcName) {\n          throw new Error(`Unexpected input to 'incorrect-type' error.`);\n        }\n        const classNameStr = className ? `${className}.` : '';\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${classNameStr}` + `${funcName}()' must be of type ${expectedType}.`;\n      },\n      'incorrect-class': ({\n        expectedClassName,\n        paramName,\n        moduleName,\n        className,\n        funcName,\n        isReturnValueProblem\n      }) => {\n        if (!expectedClassName || !moduleName || !funcName) {\n          throw new Error(`Unexpected input to 'incorrect-class' error.`);\n        }\n        const classNameStr = className ? `${className}.` : '';\n        if (isReturnValueProblem) {\n          return `The return value from ` + `'${moduleName}.${classNameStr}${funcName}()' ` + `must be an instance of class ${expectedClassName}.`;\n        }\n        return `The parameter '${paramName}' passed into ` + `'${moduleName}.${classNameStr}${funcName}()' ` + `must be an instance of class ${expectedClassName}.`;\n      },\n      'missing-a-method': ({\n        expectedMethod,\n        paramName,\n        moduleName,\n        className,\n        funcName\n      }) => {\n        if (!expectedMethod || !paramName || !moduleName || !className || !funcName) {\n          throw new Error(`Unexpected input to 'missing-a-method' error.`);\n        }\n        return `${moduleName}.${className}.${funcName}() expected the ` + `'${paramName}' parameter to expose a '${expectedMethod}' method.`;\n      },\n      'add-to-cache-list-unexpected-type': ({\n        entry\n      }) => {\n        return `An unexpected entry was passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' The entry ` + `'${JSON.stringify(entry)}' isn't supported. You must supply an array of ` + `strings with one or more characters, objects with a url property or ` + `Request objects.`;\n      },\n      'add-to-cache-list-conflicting-entries': ({\n        firstEntry,\n        secondEntry\n      }) => {\n        if (!firstEntry || !secondEntry) {\n          throw new Error(`Unexpected input to ` + `'add-to-cache-list-duplicate-entries' error.`);\n        }\n        return `Two of the entries passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` + `${firstEntry} but different revision details. Workbox is ` + `unable to cache and version the asset correctly. Please remove one ` + `of the entries.`;\n      },\n      'plugin-error-request-will-fetch': ({\n        thrownErrorMessage\n      }) => {\n        if (!thrownErrorMessage) {\n          throw new Error(`Unexpected input to ` + `'plugin-error-request-will-fetch', error.`);\n        }\n        return `An error was thrown by a plugins 'requestWillFetch()' method. ` + `The thrown error message was: '${thrownErrorMessage}'.`;\n      },\n      'invalid-cache-name': ({\n        cacheNameId,\n        value\n      }) => {\n        if (!cacheNameId) {\n          throw new Error(`Expected a 'cacheNameId' for error 'invalid-cache-name'`);\n        }\n        return `You must provide a name containing at least one character for ` + `setCacheDetails({${cacheNameId}: '...'}). Received a value of ` + `'${JSON.stringify(value)}'`;\n      },\n      'unregister-route-but-not-found-with-method': ({\n        method\n      }) => {\n        if (!method) {\n          throw new Error(`Unexpected input to ` + `'unregister-route-but-not-found-with-method' error.`);\n        }\n        return `The route you're trying to unregister was not  previously ` + `registered for the method type '${method}'.`;\n      },\n      'unregister-route-route-not-registered': () => {\n        return `The route you're trying to unregister was not previously ` + `registered.`;\n      },\n      'queue-replay-failed': ({\n        name\n      }) => {\n        return `Replaying the background sync queue '${name}' failed.`;\n      },\n      'duplicate-queue-name': ({\n        name\n      }) => {\n        return `The Queue name '${name}' is already being used. ` + `All instances of backgroundSync.Queue must be given unique names.`;\n      },\n      'expired-test-without-max-age': ({\n        methodName,\n        paramName\n      }) => {\n        return `The '${methodName}()' method can only be used when the ` + `'${paramName}' is used in the constructor.`;\n      },\n      'unsupported-route-type': ({\n        moduleName,\n        className,\n        funcName,\n        paramName\n      }) => {\n        return `The supplied '${paramName}' parameter was an unsupported type. ` + `Please check the docs for ${moduleName}.${className}.${funcName} for ` + `valid input types.`;\n      },\n      'not-array-of-class': ({\n        value,\n        expectedClass,\n        moduleName,\n        className,\n        funcName,\n        paramName\n      }) => {\n        return `The supplied '${paramName}' parameter must be an array of ` + `'${expectedClass}' objects. Received '${JSON.stringify(value)},'. ` + `Please check the call to ${moduleName}.${className}.${funcName}() ` + `to fix the issue.`;\n      },\n      'max-entries-or-age-required': ({\n        moduleName,\n        className,\n        funcName\n      }) => {\n        return `You must define either config.maxEntries or config.maxAgeSeconds` + `in ${moduleName}.${className}.${funcName}`;\n      },\n      'statuses-or-headers-required': ({\n        moduleName,\n        className,\n        funcName\n      }) => {\n        return `You must define either config.statuses or config.headers` + `in ${moduleName}.${className}.${funcName}`;\n      },\n      'invalid-string': ({\n        moduleName,\n        funcName,\n        paramName\n      }) => {\n        if (!paramName || !moduleName || !funcName) {\n          throw new Error(`Unexpected input to 'invalid-string' error.`);\n        }\n        return `When using strings, the '${paramName}' parameter must start with ` + `'http' (for cross-origin matches) or '/' (for same-origin matches). ` + `Please see the docs for ${moduleName}.${funcName}() for ` + `more info.`;\n      },\n      'channel-name-required': () => {\n        return `You must provide a channelName to construct a ` + `BroadcastCacheUpdate instance.`;\n      },\n      'invalid-responses-are-same-args': () => {\n        return `The arguments passed into responsesAreSame() appear to be ` + `invalid. Please ensure valid Responses are used.`;\n      },\n      'expire-custom-caches-only': () => {\n        return `You must provide a 'cacheName' property when using the ` + `expiration plugin with a runtime caching strategy.`;\n      },\n      'unit-must-be-bytes': ({\n        normalizedRangeHeader\n      }) => {\n        if (!normalizedRangeHeader) {\n          throw new Error(`Unexpected input to 'unit-must-be-bytes' error.`);\n        }\n        return `The 'unit' portion of the Range header must be set to 'bytes'. ` + `The Range header provided was \"${normalizedRangeHeader}\"`;\n      },\n      'single-range-only': ({\n        normalizedRangeHeader\n      }) => {\n        if (!normalizedRangeHeader) {\n          throw new Error(`Unexpected input to 'single-range-only' error.`);\n        }\n        return `Multiple ranges are not supported. Please use a  single start ` + `value, and optional end value. The Range header provided was ` + `\"${normalizedRangeHeader}\"`;\n      },\n      'invalid-range-values': ({\n        normalizedRangeHeader\n      }) => {\n        if (!normalizedRangeHeader) {\n          throw new Error(`Unexpected input to 'invalid-range-values' error.`);\n        }\n        return `The Range header is missing both start and end values. At least ` + `one of those values is needed. The Range header provided was ` + `\"${normalizedRangeHeader}\"`;\n      },\n      'no-range-header': () => {\n        return `No Range header was found in the Request provided.`;\n      },\n      'range-not-satisfiable': ({\n        size,\n        start,\n        end\n      }) => {\n        return `The start (${start}) and end (${end}) values in the Range are ` + `not satisfiable by the cached response, which is ${size} bytes.`;\n      },\n      'attempt-to-cache-non-get-request': ({\n        url,\n        method\n      }) => {\n        return `Unable to cache '${url}' because it is a '${method}' request and ` + `only 'GET' requests can be cached.`;\n      },\n      'cache-put-with-no-response': ({\n        url\n      }) => {\n        return `There was an attempt to cache '${url}' but the response was not ` + `defined.`;\n      },\n      'no-response': ({\n        url,\n        error\n      }) => {\n        let message = `The strategy could not generate a response for '${url}'.`;\n        if (error) {\n          message += ` The underlying error is ${error}.`;\n        }\n        return message;\n      },\n      'bad-precaching-response': ({\n        url,\n        status\n      }) => {\n        return `The precaching request for '${url}' failed` + (status ? ` with an HTTP status of ${status}.` : `.`);\n      },\n      'non-precached-url': ({\n        url\n      }) => {\n        return `createHandlerBoundToURL('${url}') was called, but that URL is ` + `not precached. Please pass in a URL that is precached instead.`;\n      },\n      'add-to-cache-list-conflicting-integrities': ({\n        url\n      }) => {\n        return `Two of the entries passed to ` + `'workbox-precaching.PrecacheController.addToCacheList()' had the URL ` + `${url} with different integrity values. Please remove one of them.`;\n      },\n      'missing-precache-entry': ({\n        cacheName,\n        url\n      }) => {\n        return `Unable to find a precached response in ${cacheName} for ${url}.`;\n      },\n      'cross-origin-copy-response': ({\n        origin\n      }) => {\n        return `workbox-core.copyResponse() can only be used with same-origin ` + `responses. It was passed a response with origin ${origin}.`;\n      },\n      'opaque-streams-source': ({\n        type\n      }) => {\n        const message = `One of the workbox-streams sources resulted in an ` + `'${type}' response.`;\n        if (type === 'opaqueredirect') {\n          return `${message} Please do not use a navigation request that results ` + `in a redirect as a source.`;\n        }\n        return `${message} Please ensure your sources are CORS-enabled.`;\n      }\n    };\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    const generatorFunction = (code, details = {}) => {\n      const message = messages$1[code];\n      if (!message) {\n        throw new Error(`Unable to find message for code '${code}'.`);\n      }\n      return message(details);\n    };\n    const messageGenerator = generatorFunction;\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Workbox errors should be thrown with this class.\n     * This allows use to ensure the type easily in tests,\n     * helps developers identify errors from workbox\n     * easily and allows use to optimise error\n     * messages correctly.\n     *\n     * @private\n     */\n    class WorkboxError extends Error {\n      /**\n       *\n       * @param {string} errorCode The error code that\n       * identifies this particular error.\n       * @param {Object=} details Any relevant arguments\n       * that will help developers identify issues should\n       * be added as a key on the context object.\n       */\n      constructor(errorCode, details) {\n        const message = messageGenerator(errorCode, details);\n        super(message);\n        this.name = errorCode;\n        this.details = details;\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /*\n     * This method throws if the supplied value is not an array.\n     * The destructed values are required to produce a meaningful error for users.\n     * The destructed and restructured object is so it's clear what is\n     * needed.\n     */\n    const isArray = (value, details) => {\n      if (!Array.isArray(value)) {\n        throw new WorkboxError('not-an-array', details);\n      }\n    };\n    const hasMethod = (object, expectedMethod, details) => {\n      const type = typeof object[expectedMethod];\n      if (type !== 'function') {\n        details['expectedMethod'] = expectedMethod;\n        throw new WorkboxError('missing-a-method', details);\n      }\n    };\n    const isType = (object, expectedType, details) => {\n      if (typeof object !== expectedType) {\n        details['expectedType'] = expectedType;\n        throw new WorkboxError('incorrect-type', details);\n      }\n    };\n    const isInstance = (object,\n    // Need the general type to do the check later.\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    expectedClass, details) => {\n      if (!(object instanceof expectedClass)) {\n        details['expectedClassName'] = expectedClass.name;\n        throw new WorkboxError('incorrect-class', details);\n      }\n    };\n    const isOneOf = (value, validValues, details) => {\n      if (!validValues.includes(value)) {\n        details['validValueDescription'] = `Valid values are ${JSON.stringify(validValues)}.`;\n        throw new WorkboxError('invalid-value', details);\n      }\n    };\n    const isArrayOfClass = (value,\n    // Need general type to do check later.\n    expectedClass,\n    // eslint-disable-line\n    details) => {\n      const error = new WorkboxError('not-array-of-class', details);\n      if (!Array.isArray(value)) {\n        throw error;\n      }\n      for (const item of value) {\n        if (!(item instanceof expectedClass)) {\n          throw error;\n        }\n      }\n    };\n    const finalAssertExports = {\n      hasMethod,\n      isArray,\n      isInstance,\n      isOneOf,\n      isType,\n      isArrayOfClass\n    };\n\n    // @ts-ignore\n    try {\n      self['workbox:routing:7.3.0'] && _();\n    } catch (e) {}\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * The default HTTP method, 'GET', used when there's no specific method\n     * configured for a route.\n     *\n     * @type {string}\n     *\n     * @private\n     */\n    const defaultMethod = 'GET';\n    /**\n     * The list of valid HTTP methods associated with requests that could be routed.\n     *\n     * @type {Array<string>}\n     *\n     * @private\n     */\n    const validMethods = ['DELETE', 'GET', 'HEAD', 'PATCH', 'POST', 'PUT'];\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * @param {function()|Object} handler Either a function, or an object with a\n     * 'handle' method.\n     * @return {Object} An object with a handle method.\n     *\n     * @private\n     */\n    const normalizeHandler = handler => {\n      if (handler && typeof handler === 'object') {\n        {\n          finalAssertExports.hasMethod(handler, 'handle', {\n            moduleName: 'workbox-routing',\n            className: 'Route',\n            funcName: 'constructor',\n            paramName: 'handler'\n          });\n        }\n        return handler;\n      } else {\n        {\n          finalAssertExports.isType(handler, 'function', {\n            moduleName: 'workbox-routing',\n            className: 'Route',\n            funcName: 'constructor',\n            paramName: 'handler'\n          });\n        }\n        return {\n          handle: handler\n        };\n      }\n    };\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * A `Route` consists of a pair of callback functions, \"match\" and \"handler\".\n     * The \"match\" callback determine if a route should be used to \"handle\" a\n     * request by returning a non-falsy value if it can. The \"handler\" callback\n     * is called when there is a match and should return a Promise that resolves\n     * to a `Response`.\n     *\n     * @memberof workbox-routing\n     */\n    class Route {\n      /**\n       * Constructor for Route class.\n       *\n       * @param {workbox-routing~matchCallback} match\n       * A callback function that determines whether the route matches a given\n       * `fetch` event by returning a non-falsy value.\n       * @param {workbox-routing~handlerCallback} handler A callback\n       * function that returns a Promise resolving to a Response.\n       * @param {string} [method='GET'] The HTTP method to match the Route\n       * against.\n       */\n      constructor(match, handler, method = defaultMethod) {\n        {\n          finalAssertExports.isType(match, 'function', {\n            moduleName: 'workbox-routing',\n            className: 'Route',\n            funcName: 'constructor',\n            paramName: 'match'\n          });\n          if (method) {\n            finalAssertExports.isOneOf(method, validMethods, {\n              paramName: 'method'\n            });\n          }\n        }\n        // These values are referenced directly by Router so cannot be\n        // altered by minificaton.\n        this.handler = normalizeHandler(handler);\n        this.match = match;\n        this.method = method;\n      }\n      /**\n       *\n       * @param {workbox-routing-handlerCallback} handler A callback\n       * function that returns a Promise resolving to a Response\n       */\n      setCatchHandler(handler) {\n        this.catchHandler = normalizeHandler(handler);\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * RegExpRoute makes it easy to create a regular expression based\n     * {@link workbox-routing.Route}.\n     *\n     * For same-origin requests the RegExp only needs to match part of the URL. For\n     * requests against third-party servers, you must define a RegExp that matches\n     * the start of the URL.\n     *\n     * @memberof workbox-routing\n     * @extends workbox-routing.Route\n     */\n    class RegExpRoute extends Route {\n      /**\n       * If the regular expression contains\n       * [capture groups]{@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp#grouping-back-references},\n       * the captured values will be passed to the\n       * {@link workbox-routing~handlerCallback} `params`\n       * argument.\n       *\n       * @param {RegExp} regExp The regular expression to match against URLs.\n       * @param {workbox-routing~handlerCallback} handler A callback\n       * function that returns a Promise resulting in a Response.\n       * @param {string} [method='GET'] The HTTP method to match the Route\n       * against.\n       */\n      constructor(regExp, handler, method) {\n        {\n          finalAssertExports.isInstance(regExp, RegExp, {\n            moduleName: 'workbox-routing',\n            className: 'RegExpRoute',\n            funcName: 'constructor',\n            paramName: 'pattern'\n          });\n        }\n        const match = ({\n          url\n        }) => {\n          const result = regExp.exec(url.href);\n          // Return immediately if there's no match.\n          if (!result) {\n            return;\n          }\n          // Require that the match start at the first character in the URL string\n          // if it's a cross-origin request.\n          // See https://github.com/GoogleChrome/workbox/issues/281 for the context\n          // behind this behavior.\n          if (url.origin !== location.origin && result.index !== 0) {\n            {\n              logger.debug(`The regular expression '${regExp.toString()}' only partially matched ` + `against the cross-origin URL '${url.toString()}'. RegExpRoute's will only ` + `handle cross-origin requests if they match the entire URL.`);\n            }\n            return;\n          }\n          // If the route matches, but there aren't any capture groups defined, then\n          // this will return [], which is truthy and therefore sufficient to\n          // indicate a match.\n          // If there are capture groups, then it will return their values.\n          return result.slice(1);\n        };\n        super(match, handler, method);\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    const getFriendlyURL = url => {\n      const urlObj = new URL(String(url), location.href);\n      // See https://github.com/GoogleChrome/workbox/issues/2323\n      // We want to include everything, except for the origin if it's same-origin.\n      return urlObj.href.replace(new RegExp(`^${location.origin}`), '');\n    };\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * The Router can be used to process a `FetchEvent` using one or more\n     * {@link workbox-routing.Route}, responding with a `Response` if\n     * a matching route exists.\n     *\n     * If no route matches a given a request, the Router will use a \"default\"\n     * handler if one is defined.\n     *\n     * Should the matching Route throw an error, the Router will use a \"catch\"\n     * handler if one is defined to gracefully deal with issues and respond with a\n     * Request.\n     *\n     * If a request matches multiple routes, the **earliest** registered route will\n     * be used to respond to the request.\n     *\n     * @memberof workbox-routing\n     */\n    class Router {\n      /**\n       * Initializes a new Router.\n       */\n      constructor() {\n        this._routes = new Map();\n        this._defaultHandlerMap = new Map();\n      }\n      /**\n       * @return {Map<string, Array<workbox-routing.Route>>} routes A `Map` of HTTP\n       * method name ('GET', etc.) to an array of all the corresponding `Route`\n       * instances that are registered.\n       */\n      get routes() {\n        return this._routes;\n      }\n      /**\n       * Adds a fetch event listener to respond to events when a route matches\n       * the event's request.\n       */\n      addFetchListener() {\n        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\n        self.addEventListener('fetch', event => {\n          const {\n            request\n          } = event;\n          const responsePromise = this.handleRequest({\n            request,\n            event\n          });\n          if (responsePromise) {\n            event.respondWith(responsePromise);\n          }\n        });\n      }\n      /**\n       * Adds a message event listener for URLs to cache from the window.\n       * This is useful to cache resources loaded on the page prior to when the\n       * service worker started controlling it.\n       *\n       * The format of the message data sent from the window should be as follows.\n       * Where the `urlsToCache` array may consist of URL strings or an array of\n       * URL string + `requestInit` object (the same as you'd pass to `fetch()`).\n       *\n       * ```\n       * {\n       *   type: 'CACHE_URLS',\n       *   payload: {\n       *     urlsToCache: [\n       *       './script1.js',\n       *       './script2.js',\n       *       ['./script3.js', {mode: 'no-cors'}],\n       *     ],\n       *   },\n       * }\n       * ```\n       */\n      addCacheListener() {\n        // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\n        self.addEventListener('message', event => {\n          // event.data is type 'any'\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n          if (event.data && event.data.type === 'CACHE_URLS') {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            const {\n              payload\n            } = event.data;\n            {\n              logger.debug(`Caching URLs from the window`, payload.urlsToCache);\n            }\n            const requestPromises = Promise.all(payload.urlsToCache.map(entry => {\n              if (typeof entry === 'string') {\n                entry = [entry];\n              }\n              const request = new Request(...entry);\n              return this.handleRequest({\n                request,\n                event\n              });\n              // TODO(philipwalton): TypeScript errors without this typecast for\n              // some reason (probably a bug). The real type here should work but\n              // doesn't: `Array<Promise<Response> | undefined>`.\n            })); // TypeScript\n            event.waitUntil(requestPromises);\n            // If a MessageChannel was used, reply to the message on success.\n            if (event.ports && event.ports[0]) {\n              void requestPromises.then(() => event.ports[0].postMessage(true));\n            }\n          }\n        });\n      }\n      /**\n       * Apply the routing rules to a FetchEvent object to get a Response from an\n       * appropriate Route's handler.\n       *\n       * @param {Object} options\n       * @param {Request} options.request The request to handle.\n       * @param {ExtendableEvent} options.event The event that triggered the\n       *     request.\n       * @return {Promise<Response>|undefined} A promise is returned if a\n       *     registered route can handle the request. If there is no matching\n       *     route and there's no `defaultHandler`, `undefined` is returned.\n       */\n      handleRequest({\n        request,\n        event\n      }) {\n        {\n          finalAssertExports.isInstance(request, Request, {\n            moduleName: 'workbox-routing',\n            className: 'Router',\n            funcName: 'handleRequest',\n            paramName: 'options.request'\n          });\n        }\n        const url = new URL(request.url, location.href);\n        if (!url.protocol.startsWith('http')) {\n          {\n            logger.debug(`Workbox Router only supports URLs that start with 'http'.`);\n          }\n          return;\n        }\n        const sameOrigin = url.origin === location.origin;\n        const {\n          params,\n          route\n        } = this.findMatchingRoute({\n          event,\n          request,\n          sameOrigin,\n          url\n        });\n        let handler = route && route.handler;\n        const debugMessages = [];\n        {\n          if (handler) {\n            debugMessages.push([`Found a route to handle this request:`, route]);\n            if (params) {\n              debugMessages.push([`Passing the following params to the route's handler:`, params]);\n            }\n          }\n        }\n        // If we don't have a handler because there was no matching route, then\n        // fall back to defaultHandler if that's defined.\n        const method = request.method;\n        if (!handler && this._defaultHandlerMap.has(method)) {\n          {\n            debugMessages.push(`Failed to find a matching route. Falling ` + `back to the default handler for ${method}.`);\n          }\n          handler = this._defaultHandlerMap.get(method);\n        }\n        if (!handler) {\n          {\n            // No handler so Workbox will do nothing. If logs is set of debug\n            // i.e. verbose, we should print out this information.\n            logger.debug(`No route found for: ${getFriendlyURL(url)}`);\n          }\n          return;\n        }\n        {\n          // We have a handler, meaning Workbox is going to handle the route.\n          // print the routing details to the console.\n          logger.groupCollapsed(`Router is responding to: ${getFriendlyURL(url)}`);\n          debugMessages.forEach(msg => {\n            if (Array.isArray(msg)) {\n              logger.log(...msg);\n            } else {\n              logger.log(msg);\n            }\n          });\n          logger.groupEnd();\n        }\n        // Wrap in try and catch in case the handle method throws a synchronous\n        // error. It should still callback to the catch handler.\n        let responsePromise;\n        try {\n          responsePromise = handler.handle({\n            url,\n            request,\n            event,\n            params\n          });\n        } catch (err) {\n          responsePromise = Promise.reject(err);\n        }\n        // Get route's catch handler, if it exists\n        const catchHandler = route && route.catchHandler;\n        if (responsePromise instanceof Promise && (this._catchHandler || catchHandler)) {\n          responsePromise = responsePromise.catch(async err => {\n            // If there's a route catch handler, process that first\n            if (catchHandler) {\n              {\n                // Still include URL here as it will be async from the console group\n                // and may not make sense without the URL\n                logger.groupCollapsed(`Error thrown when responding to: ` + ` ${getFriendlyURL(url)}. Falling back to route's Catch Handler.`);\n                logger.error(`Error thrown by:`, route);\n                logger.error(err);\n                logger.groupEnd();\n              }\n              try {\n                return await catchHandler.handle({\n                  url,\n                  request,\n                  event,\n                  params\n                });\n              } catch (catchErr) {\n                if (catchErr instanceof Error) {\n                  err = catchErr;\n                }\n              }\n            }\n            if (this._catchHandler) {\n              {\n                // Still include URL here as it will be async from the console group\n                // and may not make sense without the URL\n                logger.groupCollapsed(`Error thrown when responding to: ` + ` ${getFriendlyURL(url)}. Falling back to global Catch Handler.`);\n                logger.error(`Error thrown by:`, route);\n                logger.error(err);\n                logger.groupEnd();\n              }\n              return this._catchHandler.handle({\n                url,\n                request,\n                event\n              });\n            }\n            throw err;\n          });\n        }\n        return responsePromise;\n      }\n      /**\n       * Checks a request and URL (and optionally an event) against the list of\n       * registered routes, and if there's a match, returns the corresponding\n       * route along with any params generated by the match.\n       *\n       * @param {Object} options\n       * @param {URL} options.url\n       * @param {boolean} options.sameOrigin The result of comparing `url.origin`\n       *     against the current origin.\n       * @param {Request} options.request The request to match.\n       * @param {Event} options.event The corresponding event.\n       * @return {Object} An object with `route` and `params` properties.\n       *     They are populated if a matching route was found or `undefined`\n       *     otherwise.\n       */\n      findMatchingRoute({\n        url,\n        sameOrigin,\n        request,\n        event\n      }) {\n        const routes = this._routes.get(request.method) || [];\n        for (const route of routes) {\n          let params;\n          // route.match returns type any, not possible to change right now.\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n          const matchResult = route.match({\n            url,\n            sameOrigin,\n            request,\n            event\n          });\n          if (matchResult) {\n            {\n              // Warn developers that using an async matchCallback is almost always\n              // not the right thing to do.\n              if (matchResult instanceof Promise) {\n                logger.warn(`While routing ${getFriendlyURL(url)}, an async ` + `matchCallback function was used. Please convert the ` + `following route to use a synchronous matchCallback function:`, route);\n              }\n            }\n            // See https://github.com/GoogleChrome/workbox/issues/2079\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            params = matchResult;\n            if (Array.isArray(params) && params.length === 0) {\n              // Instead of passing an empty array in as params, use undefined.\n              params = undefined;\n            } else if (matchResult.constructor === Object &&\n            // eslint-disable-line\n            Object.keys(matchResult).length === 0) {\n              // Instead of passing an empty object in as params, use undefined.\n              params = undefined;\n            } else if (typeof matchResult === 'boolean') {\n              // For the boolean value true (rather than just something truth-y),\n              // don't set params.\n              // See https://github.com/GoogleChrome/workbox/pull/2134#issuecomment-513924353\n              params = undefined;\n            }\n            // Return early if have a match.\n            return {\n              route,\n              params\n            };\n          }\n        }\n        // If no match was found above, return and empty object.\n        return {};\n      }\n      /**\n       * Define a default `handler` that's called when no routes explicitly\n       * match the incoming request.\n       *\n       * Each HTTP method ('GET', 'POST', etc.) gets its own default handler.\n       *\n       * Without a default handler, unmatched requests will go against the\n       * network as if there were no service worker present.\n       *\n       * @param {workbox-routing~handlerCallback} handler A callback\n       * function that returns a Promise resulting in a Response.\n       * @param {string} [method='GET'] The HTTP method to associate with this\n       * default handler. Each method has its own default.\n       */\n      setDefaultHandler(handler, method = defaultMethod) {\n        this._defaultHandlerMap.set(method, normalizeHandler(handler));\n      }\n      /**\n       * If a Route throws an error while handling a request, this `handler`\n       * will be called and given a chance to provide a response.\n       *\n       * @param {workbox-routing~handlerCallback} handler A callback\n       * function that returns a Promise resulting in a Response.\n       */\n      setCatchHandler(handler) {\n        this._catchHandler = normalizeHandler(handler);\n      }\n      /**\n       * Registers a route with the router.\n       *\n       * @param {workbox-routing.Route} route The route to register.\n       */\n      registerRoute(route) {\n        {\n          finalAssertExports.isType(route, 'object', {\n            moduleName: 'workbox-routing',\n            className: 'Router',\n            funcName: 'registerRoute',\n            paramName: 'route'\n          });\n          finalAssertExports.hasMethod(route, 'match', {\n            moduleName: 'workbox-routing',\n            className: 'Router',\n            funcName: 'registerRoute',\n            paramName: 'route'\n          });\n          finalAssertExports.isType(route.handler, 'object', {\n            moduleName: 'workbox-routing',\n            className: 'Router',\n            funcName: 'registerRoute',\n            paramName: 'route'\n          });\n          finalAssertExports.hasMethod(route.handler, 'handle', {\n            moduleName: 'workbox-routing',\n            className: 'Router',\n            funcName: 'registerRoute',\n            paramName: 'route.handler'\n          });\n          finalAssertExports.isType(route.method, 'string', {\n            moduleName: 'workbox-routing',\n            className: 'Router',\n            funcName: 'registerRoute',\n            paramName: 'route.method'\n          });\n        }\n        if (!this._routes.has(route.method)) {\n          this._routes.set(route.method, []);\n        }\n        // Give precedence to all of the earlier routes by adding this additional\n        // route to the end of the array.\n        this._routes.get(route.method).push(route);\n      }\n      /**\n       * Unregisters a route with the router.\n       *\n       * @param {workbox-routing.Route} route The route to unregister.\n       */\n      unregisterRoute(route) {\n        if (!this._routes.has(route.method)) {\n          throw new WorkboxError('unregister-route-but-not-found-with-method', {\n            method: route.method\n          });\n        }\n        const routeIndex = this._routes.get(route.method).indexOf(route);\n        if (routeIndex > -1) {\n          this._routes.get(route.method).splice(routeIndex, 1);\n        } else {\n          throw new WorkboxError('unregister-route-route-not-registered');\n        }\n      }\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    let defaultRouter;\n    /**\n     * Creates a new, singleton Router instance if one does not exist. If one\n     * does already exist, that instance is returned.\n     *\n     * @private\n     * @return {Router}\n     */\n    const getOrCreateDefaultRouter = () => {\n      if (!defaultRouter) {\n        defaultRouter = new Router();\n        // The helpers that use the default Router assume these listeners exist.\n        defaultRouter.addFetchListener();\n        defaultRouter.addCacheListener();\n      }\n      return defaultRouter;\n    };\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Easily register a RegExp, string, or function with a caching\n     * strategy to a singleton Router instance.\n     *\n     * This method will generate a Route for you if needed and\n     * call {@link workbox-routing.Router#registerRoute}.\n     *\n     * @param {RegExp|string|workbox-routing.Route~matchCallback|workbox-routing.Route} capture\n     * If the capture param is a `Route`, all other arguments will be ignored.\n     * @param {workbox-routing~handlerCallback} [handler] A callback\n     * function that returns a Promise resulting in a Response. This parameter\n     * is required if `capture` is not a `Route` object.\n     * @param {string} [method='GET'] The HTTP method to match the Route\n     * against.\n     * @return {workbox-routing.Route} The generated `Route`.\n     *\n     * @memberof workbox-routing\n     */\n    function registerRoute(capture, handler, method) {\n      let route;\n      if (typeof capture === 'string') {\n        const captureUrl = new URL(capture, location.href);\n        {\n          if (!(capture.startsWith('/') || capture.startsWith('http'))) {\n            throw new WorkboxError('invalid-string', {\n              moduleName: 'workbox-routing',\n              funcName: 'registerRoute',\n              paramName: 'capture'\n            });\n          }\n          // We want to check if Express-style wildcards are in the pathname only.\n          // TODO: Remove this log message in v4.\n          const valueToCheck = capture.startsWith('http') ? captureUrl.pathname : capture;\n          // See https://github.com/pillarjs/path-to-regexp#parameters\n          const wildcards = '[*:?+]';\n          if (new RegExp(`${wildcards}`).exec(valueToCheck)) {\n            logger.debug(`The '$capture' parameter contains an Express-style wildcard ` + `character (${wildcards}). Strings are now always interpreted as ` + `exact matches; use a RegExp for partial or wildcard matches.`);\n          }\n        }\n        const matchCallback = ({\n          url\n        }) => {\n          {\n            if (url.pathname === captureUrl.pathname && url.origin !== captureUrl.origin) {\n              logger.debug(`${capture} only partially matches the cross-origin URL ` + `${url.toString()}. This route will only handle cross-origin requests ` + `if they match the entire URL.`);\n            }\n          }\n          return url.href === captureUrl.href;\n        };\n        // If `capture` is a string then `handler` and `method` must be present.\n        route = new Route(matchCallback, handler, method);\n      } else if (capture instanceof RegExp) {\n        // If `capture` is a `RegExp` then `handler` and `method` must be present.\n        route = new RegExpRoute(capture, handler, method);\n      } else if (typeof capture === 'function') {\n        // If `capture` is a function then `handler` and `method` must be present.\n        route = new Route(capture, handler, method);\n      } else if (capture instanceof Route) {\n        route = capture;\n      } else {\n        throw new WorkboxError('unsupported-route-type', {\n          moduleName: 'workbox-routing',\n          funcName: 'registerRoute',\n          paramName: 'capture'\n        });\n      }\n      const defaultRouter = getOrCreateDefaultRouter();\n      defaultRouter.registerRoute(route);\n      return route;\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    const _cacheNameDetails = {\n      googleAnalytics: 'googleAnalytics',\n      precache: 'precache-v2',\n      prefix: 'workbox',\n      runtime: 'runtime',\n      suffix: typeof registration !== 'undefined' ? registration.scope : ''\n    };\n    const _createCacheName = cacheName => {\n      return [_cacheNameDetails.prefix, cacheName, _cacheNameDetails.suffix].filter(value => value && value.length > 0).join('-');\n    };\n    const eachCacheNameDetail = fn => {\n      for (const key of Object.keys(_cacheNameDetails)) {\n        fn(key);\n      }\n    };\n    const cacheNames = {\n      updateDetails: details => {\n        eachCacheNameDetail(key => {\n          if (typeof details[key] === 'string') {\n            _cacheNameDetails[key] = details[key];\n          }\n        });\n      },\n      getGoogleAnalyticsName: userCacheName => {\n        return userCacheName || _createCacheName(_cacheNameDetails.googleAnalytics);\n      },\n      getPrecacheName: userCacheName => {\n        return userCacheName || _createCacheName(_cacheNameDetails.precache);\n      },\n      getPrefix: () => {\n        return _cacheNameDetails.prefix;\n      },\n      getRuntimeName: userCacheName => {\n        return userCacheName || _createCacheName(_cacheNameDetails.runtime);\n      },\n      getSuffix: () => {\n        return _cacheNameDetails.suffix;\n      }\n    };\n\n    /*\n      Copyright 2019 Google LLC\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * A helper function that prevents a promise from being flagged as unused.\n     *\n     * @private\n     **/\n    function dontWaitFor(promise) {\n      // Effective no-op.\n      void promise.then(() => {});\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    // Callbacks to be executed whenever there's a quota error.\n    // Can't change Function type right now.\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    const quotaErrorCallbacks = new Set();\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Adds a function to the set of quotaErrorCallbacks that will be executed if\n     * there's a quota error.\n     *\n     * @param {Function} callback\n     * @memberof workbox-core\n     */\n    // Can't change Function type\n    // eslint-disable-next-line @typescript-eslint/ban-types\n    function registerQuotaErrorCallback(callback) {\n      {\n        finalAssertExports.isType(callback, 'function', {\n          moduleName: 'workbox-core',\n          funcName: 'register',\n          paramName: 'callback'\n        });\n      }\n      quotaErrorCallbacks.add(callback);\n      {\n        logger.log('Registered a callback to respond to quota errors.', callback);\n      }\n    }\n\n    function _extends() {\n      return _extends = Object.assign ? Object.assign.bind() : function (n) {\n        for (var e = 1; e < arguments.length; e++) {\n          var t = arguments[e];\n          for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]);\n        }\n        return n;\n      }, _extends.apply(null, arguments);\n    }\n\n    const instanceOfAny = (object, constructors) => constructors.some(c => object instanceof c);\n    let idbProxyableTypes;\n    let cursorAdvanceMethods;\n    // This is a function to prevent it throwing up in node environments.\n    function getIdbProxyableTypes() {\n      return idbProxyableTypes || (idbProxyableTypes = [IDBDatabase, IDBObjectStore, IDBIndex, IDBCursor, IDBTransaction]);\n    }\n    // This is a function to prevent it throwing up in node environments.\n    function getCursorAdvanceMethods() {\n      return cursorAdvanceMethods || (cursorAdvanceMethods = [IDBCursor.prototype.advance, IDBCursor.prototype.continue, IDBCursor.prototype.continuePrimaryKey]);\n    }\n    const cursorRequestMap = new WeakMap();\n    const transactionDoneMap = new WeakMap();\n    const transactionStoreNamesMap = new WeakMap();\n    const transformCache = new WeakMap();\n    const reverseTransformCache = new WeakMap();\n    function promisifyRequest(request) {\n      const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n          request.removeEventListener('success', success);\n          request.removeEventListener('error', error);\n        };\n        const success = () => {\n          resolve(wrap(request.result));\n          unlisten();\n        };\n        const error = () => {\n          reject(request.error);\n          unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n      });\n      promise.then(value => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n          cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n      }).catch(() => {});\n      // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n      // is because we create many promises from a single IDBRequest.\n      reverseTransformCache.set(promise, request);\n      return promise;\n    }\n    function cacheDonePromiseForTransaction(tx) {\n      // Early bail if we've already created a done promise for this transaction.\n      if (transactionDoneMap.has(tx)) return;\n      const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n          tx.removeEventListener('complete', complete);\n          tx.removeEventListener('error', error);\n          tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n          resolve();\n          unlisten();\n        };\n        const error = () => {\n          reject(tx.error || new DOMException('AbortError', 'AbortError'));\n          unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n      });\n      // Cache it for later retrieval.\n      transactionDoneMap.set(tx, done);\n    }\n    let idbProxyTraps = {\n      get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n          // Special handling for transaction.done.\n          if (prop === 'done') return transactionDoneMap.get(target);\n          // Polyfill for objectStoreNames because of Edge.\n          if (prop === 'objectStoreNames') {\n            return target.objectStoreNames || transactionStoreNamesMap.get(target);\n          }\n          // Make tx.store return the only store in the transaction, or undefined if there are many.\n          if (prop === 'store') {\n            return receiver.objectStoreNames[1] ? undefined : receiver.objectStore(receiver.objectStoreNames[0]);\n          }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n      },\n      set(target, prop, value) {\n        target[prop] = value;\n        return true;\n      },\n      has(target, prop) {\n        if (target instanceof IDBTransaction && (prop === 'done' || prop === 'store')) {\n          return true;\n        }\n        return prop in target;\n      }\n    };\n    function replaceTraps(callback) {\n      idbProxyTraps = callback(idbProxyTraps);\n    }\n    function wrapFunction(func) {\n      // Due to expected object equality (which is enforced by the caching in `wrap`), we\n      // only create one new func per func.\n      // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n      if (func === IDBDatabase.prototype.transaction && !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n          const tx = func.call(unwrap(this), storeNames, ...args);\n          transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n          return wrap(tx);\n        };\n      }\n      // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n      // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n      // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n      // with real promises, so each advance methods returns a new promise for the cursor object, or\n      // undefined if the end of the cursor has been reached.\n      if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n          // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n          // the original object.\n          func.apply(unwrap(this), args);\n          return wrap(cursorRequestMap.get(this));\n        };\n      }\n      return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n      };\n    }\n    function transformCachableValue(value) {\n      if (typeof value === 'function') return wrapFunction(value);\n      // This doesn't return, it just creates a 'done' promise for the transaction,\n      // which is later returned for transaction.done (see idbObjectHandler).\n      if (value instanceof IDBTransaction) cacheDonePromiseForTransaction(value);\n      if (instanceOfAny(value, getIdbProxyableTypes())) return new Proxy(value, idbProxyTraps);\n      // Return the same value back if we're not going to transform it.\n      return value;\n    }\n    function wrap(value) {\n      // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n      // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n      if (value instanceof IDBRequest) return promisifyRequest(value);\n      // If we've already transformed this value before, reuse the transformed value.\n      // This is faster, but it also provides object equality.\n      if (transformCache.has(value)) return transformCache.get(value);\n      const newValue = transformCachableValue(value);\n      // Not all types are transformed.\n      // These may be primitive types, so they can't be WeakMap keys.\n      if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n      }\n      return newValue;\n    }\n    const unwrap = value => reverseTransformCache.get(value);\n\n    /**\n     * Open a database.\n     *\n     * @param name Name of the database.\n     * @param version Schema version.\n     * @param callbacks Additional callbacks.\n     */\n    function openDB(name, version, {\n      blocked,\n      upgrade,\n      blocking,\n      terminated\n    } = {}) {\n      const request = indexedDB.open(name, version);\n      const openPromise = wrap(request);\n      if (upgrade) {\n        request.addEventListener('upgradeneeded', event => {\n          upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n      }\n      if (blocked) {\n        request.addEventListener('blocked', event => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n      }\n      openPromise.then(db => {\n        if (terminated) db.addEventListener('close', () => terminated());\n        if (blocking) {\n          db.addEventListener('versionchange', event => blocking(event.oldVersion, event.newVersion, event));\n        }\n      }).catch(() => {});\n      return openPromise;\n    }\n    /**\n     * Delete a database.\n     *\n     * @param name Name of the database.\n     */\n    function deleteDB(name, {\n      blocked\n    } = {}) {\n      const request = indexedDB.deleteDatabase(name);\n      if (blocked) {\n        request.addEventListener('blocked', event => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n      }\n      return wrap(request).then(() => undefined);\n    }\n    const readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\n    const writeMethods = ['put', 'add', 'delete', 'clear'];\n    const cachedMethods = new Map();\n    function getMethod(target, prop) {\n      if (!(target instanceof IDBDatabase && !(prop in target) && typeof prop === 'string')) {\n        return;\n      }\n      if (cachedMethods.get(prop)) return cachedMethods.get(prop);\n      const targetFuncName = prop.replace(/FromIndex$/, '');\n      const useIndex = prop !== targetFuncName;\n      const isWrite = writeMethods.includes(targetFuncName);\n      if (\n      // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n      !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) || !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n      }\n      const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex) target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([target[targetFuncName](...args), isWrite && tx.done]))[0];\n      };\n      cachedMethods.set(prop, method);\n      return method;\n    }\n    replaceTraps(oldTraps => _extends({}, oldTraps, {\n      get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n      has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop)\n    }));\n\n    // @ts-ignore\n    try {\n      self['workbox:expiration:7.3.0'] && _();\n    } catch (e) {}\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    const DB_NAME = 'workbox-expiration';\n    const CACHE_OBJECT_STORE = 'cache-entries';\n    const normalizeURL = unNormalizedUrl => {\n      const url = new URL(unNormalizedUrl, location.href);\n      url.hash = '';\n      return url.href;\n    };\n    /**\n     * Returns the timestamp model.\n     *\n     * @private\n     */\n    class CacheTimestampsModel {\n      /**\n       *\n       * @param {string} cacheName\n       *\n       * @private\n       */\n      constructor(cacheName) {\n        this._db = null;\n        this._cacheName = cacheName;\n      }\n      /**\n       * Performs an upgrade of indexedDB.\n       *\n       * @param {IDBPDatabase<CacheDbSchema>} db\n       *\n       * @private\n       */\n      _upgradeDb(db) {\n        // TODO(philipwalton): EdgeHTML doesn't support arrays as a keyPath, so we\n        // have to use the `id` keyPath here and create our own values (a\n        // concatenation of `url + cacheName`) instead of simply using\n        // `keyPath: ['url', 'cacheName']`, which is supported in other browsers.\n        const objStore = db.createObjectStore(CACHE_OBJECT_STORE, {\n          keyPath: 'id'\n        });\n        // TODO(philipwalton): once we don't have to support EdgeHTML, we can\n        // create a single index with the keyPath `['cacheName', 'timestamp']`\n        // instead of doing both these indexes.\n        objStore.createIndex('cacheName', 'cacheName', {\n          unique: false\n        });\n        objStore.createIndex('timestamp', 'timestamp', {\n          unique: false\n        });\n      }\n      /**\n       * Performs an upgrade of indexedDB and deletes deprecated DBs.\n       *\n       * @param {IDBPDatabase<CacheDbSchema>} db\n       *\n       * @private\n       */\n      _upgradeDbAndDeleteOldDbs(db) {\n        this._upgradeDb(db);\n        if (this._cacheName) {\n          void deleteDB(this._cacheName);\n        }\n      }\n      /**\n       * @param {string} url\n       * @param {number} timestamp\n       *\n       * @private\n       */\n      async setTimestamp(url, timestamp) {\n        url = normalizeURL(url);\n        const entry = {\n          url,\n          timestamp,\n          cacheName: this._cacheName,\n          // Creating an ID from the URL and cache name won't be necessary once\n          // Edge switches to Chromium and all browsers we support work with\n          // array keyPaths.\n          id: this._getId(url)\n        };\n        const db = await this.getDb();\n        const tx = db.transaction(CACHE_OBJECT_STORE, 'readwrite', {\n          durability: 'relaxed'\n        });\n        await tx.store.put(entry);\n        await tx.done;\n      }\n      /**\n       * Returns the timestamp stored for a given URL.\n       *\n       * @param {string} url\n       * @return {number | undefined}\n       *\n       * @private\n       */\n      async getTimestamp(url) {\n        const db = await this.getDb();\n        const entry = await db.get(CACHE_OBJECT_STORE, this._getId(url));\n        return entry === null || entry === void 0 ? void 0 : entry.timestamp;\n      }\n      /**\n       * Iterates through all the entries in the object store (from newest to\n       * oldest) and removes entries once either `maxCount` is reached or the\n       * entry's timestamp is less than `minTimestamp`.\n       *\n       * @param {number} minTimestamp\n       * @param {number} maxCount\n       * @return {Array<string>}\n       *\n       * @private\n       */\n      async expireEntries(minTimestamp, maxCount) {\n        const db = await this.getDb();\n        let cursor = await db.transaction(CACHE_OBJECT_STORE).store.index('timestamp').openCursor(null, 'prev');\n        const entriesToDelete = [];\n        let entriesNotDeletedCount = 0;\n        while (cursor) {\n          const result = cursor.value;\n          // TODO(philipwalton): once we can use a multi-key index, we\n          // won't have to check `cacheName` here.\n          if (result.cacheName === this._cacheName) {\n            // Delete an entry if it's older than the max age or\n            // if we already have the max number allowed.\n            if (minTimestamp && result.timestamp < minTimestamp || maxCount && entriesNotDeletedCount >= maxCount) {\n              // TODO(philipwalton): we should be able to delete the\n              // entry right here, but doing so causes an iteration\n              // bug in Safari stable (fixed in TP). Instead we can\n              // store the keys of the entries to delete, and then\n              // delete the separate transactions.\n              // https://github.com/GoogleChrome/workbox/issues/1978\n              // cursor.delete();\n              // We only need to return the URL, not the whole entry.\n              entriesToDelete.push(cursor.value);\n            } else {\n              entriesNotDeletedCount++;\n            }\n          }\n          cursor = await cursor.continue();\n        }\n        // TODO(philipwalton): once the Safari bug in the following issue is fixed,\n        // we should be able to remove this loop and do the entry deletion in the\n        // cursor loop above:\n        // https://github.com/GoogleChrome/workbox/issues/1978\n        const urlsDeleted = [];\n        for (const entry of entriesToDelete) {\n          await db.delete(CACHE_OBJECT_STORE, entry.id);\n          urlsDeleted.push(entry.url);\n        }\n        return urlsDeleted;\n      }\n      /**\n       * Takes a URL and returns an ID that will be unique in the object store.\n       *\n       * @param {string} url\n       * @return {string}\n       *\n       * @private\n       */\n      _getId(url) {\n        // Creating an ID from the URL and cache name won't be necessary once\n        // Edge switches to Chromium and all browsers we support work with\n        // array keyPaths.\n        return this._cacheName + '|' + normalizeURL(url);\n      }\n      /**\n       * Returns an open connection to the database.\n       *\n       * @private\n       */\n      async getDb() {\n        if (!this._db) {\n          this._db = await openDB(DB_NAME, 1, {\n            upgrade: this._upgradeDbAndDeleteOldDbs.bind(this)\n          });\n        }\n        return this._db;\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * The `CacheExpiration` class allows you define an expiration and / or\n     * limit on the number of responses stored in a\n     * [`Cache`](https://developer.mozilla.org/en-US/docs/Web/API/Cache).\n     *\n     * @memberof workbox-expiration\n     */\n    class CacheExpiration {\n      /**\n       * To construct a new CacheExpiration instance you must provide at least\n       * one of the `config` properties.\n       *\n       * @param {string} cacheName Name of the cache to apply restrictions to.\n       * @param {Object} config\n       * @param {number} [config.maxEntries] The maximum number of entries to cache.\n       * Entries used the least will be removed as the maximum is reached.\n       * @param {number} [config.maxAgeSeconds] The maximum age of an entry before\n       * it's treated as stale and removed.\n       * @param {Object} [config.matchOptions] The [`CacheQueryOptions`](https://developer.mozilla.org/en-US/docs/Web/API/Cache/delete#Parameters)\n       * that will be used when calling `delete()` on the cache.\n       */\n      constructor(cacheName, config = {}) {\n        this._isRunning = false;\n        this._rerunRequested = false;\n        {\n          finalAssertExports.isType(cacheName, 'string', {\n            moduleName: 'workbox-expiration',\n            className: 'CacheExpiration',\n            funcName: 'constructor',\n            paramName: 'cacheName'\n          });\n          if (!(config.maxEntries || config.maxAgeSeconds)) {\n            throw new WorkboxError('max-entries-or-age-required', {\n              moduleName: 'workbox-expiration',\n              className: 'CacheExpiration',\n              funcName: 'constructor'\n            });\n          }\n          if (config.maxEntries) {\n            finalAssertExports.isType(config.maxEntries, 'number', {\n              moduleName: 'workbox-expiration',\n              className: 'CacheExpiration',\n              funcName: 'constructor',\n              paramName: 'config.maxEntries'\n            });\n          }\n          if (config.maxAgeSeconds) {\n            finalAssertExports.isType(config.maxAgeSeconds, 'number', {\n              moduleName: 'workbox-expiration',\n              className: 'CacheExpiration',\n              funcName: 'constructor',\n              paramName: 'config.maxAgeSeconds'\n            });\n          }\n        }\n        this._maxEntries = config.maxEntries;\n        this._maxAgeSeconds = config.maxAgeSeconds;\n        this._matchOptions = config.matchOptions;\n        this._cacheName = cacheName;\n        this._timestampModel = new CacheTimestampsModel(cacheName);\n      }\n      /**\n       * Expires entries for the given cache and given criteria.\n       */\n      async expireEntries() {\n        if (this._isRunning) {\n          this._rerunRequested = true;\n          return;\n        }\n        this._isRunning = true;\n        const minTimestamp = this._maxAgeSeconds ? Date.now() - this._maxAgeSeconds * 1000 : 0;\n        const urlsExpired = await this._timestampModel.expireEntries(minTimestamp, this._maxEntries);\n        // Delete URLs from the cache\n        const cache = await self.caches.open(this._cacheName);\n        for (const url of urlsExpired) {\n          await cache.delete(url, this._matchOptions);\n        }\n        {\n          if (urlsExpired.length > 0) {\n            logger.groupCollapsed(`Expired ${urlsExpired.length} ` + `${urlsExpired.length === 1 ? 'entry' : 'entries'} and removed ` + `${urlsExpired.length === 1 ? 'it' : 'them'} from the ` + `'${this._cacheName}' cache.`);\n            logger.log(`Expired the following ${urlsExpired.length === 1 ? 'URL' : 'URLs'}:`);\n            urlsExpired.forEach(url => logger.log(`    ${url}`));\n            logger.groupEnd();\n          } else {\n            logger.debug(`Cache expiration ran and found no entries to remove.`);\n          }\n        }\n        this._isRunning = false;\n        if (this._rerunRequested) {\n          this._rerunRequested = false;\n          dontWaitFor(this.expireEntries());\n        }\n      }\n      /**\n       * Update the timestamp for the given URL. This ensures the when\n       * removing entries based on maximum entries, most recently used\n       * is accurate or when expiring, the timestamp is up-to-date.\n       *\n       * @param {string} url\n       */\n      async updateTimestamp(url) {\n        {\n          finalAssertExports.isType(url, 'string', {\n            moduleName: 'workbox-expiration',\n            className: 'CacheExpiration',\n            funcName: 'updateTimestamp',\n            paramName: 'url'\n          });\n        }\n        await this._timestampModel.setTimestamp(url, Date.now());\n      }\n      /**\n       * Can be used to check if a URL has expired or not before it's used.\n       *\n       * This requires a look up from IndexedDB, so can be slow.\n       *\n       * Note: This method will not remove the cached entry, call\n       * `expireEntries()` to remove indexedDB and Cache entries.\n       *\n       * @param {string} url\n       * @return {boolean}\n       */\n      async isURLExpired(url) {\n        if (!this._maxAgeSeconds) {\n          {\n            throw new WorkboxError(`expired-test-without-max-age`, {\n              methodName: 'isURLExpired',\n              paramName: 'maxAgeSeconds'\n            });\n          }\n        } else {\n          const timestamp = await this._timestampModel.getTimestamp(url);\n          const expireOlderThan = Date.now() - this._maxAgeSeconds * 1000;\n          return timestamp !== undefined ? timestamp < expireOlderThan : true;\n        }\n      }\n      /**\n       * Removes the IndexedDB object store used to keep track of cache expiration\n       * metadata.\n       */\n      async delete() {\n        // Make sure we don't attempt another rerun if we're called in the middle of\n        // a cache expiration.\n        this._rerunRequested = false;\n        await this._timestampModel.expireEntries(Infinity); // Expires all.\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * This plugin can be used in a `workbox-strategy` to regularly enforce a\n     * limit on the age and / or the number of cached requests.\n     *\n     * It can only be used with `workbox-strategy` instances that have a\n     * [custom `cacheName` property set](/web/tools/workbox/guides/configure-workbox#custom_cache_names_in_strategies).\n     * In other words, it can't be used to expire entries in strategy that uses the\n     * default runtime cache name.\n     *\n     * Whenever a cached response is used or updated, this plugin will look\n     * at the associated cache and remove any old or extra responses.\n     *\n     * When using `maxAgeSeconds`, responses may be used *once* after expiring\n     * because the expiration clean up will not have occurred until *after* the\n     * cached response has been used. If the response has a \"Date\" header, then\n     * a light weight expiration check is performed and the response will not be\n     * used immediately.\n     *\n     * When using `maxEntries`, the entry least-recently requested will be removed\n     * from the cache first.\n     *\n     * @memberof workbox-expiration\n     */\n    class ExpirationPlugin {\n      /**\n       * @param {ExpirationPluginOptions} config\n       * @param {number} [config.maxEntries] The maximum number of entries to cache.\n       * Entries used the least will be removed as the maximum is reached.\n       * @param {number} [config.maxAgeSeconds] The maximum age of an entry before\n       * it's treated as stale and removed.\n       * @param {Object} [config.matchOptions] The [`CacheQueryOptions`](https://developer.mozilla.org/en-US/docs/Web/API/Cache/delete#Parameters)\n       * that will be used when calling `delete()` on the cache.\n       * @param {boolean} [config.purgeOnQuotaError] Whether to opt this cache in to\n       * automatic deletion if the available storage quota has been exceeded.\n       */\n      constructor(config = {}) {\n        /**\n         * A \"lifecycle\" callback that will be triggered automatically by the\n         * `workbox-strategies` handlers when a `Response` is about to be returned\n         * from a [Cache](https://developer.mozilla.org/en-US/docs/Web/API/Cache) to\n         * the handler. It allows the `Response` to be inspected for freshness and\n         * prevents it from being used if the `Response`'s `Date` header value is\n         * older than the configured `maxAgeSeconds`.\n         *\n         * @param {Object} options\n         * @param {string} options.cacheName Name of the cache the response is in.\n         * @param {Response} options.cachedResponse The `Response` object that's been\n         *     read from a cache and whose freshness should be checked.\n         * @return {Response} Either the `cachedResponse`, if it's\n         *     fresh, or `null` if the `Response` is older than `maxAgeSeconds`.\n         *\n         * @private\n         */\n        this.cachedResponseWillBeUsed = async ({\n          event,\n          request,\n          cacheName,\n          cachedResponse\n        }) => {\n          if (!cachedResponse) {\n            return null;\n          }\n          const isFresh = this._isResponseDateFresh(cachedResponse);\n          // Expire entries to ensure that even if the expiration date has\n          // expired, it'll only be used once.\n          const cacheExpiration = this._getCacheExpiration(cacheName);\n          dontWaitFor(cacheExpiration.expireEntries());\n          // Update the metadata for the request URL to the current timestamp,\n          // but don't `await` it as we don't want to block the response.\n          const updateTimestampDone = cacheExpiration.updateTimestamp(request.url);\n          if (event) {\n            try {\n              event.waitUntil(updateTimestampDone);\n            } catch (error) {\n              {\n                // The event may not be a fetch event; only log the URL if it is.\n                if ('request' in event) {\n                  logger.warn(`Unable to ensure service worker stays alive when ` + `updating cache entry for ` + `'${getFriendlyURL(event.request.url)}'.`);\n                }\n              }\n            }\n          }\n          return isFresh ? cachedResponse : null;\n        };\n        /**\n         * A \"lifecycle\" callback that will be triggered automatically by the\n         * `workbox-strategies` handlers when an entry is added to a cache.\n         *\n         * @param {Object} options\n         * @param {string} options.cacheName Name of the cache that was updated.\n         * @param {string} options.request The Request for the cached entry.\n         *\n         * @private\n         */\n        this.cacheDidUpdate = async ({\n          cacheName,\n          request\n        }) => {\n          {\n            finalAssertExports.isType(cacheName, 'string', {\n              moduleName: 'workbox-expiration',\n              className: 'Plugin',\n              funcName: 'cacheDidUpdate',\n              paramName: 'cacheName'\n            });\n            finalAssertExports.isInstance(request, Request, {\n              moduleName: 'workbox-expiration',\n              className: 'Plugin',\n              funcName: 'cacheDidUpdate',\n              paramName: 'request'\n            });\n          }\n          const cacheExpiration = this._getCacheExpiration(cacheName);\n          await cacheExpiration.updateTimestamp(request.url);\n          await cacheExpiration.expireEntries();\n        };\n        {\n          if (!(config.maxEntries || config.maxAgeSeconds)) {\n            throw new WorkboxError('max-entries-or-age-required', {\n              moduleName: 'workbox-expiration',\n              className: 'Plugin',\n              funcName: 'constructor'\n            });\n          }\n          if (config.maxEntries) {\n            finalAssertExports.isType(config.maxEntries, 'number', {\n              moduleName: 'workbox-expiration',\n              className: 'Plugin',\n              funcName: 'constructor',\n              paramName: 'config.maxEntries'\n            });\n          }\n          if (config.maxAgeSeconds) {\n            finalAssertExports.isType(config.maxAgeSeconds, 'number', {\n              moduleName: 'workbox-expiration',\n              className: 'Plugin',\n              funcName: 'constructor',\n              paramName: 'config.maxAgeSeconds'\n            });\n          }\n        }\n        this._config = config;\n        this._maxAgeSeconds = config.maxAgeSeconds;\n        this._cacheExpirations = new Map();\n        if (config.purgeOnQuotaError) {\n          registerQuotaErrorCallback(() => this.deleteCacheAndMetadata());\n        }\n      }\n      /**\n       * A simple helper method to return a CacheExpiration instance for a given\n       * cache name.\n       *\n       * @param {string} cacheName\n       * @return {CacheExpiration}\n       *\n       * @private\n       */\n      _getCacheExpiration(cacheName) {\n        if (cacheName === cacheNames.getRuntimeName()) {\n          throw new WorkboxError('expire-custom-caches-only');\n        }\n        let cacheExpiration = this._cacheExpirations.get(cacheName);\n        if (!cacheExpiration) {\n          cacheExpiration = new CacheExpiration(cacheName, this._config);\n          this._cacheExpirations.set(cacheName, cacheExpiration);\n        }\n        return cacheExpiration;\n      }\n      /**\n       * @param {Response} cachedResponse\n       * @return {boolean}\n       *\n       * @private\n       */\n      _isResponseDateFresh(cachedResponse) {\n        if (!this._maxAgeSeconds) {\n          // We aren't expiring by age, so return true, it's fresh\n          return true;\n        }\n        // Check if the 'date' header will suffice a quick expiration check.\n        // See https://github.com/GoogleChromeLabs/sw-toolbox/issues/164 for\n        // discussion.\n        const dateHeaderTimestamp = this._getDateHeaderTimestamp(cachedResponse);\n        if (dateHeaderTimestamp === null) {\n          // Unable to parse date, so assume it's fresh.\n          return true;\n        }\n        // If we have a valid headerTime, then our response is fresh iff the\n        // headerTime plus maxAgeSeconds is greater than the current time.\n        const now = Date.now();\n        return dateHeaderTimestamp >= now - this._maxAgeSeconds * 1000;\n      }\n      /**\n       * This method will extract the data header and parse it into a useful\n       * value.\n       *\n       * @param {Response} cachedResponse\n       * @return {number|null}\n       *\n       * @private\n       */\n      _getDateHeaderTimestamp(cachedResponse) {\n        if (!cachedResponse.headers.has('date')) {\n          return null;\n        }\n        const dateHeader = cachedResponse.headers.get('date');\n        const parsedDate = new Date(dateHeader);\n        const headerTime = parsedDate.getTime();\n        // If the Date header was invalid for some reason, parsedDate.getTime()\n        // will return NaN.\n        if (isNaN(headerTime)) {\n          return null;\n        }\n        return headerTime;\n      }\n      /**\n       * This is a helper method that performs two operations:\n       *\n       * - Deletes *all* the underlying Cache instances associated with this plugin\n       * instance, by calling caches.delete() on your behalf.\n       * - Deletes the metadata from IndexedDB used to keep track of expiration\n       * details for each Cache instance.\n       *\n       * When using cache expiration, calling this method is preferable to calling\n       * `caches.delete()` directly, since this will ensure that the IndexedDB\n       * metadata is also cleanly removed and open IndexedDB instances are deleted.\n       *\n       * Note that if you're *not* using cache expiration for a given cache, calling\n       * `caches.delete()` and passing in the cache's name should be sufficient.\n       * There is no Workbox-specific method needed for cleanup in that case.\n       */\n      async deleteCacheAndMetadata() {\n        // Do this one at a time instead of all at once via `Promise.all()` to\n        // reduce the chance of inconsistency if a promise rejects.\n        for (const [cacheName, cacheExpiration] of this._cacheExpirations) {\n          await self.caches.delete(cacheName);\n          await cacheExpiration.delete();\n        }\n        // Reset this._cacheExpirations to its initial state.\n        this._cacheExpirations = new Map();\n      }\n    }\n\n    // @ts-ignore\n    try {\n      self['workbox:cacheable-response:7.3.0'] && _();\n    } catch (e) {}\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * This class allows you to set up rules determining what\n     * status codes and/or headers need to be present in order for a\n     * [`Response`](https://developer.mozilla.org/en-US/docs/Web/API/Response)\n     * to be considered cacheable.\n     *\n     * @memberof workbox-cacheable-response\n     */\n    class CacheableResponse {\n      /**\n       * To construct a new CacheableResponse instance you must provide at least\n       * one of the `config` properties.\n       *\n       * If both `statuses` and `headers` are specified, then both conditions must\n       * be met for the `Response` to be considered cacheable.\n       *\n       * @param {Object} config\n       * @param {Array<number>} [config.statuses] One or more status codes that a\n       * `Response` can have and be considered cacheable.\n       * @param {Object<string,string>} [config.headers] A mapping of header names\n       * and expected values that a `Response` can have and be considered cacheable.\n       * If multiple headers are provided, only one needs to be present.\n       */\n      constructor(config = {}) {\n        {\n          if (!(config.statuses || config.headers)) {\n            throw new WorkboxError('statuses-or-headers-required', {\n              moduleName: 'workbox-cacheable-response',\n              className: 'CacheableResponse',\n              funcName: 'constructor'\n            });\n          }\n          if (config.statuses) {\n            finalAssertExports.isArray(config.statuses, {\n              moduleName: 'workbox-cacheable-response',\n              className: 'CacheableResponse',\n              funcName: 'constructor',\n              paramName: 'config.statuses'\n            });\n          }\n          if (config.headers) {\n            finalAssertExports.isType(config.headers, 'object', {\n              moduleName: 'workbox-cacheable-response',\n              className: 'CacheableResponse',\n              funcName: 'constructor',\n              paramName: 'config.headers'\n            });\n          }\n        }\n        this._statuses = config.statuses;\n        this._headers = config.headers;\n      }\n      /**\n       * Checks a response to see whether it's cacheable or not, based on this\n       * object's configuration.\n       *\n       * @param {Response} response The response whose cacheability is being\n       * checked.\n       * @return {boolean} `true` if the `Response` is cacheable, and `false`\n       * otherwise.\n       */\n      isResponseCacheable(response) {\n        {\n          finalAssertExports.isInstance(response, Response, {\n            moduleName: 'workbox-cacheable-response',\n            className: 'CacheableResponse',\n            funcName: 'isResponseCacheable',\n            paramName: 'response'\n          });\n        }\n        let cacheable = true;\n        if (this._statuses) {\n          cacheable = this._statuses.includes(response.status);\n        }\n        if (this._headers && cacheable) {\n          cacheable = Object.keys(this._headers).some(headerName => {\n            return response.headers.get(headerName) === this._headers[headerName];\n          });\n        }\n        {\n          if (!cacheable) {\n            logger.groupCollapsed(`The request for ` + `'${getFriendlyURL(response.url)}' returned a response that does ` + `not meet the criteria for being cached.`);\n            logger.groupCollapsed(`View cacheability criteria here.`);\n            logger.log(`Cacheable statuses: ` + JSON.stringify(this._statuses));\n            logger.log(`Cacheable headers: ` + JSON.stringify(this._headers, null, 2));\n            logger.groupEnd();\n            const logFriendlyHeaders = {};\n            response.headers.forEach((value, key) => {\n              logFriendlyHeaders[key] = value;\n            });\n            logger.groupCollapsed(`View response status and headers here.`);\n            logger.log(`Response status: ${response.status}`);\n            logger.log(`Response headers: ` + JSON.stringify(logFriendlyHeaders, null, 2));\n            logger.groupEnd();\n            logger.groupCollapsed(`View full response details here.`);\n            logger.log(response.headers);\n            logger.log(response);\n            logger.groupEnd();\n            logger.groupEnd();\n          }\n        }\n        return cacheable;\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * A class implementing the `cacheWillUpdate` lifecycle callback. This makes it\n     * easier to add in cacheability checks to requests made via Workbox's built-in\n     * strategies.\n     *\n     * @memberof workbox-cacheable-response\n     */\n    class CacheableResponsePlugin {\n      /**\n       * To construct a new CacheableResponsePlugin instance you must provide at\n       * least one of the `config` properties.\n       *\n       * If both `statuses` and `headers` are specified, then both conditions must\n       * be met for the `Response` to be considered cacheable.\n       *\n       * @param {Object} config\n       * @param {Array<number>} [config.statuses] One or more status codes that a\n       * `Response` can have and be considered cacheable.\n       * @param {Object<string,string>} [config.headers] A mapping of header names\n       * and expected values that a `Response` can have and be considered cacheable.\n       * If multiple headers are provided, only one needs to be present.\n       */\n      constructor(config) {\n        /**\n         * @param {Object} options\n         * @param {Response} options.response\n         * @return {Response|null}\n         * @private\n         */\n        this.cacheWillUpdate = async ({\n          response\n        }) => {\n          if (this._cacheableResponse.isResponseCacheable(response)) {\n            return response;\n          }\n          return null;\n        };\n        this._cacheableResponse = new CacheableResponse(config);\n      }\n    }\n\n    /*\n      Copyright 2020 Google LLC\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    function stripParams(fullURL, ignoreParams) {\n      const strippedURL = new URL(fullURL);\n      for (const param of ignoreParams) {\n        strippedURL.searchParams.delete(param);\n      }\n      return strippedURL.href;\n    }\n    /**\n     * Matches an item in the cache, ignoring specific URL params. This is similar\n     * to the `ignoreSearch` option, but it allows you to ignore just specific\n     * params (while continuing to match on the others).\n     *\n     * @private\n     * @param {Cache} cache\n     * @param {Request} request\n     * @param {Object} matchOptions\n     * @param {Array<string>} ignoreParams\n     * @return {Promise<Response|undefined>}\n     */\n    async function cacheMatchIgnoreParams(cache, request, ignoreParams, matchOptions) {\n      const strippedRequestURL = stripParams(request.url, ignoreParams);\n      // If the request doesn't include any ignored params, match as normal.\n      if (request.url === strippedRequestURL) {\n        return cache.match(request, matchOptions);\n      }\n      // Otherwise, match by comparing keys\n      const keysOptions = Object.assign(Object.assign({}, matchOptions), {\n        ignoreSearch: true\n      });\n      const cacheKeys = await cache.keys(request, keysOptions);\n      for (const cacheKey of cacheKeys) {\n        const strippedCacheKeyURL = stripParams(cacheKey.url, ignoreParams);\n        if (strippedRequestURL === strippedCacheKeyURL) {\n          return cache.match(cacheKey, matchOptions);\n        }\n      }\n      return;\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * The Deferred class composes Promises in a way that allows for them to be\n     * resolved or rejected from outside the constructor. In most cases promises\n     * should be used directly, but Deferreds can be necessary when the logic to\n     * resolve a promise must be separate.\n     *\n     * @private\n     */\n    class Deferred {\n      /**\n       * Creates a promise and exposes its resolve and reject functions as methods.\n       */\n      constructor() {\n        this.promise = new Promise((resolve, reject) => {\n          this.resolve = resolve;\n          this.reject = reject;\n        });\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Runs all of the callback functions, one at a time sequentially, in the order\n     * in which they were registered.\n     *\n     * @memberof workbox-core\n     * @private\n     */\n    async function executeQuotaErrorCallbacks() {\n      {\n        logger.log(`About to run ${quotaErrorCallbacks.size} ` + `callbacks to clean up caches.`);\n      }\n      for (const callback of quotaErrorCallbacks) {\n        await callback();\n        {\n          logger.log(callback, 'is complete.');\n        }\n      }\n      {\n        logger.log('Finished running callbacks.');\n      }\n    }\n\n    /*\n      Copyright 2019 Google LLC\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Returns a promise that resolves and the passed number of milliseconds.\n     * This utility is an async/await-friendly version of `setTimeout`.\n     *\n     * @param {number} ms\n     * @return {Promise}\n     * @private\n     */\n    function timeout(ms) {\n      return new Promise(resolve => setTimeout(resolve, ms));\n    }\n\n    // @ts-ignore\n    try {\n      self['workbox:strategies:7.3.0'] && _();\n    } catch (e) {}\n\n    /*\n      Copyright 2020 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    function toRequest(input) {\n      return typeof input === 'string' ? new Request(input) : input;\n    }\n    /**\n     * A class created every time a Strategy instance calls\n     * {@link workbox-strategies.Strategy~handle} or\n     * {@link workbox-strategies.Strategy~handleAll} that wraps all fetch and\n     * cache actions around plugin callbacks and keeps track of when the strategy\n     * is \"done\" (i.e. all added `event.waitUntil()` promises have resolved).\n     *\n     * @memberof workbox-strategies\n     */\n    class StrategyHandler {\n      /**\n       * Creates a new instance associated with the passed strategy and event\n       * that's handling the request.\n       *\n       * The constructor also initializes the state that will be passed to each of\n       * the plugins handling this request.\n       *\n       * @param {workbox-strategies.Strategy} strategy\n       * @param {Object} options\n       * @param {Request|string} options.request A request to run this strategy for.\n       * @param {ExtendableEvent} options.event The event associated with the\n       *     request.\n       * @param {URL} [options.url]\n       * @param {*} [options.params] The return value from the\n       *     {@link workbox-routing~matchCallback} (if applicable).\n       */\n      constructor(strategy, options) {\n        this._cacheKeys = {};\n        /**\n         * The request the strategy is performing (passed to the strategy's\n         * `handle()` or `handleAll()` method).\n         * @name request\n         * @instance\n         * @type {Request}\n         * @memberof workbox-strategies.StrategyHandler\n         */\n        /**\n         * The event associated with this request.\n         * @name event\n         * @instance\n         * @type {ExtendableEvent}\n         * @memberof workbox-strategies.StrategyHandler\n         */\n        /**\n         * A `URL` instance of `request.url` (if passed to the strategy's\n         * `handle()` or `handleAll()` method).\n         * Note: the `url` param will be present if the strategy was invoked\n         * from a workbox `Route` object.\n         * @name url\n         * @instance\n         * @type {URL|undefined}\n         * @memberof workbox-strategies.StrategyHandler\n         */\n        /**\n         * A `param` value (if passed to the strategy's\n         * `handle()` or `handleAll()` method).\n         * Note: the `param` param will be present if the strategy was invoked\n         * from a workbox `Route` object and the\n         * {@link workbox-routing~matchCallback} returned\n         * a truthy value (it will be that value).\n         * @name params\n         * @instance\n         * @type {*|undefined}\n         * @memberof workbox-strategies.StrategyHandler\n         */\n        {\n          finalAssertExports.isInstance(options.event, ExtendableEvent, {\n            moduleName: 'workbox-strategies',\n            className: 'StrategyHandler',\n            funcName: 'constructor',\n            paramName: 'options.event'\n          });\n        }\n        Object.assign(this, options);\n        this.event = options.event;\n        this._strategy = strategy;\n        this._handlerDeferred = new Deferred();\n        this._extendLifetimePromises = [];\n        // Copy the plugins list (since it's mutable on the strategy),\n        // so any mutations don't affect this handler instance.\n        this._plugins = [...strategy.plugins];\n        this._pluginStateMap = new Map();\n        for (const plugin of this._plugins) {\n          this._pluginStateMap.set(plugin, {});\n        }\n        this.event.waitUntil(this._handlerDeferred.promise);\n      }\n      /**\n       * Fetches a given request (and invokes any applicable plugin callback\n       * methods) using the `fetchOptions` (for non-navigation requests) and\n       * `plugins` defined on the `Strategy` object.\n       *\n       * The following plugin lifecycle methods are invoked when using this method:\n       * - `requestWillFetch()`\n       * - `fetchDidSucceed()`\n       * - `fetchDidFail()`\n       *\n       * @param {Request|string} input The URL or request to fetch.\n       * @return {Promise<Response>}\n       */\n      async fetch(input) {\n        const {\n          event\n        } = this;\n        let request = toRequest(input);\n        if (request.mode === 'navigate' && event instanceof FetchEvent && event.preloadResponse) {\n          const possiblePreloadResponse = await event.preloadResponse;\n          if (possiblePreloadResponse) {\n            {\n              logger.log(`Using a preloaded navigation response for ` + `'${getFriendlyURL(request.url)}'`);\n            }\n            return possiblePreloadResponse;\n          }\n        }\n        // If there is a fetchDidFail plugin, we need to save a clone of the\n        // original request before it's either modified by a requestWillFetch\n        // plugin or before the original request's body is consumed via fetch().\n        const originalRequest = this.hasCallback('fetchDidFail') ? request.clone() : null;\n        try {\n          for (const cb of this.iterateCallbacks('requestWillFetch')) {\n            request = await cb({\n              request: request.clone(),\n              event\n            });\n          }\n        } catch (err) {\n          if (err instanceof Error) {\n            throw new WorkboxError('plugin-error-request-will-fetch', {\n              thrownErrorMessage: err.message\n            });\n          }\n        }\n        // The request can be altered by plugins with `requestWillFetch` making\n        // the original request (most likely from a `fetch` event) different\n        // from the Request we make. Pass both to `fetchDidFail` to aid debugging.\n        const pluginFilteredRequest = request.clone();\n        try {\n          let fetchResponse;\n          // See https://github.com/GoogleChrome/workbox/issues/1796\n          fetchResponse = await fetch(request, request.mode === 'navigate' ? undefined : this._strategy.fetchOptions);\n          if (\"development\" !== 'production') {\n            logger.debug(`Network request for ` + `'${getFriendlyURL(request.url)}' returned a response with ` + `status '${fetchResponse.status}'.`);\n          }\n          for (const callback of this.iterateCallbacks('fetchDidSucceed')) {\n            fetchResponse = await callback({\n              event,\n              request: pluginFilteredRequest,\n              response: fetchResponse\n            });\n          }\n          return fetchResponse;\n        } catch (error) {\n          {\n            logger.log(`Network request for ` + `'${getFriendlyURL(request.url)}' threw an error.`, error);\n          }\n          // `originalRequest` will only exist if a `fetchDidFail` callback\n          // is being used (see above).\n          if (originalRequest) {\n            await this.runCallbacks('fetchDidFail', {\n              error: error,\n              event,\n              originalRequest: originalRequest.clone(),\n              request: pluginFilteredRequest.clone()\n            });\n          }\n          throw error;\n        }\n      }\n      /**\n       * Calls `this.fetch()` and (in the background) runs `this.cachePut()` on\n       * the response generated by `this.fetch()`.\n       *\n       * The call to `this.cachePut()` automatically invokes `this.waitUntil()`,\n       * so you do not have to manually call `waitUntil()` on the event.\n       *\n       * @param {Request|string} input The request or URL to fetch and cache.\n       * @return {Promise<Response>}\n       */\n      async fetchAndCachePut(input) {\n        const response = await this.fetch(input);\n        const responseClone = response.clone();\n        void this.waitUntil(this.cachePut(input, responseClone));\n        return response;\n      }\n      /**\n       * Matches a request from the cache (and invokes any applicable plugin\n       * callback methods) using the `cacheName`, `matchOptions`, and `plugins`\n       * defined on the strategy object.\n       *\n       * The following plugin lifecycle methods are invoked when using this method:\n       * - cacheKeyWillBeUsed()\n       * - cachedResponseWillBeUsed()\n       *\n       * @param {Request|string} key The Request or URL to use as the cache key.\n       * @return {Promise<Response|undefined>} A matching response, if found.\n       */\n      async cacheMatch(key) {\n        const request = toRequest(key);\n        let cachedResponse;\n        const {\n          cacheName,\n          matchOptions\n        } = this._strategy;\n        const effectiveRequest = await this.getCacheKey(request, 'read');\n        const multiMatchOptions = Object.assign(Object.assign({}, matchOptions), {\n          cacheName\n        });\n        cachedResponse = await caches.match(effectiveRequest, multiMatchOptions);\n        {\n          if (cachedResponse) {\n            logger.debug(`Found a cached response in '${cacheName}'.`);\n          } else {\n            logger.debug(`No cached response found in '${cacheName}'.`);\n          }\n        }\n        for (const callback of this.iterateCallbacks('cachedResponseWillBeUsed')) {\n          cachedResponse = (await callback({\n            cacheName,\n            matchOptions,\n            cachedResponse,\n            request: effectiveRequest,\n            event: this.event\n          })) || undefined;\n        }\n        return cachedResponse;\n      }\n      /**\n       * Puts a request/response pair in the cache (and invokes any applicable\n       * plugin callback methods) using the `cacheName` and `plugins` defined on\n       * the strategy object.\n       *\n       * The following plugin lifecycle methods are invoked when using this method:\n       * - cacheKeyWillBeUsed()\n       * - cacheWillUpdate()\n       * - cacheDidUpdate()\n       *\n       * @param {Request|string} key The request or URL to use as the cache key.\n       * @param {Response} response The response to cache.\n       * @return {Promise<boolean>} `false` if a cacheWillUpdate caused the response\n       * not be cached, and `true` otherwise.\n       */\n      async cachePut(key, response) {\n        const request = toRequest(key);\n        // Run in the next task to avoid blocking other cache reads.\n        // https://github.com/w3c/ServiceWorker/issues/1397\n        await timeout(0);\n        const effectiveRequest = await this.getCacheKey(request, 'write');\n        {\n          if (effectiveRequest.method && effectiveRequest.method !== 'GET') {\n            throw new WorkboxError('attempt-to-cache-non-get-request', {\n              url: getFriendlyURL(effectiveRequest.url),\n              method: effectiveRequest.method\n            });\n          }\n          // See https://github.com/GoogleChrome/workbox/issues/2818\n          const vary = response.headers.get('Vary');\n          if (vary) {\n            logger.debug(`The response for ${getFriendlyURL(effectiveRequest.url)} ` + `has a 'Vary: ${vary}' header. ` + `Consider setting the {ignoreVary: true} option on your strategy ` + `to ensure cache matching and deletion works as expected.`);\n          }\n        }\n        if (!response) {\n          {\n            logger.error(`Cannot cache non-existent response for ` + `'${getFriendlyURL(effectiveRequest.url)}'.`);\n          }\n          throw new WorkboxError('cache-put-with-no-response', {\n            url: getFriendlyURL(effectiveRequest.url)\n          });\n        }\n        const responseToCache = await this._ensureResponseSafeToCache(response);\n        if (!responseToCache) {\n          {\n            logger.debug(`Response '${getFriendlyURL(effectiveRequest.url)}' ` + `will not be cached.`, responseToCache);\n          }\n          return false;\n        }\n        const {\n          cacheName,\n          matchOptions\n        } = this._strategy;\n        const cache = await self.caches.open(cacheName);\n        const hasCacheUpdateCallback = this.hasCallback('cacheDidUpdate');\n        const oldResponse = hasCacheUpdateCallback ? await cacheMatchIgnoreParams(\n        // TODO(philipwalton): the `__WB_REVISION__` param is a precaching\n        // feature. Consider into ways to only add this behavior if using\n        // precaching.\n        cache, effectiveRequest.clone(), ['__WB_REVISION__'], matchOptions) : null;\n        {\n          logger.debug(`Updating the '${cacheName}' cache with a new Response ` + `for ${getFriendlyURL(effectiveRequest.url)}.`);\n        }\n        try {\n          await cache.put(effectiveRequest, hasCacheUpdateCallback ? responseToCache.clone() : responseToCache);\n        } catch (error) {\n          if (error instanceof Error) {\n            // See https://developer.mozilla.org/en-US/docs/Web/API/DOMException#exception-QuotaExceededError\n            if (error.name === 'QuotaExceededError') {\n              await executeQuotaErrorCallbacks();\n            }\n            throw error;\n          }\n        }\n        for (const callback of this.iterateCallbacks('cacheDidUpdate')) {\n          await callback({\n            cacheName,\n            oldResponse,\n            newResponse: responseToCache.clone(),\n            request: effectiveRequest,\n            event: this.event\n          });\n        }\n        return true;\n      }\n      /**\n       * Checks the list of plugins for the `cacheKeyWillBeUsed` callback, and\n       * executes any of those callbacks found in sequence. The final `Request`\n       * object returned by the last plugin is treated as the cache key for cache\n       * reads and/or writes. If no `cacheKeyWillBeUsed` plugin callbacks have\n       * been registered, the passed request is returned unmodified\n       *\n       * @param {Request} request\n       * @param {string} mode\n       * @return {Promise<Request>}\n       */\n      async getCacheKey(request, mode) {\n        const key = `${request.url} | ${mode}`;\n        if (!this._cacheKeys[key]) {\n          let effectiveRequest = request;\n          for (const callback of this.iterateCallbacks('cacheKeyWillBeUsed')) {\n            effectiveRequest = toRequest(await callback({\n              mode,\n              request: effectiveRequest,\n              event: this.event,\n              // params has a type any can't change right now.\n              params: this.params // eslint-disable-line\n            }));\n          }\n          this._cacheKeys[key] = effectiveRequest;\n        }\n        return this._cacheKeys[key];\n      }\n      /**\n       * Returns true if the strategy has at least one plugin with the given\n       * callback.\n       *\n       * @param {string} name The name of the callback to check for.\n       * @return {boolean}\n       */\n      hasCallback(name) {\n        for (const plugin of this._strategy.plugins) {\n          if (name in plugin) {\n            return true;\n          }\n        }\n        return false;\n      }\n      /**\n       * Runs all plugin callbacks matching the given name, in order, passing the\n       * given param object (merged ith the current plugin state) as the only\n       * argument.\n       *\n       * Note: since this method runs all plugins, it's not suitable for cases\n       * where the return value of a callback needs to be applied prior to calling\n       * the next callback. See\n       * {@link workbox-strategies.StrategyHandler#iterateCallbacks}\n       * below for how to handle that case.\n       *\n       * @param {string} name The name of the callback to run within each plugin.\n       * @param {Object} param The object to pass as the first (and only) param\n       *     when executing each callback. This object will be merged with the\n       *     current plugin state prior to callback execution.\n       */\n      async runCallbacks(name, param) {\n        for (const callback of this.iterateCallbacks(name)) {\n          // TODO(philipwalton): not sure why `any` is needed. It seems like\n          // this should work with `as WorkboxPluginCallbackParam[C]`.\n          await callback(param);\n        }\n      }\n      /**\n       * Accepts a callback and returns an iterable of matching plugin callbacks,\n       * where each callback is wrapped with the current handler state (i.e. when\n       * you call each callback, whatever object parameter you pass it will\n       * be merged with the plugin's current state).\n       *\n       * @param {string} name The name fo the callback to run\n       * @return {Array<Function>}\n       */\n      *iterateCallbacks(name) {\n        for (const plugin of this._strategy.plugins) {\n          if (typeof plugin[name] === 'function') {\n            const state = this._pluginStateMap.get(plugin);\n            const statefulCallback = param => {\n              const statefulParam = Object.assign(Object.assign({}, param), {\n                state\n              });\n              // TODO(philipwalton): not sure why `any` is needed. It seems like\n              // this should work with `as WorkboxPluginCallbackParam[C]`.\n              return plugin[name](statefulParam);\n            };\n            yield statefulCallback;\n          }\n        }\n      }\n      /**\n       * Adds a promise to the\n       * [extend lifetime promises]{@link https://w3c.github.io/ServiceWorker/#extendableevent-extend-lifetime-promises}\n       * of the event associated with the request being handled (usually a\n       * `FetchEvent`).\n       *\n       * Note: you can await\n       * {@link workbox-strategies.StrategyHandler~doneWaiting}\n       * to know when all added promises have settled.\n       *\n       * @param {Promise} promise A promise to add to the extend lifetime promises\n       *     of the event that triggered the request.\n       */\n      waitUntil(promise) {\n        this._extendLifetimePromises.push(promise);\n        return promise;\n      }\n      /**\n       * Returns a promise that resolves once all promises passed to\n       * {@link workbox-strategies.StrategyHandler~waitUntil}\n       * have settled.\n       *\n       * Note: any work done after `doneWaiting()` settles should be manually\n       * passed to an event's `waitUntil()` method (not this handler's\n       * `waitUntil()` method), otherwise the service worker thread may be killed\n       * prior to your work completing.\n       */\n      async doneWaiting() {\n        while (this._extendLifetimePromises.length) {\n          const promises = this._extendLifetimePromises.splice(0);\n          const result = await Promise.allSettled(promises);\n          const firstRejection = result.find(i => i.status === 'rejected');\n          if (firstRejection) {\n            throw firstRejection.reason;\n          }\n        }\n      }\n      /**\n       * Stops running the strategy and immediately resolves any pending\n       * `waitUntil()` promises.\n       */\n      destroy() {\n        this._handlerDeferred.resolve(null);\n      }\n      /**\n       * This method will call cacheWillUpdate on the available plugins (or use\n       * status === 200) to determine if the Response is safe and valid to cache.\n       *\n       * @param {Request} options.request\n       * @param {Response} options.response\n       * @return {Promise<Response|undefined>}\n       *\n       * @private\n       */\n      async _ensureResponseSafeToCache(response) {\n        let responseToCache = response;\n        let pluginsUsed = false;\n        for (const callback of this.iterateCallbacks('cacheWillUpdate')) {\n          responseToCache = (await callback({\n            request: this.request,\n            response: responseToCache,\n            event: this.event\n          })) || undefined;\n          pluginsUsed = true;\n          if (!responseToCache) {\n            break;\n          }\n        }\n        if (!pluginsUsed) {\n          if (responseToCache && responseToCache.status !== 200) {\n            responseToCache = undefined;\n          }\n          {\n            if (responseToCache) {\n              if (responseToCache.status !== 200) {\n                if (responseToCache.status === 0) {\n                  logger.warn(`The response for '${this.request.url}' ` + `is an opaque response. The caching strategy that you're ` + `using will not cache opaque responses by default.`);\n                } else {\n                  logger.debug(`The response for '${this.request.url}' ` + `returned a status code of '${response.status}' and won't ` + `be cached as a result.`);\n                }\n              }\n            }\n          }\n        }\n        return responseToCache;\n      }\n    }\n\n    /*\n      Copyright 2020 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * An abstract base class that all other strategy classes must extend from:\n     *\n     * @memberof workbox-strategies\n     */\n    class Strategy {\n      /**\n       * Creates a new instance of the strategy and sets all documented option\n       * properties as public instance properties.\n       *\n       * Note: if a custom strategy class extends the base Strategy class and does\n       * not need more than these properties, it does not need to define its own\n       * constructor.\n       *\n       * @param {Object} [options]\n       * @param {string} [options.cacheName] Cache name to store and retrieve\n       * requests. Defaults to the cache names provided by\n       * {@link workbox-core.cacheNames}.\n       * @param {Array<Object>} [options.plugins] [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\n       * to use in conjunction with this caching strategy.\n       * @param {Object} [options.fetchOptions] Values passed along to the\n       * [`init`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters)\n       * of [non-navigation](https://github.com/GoogleChrome/workbox/issues/1796)\n       * `fetch()` requests made by this strategy.\n       * @param {Object} [options.matchOptions] The\n       * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}\n       * for any `cache.match()` or `cache.put()` calls made by this strategy.\n       */\n      constructor(options = {}) {\n        /**\n         * Cache name to store and retrieve\n         * requests. Defaults to the cache names provided by\n         * {@link workbox-core.cacheNames}.\n         *\n         * @type {string}\n         */\n        this.cacheName = cacheNames.getRuntimeName(options.cacheName);\n        /**\n         * The list\n         * [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\n         * used by this strategy.\n         *\n         * @type {Array<Object>}\n         */\n        this.plugins = options.plugins || [];\n        /**\n         * Values passed along to the\n         * [`init`]{@link https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters}\n         * of all fetch() requests made by this strategy.\n         *\n         * @type {Object}\n         */\n        this.fetchOptions = options.fetchOptions;\n        /**\n         * The\n         * [`CacheQueryOptions`]{@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions}\n         * for any `cache.match()` or `cache.put()` calls made by this strategy.\n         *\n         * @type {Object}\n         */\n        this.matchOptions = options.matchOptions;\n      }\n      /**\n       * Perform a request strategy and returns a `Promise` that will resolve with\n       * a `Response`, invoking all relevant plugin callbacks.\n       *\n       * When a strategy instance is registered with a Workbox\n       * {@link workbox-routing.Route}, this method is automatically\n       * called when the route matches.\n       *\n       * Alternatively, this method can be used in a standalone `FetchEvent`\n       * listener by passing it to `event.respondWith()`.\n       *\n       * @param {FetchEvent|Object} options A `FetchEvent` or an object with the\n       *     properties listed below.\n       * @param {Request|string} options.request A request to run this strategy for.\n       * @param {ExtendableEvent} options.event The event associated with the\n       *     request.\n       * @param {URL} [options.url]\n       * @param {*} [options.params]\n       */\n      handle(options) {\n        const [responseDone] = this.handleAll(options);\n        return responseDone;\n      }\n      /**\n       * Similar to {@link workbox-strategies.Strategy~handle}, but\n       * instead of just returning a `Promise` that resolves to a `Response` it\n       * it will return an tuple of `[response, done]` promises, where the former\n       * (`response`) is equivalent to what `handle()` returns, and the latter is a\n       * Promise that will resolve once any promises that were added to\n       * `event.waitUntil()` as part of performing the strategy have completed.\n       *\n       * You can await the `done` promise to ensure any extra work performed by\n       * the strategy (usually caching responses) completes successfully.\n       *\n       * @param {FetchEvent|Object} options A `FetchEvent` or an object with the\n       *     properties listed below.\n       * @param {Request|string} options.request A request to run this strategy for.\n       * @param {ExtendableEvent} options.event The event associated with the\n       *     request.\n       * @param {URL} [options.url]\n       * @param {*} [options.params]\n       * @return {Array<Promise>} A tuple of [response, done]\n       *     promises that can be used to determine when the response resolves as\n       *     well as when the handler has completed all its work.\n       */\n      handleAll(options) {\n        // Allow for flexible options to be passed.\n        if (options instanceof FetchEvent) {\n          options = {\n            event: options,\n            request: options.request\n          };\n        }\n        const event = options.event;\n        const request = typeof options.request === 'string' ? new Request(options.request) : options.request;\n        const params = 'params' in options ? options.params : undefined;\n        const handler = new StrategyHandler(this, {\n          event,\n          request,\n          params\n        });\n        const responseDone = this._getResponse(handler, request, event);\n        const handlerDone = this._awaitComplete(responseDone, handler, request, event);\n        // Return an array of promises, suitable for use with Promise.all().\n        return [responseDone, handlerDone];\n      }\n      async _getResponse(handler, request, event) {\n        await handler.runCallbacks('handlerWillStart', {\n          event,\n          request\n        });\n        let response = undefined;\n        try {\n          response = await this._handle(request, handler);\n          // The \"official\" Strategy subclasses all throw this error automatically,\n          // but in case a third-party Strategy doesn't, ensure that we have a\n          // consistent failure when there's no response or an error response.\n          if (!response || response.type === 'error') {\n            throw new WorkboxError('no-response', {\n              url: request.url\n            });\n          }\n        } catch (error) {\n          if (error instanceof Error) {\n            for (const callback of handler.iterateCallbacks('handlerDidError')) {\n              response = await callback({\n                error,\n                event,\n                request\n              });\n              if (response) {\n                break;\n              }\n            }\n          }\n          if (!response) {\n            throw error;\n          } else {\n            logger.log(`While responding to '${getFriendlyURL(request.url)}', ` + `an ${error instanceof Error ? error.toString() : ''} error occurred. Using a fallback response provided by ` + `a handlerDidError plugin.`);\n          }\n        }\n        for (const callback of handler.iterateCallbacks('handlerWillRespond')) {\n          response = await callback({\n            event,\n            request,\n            response\n          });\n        }\n        return response;\n      }\n      async _awaitComplete(responseDone, handler, request, event) {\n        let response;\n        let error;\n        try {\n          response = await responseDone;\n        } catch (error) {\n          // Ignore errors, as response errors should be caught via the `response`\n          // promise above. The `done` promise will only throw for errors in\n          // promises passed to `handler.waitUntil()`.\n        }\n        try {\n          await handler.runCallbacks('handlerDidRespond', {\n            event,\n            request,\n            response\n          });\n          await handler.doneWaiting();\n        } catch (waitUntilError) {\n          if (waitUntilError instanceof Error) {\n            error = waitUntilError;\n          }\n        }\n        await handler.runCallbacks('handlerDidComplete', {\n          event,\n          request,\n          response,\n          error: error\n        });\n        handler.destroy();\n        if (error) {\n          throw error;\n        }\n      }\n    }\n    /**\n     * Classes extending the `Strategy` based class should implement this method,\n     * and leverage the {@link workbox-strategies.StrategyHandler}\n     * arg to perform all fetching and cache logic, which will ensure all relevant\n     * cache, cache options, fetch options and plugins are used (per the current\n     * strategy instance).\n     *\n     * @name _handle\n     * @instance\n     * @abstract\n     * @function\n     * @param {Request} request\n     * @param {workbox-strategies.StrategyHandler} handler\n     * @return {Promise<Response>}\n     *\n     * @memberof workbox-strategies.Strategy\n     */\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    const messages = {\n      strategyStart: (strategyName, request) => `Using ${strategyName} to respond to '${getFriendlyURL(request.url)}'`,\n      printFinalResponse: response => {\n        if (response) {\n          logger.groupCollapsed(`View the final response here.`);\n          logger.log(response || '[No response returned]');\n          logger.groupEnd();\n        }\n      }\n    };\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * An implementation of a [cache-first](https://developer.chrome.com/docs/workbox/caching-strategies-overview/#cache-first-falling-back-to-network)\n     * request strategy.\n     *\n     * A cache first strategy is useful for assets that have been revisioned,\n     * such as URLs like `/styles/example.a8f5f1.css`, since they\n     * can be cached for long periods of time.\n     *\n     * If the network request fails, and there is no cache match, this will throw\n     * a `WorkboxError` exception.\n     *\n     * @extends workbox-strategies.Strategy\n     * @memberof workbox-strategies\n     */\n    class CacheFirst extends Strategy {\n      /**\n       * @private\n       * @param {Request|string} request A request to run this strategy for.\n       * @param {workbox-strategies.StrategyHandler} handler The event that\n       *     triggered the request.\n       * @return {Promise<Response>}\n       */\n      async _handle(request, handler) {\n        const logs = [];\n        {\n          finalAssertExports.isInstance(request, Request, {\n            moduleName: 'workbox-strategies',\n            className: this.constructor.name,\n            funcName: 'makeRequest',\n            paramName: 'request'\n          });\n        }\n        let response = await handler.cacheMatch(request);\n        let error = undefined;\n        if (!response) {\n          {\n            logs.push(`No response found in the '${this.cacheName}' cache. ` + `Will respond with a network request.`);\n          }\n          try {\n            response = await handler.fetchAndCachePut(request);\n          } catch (err) {\n            if (err instanceof Error) {\n              error = err;\n            }\n          }\n          {\n            if (response) {\n              logs.push(`Got response from network.`);\n            } else {\n              logs.push(`Unable to get a response from the network.`);\n            }\n          }\n        } else {\n          {\n            logs.push(`Found a cached response in the '${this.cacheName}' cache.`);\n          }\n        }\n        {\n          logger.groupCollapsed(messages.strategyStart(this.constructor.name, request));\n          for (const log of logs) {\n            logger.log(log);\n          }\n          messages.printFinalResponse(response);\n          logger.groupEnd();\n        }\n        if (!response) {\n          throw new WorkboxError('no-response', {\n            url: request.url,\n            error\n          });\n        }\n        return response;\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    const cacheOkAndOpaquePlugin = {\n      /**\n       * Returns a valid response (to allow caching) if the status is 200 (OK) or\n       * 0 (opaque).\n       *\n       * @param {Object} options\n       * @param {Response} options.response\n       * @return {Response|null}\n       *\n       * @private\n       */\n      cacheWillUpdate: async ({\n        response\n      }) => {\n        if (response.status === 200 || response.status === 0) {\n          return response;\n        }\n        return null;\n      }\n    };\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * An implementation of a\n     * [stale-while-revalidate](https://developer.chrome.com/docs/workbox/caching-strategies-overview/#stale-while-revalidate)\n     * request strategy.\n     *\n     * Resources are requested from both the cache and the network in parallel.\n     * The strategy will respond with the cached version if available, otherwise\n     * wait for the network response. The cache is updated with the network response\n     * with each successful request.\n     *\n     * By default, this strategy will cache responses with a 200 status code as\n     * well as [opaque responses](https://developer.chrome.com/docs/workbox/caching-resources-during-runtime/#opaque-responses).\n     * Opaque responses are cross-origin requests where the response doesn't\n     * support [CORS](https://enable-cors.org/).\n     *\n     * If the network request fails, and there is no cache match, this will throw\n     * a `WorkboxError` exception.\n     *\n     * @extends workbox-strategies.Strategy\n     * @memberof workbox-strategies\n     */\n    class StaleWhileRevalidate extends Strategy {\n      /**\n       * @param {Object} [options]\n       * @param {string} [options.cacheName] Cache name to store and retrieve\n       * requests. Defaults to cache names provided by\n       * {@link workbox-core.cacheNames}.\n       * @param {Array<Object>} [options.plugins] [Plugins]{@link https://developers.google.com/web/tools/workbox/guides/using-plugins}\n       * to use in conjunction with this caching strategy.\n       * @param {Object} [options.fetchOptions] Values passed along to the\n       * [`init`](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters)\n       * of [non-navigation](https://github.com/GoogleChrome/workbox/issues/1796)\n       * `fetch()` requests made by this strategy.\n       * @param {Object} [options.matchOptions] [`CacheQueryOptions`](https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions)\n       */\n      constructor(options = {}) {\n        super(options);\n        // If this instance contains no plugins with a 'cacheWillUpdate' callback,\n        // prepend the `cacheOkAndOpaquePlugin` plugin to the plugins list.\n        if (!this.plugins.some(p => 'cacheWillUpdate' in p)) {\n          this.plugins.unshift(cacheOkAndOpaquePlugin);\n        }\n      }\n      /**\n       * @private\n       * @param {Request|string} request A request to run this strategy for.\n       * @param {workbox-strategies.StrategyHandler} handler The event that\n       *     triggered the request.\n       * @return {Promise<Response>}\n       */\n      async _handle(request, handler) {\n        const logs = [];\n        {\n          finalAssertExports.isInstance(request, Request, {\n            moduleName: 'workbox-strategies',\n            className: this.constructor.name,\n            funcName: 'handle',\n            paramName: 'request'\n          });\n        }\n        const fetchAndCachePromise = handler.fetchAndCachePut(request).catch(() => {\n          // Swallow this error because a 'no-response' error will be thrown in\n          // main handler return flow. This will be in the `waitUntil()` flow.\n        });\n        void handler.waitUntil(fetchAndCachePromise);\n        let response = await handler.cacheMatch(request);\n        let error;\n        if (response) {\n          {\n            logs.push(`Found a cached response in the '${this.cacheName}'` + ` cache. Will update with the network response in the background.`);\n          }\n        } else {\n          {\n            logs.push(`No response found in the '${this.cacheName}' cache. ` + `Will wait for the network response.`);\n          }\n          try {\n            // NOTE(philipwalton): Really annoying that we have to type cast here.\n            // https://github.com/microsoft/TypeScript/issues/20006\n            response = await fetchAndCachePromise;\n          } catch (err) {\n            if (err instanceof Error) {\n              error = err;\n            }\n          }\n        }\n        {\n          logger.groupCollapsed(messages.strategyStart(this.constructor.name, request));\n          for (const log of logs) {\n            logger.log(log);\n          }\n          messages.printFinalResponse(response);\n          logger.groupEnd();\n        }\n        if (!response) {\n          throw new WorkboxError('no-response', {\n            url: request.url,\n            error\n          });\n        }\n        return response;\n      }\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Claim any currently available clients once the service worker\n     * becomes active. This is normally used in conjunction with `skipWaiting()`.\n     *\n     * @memberof workbox-core\n     */\n    function clientsClaim() {\n      self.addEventListener('activate', () => self.clients.claim());\n    }\n\n    /*\n      Copyright 2020 Google LLC\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * A utility method that makes it easier to use `event.waitUntil` with\n     * async functions and return the result.\n     *\n     * @param {ExtendableEvent} event\n     * @param {Function} asyncFn\n     * @return {Function}\n     * @private\n     */\n    function waitUntil(event, asyncFn) {\n      const returnPromise = asyncFn();\n      event.waitUntil(returnPromise);\n      return returnPromise;\n    }\n\n    // @ts-ignore\n    try {\n      self['workbox:precaching:7.3.0'] && _();\n    } catch (e) {}\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    // Name of the search parameter used to store revision info.\n    const REVISION_SEARCH_PARAM = '__WB_REVISION__';\n    /**\n     * Converts a manifest entry into a versioned URL suitable for precaching.\n     *\n     * @param {Object|string} entry\n     * @return {string} A URL with versioning info.\n     *\n     * @private\n     * @memberof workbox-precaching\n     */\n    function createCacheKey(entry) {\n      if (!entry) {\n        throw new WorkboxError('add-to-cache-list-unexpected-type', {\n          entry\n        });\n      }\n      // If a precache manifest entry is a string, it's assumed to be a versioned\n      // URL, like '/app.abcd1234.js'. Return as-is.\n      if (typeof entry === 'string') {\n        const urlObject = new URL(entry, location.href);\n        return {\n          cacheKey: urlObject.href,\n          url: urlObject.href\n        };\n      }\n      const {\n        revision,\n        url\n      } = entry;\n      if (!url) {\n        throw new WorkboxError('add-to-cache-list-unexpected-type', {\n          entry\n        });\n      }\n      // If there's just a URL and no revision, then it's also assumed to be a\n      // versioned URL.\n      if (!revision) {\n        const urlObject = new URL(url, location.href);\n        return {\n          cacheKey: urlObject.href,\n          url: urlObject.href\n        };\n      }\n      // Otherwise, construct a properly versioned URL using the custom Workbox\n      // search parameter along with the revision info.\n      const cacheKeyURL = new URL(url, location.href);\n      const originalURL = new URL(url, location.href);\n      cacheKeyURL.searchParams.set(REVISION_SEARCH_PARAM, revision);\n      return {\n        cacheKey: cacheKeyURL.href,\n        url: originalURL.href\n      };\n    }\n\n    /*\n      Copyright 2020 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * A plugin, designed to be used with PrecacheController, to determine the\n     * of assets that were updated (or not updated) during the install event.\n     *\n     * @private\n     */\n    class PrecacheInstallReportPlugin {\n      constructor() {\n        this.updatedURLs = [];\n        this.notUpdatedURLs = [];\n        this.handlerWillStart = async ({\n          request,\n          state\n        }) => {\n          // TODO: `state` should never be undefined...\n          if (state) {\n            state.originalRequest = request;\n          }\n        };\n        this.cachedResponseWillBeUsed = async ({\n          event,\n          state,\n          cachedResponse\n        }) => {\n          if (event.type === 'install') {\n            if (state && state.originalRequest && state.originalRequest instanceof Request) {\n              // TODO: `state` should never be undefined...\n              const url = state.originalRequest.url;\n              if (cachedResponse) {\n                this.notUpdatedURLs.push(url);\n              } else {\n                this.updatedURLs.push(url);\n              }\n            }\n          }\n          return cachedResponse;\n        };\n      }\n    }\n\n    /*\n      Copyright 2020 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * A plugin, designed to be used with PrecacheController, to translate URLs into\n     * the corresponding cache key, based on the current revision info.\n     *\n     * @private\n     */\n    class PrecacheCacheKeyPlugin {\n      constructor({\n        precacheController\n      }) {\n        this.cacheKeyWillBeUsed = async ({\n          request,\n          params\n        }) => {\n          // Params is type any, can't change right now.\n          /* eslint-disable */\n          const cacheKey = (params === null || params === void 0 ? void 0 : params.cacheKey) || this._precacheController.getCacheKeyForURL(request.url);\n          /* eslint-enable */\n          return cacheKey ? new Request(cacheKey, {\n            headers: request.headers\n          }) : request;\n        };\n        this._precacheController = precacheController;\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * @param {string} groupTitle\n     * @param {Array<string>} deletedURLs\n     *\n     * @private\n     */\n    const logGroup = (groupTitle, deletedURLs) => {\n      logger.groupCollapsed(groupTitle);\n      for (const url of deletedURLs) {\n        logger.log(url);\n      }\n      logger.groupEnd();\n    };\n    /**\n     * @param {Array<string>} deletedURLs\n     *\n     * @private\n     * @memberof workbox-precaching\n     */\n    function printCleanupDetails(deletedURLs) {\n      const deletionCount = deletedURLs.length;\n      if (deletionCount > 0) {\n        logger.groupCollapsed(`During precaching cleanup, ` + `${deletionCount} cached ` + `request${deletionCount === 1 ? ' was' : 's were'} deleted.`);\n        logGroup('Deleted Cache Requests', deletedURLs);\n        logger.groupEnd();\n      }\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * @param {string} groupTitle\n     * @param {Array<string>} urls\n     *\n     * @private\n     */\n    function _nestedGroup(groupTitle, urls) {\n      if (urls.length === 0) {\n        return;\n      }\n      logger.groupCollapsed(groupTitle);\n      for (const url of urls) {\n        logger.log(url);\n      }\n      logger.groupEnd();\n    }\n    /**\n     * @param {Array<string>} urlsToPrecache\n     * @param {Array<string>} urlsAlreadyPrecached\n     *\n     * @private\n     * @memberof workbox-precaching\n     */\n    function printInstallDetails(urlsToPrecache, urlsAlreadyPrecached) {\n      const precachedCount = urlsToPrecache.length;\n      const alreadyPrecachedCount = urlsAlreadyPrecached.length;\n      if (precachedCount || alreadyPrecachedCount) {\n        let message = `Precaching ${precachedCount} file${precachedCount === 1 ? '' : 's'}.`;\n        if (alreadyPrecachedCount > 0) {\n          message += ` ${alreadyPrecachedCount} ` + `file${alreadyPrecachedCount === 1 ? ' is' : 's are'} already cached.`;\n        }\n        logger.groupCollapsed(message);\n        _nestedGroup(`View newly precached URLs.`, urlsToPrecache);\n        _nestedGroup(`View previously precached URLs.`, urlsAlreadyPrecached);\n        logger.groupEnd();\n      }\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    let supportStatus;\n    /**\n     * A utility function that determines whether the current browser supports\n     * constructing a new `Response` from a `response.body` stream.\n     *\n     * @return {boolean} `true`, if the current browser can successfully\n     *     construct a `Response` from a `response.body` stream, `false` otherwise.\n     *\n     * @private\n     */\n    function canConstructResponseFromBodyStream() {\n      if (supportStatus === undefined) {\n        const testResponse = new Response('');\n        if ('body' in testResponse) {\n          try {\n            new Response(testResponse.body);\n            supportStatus = true;\n          } catch (error) {\n            supportStatus = false;\n          }\n        }\n        supportStatus = false;\n      }\n      return supportStatus;\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Allows developers to copy a response and modify its `headers`, `status`,\n     * or `statusText` values (the values settable via a\n     * [`ResponseInit`]{@link https://developer.mozilla.org/en-US/docs/Web/API/Response/Response#Syntax}\n     * object in the constructor).\n     * To modify these values, pass a function as the second argument. That\n     * function will be invoked with a single object with the response properties\n     * `{headers, status, statusText}`. The return value of this function will\n     * be used as the `ResponseInit` for the new `Response`. To change the values\n     * either modify the passed parameter(s) and return it, or return a totally\n     * new object.\n     *\n     * This method is intentionally limited to same-origin responses, regardless of\n     * whether CORS was used or not.\n     *\n     * @param {Response} response\n     * @param {Function} modifier\n     * @memberof workbox-core\n     */\n    async function copyResponse(response, modifier) {\n      let origin = null;\n      // If response.url isn't set, assume it's cross-origin and keep origin null.\n      if (response.url) {\n        const responseURL = new URL(response.url);\n        origin = responseURL.origin;\n      }\n      if (origin !== self.location.origin) {\n        throw new WorkboxError('cross-origin-copy-response', {\n          origin\n        });\n      }\n      const clonedResponse = response.clone();\n      // Create a fresh `ResponseInit` object by cloning the headers.\n      const responseInit = {\n        headers: new Headers(clonedResponse.headers),\n        status: clonedResponse.status,\n        statusText: clonedResponse.statusText\n      };\n      // Apply any user modifications.\n      const modifiedResponseInit = modifier ? modifier(responseInit) : responseInit;\n      // Create the new response from the body stream and `ResponseInit`\n      // modifications. Note: not all browsers support the Response.body stream,\n      // so fall back to reading the entire body into memory as a blob.\n      const body = canConstructResponseFromBodyStream() ? clonedResponse.body : await clonedResponse.blob();\n      return new Response(body, modifiedResponseInit);\n    }\n\n    /*\n      Copyright 2020 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * A {@link workbox-strategies.Strategy} implementation\n     * specifically designed to work with\n     * {@link workbox-precaching.PrecacheController}\n     * to both cache and fetch precached assets.\n     *\n     * Note: an instance of this class is created automatically when creating a\n     * `PrecacheController`; it's generally not necessary to create this yourself.\n     *\n     * @extends workbox-strategies.Strategy\n     * @memberof workbox-precaching\n     */\n    class PrecacheStrategy extends Strategy {\n      /**\n       *\n       * @param {Object} [options]\n       * @param {string} [options.cacheName] Cache name to store and retrieve\n       * requests. Defaults to the cache names provided by\n       * {@link workbox-core.cacheNames}.\n       * @param {Array<Object>} [options.plugins] {@link https://developers.google.com/web/tools/workbox/guides/using-plugins|Plugins}\n       * to use in conjunction with this caching strategy.\n       * @param {Object} [options.fetchOptions] Values passed along to the\n       * {@link https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch#Parameters|init}\n       * of all fetch() requests made by this strategy.\n       * @param {Object} [options.matchOptions] The\n       * {@link https://w3c.github.io/ServiceWorker/#dictdef-cachequeryoptions|CacheQueryOptions}\n       * for any `cache.match()` or `cache.put()` calls made by this strategy.\n       * @param {boolean} [options.fallbackToNetwork=true] Whether to attempt to\n       * get the response from the network if there's a precache miss.\n       */\n      constructor(options = {}) {\n        options.cacheName = cacheNames.getPrecacheName(options.cacheName);\n        super(options);\n        this._fallbackToNetwork = options.fallbackToNetwork === false ? false : true;\n        // Redirected responses cannot be used to satisfy a navigation request, so\n        // any redirected response must be \"copied\" rather than cloned, so the new\n        // response doesn't contain the `redirected` flag. See:\n        // https://bugs.chromium.org/p/chromium/issues/detail?id=669363&desc=2#c1\n        this.plugins.push(PrecacheStrategy.copyRedirectedCacheableResponsesPlugin);\n      }\n      /**\n       * @private\n       * @param {Request|string} request A request to run this strategy for.\n       * @param {workbox-strategies.StrategyHandler} handler The event that\n       *     triggered the request.\n       * @return {Promise<Response>}\n       */\n      async _handle(request, handler) {\n        const response = await handler.cacheMatch(request);\n        if (response) {\n          return response;\n        }\n        // If this is an `install` event for an entry that isn't already cached,\n        // then populate the cache.\n        if (handler.event && handler.event.type === 'install') {\n          return await this._handleInstall(request, handler);\n        }\n        // Getting here means something went wrong. An entry that should have been\n        // precached wasn't found in the cache.\n        return await this._handleFetch(request, handler);\n      }\n      async _handleFetch(request, handler) {\n        let response;\n        const params = handler.params || {};\n        // Fall back to the network if we're configured to do so.\n        if (this._fallbackToNetwork) {\n          {\n            logger.warn(`The precached response for ` + `${getFriendlyURL(request.url)} in ${this.cacheName} was not ` + `found. Falling back to the network.`);\n          }\n          const integrityInManifest = params.integrity;\n          const integrityInRequest = request.integrity;\n          const noIntegrityConflict = !integrityInRequest || integrityInRequest === integrityInManifest;\n          // Do not add integrity if the original request is no-cors\n          // See https://github.com/GoogleChrome/workbox/issues/3096\n          response = await handler.fetch(new Request(request, {\n            integrity: request.mode !== 'no-cors' ? integrityInRequest || integrityInManifest : undefined\n          }));\n          // It's only \"safe\" to repair the cache if we're using SRI to guarantee\n          // that the response matches the precache manifest's expectations,\n          // and there's either a) no integrity property in the incoming request\n          // or b) there is an integrity, and it matches the precache manifest.\n          // See https://github.com/GoogleChrome/workbox/issues/2858\n          // Also if the original request users no-cors we don't use integrity.\n          // See https://github.com/GoogleChrome/workbox/issues/3096\n          if (integrityInManifest && noIntegrityConflict && request.mode !== 'no-cors') {\n            this._useDefaultCacheabilityPluginIfNeeded();\n            const wasCached = await handler.cachePut(request, response.clone());\n            {\n              if (wasCached) {\n                logger.log(`A response for ${getFriendlyURL(request.url)} ` + `was used to \"repair\" the precache.`);\n              }\n            }\n          }\n        } else {\n          // This shouldn't normally happen, but there are edge cases:\n          // https://github.com/GoogleChrome/workbox/issues/1441\n          throw new WorkboxError('missing-precache-entry', {\n            cacheName: this.cacheName,\n            url: request.url\n          });\n        }\n        {\n          const cacheKey = params.cacheKey || (await handler.getCacheKey(request, 'read'));\n          // Workbox is going to handle the route.\n          // print the routing details to the console.\n          logger.groupCollapsed(`Precaching is responding to: ` + getFriendlyURL(request.url));\n          logger.log(`Serving the precached url: ${getFriendlyURL(cacheKey instanceof Request ? cacheKey.url : cacheKey)}`);\n          logger.groupCollapsed(`View request details here.`);\n          logger.log(request);\n          logger.groupEnd();\n          logger.groupCollapsed(`View response details here.`);\n          logger.log(response);\n          logger.groupEnd();\n          logger.groupEnd();\n        }\n        return response;\n      }\n      async _handleInstall(request, handler) {\n        this._useDefaultCacheabilityPluginIfNeeded();\n        const response = await handler.fetch(request);\n        // Make sure we defer cachePut() until after we know the response\n        // should be cached; see https://github.com/GoogleChrome/workbox/issues/2737\n        const wasCached = await handler.cachePut(request, response.clone());\n        if (!wasCached) {\n          // Throwing here will lead to the `install` handler failing, which\n          // we want to do if *any* of the responses aren't safe to cache.\n          throw new WorkboxError('bad-precaching-response', {\n            url: request.url,\n            status: response.status\n          });\n        }\n        return response;\n      }\n      /**\n       * This method is complex, as there a number of things to account for:\n       *\n       * The `plugins` array can be set at construction, and/or it might be added to\n       * to at any time before the strategy is used.\n       *\n       * At the time the strategy is used (i.e. during an `install` event), there\n       * needs to be at least one plugin that implements `cacheWillUpdate` in the\n       * array, other than `copyRedirectedCacheableResponsesPlugin`.\n       *\n       * - If this method is called and there are no suitable `cacheWillUpdate`\n       * plugins, we need to add `defaultPrecacheCacheabilityPlugin`.\n       *\n       * - If this method is called and there is exactly one `cacheWillUpdate`, then\n       * we don't have to do anything (this might be a previously added\n       * `defaultPrecacheCacheabilityPlugin`, or it might be a custom plugin).\n       *\n       * - If this method is called and there is more than one `cacheWillUpdate`,\n       * then we need to check if one is `defaultPrecacheCacheabilityPlugin`. If so,\n       * we need to remove it. (This situation is unlikely, but it could happen if\n       * the strategy is used multiple times, the first without a `cacheWillUpdate`,\n       * and then later on after manually adding a custom `cacheWillUpdate`.)\n       *\n       * See https://github.com/GoogleChrome/workbox/issues/2737 for more context.\n       *\n       * @private\n       */\n      _useDefaultCacheabilityPluginIfNeeded() {\n        let defaultPluginIndex = null;\n        let cacheWillUpdatePluginCount = 0;\n        for (const [index, plugin] of this.plugins.entries()) {\n          // Ignore the copy redirected plugin when determining what to do.\n          if (plugin === PrecacheStrategy.copyRedirectedCacheableResponsesPlugin) {\n            continue;\n          }\n          // Save the default plugin's index, in case it needs to be removed.\n          if (plugin === PrecacheStrategy.defaultPrecacheCacheabilityPlugin) {\n            defaultPluginIndex = index;\n          }\n          if (plugin.cacheWillUpdate) {\n            cacheWillUpdatePluginCount++;\n          }\n        }\n        if (cacheWillUpdatePluginCount === 0) {\n          this.plugins.push(PrecacheStrategy.defaultPrecacheCacheabilityPlugin);\n        } else if (cacheWillUpdatePluginCount > 1 && defaultPluginIndex !== null) {\n          // Only remove the default plugin; multiple custom plugins are allowed.\n          this.plugins.splice(defaultPluginIndex, 1);\n        }\n        // Nothing needs to be done if cacheWillUpdatePluginCount is 1\n      }\n    }\n    PrecacheStrategy.defaultPrecacheCacheabilityPlugin = {\n      async cacheWillUpdate({\n        response\n      }) {\n        if (!response || response.status >= 400) {\n          return null;\n        }\n        return response;\n      }\n    };\n    PrecacheStrategy.copyRedirectedCacheableResponsesPlugin = {\n      async cacheWillUpdate({\n        response\n      }) {\n        return response.redirected ? await copyResponse(response) : response;\n      }\n    };\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Performs efficient precaching of assets.\n     *\n     * @memberof workbox-precaching\n     */\n    class PrecacheController {\n      /**\n       * Create a new PrecacheController.\n       *\n       * @param {Object} [options]\n       * @param {string} [options.cacheName] The cache to use for precaching.\n       * @param {string} [options.plugins] Plugins to use when precaching as well\n       * as responding to fetch events for precached assets.\n       * @param {boolean} [options.fallbackToNetwork=true] Whether to attempt to\n       * get the response from the network if there's a precache miss.\n       */\n      constructor({\n        cacheName,\n        plugins = [],\n        fallbackToNetwork = true\n      } = {}) {\n        this._urlsToCacheKeys = new Map();\n        this._urlsToCacheModes = new Map();\n        this._cacheKeysToIntegrities = new Map();\n        this._strategy = new PrecacheStrategy({\n          cacheName: cacheNames.getPrecacheName(cacheName),\n          plugins: [...plugins, new PrecacheCacheKeyPlugin({\n            precacheController: this\n          })],\n          fallbackToNetwork\n        });\n        // Bind the install and activate methods to the instance.\n        this.install = this.install.bind(this);\n        this.activate = this.activate.bind(this);\n      }\n      /**\n       * @type {workbox-precaching.PrecacheStrategy} The strategy created by this controller and\n       * used to cache assets and respond to fetch events.\n       */\n      get strategy() {\n        return this._strategy;\n      }\n      /**\n       * Adds items to the precache list, removing any duplicates and\n       * stores the files in the\n       * {@link workbox-core.cacheNames|\"precache cache\"} when the service\n       * worker installs.\n       *\n       * This method can be called multiple times.\n       *\n       * @param {Array<Object|string>} [entries=[]] Array of entries to precache.\n       */\n      precache(entries) {\n        this.addToCacheList(entries);\n        if (!this._installAndActiveListenersAdded) {\n          self.addEventListener('install', this.install);\n          self.addEventListener('activate', this.activate);\n          this._installAndActiveListenersAdded = true;\n        }\n      }\n      /**\n       * This method will add items to the precache list, removing duplicates\n       * and ensuring the information is valid.\n       *\n       * @param {Array<workbox-precaching.PrecacheController.PrecacheEntry|string>} entries\n       *     Array of entries to precache.\n       */\n      addToCacheList(entries) {\n        {\n          finalAssertExports.isArray(entries, {\n            moduleName: 'workbox-precaching',\n            className: 'PrecacheController',\n            funcName: 'addToCacheList',\n            paramName: 'entries'\n          });\n        }\n        const urlsToWarnAbout = [];\n        for (const entry of entries) {\n          // See https://github.com/GoogleChrome/workbox/issues/2259\n          if (typeof entry === 'string') {\n            urlsToWarnAbout.push(entry);\n          } else if (entry && entry.revision === undefined) {\n            urlsToWarnAbout.push(entry.url);\n          }\n          const {\n            cacheKey,\n            url\n          } = createCacheKey(entry);\n          const cacheMode = typeof entry !== 'string' && entry.revision ? 'reload' : 'default';\n          if (this._urlsToCacheKeys.has(url) && this._urlsToCacheKeys.get(url) !== cacheKey) {\n            throw new WorkboxError('add-to-cache-list-conflicting-entries', {\n              firstEntry: this._urlsToCacheKeys.get(url),\n              secondEntry: cacheKey\n            });\n          }\n          if (typeof entry !== 'string' && entry.integrity) {\n            if (this._cacheKeysToIntegrities.has(cacheKey) && this._cacheKeysToIntegrities.get(cacheKey) !== entry.integrity) {\n              throw new WorkboxError('add-to-cache-list-conflicting-integrities', {\n                url\n              });\n            }\n            this._cacheKeysToIntegrities.set(cacheKey, entry.integrity);\n          }\n          this._urlsToCacheKeys.set(url, cacheKey);\n          this._urlsToCacheModes.set(url, cacheMode);\n          if (urlsToWarnAbout.length > 0) {\n            const warningMessage = `Workbox is precaching URLs without revision ` + `info: ${urlsToWarnAbout.join(', ')}\\nThis is generally NOT safe. ` + `Learn more at https://bit.ly/wb-precache`;\n            {\n              logger.warn(warningMessage);\n            }\n          }\n        }\n      }\n      /**\n       * Precaches new and updated assets. Call this method from the service worker\n       * install event.\n       *\n       * Note: this method calls `event.waitUntil()` for you, so you do not need\n       * to call it yourself in your event handlers.\n       *\n       * @param {ExtendableEvent} event\n       * @return {Promise<workbox-precaching.InstallResult>}\n       */\n      install(event) {\n        // waitUntil returns Promise<any>\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return waitUntil(event, async () => {\n          const installReportPlugin = new PrecacheInstallReportPlugin();\n          this.strategy.plugins.push(installReportPlugin);\n          // Cache entries one at a time.\n          // See https://github.com/GoogleChrome/workbox/issues/2528\n          for (const [url, cacheKey] of this._urlsToCacheKeys) {\n            const integrity = this._cacheKeysToIntegrities.get(cacheKey);\n            const cacheMode = this._urlsToCacheModes.get(url);\n            const request = new Request(url, {\n              integrity,\n              cache: cacheMode,\n              credentials: 'same-origin'\n            });\n            await Promise.all(this.strategy.handleAll({\n              params: {\n                cacheKey\n              },\n              request,\n              event\n            }));\n          }\n          const {\n            updatedURLs,\n            notUpdatedURLs\n          } = installReportPlugin;\n          {\n            printInstallDetails(updatedURLs, notUpdatedURLs);\n          }\n          return {\n            updatedURLs,\n            notUpdatedURLs\n          };\n        });\n      }\n      /**\n       * Deletes assets that are no longer present in the current precache manifest.\n       * Call this method from the service worker activate event.\n       *\n       * Note: this method calls `event.waitUntil()` for you, so you do not need\n       * to call it yourself in your event handlers.\n       *\n       * @param {ExtendableEvent} event\n       * @return {Promise<workbox-precaching.CleanupResult>}\n       */\n      activate(event) {\n        // waitUntil returns Promise<any>\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n        return waitUntil(event, async () => {\n          const cache = await self.caches.open(this.strategy.cacheName);\n          const currentlyCachedRequests = await cache.keys();\n          const expectedCacheKeys = new Set(this._urlsToCacheKeys.values());\n          const deletedURLs = [];\n          for (const request of currentlyCachedRequests) {\n            if (!expectedCacheKeys.has(request.url)) {\n              await cache.delete(request);\n              deletedURLs.push(request.url);\n            }\n          }\n          {\n            printCleanupDetails(deletedURLs);\n          }\n          return {\n            deletedURLs\n          };\n        });\n      }\n      /**\n       * Returns a mapping of a precached URL to the corresponding cache key, taking\n       * into account the revision information for the URL.\n       *\n       * @return {Map<string, string>} A URL to cache key mapping.\n       */\n      getURLsToCacheKeys() {\n        return this._urlsToCacheKeys;\n      }\n      /**\n       * Returns a list of all the URLs that have been precached by the current\n       * service worker.\n       *\n       * @return {Array<string>} The precached URLs.\n       */\n      getCachedURLs() {\n        return [...this._urlsToCacheKeys.keys()];\n      }\n      /**\n       * Returns the cache key used for storing a given URL. If that URL is\n       * unversioned, like `/index.html', then the cache key will be the original\n       * URL with a search parameter appended to it.\n       *\n       * @param {string} url A URL whose cache key you want to look up.\n       * @return {string} The versioned URL that corresponds to a cache key\n       * for the original URL, or undefined if that URL isn't precached.\n       */\n      getCacheKeyForURL(url) {\n        const urlObject = new URL(url, location.href);\n        return this._urlsToCacheKeys.get(urlObject.href);\n      }\n      /**\n       * @param {string} url A cache key whose SRI you want to look up.\n       * @return {string} The subresource integrity associated with the cache key,\n       * or undefined if it's not set.\n       */\n      getIntegrityForCacheKey(cacheKey) {\n        return this._cacheKeysToIntegrities.get(cacheKey);\n      }\n      /**\n       * This acts as a drop-in replacement for\n       * [`cache.match()`](https://developer.mozilla.org/en-US/docs/Web/API/Cache/match)\n       * with the following differences:\n       *\n       * - It knows what the name of the precache is, and only checks in that cache.\n       * - It allows you to pass in an \"original\" URL without versioning parameters,\n       * and it will automatically look up the correct cache key for the currently\n       * active revision of that URL.\n       *\n       * E.g., `matchPrecache('index.html')` will find the correct precached\n       * response for the currently active service worker, even if the actual cache\n       * key is `'/index.html?__WB_REVISION__=1234abcd'`.\n       *\n       * @param {string|Request} request The key (without revisioning parameters)\n       * to look up in the precache.\n       * @return {Promise<Response|undefined>}\n       */\n      async matchPrecache(request) {\n        const url = request instanceof Request ? request.url : request;\n        const cacheKey = this.getCacheKeyForURL(url);\n        if (cacheKey) {\n          const cache = await self.caches.open(this.strategy.cacheName);\n          return cache.match(cacheKey);\n        }\n        return undefined;\n      }\n      /**\n       * Returns a function that looks up `url` in the precache (taking into\n       * account revision information), and returns the corresponding `Response`.\n       *\n       * @param {string} url The precached URL which will be used to lookup the\n       * `Response`.\n       * @return {workbox-routing~handlerCallback}\n       */\n      createHandlerBoundToURL(url) {\n        const cacheKey = this.getCacheKeyForURL(url);\n        if (!cacheKey) {\n          throw new WorkboxError('non-precached-url', {\n            url\n          });\n        }\n        return options => {\n          options.request = new Request(url);\n          options.params = Object.assign({\n            cacheKey\n          }, options.params);\n          return this.strategy.handle(options);\n        };\n      }\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    let precacheController;\n    /**\n     * @return {PrecacheController}\n     * @private\n     */\n    const getOrCreatePrecacheController = () => {\n      if (!precacheController) {\n        precacheController = new PrecacheController();\n      }\n      return precacheController;\n    };\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Removes any URL search parameters that should be ignored.\n     *\n     * @param {URL} urlObject The original URL.\n     * @param {Array<RegExp>} ignoreURLParametersMatching RegExps to test against\n     * each search parameter name. Matches mean that the search parameter should be\n     * ignored.\n     * @return {URL} The URL with any ignored search parameters removed.\n     *\n     * @private\n     * @memberof workbox-precaching\n     */\n    function removeIgnoredSearchParams(urlObject, ignoreURLParametersMatching = []) {\n      // Convert the iterable into an array at the start of the loop to make sure\n      // deletion doesn't mess up iteration.\n      for (const paramName of [...urlObject.searchParams.keys()]) {\n        if (ignoreURLParametersMatching.some(regExp => regExp.test(paramName))) {\n          urlObject.searchParams.delete(paramName);\n        }\n      }\n      return urlObject;\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Generator function that yields possible variations on the original URL to\n     * check, one at a time.\n     *\n     * @param {string} url\n     * @param {Object} options\n     *\n     * @private\n     * @memberof workbox-precaching\n     */\n    function* generateURLVariations(url, {\n      ignoreURLParametersMatching = [/^utm_/, /^fbclid$/],\n      directoryIndex = 'index.html',\n      cleanURLs = true,\n      urlManipulation\n    } = {}) {\n      const urlObject = new URL(url, location.href);\n      urlObject.hash = '';\n      yield urlObject.href;\n      const urlWithoutIgnoredParams = removeIgnoredSearchParams(urlObject, ignoreURLParametersMatching);\n      yield urlWithoutIgnoredParams.href;\n      if (directoryIndex && urlWithoutIgnoredParams.pathname.endsWith('/')) {\n        const directoryURL = new URL(urlWithoutIgnoredParams.href);\n        directoryURL.pathname += directoryIndex;\n        yield directoryURL.href;\n      }\n      if (cleanURLs) {\n        const cleanURL = new URL(urlWithoutIgnoredParams.href);\n        cleanURL.pathname += '.html';\n        yield cleanURL.href;\n      }\n      if (urlManipulation) {\n        const additionalURLs = urlManipulation({\n          url: urlObject\n        });\n        for (const urlToAttempt of additionalURLs) {\n          yield urlToAttempt.href;\n        }\n      }\n    }\n\n    /*\n      Copyright 2020 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * A subclass of {@link workbox-routing.Route} that takes a\n     * {@link workbox-precaching.PrecacheController}\n     * instance and uses it to match incoming requests and handle fetching\n     * responses from the precache.\n     *\n     * @memberof workbox-precaching\n     * @extends workbox-routing.Route\n     */\n    class PrecacheRoute extends Route {\n      /**\n       * @param {PrecacheController} precacheController A `PrecacheController`\n       * instance used to both match requests and respond to fetch events.\n       * @param {Object} [options] Options to control how requests are matched\n       * against the list of precached URLs.\n       * @param {string} [options.directoryIndex=index.html] The `directoryIndex` will\n       * check cache entries for a URLs ending with '/' to see if there is a hit when\n       * appending the `directoryIndex` value.\n       * @param {Array<RegExp>} [options.ignoreURLParametersMatching=[/^utm_/, /^fbclid$/]] An\n       * array of regex's to remove search params when looking for a cache match.\n       * @param {boolean} [options.cleanURLs=true] The `cleanURLs` option will\n       * check the cache for the URL with a `.html` added to the end of the end.\n       * @param {workbox-precaching~urlManipulation} [options.urlManipulation]\n       * This is a function that should take a URL and return an array of\n       * alternative URLs that should be checked for precache matches.\n       */\n      constructor(precacheController, options) {\n        const match = ({\n          request\n        }) => {\n          const urlsToCacheKeys = precacheController.getURLsToCacheKeys();\n          for (const possibleURL of generateURLVariations(request.url, options)) {\n            const cacheKey = urlsToCacheKeys.get(possibleURL);\n            if (cacheKey) {\n              const integrity = precacheController.getIntegrityForCacheKey(cacheKey);\n              return {\n                cacheKey,\n                integrity\n              };\n            }\n          }\n          {\n            logger.debug(`Precaching did not find a match for ` + getFriendlyURL(request.url));\n          }\n          return;\n        };\n        super(match, precacheController.strategy);\n      }\n    }\n\n    /*\n      Copyright 2019 Google LLC\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Add a `fetch` listener to the service worker that will\n     * respond to\n     * [network requests]{@link https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers#Custom_responses_to_requests}\n     * with precached assets.\n     *\n     * Requests for assets that aren't precached, the `FetchEvent` will not be\n     * responded to, allowing the event to fall through to other `fetch` event\n     * listeners.\n     *\n     * @param {Object} [options] See the {@link workbox-precaching.PrecacheRoute}\n     * options.\n     *\n     * @memberof workbox-precaching\n     */\n    function addRoute(options) {\n      const precacheController = getOrCreatePrecacheController();\n      const precacheRoute = new PrecacheRoute(precacheController, options);\n      registerRoute(precacheRoute);\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Adds items to the precache list, removing any duplicates and\n     * stores the files in the\n     * {@link workbox-core.cacheNames|\"precache cache\"} when the service\n     * worker installs.\n     *\n     * This method can be called multiple times.\n     *\n     * Please note: This method **will not** serve any of the cached files for you.\n     * It only precaches files. To respond to a network request you call\n     * {@link workbox-precaching.addRoute}.\n     *\n     * If you have a single array of files to precache, you can just call\n     * {@link workbox-precaching.precacheAndRoute}.\n     *\n     * @param {Array<Object|string>} [entries=[]] Array of entries to precache.\n     *\n     * @memberof workbox-precaching\n     */\n    function precache(entries) {\n      const precacheController = getOrCreatePrecacheController();\n      precacheController.precache(entries);\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * This method will add entries to the precache list and add a route to\n     * respond to fetch events.\n     *\n     * This is a convenience method that will call\n     * {@link workbox-precaching.precache} and\n     * {@link workbox-precaching.addRoute} in a single call.\n     *\n     * @param {Array<Object|string>} entries Array of entries to precache.\n     * @param {Object} [options] See the\n     * {@link workbox-precaching.PrecacheRoute} options.\n     *\n     * @memberof workbox-precaching\n     */\n    function precacheAndRoute(entries, options) {\n      precache(entries);\n      addRoute(options);\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    const SUBSTRING_TO_FIND = '-precache-';\n    /**\n     * Cleans up incompatible precaches that were created by older versions of\n     * Workbox, by a service worker registered under the current scope.\n     *\n     * This is meant to be called as part of the `activate` event.\n     *\n     * This should be safe to use as long as you don't include `substringToFind`\n     * (defaulting to `-precache-`) in your non-precache cache names.\n     *\n     * @param {string} currentPrecacheName The cache name currently in use for\n     * precaching. This cache won't be deleted.\n     * @param {string} [substringToFind='-precache-'] Cache names which include this\n     * substring will be deleted (excluding `currentPrecacheName`).\n     * @return {Array<string>} A list of all the cache names that were deleted.\n     *\n     * @private\n     * @memberof workbox-precaching\n     */\n    const deleteOutdatedCaches = async (currentPrecacheName, substringToFind = SUBSTRING_TO_FIND) => {\n      const cacheNames = await self.caches.keys();\n      const cacheNamesToDelete = cacheNames.filter(cacheName => {\n        return cacheName.includes(substringToFind) && cacheName.includes(self.registration.scope) && cacheName !== currentPrecacheName;\n      });\n      await Promise.all(cacheNamesToDelete.map(cacheName => self.caches.delete(cacheName)));\n      return cacheNamesToDelete;\n    };\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Adds an `activate` event listener which will clean up incompatible\n     * precaches that were created by older versions of Workbox.\n     *\n     * @memberof workbox-precaching\n     */\n    function cleanupOutdatedCaches() {\n      // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705\n      self.addEventListener('activate', event => {\n        const cacheName = cacheNames.getPrecacheName();\n        event.waitUntil(deleteOutdatedCaches(cacheName).then(cachesDeleted => {\n          {\n            if (cachesDeleted.length > 0) {\n              logger.log(`The following out-of-date precaches were cleaned up ` + `automatically:`, cachesDeleted);\n            }\n          }\n        }));\n      });\n    }\n\n    /*\n      Copyright 2018 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * NavigationRoute makes it easy to create a\n     * {@link workbox-routing.Route} that matches for browser\n     * [navigation requests]{@link https://developers.google.com/web/fundamentals/primers/service-workers/high-performance-loading#first_what_are_navigation_requests}.\n     *\n     * It will only match incoming Requests whose\n     * {@link https://fetch.spec.whatwg.org/#concept-request-mode|mode}\n     * is set to `navigate`.\n     *\n     * You can optionally only apply this route to a subset of navigation requests\n     * by using one or both of the `denylist` and `allowlist` parameters.\n     *\n     * @memberof workbox-routing\n     * @extends workbox-routing.Route\n     */\n    class NavigationRoute extends Route {\n      /**\n       * If both `denylist` and `allowlist` are provided, the `denylist` will\n       * take precedence and the request will not match this route.\n       *\n       * The regular expressions in `allowlist` and `denylist`\n       * are matched against the concatenated\n       * [`pathname`]{@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLHyperlinkElementUtils/pathname}\n       * and [`search`]{@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLHyperlinkElementUtils/search}\n       * portions of the requested URL.\n       *\n       * *Note*: These RegExps may be evaluated against every destination URL during\n       * a navigation. Avoid using\n       * [complex RegExps](https://github.com/GoogleChrome/workbox/issues/3077),\n       * or else your users may see delays when navigating your site.\n       *\n       * @param {workbox-routing~handlerCallback} handler A callback\n       * function that returns a Promise resulting in a Response.\n       * @param {Object} options\n       * @param {Array<RegExp>} [options.denylist] If any of these patterns match,\n       * the route will not handle the request (even if a allowlist RegExp matches).\n       * @param {Array<RegExp>} [options.allowlist=[/./]] If any of these patterns\n       * match the URL's pathname and search parameter, the route will handle the\n       * request (assuming the denylist doesn't match).\n       */\n      constructor(handler, {\n        allowlist = [/./],\n        denylist = []\n      } = {}) {\n        {\n          finalAssertExports.isArrayOfClass(allowlist, RegExp, {\n            moduleName: 'workbox-routing',\n            className: 'NavigationRoute',\n            funcName: 'constructor',\n            paramName: 'options.allowlist'\n          });\n          finalAssertExports.isArrayOfClass(denylist, RegExp, {\n            moduleName: 'workbox-routing',\n            className: 'NavigationRoute',\n            funcName: 'constructor',\n            paramName: 'options.denylist'\n          });\n        }\n        super(options => this._match(options), handler);\n        this._allowlist = allowlist;\n        this._denylist = denylist;\n      }\n      /**\n       * Routes match handler.\n       *\n       * @param {Object} options\n       * @param {URL} options.url\n       * @param {Request} options.request\n       * @return {boolean}\n       *\n       * @private\n       */\n      _match({\n        url,\n        request\n      }) {\n        if (request && request.mode !== 'navigate') {\n          return false;\n        }\n        const pathnameAndSearch = url.pathname + url.search;\n        for (const regExp of this._denylist) {\n          if (regExp.test(pathnameAndSearch)) {\n            {\n              logger.log(`The navigation route ${pathnameAndSearch} is not ` + `being used, since the URL matches this denylist pattern: ` + `${regExp.toString()}`);\n            }\n            return false;\n          }\n        }\n        if (this._allowlist.some(regExp => regExp.test(pathnameAndSearch))) {\n          {\n            logger.debug(`The navigation route ${pathnameAndSearch} ` + `is being used.`);\n          }\n          return true;\n        }\n        {\n          logger.log(`The navigation route ${pathnameAndSearch} is not ` + `being used, since the URL being navigated to doesn't ` + `match the allowlist.`);\n        }\n        return false;\n      }\n    }\n\n    /*\n      Copyright 2019 Google LLC\n\n      Use of this source code is governed by an MIT-style\n      license that can be found in the LICENSE file or at\n      https://opensource.org/licenses/MIT.\n    */\n    /**\n     * Helper function that calls\n     * {@link PrecacheController#createHandlerBoundToURL} on the default\n     * {@link PrecacheController} instance.\n     *\n     * If you are creating your own {@link PrecacheController}, then call the\n     * {@link PrecacheController#createHandlerBoundToURL} on that instance,\n     * instead of using this function.\n     *\n     * @param {string} url The precached URL which will be used to lookup the\n     * `Response`.\n     * @param {boolean} [fallbackToNetwork=true] Whether to attempt to get the\n     * response from the network if there's a precache miss.\n     * @return {workbox-routing~handlerCallback}\n     *\n     * @memberof workbox-precaching\n     */\n    function createHandlerBoundToURL(url) {\n      const precacheController = getOrCreatePrecacheController();\n      return precacheController.createHandlerBoundToURL(url);\n    }\n\n    exports.CacheFirst = CacheFirst;\n    exports.CacheableResponsePlugin = CacheableResponsePlugin;\n    exports.ExpirationPlugin = ExpirationPlugin;\n    exports.NavigationRoute = NavigationRoute;\n    exports.StaleWhileRevalidate = StaleWhileRevalidate;\n    exports.cleanupOutdatedCaches = cleanupOutdatedCaches;\n    exports.clientsClaim = clientsClaim;\n    exports.createHandlerBoundToURL = createHandlerBoundToURL;\n    exports.precacheAndRoute = precacheAndRoute;\n    exports.registerRoute = registerRoute;\n\n}));\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\public\\firebase-messaging-sw.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\public\\sw.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\replace_batta.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\replace_batta.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\scripts\\generate-sitemap.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\AboutUs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\AdditionalChargesDrawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\AdminPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\BottomNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\BusinessCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\Calculator.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'calculate'. Either include it or remove the dependency array.","line":590,"column":8,"nodeType":"ArrayExpression","endLine":590,"endColumn":230,"suggestions":[{"desc":"Update the dependencies array to be: [distance, tripType, days, selectedVehicle, customRate, hillStationCharge, petCharge, toll, permit, parking, garageBuffer, driverBata, nightCharge, hourlyPackage, durationHours, extraItems, manualDriverBata, initialResult, calculate]","fix":{"range":[27089,27311],"text":"[distance, tripType, days, selectedVehicle, customRate, hillStationCharge, petCharge, toll, permit, parking, garageBuffer, driverBata, nightCharge, hourlyPackage, durationHours, extraItems, manualDriverBata, initialResult, calculate]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'SERVICES'. Either include it or remove the dependency array.","line":1986,"column":8,"nodeType":"ArrayExpression","endLine":1986,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [SERVICES]","fix":{"range":[100642,100644],"text":"[SERVICES]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\CalculatorFAQ.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\ContactUs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\Dashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":193,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10085,10088],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10085,10088],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { safeJSONParse } from '../utils/storage';\r\nimport type { Trip, Expense } from '../utils/fare';\r\nimport { IndianRupee, TrendingUp, CheckCircle2 } from 'lucide-react';\r\n\r\n\r\n\r\n\r\ninterface DashboardProps {\r\n    trips: Trip[];\r\n}\r\n\r\n\r\n\r\n\r\ntype TimeRange = 'today' | 'week' | 'month' | 'year';\r\n\r\nconst Dashboard: React.FC<DashboardProps> = ({ trips }) => {\r\n\r\n    const [range, setRange] = useState<TimeRange>('today');\r\n\r\n\r\n    const now = new Date();\r\n    const today = now.toISOString().split('T')[0];\r\n\r\n    const isThisWeek = (dateStr: string) => {\r\n        const d = new Date(dateStr);\r\n        const diff = now.getTime() - d.getTime();\r\n        return diff <= 7 * 24 * 60 * 60 * 1000;\r\n    };\r\n    const isThisMonth = (dateStr: string) => {\r\n        const d = new Date(dateStr);\r\n        return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();\r\n    };\r\n    const isThisYear = (dateStr: string) => {\r\n        const d = new Date(dateStr);\r\n        return d.getFullYear() === now.getFullYear();\r\n    };\r\n\r\n    const expenses = safeJSONParse<Expense[]>('cab-expenses', []);\r\n\r\n    const getStats = () => {\r\n        let income = 0;\r\n        let spending = 0;\r\n        let label = '';\r\n\r\n        switch (range) {\r\n            case 'today':\r\n                income = trips.filter(t => t.date.startsWith(today)).reduce((sum, t) => sum + t.totalFare, 0);\r\n                spending = expenses.filter(e => e.date.startsWith(today)).reduce((sum, e) => sum + e.amount, 0);\r\n                label = 'CASH FLOW TODAY';\r\n                break;\r\n            case 'week':\r\n                income = trips.filter(t => isThisWeek(t.date)).reduce((sum, t) => sum + t.totalFare, 0);\r\n                spending = expenses.filter(e => isThisWeek(e.date)).reduce((sum, e) => sum + e.amount, 0);\r\n                label = 'CASH FLOW THIS WEEK';\r\n                break;\r\n            case 'month':\r\n                income = trips.filter(t => isThisMonth(t.date)).reduce((sum, t) => sum + t.totalFare, 0);\r\n                spending = expenses.filter(e => isThisMonth(e.date)).reduce((sum, e) => sum + e.amount, 0);\r\n                label = 'CASH FLOW THIS MONTH';\r\n                break;\r\n            case 'year':\r\n                income = trips.filter(t => isThisYear(t.date)).reduce((sum, t) => sum + t.totalFare, 0);\r\n                spending = expenses.filter(e => isThisYear(e.date)).reduce((sum, e) => sum + e.amount, 0);\r\n                label = 'CASH FLOW THIS YEAR';\r\n                break;\r\n        }\r\n        return { income, spending, profit: income - spending, label };\r\n    };\r\n\r\n    const stats = getStats();\r\n\r\n\r\n\r\n    return (\r\n        <div className=\"space-y-4 pb-24\">\r\n            {/* Main Dynamic Card - Clean White Theme */}\r\n            <div className=\"bg-white rounded-xl p-3 border border-slate-200 shadow-sm relative overflow-hidden\">\r\n                <div className=\"relative z-10 flex justify-between items-start\">\r\n                    <div>\r\n                        <p className=\"text-[9px] font-bold uppercase tracking-wide flex items-center gap-1.5 text-slate-400\">\r\n                            <TrendingUp size={12} aria-hidden=\"true\" /> {stats.label}\r\n                        </p>\r\n                        <h2 className={`text-xl font-bold mt-1.5 tabular-nums tracking-tight ${stats.profit >= 0 ? 'text-slate-900' : 'text-red-600'}`}>\r\n                            {stats.profit.toLocaleString()}\r\n                        </h2>\r\n                    </div>\r\n                    <div className=\"bg-blue-50 p-2 rounded-lg border border-blue-100\">\r\n                        <IndianRupee size={16} strokeWidth={2.5} className=\"text-[#0047AB]\" />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"mt-3 flex gap-2\">\r\n                    <div className=\"flex-1 bg-slate-50 rounded-xl p-2.5 border border-slate-100 relative group\">\r\n                        <div className=\"flex justify-between items-start\">\r\n                            <p className=\"text-[10px] font-bold uppercase tracking-wide text-slate-500\">INCOME</p>\r\n                            <button\r\n                                onClick={() => window.dispatchEvent(new CustomEvent('nav-tab-change', { detail: 'trips' }))}\r\n                                className=\"text-[9px] font-bold bg-white border border-slate-200 text-slate-600 px-2 py-0.5 rounded-full uppercase tracking-wide hover:text-green-600 hover:border-green-300 transition-all shadow-sm\"\r\n                            >\r\n                                Add\r\n                            </button>\r\n                        </div>\r\n                        <p className=\"text-sm font-bold mt-0.5 text-slate-800\">{stats.income.toLocaleString()}</p>\r\n                    </div>\r\n                    <div className=\"flex-1 bg-slate-50 rounded-xl p-2.5 border border-slate-100 relative group\">\r\n                        <div className=\"flex justify-between items-start\">\r\n                            <p className=\"text-[10px] font-bold uppercase tracking-wide text-slate-500\">SPENT</p>\r\n                            <button\r\n                                onClick={() => window.dispatchEvent(new CustomEvent('nav-tab-change', { detail: 'expenses' }))}\r\n                                className=\"text-[9px] font-bold bg-white border border-slate-200 text-slate-600 px-2 py-0.5 rounded-full uppercase tracking-wide hover:text-red-500 hover:border-red-300 transition-all shadow-sm\"\r\n                            >\r\n                                Add\r\n                            </button>\r\n                        </div>\r\n                        <p className=\"text-sm font-bold mt-0.5 text-slate-800\">{stats.spending.toLocaleString()}</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"mt-3 pt-3 border-t border-slate-50 flex justify-between items-center\">\r\n                    <div className=\"text-left\">\r\n                        <p className=\"text-[10px] font-bold uppercase tracking-wide text-slate-500\">MARGIN</p>\r\n                        <p className={`text-base font-bold mt-0.5 ${stats.income > 0 && stats.profit >= 0 ? 'text-green-600' : stats.profit < 0 ? 'text-red-600' : 'text-slate-400'}`}>\r\n                            {stats.income > 0 ? Math.round((stats.profit / stats.income) * 100) : 0}%\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"w-1/2 h-2.5 bg-slate-100 rounded-full overflow-hidden shadow-inner\">\r\n                        <div\r\n                            className={`h-full rounded-full transition-all duration-1000 ${stats.profit >= 0 ? 'bg-green-500' : 'bg-red-500'}`}\r\n                            style={{ width: `${Math.max(0, Math.min(100, stats.income > 0 ? Math.abs((stats.profit / stats.income) * 100) : 0))}%` }}\r\n                        ></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Range Toggle - Clean Pill Style */}\r\n            <div className=\"bg-white p-1 rounded-xl shadow-sm border border-slate-200 flex gap-1\">\r\n                {(['today', 'week', 'month', 'year'] as const).map((r) => (\r\n                    <button\r\n                        key={r}\r\n                        onClick={() => setRange(r)}\r\n                        aria-label={`Show stats for ${r}`}\r\n                        aria-pressed={range === r}\r\n                        className={`flex-1 py-1.5 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all ${range === r\r\n                            ? 'bg-[#0047AB] text-white shadow-sm'\r\n                            : 'text-slate-500 hover:bg-slate-50'\r\n                            }`}\r\n                    >\r\n                        {r}\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Daily Audit - Compact */}\r\n            <div\r\n                onClick={() => window.dispatchEvent(new CustomEvent('nav-tab-change', { detail: 'expenses' }))}\r\n                className=\"flex items-center justify-between p-3 bg-white border border-slate-200 rounded-xl shadow-sm cursor-pointer hover:bg-slate-50 transition-colors\"\r\n            >\r\n                <div className=\"flex items-center gap-3\">\r\n                    <div className=\"p-2.5 bg-green-50 border border-green-100 rounded-xl text-green-700 shadow-sm\">\r\n                        <CheckCircle2 size={18} />\r\n                    </div>\r\n                    <div>\r\n                        <p className=\"text-[12px] font-bold uppercase tracking-wide text-slate-900 leading-tight\">Daily Audit</p>\r\n                        <p className=\"text-[10px] font-bold text-slate-500 mt-0.5 tracking-tight\">Verify today's accounts</p>\r\n                    </div>\r\n                </div>\r\n                <div className=\"px-5 py-2 bg-green-600 text-white rounded-full shadow-md shadow-green-100\">\r\n                    <span className=\"text-[11px] font-bold uppercase tracking-wider\">Start Now</span>\r\n                </div>\r\n            </div>\r\n\r\n\r\n\r\n\r\n\r\n            {/* Recent Activity Feed - Compact */}\r\n            <div className=\"bg-white border border-slate-200 rounded-xl p-3 shadow-sm\">\r\n                <div className=\"flex items-center justify-between mb-3\">\r\n                    <h3 className=\"text-[10px] font-bold text-slate-900 uppercase tracking-wide flex items-center gap-1.5\">\r\n                        <TrendingUp size={12} className=\"text-slate-400\" /> Recent Activity\r\n                    </h3>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                    {[\r\n                        ...trips.map(t => ({ ...t, type: 'trip' as const, sortDate: t.date, displayAmount: t.totalFare })),\r\n                        ...expenses.map(e => ({ ...e, type: 'expense' as const, sortDate: e.date, displayAmount: e.amount }))\r\n                    ]\r\n                        .sort((a, b) => new Date(b.sortDate).getTime() - new Date(a.sortDate).getTime())\r\n                        .slice(0, 3)\r\n                        .map((item: any) => (\r\n                            <div key={item.id} className=\"flex items-center justify-between group p-1.5 hover:bg-slate-50 rounded-lg transition-colors\">\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <div className={`w-8 h-8 rounded-lg flex items-center justify-center border ${item.type === 'trip'\r\n                                        ? 'bg-green-50 border-green-100 text-green-600'\r\n                                        : 'bg-red-50 border-red-100 text-red-600'}`}>\r\n                                        {item.type === 'trip' ? <IndianRupee size={14} /> : <TrendingUp size={14} className=\"rotate-180\" />}\r\n                                    </div>\r\n                                    <div>\r\n                                        <p className=\"text-[12px] font-bold text-slate-900 uppercase tracking-wide\">\r\n                                            {item.type === 'trip' ? (item.customerName || 'Trip Income') : (item.category || 'Expense')}\r\n                                        </p>\r\n                                        <p className=\"text-[9px] font-bold text-slate-500 mt-0\">\r\n                                            {new Date(item.sortDate).toLocaleDateString('en-IN', { day: 'numeric', month: 'short' })}  {item.type === 'trip' ? 'Income' : 'Spent'}\r\n                                        </p>\r\n                                    </div>\r\n                                </div>\r\n                                <span className={`text-[13px] font-bold tabular-nums tracking-tight ${item.type === 'trip' ? 'text-green-600' : 'text-red-600'}`}>\r\n                                    {item.type === 'trip' ? '+' : '-'}{item.displayAmount?.toLocaleString()}\r\n                                </span>\r\n                            </div>\r\n                        ))}\r\n\r\n                    {trips.length === 0 && expenses.length === 0 && (\r\n                        <p className=\"text-center text-[11px] text-slate-400 font-bold uppercase tracking-wide py-4\">No recent activity</p>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Dashboard;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\DocumentScanner.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1881,1884],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1881,1884],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef } from 'react';\r\nimport { Camera, Scan, X, Loader2, FileImage } from 'lucide-react';\r\nimport { performOcr, parseReceipt, parseDocument } from '../utils/visionApi';\r\n\r\ninterface DocumentScannerProps {\r\n    onScanComplete: (data: {\r\n        amount?: number;\r\n        date?: string;\r\n        liters?: number;\r\n        expiryDate?: string;\r\n        docNumber?: string;\r\n        fullText: string\r\n    }) => void;\r\n    onClose: () => void;\r\n    label?: string;\r\n}\r\n\r\nconst DocumentScanner: React.FC<DocumentScannerProps> = ({ onScanComplete, onClose, label = \"Scan Receipt\" }) => {\r\n    const [isScanning, setIsScanning] = useState(false);\r\n    const [preview, setPreview] = useState<string | null>(null);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        const reader = new FileReader();\r\n        reader.onloadend = () => {\r\n            setPreview(reader.result as string);\r\n            setError(null);\r\n        };\r\n        reader.readAsDataURL(file);\r\n    };\r\n\r\n    const startScan = async () => {\r\n        if (!preview) return;\r\n\r\n        setIsScanning(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const result = await performOcr(preview);\r\n            if (!result.fullText) {\r\n                throw new Error(\"Could not read any text from this image. Please try a clearer photo.\");\r\n            }\r\n\r\n            const parsedReceipt = parseReceipt(result.lines);\r\n            const parsedDoc = parseDocument(result.lines);\r\n\r\n            onScanComplete({\r\n                ...parsedReceipt,\r\n                ...parsedDoc,\r\n                fullText: result.fullText\r\n            });\r\n        } catch (err: any) {\r\n            console.error('OCR Process failed:', err);\r\n            setError(err.message || \"Scanning failed. Please try again.\");\r\n            setIsScanning(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-slate-900/90 backdrop-blur-sm animate-in fade-in duration-300\">\r\n            <div className=\"relative w-full max-w-md bg-white rounded-[32px] shadow-2xl overflow-hidden border border-white/20\">\r\n\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b border-slate-100 flex items-center justify-between\">\r\n                    <div>\r\n                        <h3 className=\"text-lg font-black text-slate-900 uppercase tracking-tight\">{label}</h3>\r\n                        <p className=\"text-[10px] text-slate-400 font-bold uppercase tracking-widest\">Powered by Google Vision</p>\r\n                    </div>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"p-2 bg-slate-100 rounded-full text-slate-400 hover:text-slate-600 active:scale-90 transition-all\"\r\n                    >\r\n                        <X size={20} />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"p-6 space-y-6 text-center\">\r\n                    {!preview ? (\r\n                        <div\r\n                            onClick={() => fileInputRef.current?.click()}\r\n                            className=\"aspect-[3/4] border-2 border-dashed border-slate-200 rounded-3xl flex flex-col items-center justify-center gap-4 cursor-pointer hover:border-blue-300 hover:bg-blue-50/30 transition-all group\"\r\n                        >\r\n                            <div className=\"w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center text-blue-500 group-hover:scale-110 transition-transform\">\r\n                                <Camera size={32} />\r\n                            </div>\r\n                            <div className=\"space-y-1\">\r\n                                <p className=\"text-xs font-black text-slate-700 uppercase tracking-wider\">Take Photo / Upload</p>\r\n                                <p className=\"text-[10px] text-slate-400 font-bold uppercase tracking-widest\">Use clear lighting for best results</p>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"relative group\">\r\n                            <div className=\"aspect-[3/4] rounded-3xl overflow-hidden shadow-lg border-4 border-white\">\r\n                                <img src={preview} alt=\"Preview\" className=\"w-full h-full object-cover\" />\r\n                                {isScanning && (\r\n                                    <div className=\"absolute inset-0 bg-[#0047AB]/60 backdrop-blur-[2px] flex flex-col items-center justify-center text-white p-6\">\r\n                                        <div className=\"relative\">\r\n                                            <Loader2 size={48} className=\"animate-spin mb-4\" />\r\n                                            <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                                                <Scan size={24} className=\"opacity-50\" />\r\n                                            </div>\r\n                                        </div>\r\n                                        <p className=\"text-sm font-black uppercase tracking-widest animate-pulse\">Scanning Content...</p>\r\n                                        <div className=\"mt-4 w-full bg-white/20 h-1.5 rounded-full overflow-hidden\">\r\n                                            <div className=\"bg-white h-full animate-progress-indefinite rounded-full\" />\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                            {!isScanning && (\r\n                                <button\r\n                                    onClick={() => setPreview(null)}\r\n                                    className=\"absolute -top-3 -right-3 p-2 bg-red-500 text-white rounded-full shadow-lg active:scale-90 transition-all\"\r\n                                >\r\n                                    <X size={16} />\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n\r\n                    {error && (\r\n                        <div className=\"p-3 bg-red-50 border border-red-100 rounded-xl\">\r\n                            <p className=\"text-[10px] font-bold text-red-500 uppercase tracking-tight\">{error}</p>\r\n                        </div>\r\n                    )}\r\n\r\n                    <input\r\n                        type=\"file\"\r\n                        ref={fileInputRef}\r\n                        onChange={handleFileSelect}\r\n                        accept=\"image/*\"\r\n                        capture=\"environment\"\r\n                        className=\"hidden\"\r\n                    />\r\n\r\n                    {preview && !isScanning && (\r\n                        <button\r\n                            onClick={startScan}\r\n                            className=\"w-full py-4 bg-[#0047AB] text-white rounded-2xl font-black text-xs uppercase tracking-[0.2em] shadow-xl shadow-blue-500/20 active:scale-[0.98] transition-all flex items-center justify-center gap-3\"\r\n                        >\r\n                            <Scan size={18} />\r\n                            Start Smart Scan\r\n                        </button>\r\n                    )}\r\n\r\n                    {!preview && (\r\n                        <button\r\n                            onClick={() => fileInputRef.current?.click()}\r\n                            className=\"w-full py-4 bg-slate-100 text-slate-600 rounded-2xl font-black text-xs uppercase tracking-[0.2em] active:scale-[0.98] transition-all flex items-center justify-center gap-3\"\r\n                        >\r\n                            <FileImage size={18} />\r\n                            Select File\r\n                        </button>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Footer hint */}\r\n                <div className=\"px-6 py-4 bg-slate-50 border-t border-slate-100\">\r\n                    <p className=\"text-[9px] text-slate-400 font-bold text-center uppercase tracking-widest leading-relaxed\">\r\n                        RC Books, Licenses, and Fuel Bills are automatically recognized.\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default DocumentScanner;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\DocumentVault.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1175,1178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1175,1178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'user'. Either include it or remove the dependency array.","line":90,"column":8,"nodeType":"ArrayExpression","endLine":90,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [user]","fix":{"range":[3347,3357],"text":"[user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":185,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7499,7502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7499,7502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":226,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8992,8995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8992,8995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport {\r\n    Trash2,\r\n    FileText,\r\n    CheckCircle,\r\n    AlertCircle,\r\n    Loader2,\r\n    X,\r\n    Scan,\r\n    Calendar,\r\n    Pencil,\r\n    ChevronDown,\r\n    Plus\r\n} from 'lucide-react';\r\nimport { generateId } from '../utils/uuid';\r\n\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { supabase } from '../utils/supabase';\r\nimport { useSettings } from '../contexts/SettingsContext';\r\nimport { Analytics } from '../utils/monitoring';\r\nimport DocumentScanner from './DocumentScanner';\r\n\r\ninterface VaultDoc {\r\n    id: string;\r\n    name: string;\r\n    type: string;\r\n    expiryDate: string;\r\n    fileUrl?: string;\r\n    filePath?: string;\r\n}\r\n\r\nconst VEHICLE_DOC_TYPES = [\r\n    { id: 'Insurance', label: 'Insurance Policy', desc: 'Valid comprehensive or 3rd party policy' },\r\n    { id: 'Permit', label: 'Permit Copy', desc: 'State or National Taxi Permit' },\r\n    { id: 'Fitness', label: 'FC (Fitness)', desc: 'Current Fitness Certificate' },\r\n    { id: 'Pollution', label: 'Pollution (PUC)', desc: 'Emission Test Certificate' }\r\n];\r\n\r\n\r\n\r\nconst DocumentVault: React.FC<{ onStatsUpdate?: (stats: any) => void }> = ({ onStatsUpdate }) => {\r\n    const { user } = useAuth();\r\n    const { settings, setDocStats } = useSettings();\r\n\r\n    const [allDocs, setAllDocs] = useState<VaultDoc[]>([]);\r\n    const [selectedVehicleId, setSelectedVehicleId] = useState<string>('');\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [editingType, setEditingType] = useState<string | null>(null);\r\n    const [scannerType, setScannerType] = useState<string | null>(null);\r\n    const [formDate, setFormDate] = useState('');\r\n\r\n    const currentVehicle = useMemo(() =>\r\n        settings.vehicles.find(v => v.id === selectedVehicleId) || settings.vehicles[0],\r\n        [settings.vehicles, selectedVehicleId]);\r\n\r\n    useEffect(() => {\r\n        if (settings.vehicles.length > 0 && !selectedVehicleId) {\r\n            setSelectedVehicleId(settings.vehicles[0].id);\r\n        }\r\n    }, [settings.vehicles, selectedVehicleId]);\r\n\r\n    const fetchDocuments = useCallback(async () => {\r\n        // Force loader off after 5 seconds max to prevent hanging\r\n        const safeParams = { timeout: 5000 };\r\n        const timer = setTimeout(() => setIsLoading(false), safeParams.timeout);\r\n\r\n        try {\r\n            if (user) {\r\n                // Race Supabase against a timeout logic internally to avoid hanging promise\r\n                const fetchPromise = supabase.from('user_documents').select('*').eq('user_id', user.id);\r\n                const { data, error } = await fetchPromise;\r\n\r\n                if (error) throw error;\r\n                if (data) {\r\n                    setAllDocs(data.map(d => ({\r\n                        id: d.id, name: d.name, type: d.type, expiryDate: d.expiry_date,\r\n                        fileUrl: d.file_url, filePath: d.file_path\r\n                    })));\r\n                }\r\n            } else {\r\n                const localData = localStorage.getItem('cab-docs');\r\n                if (localData) setAllDocs(JSON.parse(localData));\r\n            }\r\n        } catch (err) {\r\n            console.error('[DocumentVault] Fetch Error:', err);\r\n        } finally {\r\n            clearTimeout(timer);\r\n            setIsLoading(false);\r\n        }\r\n    }, [user?.id]); // Depend on ID string, not object reference\r\n\r\n    useEffect(() => {\r\n        fetchDocuments();\r\n    }, [fetchDocuments]);\r\n\r\n    const stats = useMemo(() => {\r\n        const relevantDocs = allDocs;\r\n        const vNumber = currentVehicle?.number;\r\n        const hasFullVehicle = VEHICLE_DOC_TYPES.every(req =>\r\n            relevantDocs.some(d => d.type === req.id && d.name === vNumber));\r\n        return { hasFullVehicle, hasFullDriver: true };\r\n    }, [allDocs, currentVehicle]);\r\n\r\n    useEffect(() => {\r\n        setDocStats(prev => {\r\n            if (prev.hasFullVehicle === stats.hasFullVehicle && prev.hasFullDriver === stats.hasFullDriver) return prev;\r\n            return stats;\r\n        });\r\n        if (onStatsUpdate) onStatsUpdate(stats);\r\n    }, [stats, setDocStats, onStatsUpdate]);\r\n\r\n    // OPTIMISTIC SAVE\r\n    const handleSave = async (docType: string, category: 'vehicle' | 'driver') => {\r\n        if (!formDate) { alert('Please select an expiry date first.'); return; }\r\n\r\n        const docName = category === 'vehicle' ? (currentVehicle?.number || '') : (settings.holderName || 'Driver');\r\n        if (!docName) { alert('Missing vehicle or driver information.'); return; }\r\n\r\n        const newDocData: VaultDoc = {\r\n            id: generateId(), name: docName, type: docType, expiryDate: formDate\r\n        };\r\n\r\n        const previousDocs = [...allDocs];\r\n\r\n        // IMMEDIATE UPDATE\r\n        setAllDocs(prev => {\r\n            const others = prev.filter(d => !(d.type === docType && d.name === docName));\r\n            const updated = [...others, newDocData];\r\n            if (!user) localStorage.setItem('cab-docs', JSON.stringify(updated));\r\n            return updated;\r\n        });\r\n        setEditingType(null);\r\n\r\n        // BACKGROUND SYNC\r\n        if (user) {\r\n            const syncToDb = async () => {\r\n                try {\r\n                    // Check DB for existing record to avoid ID mismatches or duplicates\r\n                    const { data: dbRecord, error: fetchError } = await supabase\r\n                        .from('user_documents')\r\n                        .select('id')\r\n                        .eq('user_id', user.id)\r\n                        .eq('name', docName)\r\n                        .eq('type', docType)\r\n                        .maybeSingle();\r\n\r\n                    if (fetchError) throw fetchError;\r\n\r\n                    // Preserve existing file connection if updating\r\n                    const existingLocal = previousDocs.find(d => d.type === docType && d.name === docName);\r\n                    const payload = {\r\n                        user_id: user.id, name: docName, type: docType, expiry_date: formDate,\r\n                        file_url: existingLocal?.fileUrl || null, file_path: existingLocal?.filePath || null\r\n                    };\r\n\r\n                    let result;\r\n                    if (dbRecord) {\r\n                        result = await supabase\r\n                            .from('user_documents')\r\n                            .update(payload)\r\n                            .eq('id', dbRecord.id)\r\n                            .select()\r\n                            .single();\r\n                    } else {\r\n                        result = await supabase\r\n                            .from('user_documents')\r\n                            .insert(payload)\r\n                            .select()\r\n                            .single();\r\n                    }\r\n\r\n                    if (result.error) throw result.error;\r\n\r\n                    // Update the local state with the REAL database ID to ensure future updates work\r\n                    if (result.data) {\r\n                        setAllDocs(current => current.map(d =>\r\n                            (d.type === docType && d.name === docName) ? { ...d, id: result.data.id } : d\r\n                        ));\r\n                        Analytics.logActivity('document_uploaded', {\r\n                            type: docType,\r\n                            name: docName,\r\n                            expiry: formDate\r\n                        }, user.id);\r\n                    }\r\n                } catch (err: any) {\r\n                    console.error('Background Save Failed:', err);\r\n                    setAllDocs(previousDocs); // Revert\r\n                    alert(`Save failed: ${err.message || 'Network error'}`);\r\n                }\r\n            };\r\n            syncToDb();\r\n        }\r\n    };\r\n\r\n    // OPTIMISTIC DELETE\r\n    const handleDelete = async (doc: VaultDoc) => {\r\n        if (!confirm('Delete this date?')) return;\r\n        const previousDocs = [...allDocs];\r\n\r\n        setAllDocs(prev => {\r\n            const updated = prev.filter(d => d.id !== doc.id);\r\n            if (!user) localStorage.setItem('cab-docs', JSON.stringify(updated));\r\n            return updated;\r\n        });\r\n\r\n        if (user) {\r\n            const syncDelete = async () => {\r\n                try {\r\n                    const { error } = await supabase.from('user_documents').delete().eq('id', doc.id);\r\n                    if (error) throw error;\r\n                    await Analytics.logActivity('document_deleted', {\r\n                        id: doc.id,\r\n                        type: doc.type,\r\n                        name: doc.name\r\n                    }, user.id);\r\n                } catch (err) {\r\n                    console.error('Delete Failed:', err);\r\n                    setAllDocs(previousDocs); // Revert\r\n                    alert('Delete failed. Please check connection.');\r\n                }\r\n            };\r\n            syncDelete();\r\n        }\r\n    };\r\n\r\n    const handleScanComplete = (data: any) => {\r\n        const rawDate = data.expiryDate || data.date;\r\n        if (rawDate) {\r\n            let normalized = rawDate.replace(/\\//g, '-');\r\n            const parts = normalized.split('-');\r\n            if (parts.length === 3 && parts[2].length === 4) normalized = `${parts[2]}-${parts[1]}-${parts[0]}`;\r\n            setFormDate(normalized);\r\n        }\r\n        setScannerType(null);\r\n    };\r\n\r\n    const getExpiryStatus = (dateStr: string) => {\r\n        const today = new Date();\r\n        const exp = new Date(dateStr);\r\n        const diffDays = Math.ceil((exp.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\r\n        if (diffDays < 0) return { label: 'EXPIRED', color: 'text-red-500', bg: 'bg-red-50', badge: 'bg-red-500' };\r\n        if (diffDays <= 30) return { label: `${diffDays} DAYS LEFT`, color: 'text-orange-500', bg: 'bg-orange-50', badge: 'bg-orange-500' };\r\n        return { label: 'ACTIVE', color: 'text-green-600', bg: 'bg-green-50', badge: 'bg-green-100 text-green-700' };\r\n    };\r\n\r\n    const renderCard = (def: { id: string, label: string, desc: string }, category: 'vehicle' | 'driver') => {\r\n        const isEditing = editingType === def.id;\r\n        const targetName = category === 'vehicle' ? currentVehicle?.number : (settings.holderName || 'Driver');\r\n        const doc = allDocs.find(d => d.type === def.id && (category === 'vehicle' ? d.name === targetName : true));\r\n        const status = doc ? getExpiryStatus(doc.expiryDate) : null;\r\n\r\n        if (isEditing) {\r\n            return (\r\n                <div key={def.id} className=\"bg-white border-2 border-blue-500 rounded-3xl p-5 shadow-xl animate-fade-in relative z-10\">\r\n                    <div className=\"flex justify-between items-start mb-4\">\r\n                        <div>\r\n                            <h4 className=\"text-sm font-black text-slate-800 uppercase tracking-wide\">{def.label}</h4>\r\n                            <p className=\"text-[10px] text-blue-600 font-bold uppercase tracking-widest mt-1\">Set Expiry Date</p>\r\n                        </div>\r\n                        <button onClick={() => { setEditingType(null); setFormDate(''); }} className=\"p-1.5 bg-slate-100 text-slate-500 rounded-full hover:bg-slate-200 transition-colors\">\r\n                            <X size={16} />\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"relative group\">\r\n                            <div className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition-colors\"><Calendar size={18} /></div>\r\n                            <input type=\"date\" value={formDate} onChange={(e) => setFormDate(e.target.value)} className=\"w-full h-12 pl-10 pr-4 bg-slate-50 border border-slate-200 rounded-xl text-sm font-bold text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all uppercase\" />\r\n                        </div>\r\n                        <div className=\"flex gap-3\">\r\n                            <button onClick={() => setScannerType(def.id)} className=\"flex-1 h-12 bg-slate-50 border border-slate-200 text-slate-600 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-white hover:border-blue-300 hover:text-blue-600 transition-all flex items-center justify-center gap-2\">\r\n                                <Scan size={16} /> Scan\r\n                            </button>\r\n                            <button onClick={() => handleSave(def.id, category)} className=\"flex-1 h-12 bg-blue-600 text-white rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-blue-700 active:scale-95 transition-all flex items-center justify-center gap-2 shadow-lg shadow-blue-200\">\r\n                                <CheckCircle size={16} /> Save\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <div key={def.id} className=\"bg-white border border-slate-100 rounded-3xl p-4 shadow-sm hover:shadow-md hover:border-blue-100 transition-all group\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className={`w-12 h-12 rounded-2xl flex-shrink-0 flex items-center justify-center ${doc ? status?.bg : 'bg-slate-50'} transition-colors`}>\r\n                        {doc ? (status?.label === 'EXPIRED' ? <AlertCircle size={22} className=\"text-red-500\" /> : <CheckCircle size={22} className=\"text-green-600\" />) : <FileText size={22} className=\"text-slate-300\" />}\r\n                    </div>\r\n                    <div className=\"flex-1 min-w-0\">\r\n                        <h4 className=\"text-xs font-black text-slate-800 uppercase tracking-wide\">{def.label}</h4>\r\n                        {!doc ? <p className=\"text-[9px] font-bold text-slate-400 uppercase tracking-widest truncate mt-0.5\">{def.desc}</p> : (\r\n                            <div className=\"flex items-center gap-2 mt-1\">\r\n                                <span className={`px-2 py-0.5 rounded-md text-[8px] font-black uppercase tracking-wider ${status?.badge} ${status?.label === 'ACTIVE' ? 'text-white bg-green-500' : ''}`}>{status?.label}</span>\r\n                                <span className=\"text-[10px] font-bold text-slate-700\">{doc.expiryDate}</span>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                    <div className=\"flex items-center gap-1\">\r\n                        {!doc ? (\r\n                            <button onClick={() => { setEditingType(def.id); setFormDate(''); }} className=\"w-9 h-9 flex items-center justify-center bg-blue-50 text-blue-600 rounded-xl hover:bg-blue-600 hover:text-white transition-all shadow-sm active:scale-90\"><Plus size={18} strokeWidth={2.5} /></button>\r\n                        ) : (\r\n                            <>\r\n                                <button onClick={() => { setEditingType(def.id); setFormDate(doc.expiryDate); }} className=\"w-9 h-9 flex items-center justify-center bg-slate-50 text-slate-400 rounded-xl hover:bg-blue-50 hover:text-blue-600 transition-all active:scale-90\"><Pencil size={16} /></button>\r\n                                <button onClick={() => handleDelete(doc)} className=\"w-9 h-9 flex items-center justify-center bg-slate-50 text-slate-400 rounded-xl hover:bg-red-50 hover:text-red-500 transition-all active:scale-90\"><Trash2 size={16} /></button>\r\n                            </>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-8 pb-20 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n            {isLoading && (\r\n                <div className=\"flex justify-center p-4\">\r\n                    <Loader2 size={24} className=\"text-blue-600 animate-spin\" />\r\n                </div>\r\n            )}\r\n            <section className=\"space-y-4\">\r\n                <div className=\"flex items-center justify-between px-2\">\r\n                    <div>\r\n                        <h3 className=\"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] flex items-center gap-2\">Vehicle Documents {isLoading && <span className=\"w-1.5 h-1.5 bg-blue-500 rounded-full animate-ping\" />}</h3>\r\n                        {currentVehicle && <p className=\"text-[8px] font-bold text-blue-600 mt-1 uppercase tracking-widest\">{currentVehicle.model}</p>}\r\n                    </div>\r\n                    {settings.vehicles.length > 0 ? (\r\n                        <div className=\"relative group\">\r\n                            <select value={selectedVehicleId} onChange={(e) => setSelectedVehicleId(e.target.value)} className=\"appearance-none bg-slate-900 text-white pl-4 pr-10 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-wider outline-none cursor-pointer shadow-lg hover:bg-slate-800 transition-colors\">\r\n                                {settings.vehicles.map(v => <option key={v.id} value={v.id}>{v.number}</option>)}\r\n                            </select>\r\n                            <ChevronDown size={14} className=\"absolute right-3 top-1/2 -translate-y-1/2 text-white/50 pointer-events-none group-hover:text-white transition-colors\" />\r\n                        </div>\r\n                    ) : (\r\n                        <button className=\"px-3 py-1.5 bg-red-50 text-red-500 text-[9px] font-black uppercase tracking-widest rounded-lg border border-red-100\">No Vehicle</button>\r\n                    )}\r\n                </div>\r\n                {settings.vehicles.length === 0 ? (\r\n                    <div className=\"p-8 border-2 border-dashed border-slate-200 rounded-3xl bg-slate-50 flex flex-col items-center justify-center text-center gap-3\">\r\n                        <div className=\"w-12 h-12 bg-white rounded-full shadow-sm flex items-center justify-center\"><AlertCircle size={24} className=\"text-slate-300\" /></div>\r\n                        <div><p className=\"text-xs font-black text-slate-700 uppercase\">No Fleet Found</p><p className=\"text-[10px] text-slate-400 font-medium mt-1\">Add a vehicle in the 'Garage' tab first.</p></div>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"space-y-3\">{VEHICLE_DOC_TYPES.map(def => renderCard(def, 'vehicle'))}</div>\r\n                )}\r\n            </section>\r\n            {scannerType && <DocumentScanner label=\"Scan Expiry Date\" onClose={() => setScannerType(null)} onScanComplete={handleScanComplete} />}\r\n        </div >\r\n    );\r\n};\r\n\r\nexport default DocumentVault;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\ExpenseTracker.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1695,1698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1695,1698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5074,5077],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5074,5077],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":339,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":339,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16368,16371],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16368,16371],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport {\r\n    Plus, Fuel, Settings, Trash2, PieChart, ShoppingBag, Coffee, Calculator, Wallet, MapPin, Shield, CreditCard, Scan\r\n} from 'lucide-react';\r\nimport { generateId } from '../utils/uuid';\r\n\r\nimport { useSettings } from '../contexts/SettingsContext';\r\nimport type { Expense } from '../utils/fare';\r\nimport { safeJSONParse } from '../utils/storage';\r\nimport DocumentScanner from './DocumentScanner';\r\n\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { supabase } from '../utils/supabase';\r\nimport { Analytics } from '../utils/monitoring';\r\n\r\nconst ExpenseTracker: React.FC = () => {\r\n    const { t } = useSettings();\r\n    const { user } = useAuth();\r\n    const [expenses, setExpenses] = useState<Expense[]>(() => safeJSONParse<Expense[]>('cab-expenses', []));\r\n    const [amount, setAmount] = useState('');\r\n    const [category, setCategory] = useState<Expense['category']>('fuel');\r\n    const [desc, setDesc] = useState('');\r\n    const [showScanner, setShowScanner] = useState(false);\r\n\r\n    // Cloud Sync: Fetch expenses on load/login\r\n    useEffect(() => {\r\n        const fetchExpenses = async () => {\r\n            if (user) {\r\n                // 1. Fetch Cloud Expenses\r\n                const { data, error } = await supabase.from('expenses').select('*').order('date', { ascending: false });\r\n\r\n                if (!error) {\r\n                    const cloudExpensesMap = new Map();\r\n                    if (data) {\r\n                        data.forEach(row => {\r\n                            cloudExpensesMap.set(row.id, {\r\n                                id: row.id,\r\n                                category: row.category as any,\r\n                                amount: Number(row.amount),\r\n                                description: row.description || '',\r\n                                date: row.date\r\n                            });\r\n                        });\r\n                    }\r\n\r\n                    // 2. Identify Local-Only Expenses (created offline)\r\n                    const localStored = safeJSONParse<Expense[]>('cab-expenses', []);\r\n                    const localToUpload: Expense[] = [];\r\n\r\n                    for (const localE of localStored) {\r\n                        if (!cloudExpensesMap.has(localE.id)) {\r\n                            localToUpload.push(localE);\r\n                        }\r\n                    }\r\n\r\n                    // 3. Upload Offline Expenses\r\n                    if (localToUpload.length > 0) {\r\n                        console.log(`Syncing ${localToUpload.length} local expenses to cloud...`);\r\n                        await Promise.all(localToUpload.map(e =>\r\n                            supabase.from('expenses').upsert({\r\n                                id: e.id,\r\n                                user_id: user.id,\r\n                                category: e.category,\r\n                                amount: e.amount,\r\n                                description: e.description,\r\n                                date: e.date\r\n                            })\r\n                        ));\r\n                    }\r\n\r\n                    // 4. Merge State (Cloud Wins + Local which is now Cloud)\r\n                    setExpenses(prev => {\r\n                        const merged = new Map<string, Expense>();\r\n                        // Keep current state\r\n                        prev.forEach((e) => merged.set(e.id, e));\r\n                        // Add Cloud (which now includes uploaded ones effectively)\r\n                        cloudExpensesMap.forEach((e, id) => merged.set(id, e));\r\n                        // Add uploaded ones explicitly to be safe for immediate UI update? \r\n                        localToUpload.forEach(e => merged.set(e.id, e));\r\n\r\n                        const mergedArray = Array.from(merged.values()).sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()) as Expense[];\r\n                        // Update LocalStorage to match synced state\r\n                        localStorage.setItem('cab-expenses', JSON.stringify(mergedArray));\r\n                        return mergedArray;\r\n                    });\r\n                }\r\n            }\r\n        };\r\n        fetchExpenses();\r\n    }, [user]);\r\n\r\n    // 5. Real-time Subscription for Simultaneous Sync\r\n    useEffect(() => {\r\n        if (!user) return;\r\n\r\n        const channel = supabase\r\n            .channel('public:expenses')\r\n            .on(\r\n                'postgres_changes',\r\n                {\r\n                    event: '*',\r\n                    schema: 'public',\r\n                    table: 'expenses',\r\n                    filter: `user_id=eq.${user.id}`,\r\n                },\r\n                (payload) => {\r\n                    console.log('Real-time expense change:', payload);\r\n                    if (payload.eventType === 'INSERT' || payload.eventType === 'UPDATE') {\r\n                        const newExpense: Expense = {\r\n                            id: payload.new.id,\r\n                            category: payload.new.category as any,\r\n                            amount: Number(payload.new.amount),\r\n                            description: payload.new.description || '',\r\n                            date: payload.new.date\r\n                        };\r\n\r\n                        setExpenses(prev => {\r\n                            const idx = prev.findIndex(e => e.id === newExpense.id);\r\n                            if (idx !== -1) {\r\n                                if (JSON.stringify(prev[idx]) === JSON.stringify(newExpense)) return prev;\r\n                                const next = [...prev];\r\n                                next[idx] = newExpense;\r\n                                return next;\r\n                            }\r\n                            return [newExpense, ...prev].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n                        });\r\n\r\n                        // Update LocalStorage\r\n                        const current = safeJSONParse<Expense[]>('cab-expenses', []);\r\n                        const idx = current.findIndex(e => e.id === newExpense.id);\r\n                        let updated;\r\n                        if (idx !== -1) {\r\n                            updated = [...current];\r\n                            updated[idx] = newExpense;\r\n                        } else {\r\n                            updated = [newExpense, ...current];\r\n                        }\r\n                        localStorage.setItem('cab-expenses', JSON.stringify(updated));\r\n\r\n                    } else if (payload.eventType === 'DELETE') {\r\n                        setExpenses(prev => prev.filter(e => e.id !== payload.old.id));\r\n                        const current = safeJSONParse<Expense[]>('cab-expenses', []);\r\n                        localStorage.setItem('cab-expenses', JSON.stringify(current.filter(e => e.id !== payload.old.id)));\r\n                    }\r\n                }\r\n            )\r\n            .subscribe();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [user]);\r\n\r\n    const addExpense = async () => {\r\n        if (!amount) return;\r\n        const newExpense: Expense = {\r\n            id: generateId(),\r\n            category,\r\n            amount: Number(amount),\r\n            description: desc,\r\n            date: new Date().toISOString()\r\n        };\r\n\r\n        const up = [newExpense, ...expenses];\r\n        setExpenses(up);\r\n        localStorage.setItem('cab-expenses', JSON.stringify(up));\r\n        setAmount(''); setDesc('');\r\n\r\n        // Sync to Cloud\r\n        if (user) {\r\n            await supabase.from('expenses').insert({\r\n                id: newExpense.id,\r\n                user_id: user.id,\r\n                category: newExpense.category,\r\n                amount: newExpense.amount,\r\n                description: newExpense.description,\r\n                date: newExpense.date\r\n            });\r\n            await Analytics.logActivity('expense_logged', {\r\n                amount: newExpense.amount,\r\n                category: newExpense.category,\r\n                description: newExpense.description\r\n            }, user.id);\r\n        }\r\n    };\r\n\r\n    const handleScanComplete = (data: { amount?: number; date?: string; fullText: string }) => {\r\n        if (data.amount) {\r\n            setAmount(data.amount.toString());\r\n            setCategory('fuel'); // OCR is mostly used for fuel\r\n            setDesc(`Smart Scan: ${new Date().toLocaleDateString()}`);\r\n        }\r\n        setShowScanner(false);\r\n    };\r\n\r\n    const deleteExpense = async (id: string) => {\r\n        const deletedExpense = expenses.find(e => e.id === id);\r\n        const up = expenses.filter(e => e.id !== id);\r\n        setExpenses(up);\r\n        localStorage.setItem('cab-expenses', JSON.stringify(up));\r\n\r\n        // Sync to Cloud\r\n        if (user) {\r\n            await supabase.from('expenses').delete().eq('id', id);\r\n            if (deletedExpense) {\r\n                await Analytics.logActivity('expense_deleted', {\r\n                    id,\r\n                    amount: deletedExpense.amount,\r\n                    category: deletedExpense.category\r\n                }, user.id);\r\n            }\r\n        }\r\n    };\r\n\r\n    const now = new Date();\r\n    const today = now.toISOString().split('T')[0];\r\n\r\n    // Helper for date ranges\r\n    const isThisWeek = (dateStr: string) => {\r\n        const d = new Date(dateStr);\r\n        const diff = now.getTime() - d.getTime();\r\n        return diff <= 7 * 24 * 60 * 60 * 1000;\r\n    };\r\n    const isThisMonth = (dateStr: string) => {\r\n        const d = new Date(dateStr);\r\n        return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();\r\n    };\r\n    const isThisYear = (dateStr: string) => {\r\n        const d = new Date(dateStr);\r\n        return d.getFullYear() === now.getFullYear();\r\n    };\r\n\r\n    const todaysExpenses = expenses.filter(e => e.date.startsWith(today));\r\n    const totalSpentToday = todaysExpenses.reduce((sum, e) => sum + e.amount, 0);\r\n    const totalSpentWeek = expenses.filter(e => isThisWeek(e.date)).reduce((sum, e) => sum + e.amount, 0);\r\n    const totalSpentMonth = expenses.filter(e => isThisMonth(e.date)).reduce((sum, e) => sum + e.amount, 0);\r\n    const totalSpentYear = expenses.filter(e => isThisYear(e.date)).reduce((sum, e) => sum + e.amount, 0);\r\n\r\n    const getIcon = (cat: string) => {\r\n        switch (cat) {\r\n            case 'fuel': return <Fuel size={16} />;\r\n            case 'food': return <Coffee size={16} />;\r\n            case 'maintenance': return <Settings size={16} />;\r\n            case 'toll': return <MapPin size={16} />;\r\n            case 'permit': return <Shield size={16} />;\r\n            case 'parking': return <CreditCard size={16} />;\r\n            default: return <ShoppingBag size={16} />;\r\n        }\r\n    }\r\n\r\n    const getCategoryColor = (cat: string) => {\r\n        switch (cat) {\r\n            case 'fuel': return 'text-orange-500 bg-orange-50 border-orange-100';\r\n            case 'food': return 'text-blue-500 bg-blue-50 border-blue-100';\r\n            case 'maintenance': return 'text-purple-500 bg-purple-50 border-purple-100';\r\n            case 'toll': return 'text-emerald-500 bg-emerald-50 border-emerald-100';\r\n            case 'permit': return 'text-indigo-500 bg-indigo-50 border-indigo-100';\r\n            case 'parking': return 'text-rose-500 bg-rose-50 border-rose-100';\r\n            default: return 'text-slate-500 bg-slate-50 border-slate-100';\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-4 pb-24\">\r\n            {/* Cash Flow Summary - Dynamic Grid */}\r\n            <div className=\"space-y-3\">\r\n                <div className=\"bg-white border border-slate-200 rounded-2xl p-3 shadow-sm flex items-center justify-between\">\r\n                    <div>\r\n                        <p className=\"text-[9px] font-black uppercase tracking-[0.2em] text-slate-400 mb-0.5\">TOTAL SPENT TODAY</p>\r\n                        <h2 className=\"text-2xl font-black tabular-nums tracking-tight text-slate-900\">{totalSpentToday.toLocaleString()}</h2>\r\n                    </div>\r\n                    <div className=\"p-2.5 bg-slate-50 rounded-xl border border-slate-100 text-slate-600\">\r\n                        <PieChart size={18} />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-3 gap-1.5\">\r\n                    <div className=\"bg-white border border-slate-200 rounded-xl p-2.5 shadow-sm\">\r\n                        <p className=\"text-[7px] font-black text-slate-400 uppercase tracking-widest mb-0.5\">THIS WEEK</p>\r\n                        <p className=\"text-xs font-black text-slate-900\">{totalSpentWeek.toLocaleString()}</p>\r\n                    </div>\r\n                    <div className=\"bg-white border border-slate-200 rounded-xl p-2.5 shadow-sm\">\r\n                        <p className=\"text-[7px] font-black text-slate-400 uppercase tracking-widest mb-0.5\">THIS MONTH</p>\r\n                        <p className=\"text-xs font-black text-slate-900\">{totalSpentMonth.toLocaleString()}</p>\r\n                    </div>\r\n                    <div className=\"bg-white border border-slate-200 rounded-xl p-2.5 shadow-sm\">\r\n                        <p className=\"text-[7px] font-black text-slate-400 uppercase tracking-widest mb-0.5\">THIS YEAR</p>\r\n                        <p className=\"text-xs font-black text-slate-900\">{totalSpentYear.toLocaleString()}</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Expense Entry Card - Compacter */}\r\n            <div className=\"bg-white border border-slate-200 rounded-2xl p-3 shadow-sm space-y-3\">\r\n                <div className=\"flex items-center justify-between border-b border-slate-50 pb-2\">\r\n                    <div className=\"flex items-center gap-2.5\">\r\n                        <div className=\"p-1.5 bg-blue-50 text-[#0047AB] rounded-lg\">\r\n                            <Plus size={14} strokeWidth={3} />\r\n                        </div>\r\n                        <div>\r\n                            <h3 className=\"text-xs font-black text-slate-900 uppercase tracking-tight\">New Expenditure</h3>\r\n                        </div>\r\n                    </div>\r\n                    <button\r\n                        onClick={() => setShowScanner(true)}\r\n                        className=\"flex items-center gap-1.5 px-2.5 py-1.5 bg-blue-50 text-[#0047AB] rounded-xl border border-blue-100 hover:bg-blue-100 transition-all active:scale-95 group\"\r\n                    >\r\n                        <Scan size={12} className=\"group-hover:rotate-12 transition-transform\" />\r\n                        <span className=\"text-[9px] font-black uppercase tracking-widest\">Scan Bill</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {showScanner && (\r\n                    <DocumentScanner\r\n                        onClose={() => setShowScanner(false)}\r\n                        onScanComplete={handleScanComplete}\r\n                        label=\"Scan Fuel Receipt\"\r\n                    />\r\n                )}\r\n\r\n                <div className=\"grid grid-cols-[1fr,1.5fr] gap-2.5\">\r\n                    <div className=\"space-y-1\">\r\n                        <label className=\"text-[9px] font-black text-slate-400 uppercase tracking-tight ml-1\">AMOUNT</label>\r\n                        <div className=\"relative\">\r\n                            <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 font-bold text-xs\"></span>\r\n                            <input\r\n                                type=\"number\"\r\n                                value={amount}\r\n                                onChange={(_) => setAmount(_.target.value)}\r\n                                className=\"tn-input h-9 pl-7 bg-slate-50 border-slate-200 font-black text-sm w-full\"\r\n                                placeholder=\"0\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"space-y-1\">\r\n                        <label className=\"text-[9px] font-black text-slate-400 uppercase tracking-tight ml-1\">CATEGORY</label>\r\n                        <select\r\n                            value={category}\r\n                            onChange={(_) => setCategory(_.target.value as any)}\r\n                            className=\"tn-input h-9 bg-slate-50 border-slate-200 font-bold text-[10px] uppercase w-full\"\r\n                        >\r\n                            {['fuel', 'maintenance', 'food', 'toll', 'permit', 'parking', 'other'].map(c => <option key={c} value={c}>{t(c)}</option>)}\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n\r\n                <button\r\n                    onClick={addExpense}\r\n                    className=\"w-full bg-[#0047AB] text-white h-10 rounded-xl font-black text-[10px] uppercase tracking-[0.15em] shadow-md active:scale-[0.98] transition-all flex items-center justify-center gap-2\"\r\n                >\r\n                    <Wallet size={14} /> REGISTER EXPENSE\r\n                </button>\r\n            </div>\r\n\r\n            {/* Transaction Feed - Condensed List */}\r\n            <div className=\"space-y-2\">\r\n                <div className=\"flex items-center justify-between px-2 pt-2\">\r\n                    <h3 className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">Recent Activity</h3>\r\n                    <span className=\"text-[9px] font-bold text-[#0047AB] bg-blue-50 px-2 py-0.5 rounded-md\">{todaysExpenses.length} Today</span>\r\n                </div>\r\n\r\n                {expenses.length === 0 ? (\r\n                    <div className=\"bg-white border border-slate-200 border-dashed rounded-2xl py-8 flex flex-col items-center justify-center text-center opacity-60\">\r\n                        <Calculator size={32} className=\"text-slate-200 mb-2\" />\r\n                        <p className=\"text-[10px] font-bold text-slate-400 uppercase\">No expenses recorded</p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"space-y-2\">\r\n                        {expenses.map(e => {\r\n                            const isToday = e.date.startsWith(today);\r\n                            return (\r\n                                <div key={e.id} className={`bg-white border rounded-xl p-3 flex justify-between items-center shadow-sm ${isToday ? 'border-slate-200' : 'border-slate-100 opacity-60'}`}>\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className={`p-2 rounded-lg border ${getCategoryColor(e.category)}`}>\r\n                                            {getIcon(e.category)}\r\n                                        </div>\r\n                                        <div>\r\n                                            <h4 className=\"text-xs font-black text-slate-900 uppercase tracking-tight\">{t(e.category)}</h4>\r\n                                            {e.description && <p className=\"text-[8px] text-slate-400 font-medium italic\">{e.description}</p>}\r\n                                            <p className=\"text-[9px] font-bold text-slate-400 uppercase\">\r\n                                                {new Date(e.date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"text-right\">\r\n                                            <p className=\"text-sm font-black text-slate-900 tabular-nums\">{e.amount}</p>\r\n                                        </div>\r\n                                        <button\r\n                                            onClick={() => deleteExpense(e.id)}\r\n                                            className=\"p-1.5 text-slate-300 hover:text-red-500 transition-all\"\r\n                                        >\r\n                                            <Trash2 size={14} />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ExpenseTracker;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\Finance.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\Footer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\GoogleSignInButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\Header.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\History.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":279,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13240,13243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13240,13243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":296,"column":137,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":140,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15027,15030],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15027,15030],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from 'react';\r\nimport { useSettings } from '../contexts/SettingsContext';\r\nimport type { Trip } from '../utils/fare';\r\nimport { shareReceipt, shareQuotation, generateQuotationPDF, generateReceiptPDF, generateBulkReceiptsPDF, type SavedQuotation } from '../utils/pdf';\r\nimport { format, subMonths, addMonths, isSameMonth } from 'date-fns';\r\nimport { FileText, Share2, Eye, Trash2, Download, ChevronLeft, ChevronRight, Calendar } from 'lucide-react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { useAdProtection } from '../hooks/useAdProtection';\r\nimport PDFPreviewModal from './PDFPreviewModal';\r\n\r\n\r\ninterface HistoryProps {\r\n    trips?: Trip[];\r\n    quotations?: SavedQuotation[];\r\n    type: 'invoice' | 'quotation';\r\n    onDeleteTrip?: (id: string) => void;\r\n    onDeleteQuotation?: (id: string) => void;\r\n    onConvertQuotation?: (quotation: SavedQuotation) => void;\r\n}\r\n\r\ntype TimeFilter = 'all' | 'today' | 'week' | 'month';\r\n\r\nconst History: React.FC<HistoryProps> = ({ trips = [], quotations = [], type, onDeleteTrip, onDeleteQuotation }) => {\r\n    const { settings } = useSettings();\r\n    const { user } = useAuth();\r\n    const [filter, setFilter] = useState<TimeFilter>('all');\r\n    const [selectedMonth, setSelectedMonth] = useState(new Date());\r\n\r\n    // Preview State\r\n    const [showPreview, setShowPreview] = useState(false);\r\n    const [previewPdfUrl, setPreviewPdfUrl] = useState('');\r\n\r\n    // Filter Logic\r\n    const filteredItems = useMemo(() => {\r\n        const now = new Date();\r\n        const today = now.toISOString().split('T')[0];\r\n        const data = type === 'invoice' ? trips : quotations;\r\n\r\n        return data.filter(item => {\r\n            const date = new Date(item.date);\r\n            const dateStr = date.toISOString().split('T')[0];\r\n\r\n            if (filter === 'today') return dateStr === today;\r\n            if (filter === 'week') {\r\n                const diffTime = Math.abs(now.getTime() - date.getTime());\r\n                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n                return diffDays <= 7;\r\n            }\r\n            if (filter === 'month') {\r\n                return isSameMonth(date, selectedMonth);\r\n            }\r\n            return true;\r\n        }).sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n    }, [trips, quotations, filter, type, selectedMonth]);\r\n\r\n    // Calculate Total Amount\r\n    const totalAmount = useMemo(() => {\r\n        if (type === 'invoice') {\r\n            return (filteredItems as Trip[]).reduce((sum, item) => sum + item.totalFare, 0);\r\n        } else {\r\n            return (filteredItems as SavedQuotation[]).reduce((sum, item) => {\r\n                const itemTotal = item.items.reduce((s, i) => s + (parseFloat(i.amount) || 0), 0);\r\n                const gst = item.gstEnabled ? itemTotal * 0.05 : 0;\r\n                return sum + itemTotal + gst;\r\n            }, 0);\r\n        }\r\n    }, [filteredItems, type]);\r\n\r\n    const formatDate = (dateString: string) => {\r\n        return new Date(dateString).toLocaleDateString('en-IN', {\r\n            day: '2-digit',\r\n            month: '2-digit',\r\n            year: 'numeric'\r\n        });\r\n    };\r\n\r\n    const handlePreviewQuotation = async (q: SavedQuotation) => {\r\n        const quoteData = {\r\n            customerName: q.customerName,\r\n            subject: q.subject,\r\n            date: q.date,\r\n            items: q.items,\r\n            gstEnabled: q.gstEnabled,\r\n            quotationNo: q.quotationNo,\r\n            terms: q.terms,\r\n            customerAddress: q.customerAddress,\r\n            customerGstin: q.customerGstin\r\n        };\r\n        const doc = await generateQuotationPDF(quoteData, {\r\n            ...settings,\r\n            vehicleNumber: 'N/A' // Quotations are generic\r\n        });\r\n        setPreviewPdfUrl(URL.createObjectURL(doc.output('blob')));\r\n        setShowPreview(true);\r\n    };\r\n\r\n    const handlePreviewInvoice = async (trip: Trip) => {\r\n        const doc = await generateReceiptPDF(trip, {\r\n            ...settings,\r\n            vehicleNumber: settings.vehicles.find(v => v.id === settings.currentVehicleId)?.number || 'N/A'\r\n        });\r\n        setPreviewPdfUrl(URL.createObjectURL(doc.output('blob')));\r\n        setShowPreview(true);\r\n    };\r\n\r\n    const handleDownloadQuotation = async (q: SavedQuotation) => {\r\n        const quoteData = {\r\n            customerName: q.customerName,\r\n            subject: q.subject,\r\n            date: q.date,\r\n            items: q.items,\r\n            gstEnabled: q.gstEnabled,\r\n            quotationNo: q.quotationNo,\r\n            terms: q.terms,\r\n            customerAddress: q.customerAddress,\r\n            customerGstin: q.customerGstin\r\n        };\r\n        const doc = await generateQuotationPDF(quoteData, {\r\n            ...settings,\r\n            vehicleNumber: 'N/A'\r\n        });\r\n        doc.save(`${q.quotationNo || 'quotation'}.pdf`);\r\n    };\r\n\r\n    const handleDownloadInvoice = async (trip: Trip) => {\r\n        const doc = await generateReceiptPDF(trip, {\r\n            ...settings,\r\n            vehicleNumber: settings.vehicles.find(v => v.id === settings.currentVehicleId)?.number || 'N/A'\r\n        });\r\n        doc.save(`${trip.invoiceNo || 'invoice'}.pdf`);\r\n    };\r\n\r\n    const handleShareQuotation = async (q: SavedQuotation) => {\r\n        const quoteData = {\r\n            customerName: q.customerName,\r\n            subject: q.subject,\r\n            date: q.date,\r\n            items: q.items,\r\n            gstEnabled: q.gstEnabled,\r\n            quotationNo: q.quotationNo,\r\n            terms: q.terms,\r\n            customerAddress: q.customerAddress,\r\n            customerGstin: q.customerGstin\r\n        };\r\n        await shareQuotation(quoteData, {\r\n            ...settings,\r\n            vehicleNumber: 'N/A', // Quotations are generic usually\r\n            userId: user?.id\r\n        });\r\n    };\r\n\r\n    const handleBulkDownload = async () => {\r\n        if (type !== 'invoice') return;\r\n        \r\n        // Sort items by Invoice Number for the report\r\n        const itemsToPrint = [...filteredItems] as Trip[];\r\n        itemsToPrint.sort((a, b) => {\r\n             const aNum = a.invoiceNo || '';\r\n             const bNum = b.invoiceNo || '';\r\n             return aNum.localeCompare(bNum, undefined, { numeric: true, sensitivity: 'base' });\r\n        });\r\n\r\n        if (itemsToPrint.length === 0) {\r\n            alert('No invoices to download for this month.');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const doc = await generateBulkReceiptsPDF(itemsToPrint, {\r\n                ...settings,\r\n                vehicleNumber: settings.vehicles.find(v => v.id === settings.currentVehicleId)?.number || 'N/A'\r\n            });\r\n            const monthStr = format(selectedMonth, 'MMM-yyyy');\r\n            doc.save(`${monthStr}-Invoices.pdf`);\r\n        } catch (error) {\r\n            console.error('Bulk download failed:', error);\r\n            alert('Failed to generate monthly report.');\r\n        }\r\n    };\r\n\r\n    // Ad Removal\r\n    const { triggerAction } = useAdProtection();\r\n\r\n\r\n    return (\r\n        <div className=\"space-y-3 pt-2 pb-24\">\r\n            <React.Suspense fallback={null}>\r\n            </React.Suspense>\r\n\r\n\r\n            <PDFPreviewModal\r\n                isOpen={showPreview}\r\n                onClose={() => setShowPreview(false)}\r\n                pdfUrl={previewPdfUrl}\r\n                title={type === 'invoice' ? \"Invoice Preview\" : \"Quotation Preview\"}\r\n            />\r\n\r\n            {/* Filter & Summary Section */}\r\n            <div className=\"flex flex-col gap-1.5 sticky top-[-16px] md:top-[-32px] z-20 bg-[#F5F7FA]/95 backdrop-blur-md -mx-3 px-3 py-1.5 mb-2 border-b border-slate-200/50 shadow-sm\">\r\n                <div className=\"flex flex-col gap-2\">\r\n                    <div className=\"flex justify-between items-center px-0.5\">\r\n                        <h3 className={`text-[10px] font-black uppercase tracking-widest relative inline-block ${type === 'invoice' ? 'text-slate-800' : 'text-slate-800'}`}>\r\n                            {filter === 'month' ? format(selectedMonth, 'MMMM yyyy') : `Recent ${type === 'invoice' ? 'Invoices' : 'Quotations'}`}\r\n                            <span className={`absolute -bottom-1 left-0 w-6 h-0.5 rounded-full ${type === 'invoice' ? 'bg-blue-600' : 'bg-[#6366F1]'}`}></span>\r\n                        </h3>\r\n                        <div className=\"flex bg-slate-100/50 rounded-lg p-0.5 border border-slate-200/50\">\r\n                            {(['all', 'today', 'week', 'month'] as const).map((f) => (\r\n                                <button\r\n                                    key={f}\r\n                                    onClick={() => setFilter(f)}\r\n                                    className={`px-2 py-0.5 rounded-md text-[8px] font-black uppercase transition-all ${filter === f ? 'bg-white text-blue-600 shadow-sm ring-1 ring-slate-100' : 'text-slate-400 hover:text-slate-600'}`}\r\n                                >\r\n                                    {f}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Month Navigator & Actions */}\r\n                    {filter === 'month' && (\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <div className=\"flex-1 flex items-center justify-between bg-white rounded-lg p-1 border border-slate-200 shadow-sm\">\r\n                                <button\r\n                                    onClick={() => setSelectedMonth((prev: Date) => subMonths(prev, 1))}\r\n                                    className=\"p-1 hover:bg-slate-50 rounded-md text-slate-400 hover:text-slate-600 transition-colors\"\r\n                                >\r\n                                    <ChevronLeft size={16} />\r\n                                </button>\r\n                                <div className=\"flex items-center gap-2 text-slate-600\">\r\n                                    <Calendar size={12} className=\"text-slate-400\" />\r\n                                    <span className=\"text-[10px] font-black uppercase tracking-widest\">\r\n                                        {format(selectedMonth, 'MMMM yyyy')}\r\n                                    </span>\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => setSelectedMonth((prev: Date) => addMonths(prev, 1))}\r\n                                    className=\"p-1 hover:bg-slate-50 rounded-md text-slate-400 hover:text-slate-600 transition-colors\"\r\n                                >\r\n                                    <ChevronRight size={16} />\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Download Button */}\r\n                            {type === 'invoice' && filteredItems.length > 0 && (\r\n                                <button\r\n                                    onClick={() => triggerAction(handleBulkDownload)}\r\n                                    className=\"p-1.5 bg-blue-600 text-white rounded-lg shadow-sm hover:bg-blue-700 transition-colors flex items-center justify-center\"\r\n                                    title=\"Download Monthly Report\"\r\n                                >\r\n                                    <Download size={16} />\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Total Summary Card - More Compact */}\r\n                <div className=\"bg-white border border-slate-200 rounded-xl p-2 flex justify-between items-center shadow-sm\">\r\n                    <div>\r\n                        <p className=\"text-[8px] font-black text-slate-400 uppercase tracking-widest mb-0.5 line-clamp-1\">Total Volume</p>\r\n                        <h2 className=\"text-base font-black tracking-tight text-slate-900 leading-none\">{Math.round(totalAmount).toLocaleString('en-IN')}</h2>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                        <span className=\"text-[8px] bg-blue-50 text-blue-700 px-2 py-0.5 rounded-md font-black uppercase tracking-wider border border-blue-100\">{filteredItems.length} {type === 'invoice' ? 'Invoices' : 'Quotes'}</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {\r\n                filteredItems.length === 0 ? (\r\n                    <div className=\"bg-white border border-slate-200 border-dashed rounded-2xl py-12 flex flex-col items-center justify-center text-center\">\r\n                        <FileText className=\"text-slate-200 mb-3\" size={32} />\r\n                        <p className=\"text-[11px] font-bold text-slate-400 uppercase tracking-wide\">\r\n                            No {type === 'invoice' ? 'invoices' : 'quotations'} found for {filter === 'month' ? format(selectedMonth, 'MMM yyyy') : filter}\r\n                        </p>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"space-y-3\">\r\n                        {filteredItems.map((item: any) => (\r\n                            <div key={item.id} className=\"bg-white border border-slate-200 rounded-xl shadow-sm relative overflow-hidden group hover:shadow-md transition-all mx-1 mb-2\">\r\n                                <div className={`absolute left-0 top-0 bottom-0 w-1 ${type === 'invoice' ? (item.mode === 'outstation' ? 'bg-purple-500' : 'bg-blue-600') : 'bg-indigo-600'}`}></div>\r\n\r\n                                <div className=\"p-2.5 pl-3.5\">\r\n                                    {/* Top Row: Invoice No & Date */}\r\n                                    <div className=\"flex justify-between items-center mb-1\">\r\n                                        <span className=\"text-[9px] font-black text-slate-500 uppercase tracking-widest bg-slate-50 px-1.5 py-0.5 rounded border border-slate-100\">\r\n                                            {(type === 'invoice' ? (item.invoiceNo || 'INV-000') : (item.quotationNo || 'QTN-000'))}\r\n                                        </span>\r\n                                        <span className=\"text-[9px] font-bold text-slate-400\">{formatDate(item.date)}</span>\r\n                                    </div>\r\n\r\n                                    {/* Main Content: Customer & Amount */}\r\n                                    <div className=\"flex justify-between items-center mb-1.5\">\r\n                                        <h4 className=\"text-sm font-black text-slate-800 uppercase tracking-tight truncate leading-none\">{item.customerName || 'Guest User'}</h4>\r\n                                        <p className=\"text-base font-black text-slate-900 tracking-tight tabular-nums leading-none\">\r\n                                            {Math.round(type === 'invoice' ? item.totalFare : (item.items || []).reduce((s: number, i: any) => s + (parseFloat(i.amount) || 0), 0) * (item.gstEnabled ? 1.05 : 1)).toLocaleString('en-IN')}\r\n                                        </p>\r\n                                    </div>\r\n\r\n                                    {/* Route Details */}\r\n                                    <div className=\"flex items-center gap-2 mb-2\">\r\n                                        <span className={`inline-flex items-center px-1 py-px rounded-[4px] text-[8px] font-black uppercase tracking-wider border ${type === 'invoice' ? 'bg-blue-50 text-blue-700 border-blue-100' : 'bg-indigo-50 text-indigo-700 border-indigo-100'}`}>\r\n                                            {type === 'invoice' ? (item.mode || 'TRIP') : 'QUOTE'}\r\n                                        </span>\r\n                                        <span className=\"text-[10px] font-bold text-slate-500 truncate max-w-[200px]\">\r\n                                            {type === 'invoice' ? `${item.from}${item.to ? `  ${item.to}` : ''}` : item.subject}\r\n                                        </span>\r\n                                    </div>\r\n\r\n                                    {/* Footer Actions - Compact */}\r\n                                    <div className=\"flex items-center justify-between pt-1.5 border-t border-slate-100\">\r\n                                        <div className=\"flex gap-4\">\r\n                                            <button\r\n                                                onClick={() => triggerAction(() => type === 'invoice' ? handlePreviewInvoice(item) : handlePreviewQuotation(item))}\r\n                                                className=\"flex items-center gap-1 text-[9px] font-bold text-slate-400 hover:text-blue-600 transition-colors uppercase tracking-wide\"\r\n                                            >\r\n                                                <Eye size={12} strokeWidth={2.5} />\r\n                                                <span>View</span>\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={() => triggerAction(() => type === 'invoice' ? handleDownloadInvoice(item) : handleDownloadQuotation(item))}\r\n                                                className=\"flex items-center gap-1 text-[9px] font-bold text-slate-400 hover:text-blue-600 transition-colors uppercase tracking-wide\"\r\n                                            >\r\n                                                <Download size={12} strokeWidth={2.5} />\r\n                                                <span>PDF</span>\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={() => triggerAction(() => type === 'invoice' ? shareReceipt(item, { ...settings, vehicleNumber: settings.vehicles.find(v => v.id === settings.currentVehicleId)?.number || 'N/A', userId: user?.id }) : handleShareQuotation(item))}\r\n                                                className=\"flex items-center gap-1 text-[9px] font-bold text-slate-400 hover:text-green-600 transition-colors uppercase tracking-wide\"\r\n                                            >\r\n                                                <Share2 size={12} strokeWidth={2.5} />\r\n                                                <span>Share</span>\r\n                                            </button>\r\n                                        </div>\r\n                                        \r\n                                        {(type === 'invoice' ? onDeleteTrip : onDeleteQuotation) && (\r\n                                            <button\r\n                                                onClick={() => type === 'invoice' ? onDeleteTrip!(item.id) : onDeleteQuotation!(item.id)}\r\n                                                className=\"p-1 rounded text-slate-300 hover:bg-red-50 hover:text-red-500 transition-colors\"\r\n                                            >\r\n                                                <Trash2 size={12} strokeWidth={2.5} />\r\n                                            </button>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )\r\n            }\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default History;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\InterstitialAd.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\websites\\cab driver\\src\\components\\InterstitialAd.tsx:17:13\n  15 |         if (isOpen) {\n  16 |             // eslint-disable-next-line\n> 17 |             setTimeLeft(5);\n     |             ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  18 |             setCanSkip(false);\n  19 |             const timer = setInterval(() => {\n  20 |                 setTimeLeft((prev) => {","line":17,"column":13,"nodeType":null,"endLine":17,"endColumn":24,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\Login.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\MapPicker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":63,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":102,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":102,"endColumn":25},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'dropMarker' and 'pickupMarker'. Either include them or remove the dependency array.","line":298,"column":8,"nodeType":"ArrayExpression","endLine":298,"endColumn":49,"suggestions":[{"desc":"Update the dependencies array to be: [map, mode, pickupLocation, dropLocation, pickupMarker, dropMarker]","fix":{"range":[11252,11293],"text":"[map, mode, pickupLocation, dropLocation, pickupMarker, dropMarker]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useRef, useState } from 'react';\r\nimport { loadGoogleMaps, getCurrentLocation } from '../utils/googleMaps';\r\nimport { calculateAdvancedRoute } from '../utils/routesApi';\r\nimport { MapPin, X, Search, Locate } from 'lucide-react';\r\n\r\ninterface MapPickerProps {\r\n    onLocationSelect: (\r\n        pickup: string,\r\n        drop: string,\r\n        distance: number,\r\n        toll?: number,\r\n        pickupLat?: number,\r\n        pickupLng?: number,\r\n        dropLat?: number,\r\n        dropLng?: number\r\n    ) => void;\r\n    onClose: () => void;\r\n}\r\n\r\nconst MapPicker: React.FC<MapPickerProps> = ({ onLocationSelect, onClose }) => {\r\n    const mapRef = useRef<HTMLDivElement>(null);\r\n    const searchInputRef = useRef<HTMLInputElement>(null);\r\n    const [isDragging, setIsDragging] = useState(false);\r\n    const [map, setMap] = useState<google.maps.Map | null>(null);\r\n    const [pickupMarker, setPickupMarker] = useState<google.maps.Marker | null>(null);\r\n    const [dropMarker, setDropMarker] = useState<google.maps.Marker | null>(null);\r\n    const [directionsRenderer, setDirectionsRenderer] = useState<google.maps.DirectionsRenderer | null>(null);\r\n    const [pickupLocation, setPickupLocation] = useState<{ lat: number; lng: number; address: string } | null>(null);\r\n    const [dropLocation, setDropLocation] = useState<{ lat: number; lng: number; address: string } | null>(null);\r\n    const [distance, setDistance] = useState<number>(0);\r\n    const [tollEstimate, setTollEstimate] = useState<number>(0);\r\n    const [mode, setMode] = useState<'pickup' | 'drop'>('pickup');\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<string>('');\r\n\r\n    // Initialize map\r\n    useEffect(() => {\r\n        let isMounted = true;\r\n\r\n        const initMap = async () => {\r\n            // Check if mapRef is available before proceeding\r\n            if (!mapRef.current) {\r\n                // Try again after a short delay\r\n                setTimeout(() => {\r\n                    if (isMounted && mapRef.current) {\r\n                        initMap();\r\n                    }\r\n                }, 100);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                const google = await loadGoogleMaps();\r\n\r\n                if (!isMounted) return;\r\n\r\n                if (!mapRef.current) return;\r\n\r\n                // Get current location or default to India center\r\n                let center = { lat: 20.5937, lng: 78.9629 }; // India center\r\n                try {\r\n                    center = await getCurrentLocation();\r\n                } catch (e) {\r\n                    // Ignore error and use default\r\n                }\r\n\r\n                const mapInstance = new google.maps.Map(mapRef.current, {\r\n                    center,\r\n                    zoom: 14,\r\n                    mapTypeId: 'roadmap',\r\n                    mapTypeControl: false,\r\n                    streetViewControl: false,\r\n                    fullscreenControl: false,\r\n                    zoomControl: false,\r\n                    clickableIcons: false,\r\n                    gestureHandling: 'greedy',\r\n                });\r\n\r\n                // Add a small delay and force a resize trigger\r\n                setTimeout(() => {\r\n                    google.maps.event.trigger(mapInstance, 'resize');\r\n                }, 500);\r\n\r\n                if (!isMounted) return;\r\n                setMap(mapInstance);\r\n\r\n                // Initialize directions renderer\r\n                const renderer = new google.maps.DirectionsRenderer({\r\n                    map: mapInstance,\r\n                    suppressMarkers: true,\r\n                    polylineOptions: {\r\n                        strokeColor: '#0047AB',\r\n                        strokeWeight: 4,\r\n                    },\r\n                });\r\n\r\n                if (!isMounted) return;\r\n                setDirectionsRenderer(renderer);\r\n\r\n                if (!isMounted) return;\r\n                setLoading(false);\r\n            } catch (err) {\r\n                if (!isMounted) return;\r\n                setError('Failed to load Google Maps. Please check your API key.');\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        initMap();\r\n\r\n        return () => {\r\n            isMounted = false;\r\n        };\r\n    }, []);\r\n\r\n\r\n    const [inputValue, setInputValue] = useState('');\r\n    const [predictions, setPredictions] = useState<google.maps.places.AutocompletePrediction[]>([]);\r\n    const [showPredictions, setShowPredictions] = useState(false);\r\n\r\n    // Initialize Autocomplete Service Logic (Replacing Deprecated Widget)\r\n    const handleSearchInput = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const val = e.target.value;\r\n        setInputValue(val);\r\n\r\n        if (!val || val.length < 3) {\r\n            setPredictions([]);\r\n            setShowPredictions(false);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const google = await loadGoogleMaps();\r\n            const service = new google.maps.places.AutocompleteService();\r\n            const request: google.maps.places.AutocompletionRequest = {\r\n                input: val,\r\n                componentRestrictions: { country: 'in' },\r\n            };\r\n\r\n            // Bias towards map view if available\r\n            if (map) {\r\n                const bounds = map.getBounds();\r\n                if (bounds) {\r\n                    request.bounds = bounds;\r\n                }\r\n            }\r\n\r\n            service.getPlacePredictions(request, (results, status) => {\r\n                if (status === google.maps.places.PlacesServiceStatus.OK && results) {\r\n                    setPredictions(results);\r\n                    setShowPredictions(true);\r\n                } else {\r\n                    setPredictions([]);\r\n                    setShowPredictions(false);\r\n                }\r\n            });\r\n        } catch (error) {\r\n            console.error('Error fetching predictions:', error);\r\n        }\r\n    };\r\n\r\n    const handlePredictionSelect = async (placeId: string, description: string) => {\r\n        setInputValue(description);\r\n        setShowPredictions(false);\r\n        setPredictions([]);\r\n\r\n        try {\r\n            const google = await loadGoogleMaps();\r\n            const geocoder = new google.maps.Geocoder();\r\n\r\n            geocoder.geocode({ placeId: placeId }, (results, status) => {\r\n                if (status === 'OK' && results && results[0]) {\r\n                    const place = results[0];\r\n                    if (!place.geometry || !place.geometry.location) return;\r\n\r\n                    if (place.geometry.viewport && map) {\r\n                        map.fitBounds(place.geometry.viewport);\r\n                    } else if (map) {\r\n                        map.setCenter(place.geometry.location);\r\n                        map.setZoom(17);\r\n                    }\r\n                }\r\n            });\r\n        } catch (error) {\r\n            console.error('Error geocoding place:', error);\r\n        }\r\n    };\r\n\r\n    // Handle Map Events (Center Pin Logic)\r\n    useEffect(() => {\r\n        if (!map) return;\r\n\r\n        const handleCenterChanged = () => {\r\n            setIsDragging(true);\r\n            // Clear current selection state while dragging to indicate liveness? \r\n            // Better to keep previous until settled to avoid flickering text.\r\n        };\r\n\r\n        const handleIdle = async () => {\r\n            setIsDragging(false);\r\n            const center = map.getCenter();\r\n            if (!center) return;\r\n\r\n            const lat = center.lat();\r\n            const lng = center.lng();\r\n\r\n            // Reverse geocode\r\n            try {\r\n                const google = await loadGoogleMaps();\r\n                const geocoder = new google.maps.Geocoder();\r\n\r\n                geocoder.geocode({ location: { lat, lng } }, (results, status) => {\r\n                    if (status === 'OK' && results && results[0]) {\r\n                        const address = results[0].formatted_address;\r\n                        const locationData = { lat, lng, address };\r\n\r\n                        if (mode === 'pickup') {\r\n                            setPickupLocation(locationData);\r\n                        } else {\r\n                            setDropLocation(locationData);\r\n                        }\r\n                    }\r\n                });\r\n            } catch (err) {\r\n                console.error('Geocoding error:', err);\r\n            }\r\n        };\r\n\r\n        const centerChangedListener = map.addListener('center_changed', handleCenterChanged);\r\n        const idleListener = map.addListener('idle', handleIdle);\r\n\r\n        return () => {\r\n            google.maps.event.removeListener(centerChangedListener);\r\n            google.maps.event.removeListener(idleListener);\r\n        };\r\n    }, [map, mode]);\r\n\r\n    // Manage Markers (Only show static markers for inactive modes)\r\n    useEffect(() => {\r\n        if (!map) return;\r\n\r\n        const updateMarkers = async () => {\r\n            const google = await loadGoogleMaps();\r\n\r\n            // Handle Pickup Marker\r\n            if (pickupLocation && mode === 'drop') {\r\n                if (!pickupMarker) {\r\n                    const marker = new google.maps.Marker({\r\n                        position: pickupLocation,\r\n                        map,\r\n                        icon: {\r\n                            path: google.maps.SymbolPath.CIRCLE,\r\n                            scale: 8,\r\n                            fillColor: '#00965E',\r\n                            fillOpacity: 1,\r\n                            strokeColor: '#ffffff',\r\n                            strokeWeight: 2,\r\n                        },\r\n                    });\r\n                    setPickupMarker(marker);\r\n                } else {\r\n                    pickupMarker.setPosition(pickupLocation);\r\n                    pickupMarker.setMap(map);\r\n                }\r\n            } else {\r\n                // If in pickup mode, hide the static marker (we use center pin)\r\n                if (pickupMarker) pickupMarker.setMap(null);\r\n            }\r\n\r\n            // Handle Drop Marker\r\n            // We usually don't need a static drop marker until confirmation, \r\n            // but if we were to switch back to pickup, we might want to see where drop was LEFT.\r\n            if (dropLocation && mode === 'pickup') {\r\n                if (!dropMarker) {\r\n                    const marker = new google.maps.Marker({\r\n                        position: dropLocation,\r\n                        map,\r\n                        icon: {\r\n                            path: google.maps.SymbolPath.CIRCLE,\r\n                            scale: 8,\r\n                            fillColor: '#DC2626',\r\n                            fillOpacity: 1,\r\n                            strokeColor: '#ffffff',\r\n                            strokeWeight: 2,\r\n                        },\r\n                    });\r\n                    setDropMarker(marker);\r\n                } else {\r\n                    dropMarker.setPosition(dropLocation);\r\n                    dropMarker.setMap(map);\r\n                }\r\n            } else {\r\n                if (dropMarker) dropMarker.setMap(null);\r\n            }\r\n        };\r\n\r\n        updateMarkers();\r\n    }, [map, mode, pickupLocation, dropLocation]);\r\n\r\n    const handleMyLocation = async () => {\r\n        if (!map) return;\r\n        try {\r\n            const location = await getCurrentLocation();\r\n            map.setCenter(location);\r\n            map.setZoom(17);\r\n        } catch (e) {\r\n            console.error('Error getting location', e);\r\n        }\r\n    };\r\n\r\n    // Calculate distance and TOLLS when both locations are set\r\n    useEffect(() => {\r\n        if (pickupLocation && dropLocation && directionsRenderer) {\r\n            const timer = setTimeout(async () => {\r\n                try {\r\n                    // 1. Load Google Maps\r\n                    const google = await loadGoogleMaps();\r\n                    const directionsService = new google.maps.DirectionsService();\r\n\r\n                    // 2. Call Standard Directions API (Visualize Route + Get Basic Distance)\r\n                    directionsService.route(\r\n                        {\r\n                            origin: { lat: pickupLocation.lat, lng: pickupLocation.lng },\r\n                            destination: { lat: dropLocation.lat, lng: dropLocation.lng },\r\n                            travelMode: google.maps.TravelMode.DRIVING,\r\n                        },\r\n                        async (result: google.maps.DirectionsResult | null, status: google.maps.DirectionsStatus) => {\r\n                            if (status === 'OK' && result) {\r\n                                // Draw Route\r\n                                directionsRenderer.setDirections(result);\r\n\r\n                                // Extract Distance from Directions API (No need for extra DistanceMatrix call)\r\n                                if (result.routes[0]?.legs[0]) {\r\n                                    const leg = result.routes[0].legs[0];\r\n                                    if (leg.distance?.value) {\r\n                                        setDistance(Math.round(leg.distance.value / 1000));\r\n                                    }\r\n                                }\r\n\r\n                                // 3. Call Advanced Routes API (Tolls) - Only if Directions succeeded\r\n                                // This is the expensive \"Compute Routes\" call.\r\n                                const advancedRes = await calculateAdvancedRoute(\r\n                                    { lat: pickupLocation.lat, lng: pickupLocation.lng },\r\n                                    { lat: dropLocation.lat, lng: dropLocation.lng }\r\n                                );\r\n\r\n                                if (advancedRes) {\r\n                                    // Prefer the precise distance from Routes API if available, else stick to Directions API\r\n                                    // setDistance(advancedRes.distanceKm); \r\n                                    setTollEstimate(advancedRes.tollPrice);\r\n                                }\r\n                            }\r\n                        }\r\n                    );\r\n                } catch (err) {\r\n                    console.error('Error calculating route:', err);\r\n                }\r\n            }, 1000); // Debounce by 1 second to prevent API spam while dragging\r\n\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [pickupLocation, dropLocation, directionsRenderer]);\r\n\r\n    const handleConfirm = () => {\r\n        if (pickupLocation && dropLocation) {\r\n            onLocationSelect(\r\n                pickupLocation.address,\r\n                dropLocation.address,\r\n                distance,\r\n                tollEstimate,\r\n                pickupLocation.lat,\r\n                pickupLocation.lng,\r\n                dropLocation.lat,\r\n                dropLocation.lng\r\n            );\r\n            onClose();\r\n        }\r\n    };\r\n\r\n    if (error) {\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\r\n                <div className=\"bg-white rounded-2xl p-6 max-w-md\">\r\n                    <h3 className=\"text-lg font-black text-red-600 mb-2\">Error</h3>\r\n                    <p className=\"text-sm text-slate-600 mb-4\">{error}</p>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"w-full bg-slate-900 text-white py-3 rounded-xl font-bold\"\r\n                    >\r\n                        Close\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex flex-col\">\r\n            {/* Loading Overlay */}\r\n            {loading && (\r\n                <div className=\"absolute inset-0 bg-white z-[60] flex items-center justify-center\">\r\n                    <div className=\"text-center\">\r\n                        <div className=\"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-3\"></div>\r\n                        <p className=\"text-sm font-bold text-slate-600\">Loading Map...</p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n            {/* Header */}\r\n            <div className=\"bg-white border-b border-slate-200 px-3 py-2.5 flex items-center justify-between shrink-0 z-20 shadow-sm\">\r\n                <div>\r\n                    <h3 className=\"text-sm font-black text-slate-900 uppercase tracking-tight\">Select Location</h3>\r\n                    <p className=\"text-[10px] text-slate-500 font-bold mt-0.5 flex items-center gap-1\">\r\n                        {mode === 'pickup' ? <span className=\"text-green-600\">Drag for Pickup</span> : <span className=\"text-red-600\">Drag for Drop</span>}\r\n                    </p>\r\n                </div>\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"w-8 h-8 flex items-center justify-center bg-slate-100 rounded-full hover:bg-slate-200 active:scale-95 transition-all\"\r\n                >\r\n                    <X size={16} />\r\n                </button>\r\n            </div>\r\n\r\n            {/* Map Container with Overlays */}\r\n            <div className=\"flex-1 relative\">\r\n                {/* Search Bar */}\r\n                <div className=\"absolute top-3 left-3 right-3 z-10 w-auto\">\r\n                    <div className=\"bg-white rounded-xl shadow-lg flex items-center p-2.5 animate-in fade-in slide-in-from-top-4 duration-300\">\r\n                        <Search className=\"text-slate-400 w-4 h-4 mr-2\" />\r\n                        <input\r\n                            ref={searchInputRef}\r\n                            type=\"text\"\r\n                            value={inputValue}\r\n                            onChange={handleSearchInput}\r\n                            placeholder=\"Search places...\"\r\n                            className=\"flex-1 outline-none text-slate-700 placeholder:text-slate-400 text-xs font-bold bg-transparent\"\r\n                        />\r\n                    </div>\r\n                    {/* Predictions Dropdown */}\r\n                    {showPredictions && predictions.length > 0 && (\r\n                        <div className=\"bg-white mt-1 rounded-xl shadow-xl border border-slate-100 max-h-60 overflow-y-auto\">\r\n                            {predictions.map((prediction) => (\r\n                                <button\r\n                                    key={prediction.place_id}\r\n                                    onClick={() => handlePredictionSelect(prediction.place_id, prediction.description)}\r\n                                    className=\"w-full text-left px-4 py-3 hover:bg-slate-50 border-b border-slate-50 last:border-0 transition-colors\"\r\n                                >\r\n                                    <p className=\"text-xs font-bold text-slate-700\">{prediction.structured_formatting.main_text}</p>\r\n                                    <p className=\"text-[10px] text-slate-500 font-medium\">{prediction.structured_formatting.secondary_text}</p>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Map Div */}\r\n                <div ref={mapRef} className=\"absolute inset-0 w-full h-full\" />\r\n\r\n                {/* Center Pin Overlay */}\r\n                <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none z-20 -mt-[35px]\">\r\n                    <div className={`relative flex flex-col items-center transition-transform duration-200 ${isDragging ? '-translate-y-2' : ''}`}>\r\n                        {/* Floating Label */}\r\n                        <div className={`mb-1 px-3 py-1.5 rounded-full shadow-md text-xs font-bold text-white whitespace-nowrap\r\n                           ${mode === 'pickup' ? 'bg-green-600' : 'bg-red-600'}`}>\r\n                            {isDragging ? 'Moving...' : (mode === 'pickup' ? 'Set Pickup' : 'Set Drop')}\r\n                        </div>\r\n                        {/* Pin Icon */}\r\n                        <MapPin\r\n                            size={40}\r\n                            className={`drop-shadow-xl ${mode === 'pickup' ? 'text-green-600 fill-green-600' : 'text-red-600 fill-red-600'}`}\r\n                        />\r\n                        {/* Pin Shadow Dot */}\r\n                        <div className=\"w-1.5 h-1.5 bg-black/20 rounded-full mt-[-2px] blur-[1px]\"></div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* My Location Button */}\r\n                <button\r\n                    onClick={handleMyLocation}\r\n                    className=\"absolute bottom-4 right-4 bg-white p-3 rounded-full shadow-lg hover:bg-slate-50 active:scale-95 transition-all z-10\"\r\n                >\r\n                    <Locate size={24} className=\"text-slate-700\" />\r\n                </button>\r\n            </div>\r\n\r\n            {/* Location Info */}\r\n            <div className=\"bg-white border-t border-slate-200 p-3 space-y-2.5 shrink-0 z-30 shadow-[0_-5px_20px_-5px_rgba(0,0,0,0.1)]\">\r\n                {pickupLocation && (\r\n                    <div className=\"flex items-start gap-2.5 p-2 bg-green-50 rounded-xl border border-green-200 shadow-sm\">\r\n                        <div className=\"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5\">\r\n                            <MapPin size={12} className=\"text-white\" />\r\n                        </div>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                            <p className=\"text-[9px] font-black text-green-700 uppercase tracking-wide leading-none mb-0.5\">Pickup</p>\r\n                            <p className=\"text-xs font-bold text-slate-700 truncate leading-tight\">{pickupLocation.address}</p>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {dropLocation && (\r\n                    <div className=\"flex items-start gap-2.5 p-2 bg-red-50 rounded-xl border border-red-200 shadow-sm\">\r\n                        <div className=\"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5\">\r\n                            <MapPin size={12} className=\"text-white\" />\r\n                        </div>\r\n                        <div className=\"flex-1 min-w-0\">\r\n                            <p className=\"text-[9px] font-black text-red-700 uppercase tracking-wide leading-none mb-0.5\">Drop</p>\r\n                            <p className=\"text-xs font-bold text-slate-700 truncate leading-tight\">{dropLocation.address}</p>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {(distance > 0 || tollEstimate > 0) && (\r\n                    <div className=\"flex gap-2\">\r\n                        {distance > 0 && (\r\n                            <div className=\"flex-1 flex items-center justify-between p-2 bg-blue-50 rounded-lg border border-blue-200\">\r\n                                <span className=\"text-[9px] font-black text-blue-900 uppercase tracking-wide\">Distance</span>\r\n                                <span className=\"text-xs font-black text-blue-700\">{distance} KM</span>\r\n                            </div>\r\n                        )}\r\n                        {tollEstimate > 0 && (\r\n                            <div className=\"flex-1 flex items-center justify-between p-2 bg-orange-50 rounded-lg border border-orange-200\">\r\n                                <span className=\"text-[9px] font-black text-orange-900 uppercase tracking-wide\">Est. Toll</span>\r\n                                <span className=\"text-xs font-black text-orange-700\">{tollEstimate}</span>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Action Buttons */}\r\n                <div className=\"flex gap-2 pt-1\">\r\n                    <button\r\n                        onClick={() => setMode(mode === 'pickup' ? 'drop' : 'pickup')}\r\n                        className=\"flex-1 bg-slate-100 hover:bg-slate-200 text-slate-600 h-10 rounded-xl font-black text-[10px] uppercase tracking-wider\"\r\n                    >\r\n                        Switch to {mode === 'pickup' ? 'Drop' : 'Pickup'}\r\n                    </button>\r\n                    <button\r\n                        onClick={handleConfirm}\r\n                        disabled={!pickupLocation || !dropLocation}\r\n                        className=\"flex-1 bg-[#0047AB] text-white h-10 rounded-xl font-black text-[10px] uppercase tracking-wider disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-blue-200\"\r\n                    >\r\n                        Confirm ({distance} KM)\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default MapPicker;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\MobileMenuContainer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\Notifications.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\PDFPreviewModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\PlacesAutocomplete.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'inputValue'. Either include it or remove the dependency array.","line":46,"column":8,"nodeType":"ArrayExpression","endLine":46,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [inputValue, value]","fix":{"range":[1565,1572],"text":"[inputValue, value]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useRef, useState } from 'react';\r\nimport { loadGoogleMaps } from '../utils/googleMaps';\r\nimport { Map, Loader2, MapPin, X } from 'lucide-react';\r\n\r\ninterface PlacesAutocompleteProps {\r\n    id?: string;\r\n    value: string;\r\n    onChange: (value: string) => void;\r\n    onPlaceSelected?: (place: { address: string; lat: number; lng: number }) => void;\r\n    onMapClick?: () => void;\r\n    placeholder?: string;\r\n    className?: string;\r\n    label?: string;\r\n    icon?: React.ReactNode;\r\n    rightContent?: React.ReactNode;\r\n    onBlur?: () => void;\r\n}\r\n\r\nconst PlacesAutocomplete: React.FC<PlacesAutocompleteProps> = ({\r\n    id,\r\n    value,\r\n    onChange,\r\n    onPlaceSelected,\r\n    onMapClick,\r\n    placeholder,\r\n    className,\r\n    label,\r\n    icon,\r\n    rightContent,\r\n    onBlur\r\n}) => {\r\n    const [inputValue, setInputValue] = useState(value);\r\n    const [predictions, setPredictions] = useState<google.maps.places.AutocompletePrediction[]>([]);\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [dropdownPosition, setDropdownPosition] = useState<'top' | 'bottom'>('bottom');\r\n    const wrapperRef = useRef<HTMLDivElement>(null);\r\n    const sessionTokenRef = useRef<google.maps.places.AutocompleteSessionToken | null>(null);\r\n    const placesServiceRef = useRef<google.maps.places.PlacesService | null>(null);\r\n\r\n    // Sync internal state with prop value\r\n    useEffect(() => {\r\n        if (value !== inputValue) {\r\n            setInputValue(value);\r\n        }\r\n    }, [value]);\r\n\r\n    // Close dropdown on click outside\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            if (wrapperRef.current && !wrapperRef.current.contains(event.target as Node)) {\r\n                setIsOpen(false);\r\n            }\r\n        };\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, []);\r\n\r\n    // Smart Positioning and Scroll Logic\r\n    const ensureVisibility = () => {\r\n        // 1. Scroll into view (delayed for keyboard animation)\r\n        // REMOVED auto-scroll on typing as it causes jumping and poor UX on mobile\r\n        // setTimeout(() => {\r\n        //     if (wrapperRef.current) {\r\n        //         wrapperRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n        //     }\r\n        // }, 300);\r\n\r\n        // 2. Decide Dropdown Position (Top vs Bottom)\r\n        if (wrapperRef.current) {\r\n            const rect = wrapperRef.current.getBoundingClientRect();\r\n            const spaceBelow = window.innerHeight - rect.bottom;\r\n            // If less than 200px (approx 3 items) below, and we have more space above, flip it\r\n            if (spaceBelow < 200 && rect.top > 200) {\r\n                setDropdownPosition('top');\r\n            } else {\r\n                setDropdownPosition('bottom');\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleFocus = () => {\r\n        if (inputValue && predictions.length > 0) {\r\n            setIsOpen(true);\r\n        }\r\n        ensureVisibility();\r\n        // Only scroll on explicit focus, not while typing\r\n        setTimeout(() => {\r\n            if (wrapperRef.current) {\r\n                wrapperRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n            }\r\n        }, 300);\r\n    };\r\n\r\n    const debounceTimerRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n    const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const val = e.target.value;\r\n        setInputValue(val);\r\n        onChange(val);\r\n\r\n        if (!val || val.length < 3) {\r\n            setPredictions([]);\r\n            setIsOpen(false);\r\n            return;\r\n        }\r\n\r\n        // Clear previous timer\r\n        if (debounceTimerRef.current) {\r\n            clearTimeout(debounceTimerRef.current);\r\n        }\r\n\r\n        // Set a new timer (Debounce for 500ms)\r\n        debounceTimerRef.current = setTimeout(async () => {\r\n            // Re-check visibility (positioning only) when typing creates new results\r\n            ensureVisibility();\r\n\r\n            setIsLoading(true);\r\n\r\n            try {\r\n                const google = await loadGoogleMaps();\r\n                if (!google) throw new Error(\"Google Maps SDK not available\");\r\n\r\n                // Initialize Session Token if needed\r\n                if (!sessionTokenRef.current) {\r\n                    sessionTokenRef.current = new google.maps.places.AutocompleteSessionToken();\r\n                }\r\n\r\n                const service = new google.maps.places.AutocompleteService();\r\n                const request: google.maps.places.AutocompletionRequest = {\r\n                    input: val,\r\n                    componentRestrictions: { country: 'in' },\r\n                    sessionToken: sessionTokenRef.current,\r\n                };\r\n\r\n                service.getPlacePredictions(request, (results, status) => {\r\n                    setIsLoading(false);\r\n                    if (status === google.maps.places.PlacesServiceStatus.OK && results) {\r\n                        setPredictions(results);\r\n                        setIsOpen(true);\r\n                        ensureVisibility();\r\n                    } else {\r\n                        setPredictions([]);\r\n                        setIsOpen(false);\r\n                    }\r\n                });\r\n            } catch (error) {\r\n                console.warn('[PlacesAutocomplete] API Error (Falling back to manual input):', error);\r\n                setIsLoading(false);\r\n                setPredictions([]);\r\n                setIsOpen(false);\r\n            }\r\n        }, 500); // 500ms debounce delay\r\n    };\r\n\r\n    const handlePlaceSelect = async (placeId: string, description: string) => {\r\n        setInputValue(description);\r\n        onChange(description);\r\n        setIsOpen(false);\r\n        setPredictions([]);\r\n\r\n        if (onPlaceSelected) {\r\n            try {\r\n                const google = await loadGoogleMaps();\r\n                if (!google) return;\r\n\r\n                // Use PlacesService to get details (concludes the billing session)\r\n                if (!placesServiceRef.current) {\r\n                    placesServiceRef.current = new google.maps.places.PlacesService(document.createElement('div'));\r\n                }\r\n\r\n                const request: google.maps.places.PlaceDetailsRequest = {\r\n                    placeId: placeId,\r\n                    fields: ['geometry', 'formatted_address'],\r\n                    sessionToken: sessionTokenRef.current || undefined\r\n                };\r\n\r\n                placesServiceRef.current.getDetails(request, (place, status) => {\r\n                    if (status === google.maps.places.PlacesServiceStatus.OK && place && place.geometry && place.geometry.location) {\r\n                        const lat = place.geometry.location.lat();\r\n                        const lng = place.geometry.location.lng();\r\n                        const formattedAddress = place.formatted_address || description;\r\n\r\n                        onPlaceSelected({\r\n                            address: formattedAddress,\r\n                            lat,\r\n                            lng\r\n                        });\r\n\r\n                        // Update input with full formatted address\r\n                        setInputValue(formattedAddress);\r\n                        onChange(formattedAddress);\r\n\r\n                        // Reset Session Token for next search\r\n                        sessionTokenRef.current = null;\r\n\r\n                    } else {\r\n                        console.error('Places Details fetch failed status:', status);\r\n                    }\r\n                });\r\n\r\n            } catch (error) {\r\n                console.error('Error fetching place details:', error);\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-1 w-full relative\" ref={wrapperRef}>\r\n            {/* ... label ... */}\r\n            {label && (\r\n                <label htmlFor={id} className=\"text-[9px] font-black text-slate-500 uppercase ml-1 flex items-center gap-1.5\">\r\n                    {icon} {label}\r\n                </label>\r\n            )}\r\n\r\n            <div className=\"relative group\">\r\n                {/* Removed duplicate internal MapPin icon */}\r\n\r\n\r\n                {onMapClick && (\r\n                    <button\r\n                        type=\"button\"\r\n                        onClick={onMapClick}\r\n                        className=\"absolute left-2 top-1/2 -translate-y-1/2 p-1 text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors z-10\"\r\n                        title=\"Select on map\"\r\n                    >\r\n                        <Map size={14} />\r\n                    </button>\r\n                )}\r\n\r\n                <input\r\n                    id={id}\r\n                    name={id}\r\n                    type=\"text\"\r\n                    value={inputValue}\r\n                    onChange={handleInputChange}\r\n                    onFocus={handleFocus}\r\n                    onBlur={onBlur}\r\n                    className={className || `tn-input h-9 w-full bg-slate-50 border-slate-200 text-xs font-bold ${onMapClick ? 'pl-9' : 'pl-3'} pr-8`}\r\n                    placeholder={placeholder || \"Start typing...\"}\r\n                    autoComplete=\"off\"\r\n                />\r\n\r\n                <div className=\"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1\">\r\n                    {isLoading && <Loader2 size={14} className=\"animate-spin text-slate-400\" />}\r\n                    {inputValue && (\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={() => {\r\n                                setInputValue('');\r\n                                onChange('');\r\n                                setPredictions([]);\r\n                                setIsOpen(false);\r\n                            }}\r\n                            className=\"p-1 hover:bg-slate-100 rounded-full transition-colors text-slate-400\"\r\n                        >\r\n                            <X size={14} />\r\n                        </button>\r\n                    )}\r\n                    {rightContent}\r\n                </div>\r\n\r\n                {/* Custom Dropdown */}\r\n                {isOpen && predictions.length > 0 && (\r\n                    <div className={`absolute left-0 right-0 z-50 bg-white rounded-xl shadow-xl border border-slate-100 max-h-60 overflow-y-auto ${dropdownPosition === 'top'\r\n                        ? 'bottom-full mb-1'\r\n                        : 'top-full mt-1'\r\n                        }`}>\r\n                        {predictions.map((prediction) => (\r\n                            <button\r\n                                key={prediction.place_id}\r\n                                type=\"button\"\r\n                                onClick={() => handlePlaceSelect(prediction.place_id, prediction.description)}\r\n                                className=\"w-full text-left px-3 py-2 hover:bg-blue-50 flex items-start gap-2.5 transition-colors border-b border-slate-50 last:border-0\"\r\n                            >\r\n                                <MapPin size={14} className=\"mt-0.5 text-slate-400 shrink-0\" />\r\n                                <div>\r\n                                    <p className=\"text-[11px] font-bold text-slate-700 leading-tight\">\r\n                                        {prediction.structured_formatting.main_text}\r\n                                    </p>\r\n                                    <p className=\"text-[9px] text-slate-400 font-bold leading-tight mt-0.5\">\r\n                                        {prediction.structured_formatting.secondary_text}\r\n                                    </p>\r\n                                </div>\r\n                            </button>\r\n                        ))}\r\n                        <div className=\"px-3 py-1 bg-slate-50 text-[9px] text-slate-400 text-right uppercase tracking-widest font-bold\">\r\n                            Powered by Google\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default PlacesAutocomplete;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\PricingModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\PrivacyPolicy.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\Profile.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'settings.driverPhone' and 'updateSettings'. Either include them or remove the dependency array.","line":63,"column":8,"nodeType":"ArrayExpression","endLine":63,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [settings.driverPhone, updateSettings, user.id]","fix":{"range":[2452,2462],"text":"[settings.driverPhone, updateSettings, user.id]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\PublicProfile.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":125,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":128,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1875,1878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1875,1878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\QRGenerator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\QuickNotes.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\websites\\cab driver\\src\\components\\QuickNotes.tsx:56:13\n  54 |         // External trigger to create new note\n  55 |         if (onCreateNew) {\n> 56 |             handleAddNote();\n     |             ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  57 |         }\n  58 |     }, [onCreateNew]);\n  59 |","line":56,"column":13,"nodeType":null,"endLine":56,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4456,4459],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4456,4459],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4743,4746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4743,4746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { safeJSONParse } from '../utils/storage';\r\nimport { Analytics } from '../utils/monitoring';\r\nimport { StickyNote, Plus, Trash2, X, Save, Mic } from 'lucide-react';\r\n\r\ninterface Note {\r\n    id: string;\r\n    content: string;\r\n    createdAt: string;\r\n    color?: string; // Future proofing for Keep-like colors\r\n}\r\n\r\ninterface QuickNotesProps {\r\n    onCreateNew?: number; // Timestamp to trigger creation\r\n}\r\n\r\nconst QuickNotes: React.FC<QuickNotesProps> = ({ onCreateNew }) => {\r\n    const [notes, setNotes] = useState<Note[]>(() => {\r\n        const saved = safeJSONParse<Note[]>('driver-quick-notes', []);\r\n        if (saved.length === 0) {\r\n            // Default Welcome Notes\r\n            return [\r\n                {\r\n                    id: 'example-1',\r\n                    content: \"Trip Log Example:\\n\\nStart KM: 45,000\\nEnd KM: 45,250\\nTotal Run: 250 KM\\n\\nFuel: 2000 (35L)\",\r\n                    createdAt: new Date().toISOString()\r\n                },\r\n                {\r\n                    id: 'example-2',\r\n                    content: \"Pending Payments:\\n\\n- Saravana: 500 (GPay)\\n- Airport Trip: 1200 (Cash Pending)\",\r\n                    createdAt: new Date(Date.now() - 86400000).toISOString() // Yesterday\r\n                }\r\n            ];\r\n        }\r\n        return saved;\r\n    });\r\n\r\n    const [selectedNote, setSelectedNote] = useState<Note | null>(null);\r\n    const [isEditing, setIsEditing] = useState(false);\r\n    const [isRecording, setIsRecording] = useState(false);\r\n\r\n    // Handle \"Add Note\" - Opens Modal immediately\r\n    const handleAddNote = () => {\r\n        const newNote: Note = {\r\n            id: Date.now().toString(),\r\n            content: '',\r\n            createdAt: new Date().toISOString()\r\n        };\r\n        setSelectedNote(newNote);\r\n        setIsEditing(true);\r\n    };\r\n\r\n    useEffect(() => {\r\n        // External trigger to create new note\r\n        if (onCreateNew) {\r\n            handleAddNote();\r\n        }\r\n    }, [onCreateNew]);\r\n\r\n    useEffect(() => {\r\n        localStorage.setItem('driver-quick-notes', JSON.stringify(notes));\r\n    }, [notes]);\r\n\r\n    // Handle \"Edit Note\" - Opens Modal with existing content\r\n    const handleNoteClick = (note: Note) => {\r\n        setSelectedNote({ ...note }); // Create a copy to edit\r\n        setIsEditing(true);\r\n    };\r\n\r\n    // Save changes from Modal\r\n    const handleSave = async () => {\r\n        if (!selectedNote) return;\r\n\r\n        // If it's empty, maybe warn or delete? For now, we save even if empty like Keep, or delete if totally empty.\r\n        if (!selectedNote.content.trim()) {\r\n            // If it's a new note (not in list) and empty, simply discard.\r\n            // If it's existing and empty, we can choose to delete or keep empty.\r\n            // Let's discard if completely empty to keep it clean.\r\n            if (isEditing && !notes.find(n => n.id === selectedNote.id)) {\r\n                handleClose();\r\n                return;\r\n            }\r\n        }\r\n\r\n        const isNew = !notes.find(n => n.id === selectedNote.id);\r\n\r\n        setNotes(prev => {\r\n            const exists = prev.find(n => n.id === selectedNote.id);\r\n            if (exists) {\r\n                return prev.map(n => n.id === selectedNote.id ? selectedNote : n);\r\n            } else {\r\n                return [selectedNote, ...prev];\r\n            }\r\n        });\r\n\r\n        if (isNew) {\r\n            await Analytics.logActivity('note_created', { length: selectedNote.content.length });\r\n        } else {\r\n            await Analytics.logActivity('note_updated', { id: selectedNote.id });\r\n        }\r\n\r\n        handleClose();\r\n    };\r\n\r\n    const handleDelete = (id: string, e?: React.MouseEvent) => {\r\n        e?.stopPropagation();\r\n        if (window.confirm('Delete this note?')) {\r\n            setNotes(prev => prev.filter(note => note.id !== id));\r\n            if (selectedNote?.id === id) handleClose();\r\n        }\r\n    };\r\n\r\n    const handleClose = () => {\r\n        setSelectedNote(null);\r\n        setIsEditing(false);\r\n    };\r\n\r\n    // Voice Handler\r\n    const toggleRecording = () => {\r\n        if (!('webkitSpeechRecognition' in window)) {\r\n            alert('Voice input is not supported in this browser. Try Chrome.');\r\n            return;\r\n        }\r\n\r\n        if (isRecording) {\r\n            setIsRecording(false);\r\n            return;\r\n        }\r\n\r\n        const recognition = new (window as any).webkitSpeechRecognition();\r\n        recognition.continuous = false;\r\n        recognition.interimResults = false;\r\n        recognition.lang = 'en-IN'; // Default to Indian English\r\n\r\n        recognition.onstart = () => setIsRecording(true);\r\n\r\n        recognition.onresult = (event: any) => {\r\n            const transcript = event.results[0][0].transcript;\r\n            if (selectedNote) {\r\n                setSelectedNote(prev => prev ? {\r\n                    ...prev,\r\n                    content: prev.content + (prev.content ? '\\n' : '') + transcript\r\n                } : null);\r\n            }\r\n        };\r\n\r\n        recognition.onerror = () => setIsRecording(false);\r\n        recognition.onend = () => setIsRecording(false);\r\n\r\n        recognition.start();\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-4 pb-24 relative\">\r\n            <div className=\"flex items-center justify-between mb-3 px-1\">\r\n                <div className=\"flex items-center gap-2\">\r\n                    <div className=\"p-1.5 bg-yellow-100 text-yellow-700 rounded-lg\">\r\n                        <StickyNote size={18} />\r\n                    </div>\r\n                    <div>\r\n                        <h2 className=\"text-lg font-black text-slate-800 uppercase tracking-tight\">Quick Notes</h2>\r\n                        <p className=\"text-[10px] text-slate-500 font-bold\">Trip logs & reminders</p>\r\n                    </div>\r\n                </div>\r\n                <button\r\n                    onClick={handleAddNote}\r\n                    className=\"flex items-center gap-1.5 bg-[#0047AB] text-white px-3 py-2 rounded-xl hover:bg-[#003a8c] transition-all active:scale-95 shadow-md shadow-blue-500/20\"\r\n                >\r\n                    <Plus size={16} strokeWidth={3} />\r\n                    <span className=\"text-[10px] font-black uppercase tracking-wider\">New Note</span>\r\n                </button>\r\n            </div>\r\n\r\n            {notes.length === 0 ? (\r\n                <div className=\"bg-slate-50 border-2 border-dashed border-slate-200 rounded-2xl p-10 text-center cursor-pointer hover:bg-slate-100 transition-colors\" onClick={handleAddNote}>\r\n                    <StickyNote size={48} className=\"mx-auto text-slate-300 mb-4\" />\r\n                    <p className=\"text-base font-bold text-slate-400 uppercase tracking-wide\">No notes yet</p>\r\n                    <p className=\"text-sm text-slate-400 mt-2 max-w-xs mx-auto\">Tap here to create your first note.</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\r\n                    {notes.map((note) => (\r\n                        <div\r\n                            key={note.id}\r\n                            onClick={() => handleNoteClick(note)}\r\n                            className=\"bg-yellow-50 border border-yellow-200 rounded-xl p-2.5 shadow-sm hover:shadow-md transition-all cursor-pointer group relative flex flex-col h-[120px]\"\r\n                        >\r\n                            {/* Note Content Preview */}\r\n                            <div className=\"flex-1 overflow-hidden relative\">\r\n                                <p className=\"text-[10px] text-slate-800 font-medium whitespace-pre-wrap leading-relaxed font-sans\" style={{ fontFamily: 'Noto Sans, sans-serif' }}>\r\n                                    {note.content || <span className=\"text-slate-400 italic\">Empty note...</span>}\r\n                                </p>\r\n                                {/* Fade out effect at bottom */}\r\n                                <div className=\"absolute bottom-0 left-0 w-full h-6 bg-linear-to-t from-yellow-50 to-transparent pointer-events-none\"></div>\r\n                            </div>\r\n\r\n                            <div className=\"flex justify-between items-center mt-1.5 pt-1.5 border-t border-yellow-200/50\">\r\n                                <span className=\"text-[8px] font-bold text-slate-400\">\r\n                                    {new Date(note.createdAt).toLocaleDateString('en-IN', { month: 'short', day: 'numeric' })}\r\n                                </span>\r\n                                <button\r\n                                    onClick={(e) => handleDelete(note.id, e)}\r\n                                    className=\"p-1 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors\"\r\n                                >\r\n                                    <Trash2 size={10} />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {isEditing && selectedNote && (\r\n                <div className=\"fixed inset-0 z-100 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-in fade-in duration-200\">\r\n                    <div\r\n                        className=\"bg-[#fffef0] w-full max-w-lg rounded-2xl shadow-2xl flex flex-col max-h-[80vh] animate-slide-up\"\r\n                        onClick={(e) => e.stopPropagation()}\r\n                    >\r\n                        {/* Modal Header */}\r\n                        <div className=\"flex items-center justify-between p-3 border-b border-yellow-200/50\">\r\n                            <span className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest\">\r\n                                {notes.find(n => n.id === selectedNote.id) ? 'Edit Note' : 'New Note'}\r\n                            </span>\r\n                            <div className=\"flex items-center gap-1\">\r\n                                {/* Voice Button */}\r\n                                <button\r\n                                    onClick={toggleRecording}\r\n                                    className={`p-1.5 rounded-full transition-all ${isRecording ? 'bg-red-500 text-white animate-pulse shadow-lg shadow-red-500/30' : 'text-slate-400 hover:text-red-500 hover:bg-red-50'}`}\r\n                                    title=\"Voice Note\"\r\n                                >\r\n                                    <Mic size={16} />\r\n                                </button>\r\n\r\n                                <button\r\n                                    onClick={() => handleDelete(selectedNote.id)}\r\n                                    className=\"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors\"\r\n                                    title=\"Delete\"\r\n                                >\r\n                                    <Trash2 size={16} />\r\n                                </button>\r\n                                <button\r\n                                    onClick={handleClose}\r\n                                    className=\"p-1.5 text-slate-400 hover:text-slate-700 hover:bg-slate-100 rounded-full transition-colors\"\r\n                                >\r\n                                    <X size={18} />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Editor Area */}\r\n                        <div className=\"flex-1 overflow-y-auto p-0 relative\">\r\n                            {isRecording && (\r\n                                <div className=\"absolute top-2 left-1/2 transform -translate-x-1/2 bg-red-100 text-red-600 text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-wider animate-bounce\">\r\n                                    Listening...\r\n                                </div>\r\n                            )}\r\n                            <textarea\r\n                                value={selectedNote.content}\r\n                                onChange={(e) => setSelectedNote(prev => prev ? { ...prev, content: e.target.value } : null)}\r\n                                placeholder=\"Type or Tap Mic to Speak...&#10;Ex: Trip via Vellore started.\"\r\n                                className=\"w-full h-full min-h-[300px] p-5 bg-transparent text-slate-800 text-sm leading-relaxed resize-none focus:outline-none placeholder:text-slate-300\"\r\n                                style={{ fontFamily: 'Noto Sans, sans-serif' }}\r\n                                autoFocus\r\n                            />\r\n                        </div>\r\n\r\n                        {/* Modal Footer */}\r\n                        <div className=\"p-3 border-t border-yellow-200/50 flex justify-end gap-2 bg-yellow-50/50 rounded-b-2xl\">\r\n                            <button\r\n                                onClick={handleClose}\r\n                                className=\"px-4 py-2 rounded-xl text-slate-500 font-bold text-[10px] uppercase tracking-wider hover:bg-slate-100 transition-colors\"\r\n                            >\r\n                                Cancel\r\n                            </button>\r\n                            <button\r\n                                onClick={handleSave}\r\n                                className=\"flex items-center gap-1.5 px-5 py-2 bg-[#0047AB] text-white rounded-xl font-black text-[10px] uppercase tracking-wider shadow-lg shadow-blue-500/20 active:scale-95 transition-all hover:bg-blue-700\"\r\n                            >\r\n                                <Save size={14} />\r\n                                Save Note\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default QuickNotes;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\QuotationForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\RouteLandingPage.tsx","messages":[{"ruleId":"prefer-const","severity":2,"message":"'vehicle' is never reassigned. Use 'const' instead.","line":28,"column":21,"nodeType":"Identifier","messageId":"useConst","endLine":28,"endColumn":28,"fix":{"range":[1116,1138],"text":"const vehicle = 'sedan';"}},{"ruleId":"prefer-const","severity":2,"message":"'lastPart' is never reassigned. Use 'const' instead.","line":29,"column":21,"nodeType":"Identifier","messageId":"useConst","endLine":29,"endColumn":29,"fix":{"range":[1167,1214],"text":"const lastPart = restParts[restParts.length - 1];"}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport Calculator from './Calculator';\r\nimport SEOHead from './SEOHead';\r\n\r\ninterface RouteLandingPageProps {\r\n    slug: string;\r\n}\r\n\r\nconst RouteLandingPage: React.FC<RouteLandingPageProps> = ({ slug }) => {\r\n\r\n    // Parse the slug: \"chennai-to-bangalore-taxi\" -> { from: \"Chennai\", to: \"Bangalore\", vehicle: ... }\r\n    const routeData = useMemo(() => {\r\n        try {\r\n            // Remove leading slash if present\r\n            const cleanSlug = slug.startsWith('/') ? slug.slice(1) : slug;\r\n\r\n            // Pattern 1: City to City (chennai-to-bangalore-taxi)\r\n            const toIndex = cleanSlug.indexOf('-to-');\r\n            if (toIndex !== -1) {\r\n                const parts = cleanSlug.split('-');\r\n                const toPartIndex = parts.indexOf('to');\r\n\r\n                // Reconstruct city names (handling multi-word cities like \"new-delhi\")\r\n                const fromParts = parts.slice(0, toPartIndex);\r\n                const restParts = parts.slice(toPartIndex + 1);\r\n\r\n                // Check for suffix like \"-taxi\", \"-cab\" at the end\r\n                let vehicle = 'sedan'; // default\r\n                let lastPart = restParts[restParts.length - 1];\r\n\r\n                const suffixes = ['taxi', 'cab', 'cabs', 'rental'];\r\n                if (suffixes.includes(lastPart)) {\r\n                    restParts.pop(); // remove suffix\r\n                }\r\n\r\n                // Check for vehicle type in the rest (e.g. bangalore-innova-taxi)\r\n                // This is a simple parser; can be enhanced.\r\n\r\n                const fromCity = fromParts.map(s => s.charAt(0).toUpperCase() + s.slice(1)).join(' ');\r\n                const toCity = restParts.map(s => s.charAt(0).toUpperCase() + s.slice(1)).join(' ');\r\n\r\n                return {\r\n                    from: fromCity,\r\n                    to: toCity,\r\n                    vehicle\r\n                };\r\n            }\r\n\r\n            // Pattern 2: Service (outstation-cabs) - fallback\r\n            // We might just map this to the calculator with no specific route\r\n            return null;\r\n        } catch (e) {\r\n            console.error(\"Failed to parse route slug\", e);\r\n            return null;\r\n        }\r\n    }, [slug]);\r\n\r\n    if (!routeData) {\r\n        // Fallback if parsing fails\r\n        return <Calculator />;\r\n    }\r\n\r\n    const title = `${routeData.from} to ${routeData.to} Taxi Fare - Book Online | Sarathi Book`;\r\n    const description = `Book Safe & Reliable Taxi from ${routeData.from} to ${routeData.to}. Check fare estimate, distance, and book ${routeData.vehicle} instantly. Best rates for outstation cabs.`;\r\n\r\n    return (\r\n        <div className=\"animate-fade-in\">\r\n            <SEOHead\r\n                title={title}\r\n                description={description}\r\n                canonical={`https://sarathibook.com/${slug}`}\r\n            />\r\n            {/* We pass undefined for vehicle to let Calculator decide or use default, unless we parsed a specific vehicle */}\r\n            <Calculator\r\n                initialPickup={routeData.from}\r\n                initialDrop={routeData.to}\r\n            />\r\n\r\n            {/* Additional Route Content for SEO/Ads */}\r\n            <div className=\"mt-12 bg-white rounded-3xl border border-slate-200 p-8 shadow-sm\">\r\n                <h2 className=\"text-2xl font-black text-slate-800 uppercase tracking-tighter mb-6 leading-none border-l-4 border-blue-600 pl-4\">\r\n                    About {routeData.from} to {routeData.to} Taxi Service\r\n                </h2>\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                    <div className=\"space-y-4\">\r\n                        <p className=\"text-sm text-slate-600 leading-relaxed font-medium\">\r\n                            Traveling from {routeData.from} to {routeData.to} by road is a popular choice for many travelers in India. Whether you are traveling for business, a family vacation, or a quick weekend getaway, our taxi fare calculator provides the most accurate and transparent pricing for this route.\r\n                        </p>\r\n                        <p className=\"text-sm text-slate-600 leading-relaxed font-medium\">\r\n                            We offer a variety of vehicles including compact hatchbacks, comfortable sedans like Swift Dzire, spacious SUVs like Toyota Innova, and larger Tempo Travellers for group travel.\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"bg-slate-50 p-6 rounded-2xl border border-slate-100\">\r\n                        <h3 className=\"text-xs font-black text-slate-700 uppercase tracking-widest mb-4\">Trip Information</h3>\r\n                        <ul className=\"space-y-3\">\r\n                            <li className=\"flex justify-between items-center text-xs\">\r\n                                <span className=\"text-slate-500 font-bold uppercase tracking-wider\">Estimated Distance</span>\r\n                                <span className=\"text-slate-900 font-black tracking-tight tracking-wider uppercase\">Calculated in real-time</span>\r\n                            </li>\r\n                            <li className=\"flex justify-between items-center text-xs\">\r\n                                <span className=\"text-slate-500 font-bold uppercase tracking-wider\">Best for</span>\r\n                                <span className=\"text-slate-900 font-black tracking-tight tracking-wider uppercase underline decoration-blue-500\">Outstation / Drop Trip</span>\r\n                            </li>\r\n                            <li className=\"flex justify-between items-center text-xs\">\r\n                                <span className=\"text-slate-500 font-bold uppercase tracking-wider\">Pricing model</span>\r\n                                <span className=\"text-slate-900 font-black tracking-tight tracking-wider uppercase\">Transparent per KM</span>\r\n                            </li>\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"mt-8 pt-8 border-t border-slate-100 grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                    <div className=\"flex gap-4\">\r\n                        <div className=\"w-10 h-10 rounded-xl bg-blue-50 flex items-center justify-center text-blue-600 shrink-0\">\r\n                            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z\" /></svg>\r\n                        </div>\r\n                        <div>\r\n                            <h4 className=\"text-[10px] font-black text-slate-800 uppercase tracking-widest mb-1\">Safe Travel</h4>\r\n                            <p className=\"text-[10px] text-slate-500 font-medium\">Verified professional drivers.</p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex gap-4\">\r\n                        <div className=\"w-10 h-10 rounded-xl bg-emerald-50 flex items-center justify-center text-emerald-600 shrink-0\">\r\n                            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"10\" /><path d=\"m9 12 2 2 4-4\" /></svg>\r\n                        </div>\r\n                        <div>\r\n                            <h4 className=\"text-[10px] font-black text-slate-800 uppercase tracking-widest mb-1\">Fixed Price</h4>\r\n                            <p className=\"text-[10px] text-slate-500 font-medium\">No hidden surcharges or commissions.</p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex gap-4\">\r\n                        <div className=\"w-10 h-10 rounded-xl bg-purple-50 flex items-center justify-center text-purple-600 shrink-0\">\r\n                            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6\" /></svg>\r\n                        </div>\r\n                        <div>\r\n                            <h4 className=\"text-[10px] font-black text-slate-800 uppercase tracking-widest mb-1\">Best Rates</h4>\r\n                            <p className=\"text-[10px] text-slate-500 font-medium\">Compare and find the lowest fare.</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default RouteLandingPage;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\RoutesDirectory.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\SEOHead.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[124,127],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[124,127],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'canonical'. Either include it or remove the dependency array.","line":74,"column":8,"nodeType":"ArrayExpression","endLine":74,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [title, description, schema, canonical]","fix":{"range":[3119,3147],"text":"[title, description, schema, canonical]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect } from 'react';\r\n\r\ninterface SEOHeadProps {\r\n    title: string;\r\n    description?: string;\r\n    schema?: any;\r\n    canonical?: string;\r\n}\r\n\r\nconst SEOHead: React.FC<SEOHeadProps> = ({ title, description, schema, canonical }) => {\r\n    useEffect(() => {\r\n        // Update Title\r\n        const prevTitle = document.title;\r\n        document.title = title.includes('Sarathi Book') ? title : `${title} | Sarathi Book`;\r\n\r\n        // Update Description Meta Tag\r\n        let metaDescription = document.querySelector('meta[name=\"description\"]');\r\n        if (!metaDescription) {\r\n            metaDescription = document.createElement('meta');\r\n            metaDescription.setAttribute('name', 'description');\r\n            document.head.appendChild(metaDescription);\r\n        }\r\n\r\n        const prevDescription = metaDescription.getAttribute('content');\r\n        if (description) {\r\n            metaDescription.setAttribute('content', description);\r\n        }\r\n\r\n        // Handle Open Graph Tags\r\n        const ogTitle = document.querySelector('meta[property=\"og:title\"]');\r\n        if (ogTitle) ogTitle.setAttribute('content', title.includes('Sarathi Book') ? title : `${title} | Sarathi Book`);\r\n\r\n        const ogDesc = document.querySelector('meta[property=\"og:description\"]');\r\n        if (ogDesc && description) ogDesc.setAttribute('content', description);\r\n\r\n        const ogUrl = document.querySelector('meta[property=\"og:url\"]');\r\n        if (ogUrl) ogUrl.setAttribute('content', window.location.href);\r\n\r\n        // Handle Canonical Tag\r\n        let linkCanonical = document.querySelector('link[rel=\"canonical\"]');\r\n        if (!linkCanonical) {\r\n            linkCanonical = document.createElement('link');\r\n            linkCanonical.setAttribute('rel', 'canonical');\r\n            document.head.appendChild(linkCanonical);\r\n        }\r\n        const currentUrl = canonical || (window.location.origin + window.location.pathname + window.location.search);\r\n        linkCanonical.setAttribute('href', currentUrl);\r\n\r\n        // Handle Dynamic Schema (JSON-LD)\r\n        let schemaScript = document.getElementById('dynamic-seo-schema');\r\n        if (schema) {\r\n            if (!schemaScript) {\r\n                schemaScript = document.createElement('script');\r\n                schemaScript.id = 'dynamic-seo-schema';\r\n                schemaScript.setAttribute('type', 'application/ld+json');\r\n                document.head.appendChild(schemaScript);\r\n            }\r\n            schemaScript.textContent = JSON.stringify(schema);\r\n        } else if (schemaScript) {\r\n            schemaScript.remove();\r\n        }\r\n\r\n        return () => {\r\n            document.title = prevTitle;\r\n            if (prevDescription) {\r\n                metaDescription?.setAttribute('content', prevDescription);\r\n            }\r\n            // We don't necessarily remove schema on unmount if it's the main page schema, \r\n            // but for dynamic route pages, it's safer to cleanup.\r\n            if (schema) {\r\n                document.getElementById('dynamic-seo-schema')?.remove();\r\n            }\r\n        };\r\n    }, [title, description, schema]);\r\n\r\n    return null;\r\n};\r\n\r\nexport default SEOHead;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\SalaryManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\SarathiAI.tsx","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":109,"column":9,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":109,"endColumn":22,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[4022,4035],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4080,4083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4080,4083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4414,4417],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4414,4417],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useEffect } from 'react';\r\nimport { Send, X, Bot, User, Loader2, Sparkles, MoveHorizontal, Mic } from 'lucide-react';\r\nimport { chatWithSarathi } from '../utils/geminiApi';\r\nimport { Analytics } from '../utils/monitoring';\r\n\r\ninterface SarathiAIProps {\r\n    onNavigate?: (page: string) => void;\r\n}\r\n\r\nconst SarathiAI: React.FC<SarathiAIProps> = ({ onNavigate }) => {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [message, setMessage] = useState('');\r\n    const [chatHistory, setChatHistory] = useState<{ role: \"user\" | \"model\", text: string }[]>([]);\r\n    const [isTyping, setIsTyping] = useState(false);\r\n    const scrollRef = useRef<HTMLDivElement>(null);\r\n\r\n    useEffect(() => {\r\n        if (scrollRef.current) {\r\n            scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\r\n        }\r\n    }, [chatHistory, isTyping]);\r\n\r\n    const speakResponse = (text: string) => {\r\n        if (!('speechSynthesis' in window)) return;\r\n\r\n        // Cancel any ongoing speech\r\n        window.speechSynthesis.cancel();\r\n\r\n        const utterance = new SpeechSynthesisUtterance(text);\r\n\r\n        // Try to find a good Indian English or Tamil voice\r\n        const voices = window.speechSynthesis.getVoices();\r\n        const indianVoice = voices.find(v => v.lang.includes('en-IN')) || voices.find(v => v.lang.includes('en-GB'));\r\n\r\n        if (indianVoice) utterance.voice = indianVoice;\r\n        utterance.rate = 1.0;\r\n        utterance.pitch = 1.0;\r\n\r\n        window.speechSynthesis.speak(utterance);\r\n    };\r\n\r\n    const handleSend = async (overrideMessage?: string) => {\r\n        const textToSend = overrideMessage || message;\r\n        if (!textToSend.trim()) return;\r\n\r\n        setMessage('');\r\n        setChatHistory(prev => [...prev, { role: \"user\", text: textToSend }]);\r\n        setIsTyping(true);\r\n\r\n        // --- GATHER SITE CONTEXT ---\r\n        const trips = localStorage.getItem('namma-cab-trips') || '[]';\r\n        const notes = localStorage.getItem('driver-quick-notes') || '[]';\r\n        const expenses = localStorage.getItem('cab-expenses') || '[]';\r\n        const settings = localStorage.getItem('namma-cab-settings') || '{}';\r\n\r\n        const contextString = `\r\n            USER_PROFILE: ${settings}\r\n            TRIPS_DATA: ${trips}\r\n            EXPENSES_DATA: ${expenses}\r\n            QUICK_NOTES: ${notes}\r\n        `.slice(0, 3000); // Limit context size\r\n\r\n        // Prepare history for Gemini API\r\n        const apiHistory = chatHistory.map(h => ({\r\n            role: h.role,\r\n            parts: [{ text: h.text }]\r\n        }));\r\n\r\n        const responseRaw = await chatWithSarathi(textToSend, apiHistory, contextString);\r\n\r\n        // Parse Commands\r\n        let responseText = responseRaw;\r\n        const navMatch = responseRaw.match(/\\[\\[NAVIGATE:(.*?)\\]\\]/);\r\n\r\n        if (navMatch && navMatch[1]) {\r\n            const targetPage = navMatch[1].trim();\r\n            responseText = responseText.replace(navMatch[0], '').trim(); // Remove command from chat\r\n\r\n            if (onNavigate) {\r\n                // Small delay to let user read \"Opening...\" if present\r\n                setTimeout(() => {\r\n                    onNavigate(targetPage);\r\n                    setIsOpen(false); // Auto-close on nav? Maybe keep open? Let's close for \"Assistant\" feel.\r\n                }, 1500);\r\n            }\r\n        }\r\n\r\n        setIsTyping(false);\r\n        setChatHistory(prev => [...prev, { role: \"model\", text: responseText }]);\r\n\r\n        // Voice Assistant: Talk back!\r\n        speakResponse(responseText);\r\n\r\n        await Analytics.logActivity('ai_query', {\r\n            query: textToSend,\r\n            responseLength: responseText.length,\r\n            hasCommand: !!navMatch\r\n        });\r\n    };\r\n\r\n    const toggleVoiceInput = () => {\r\n        if (!('webkitSpeechRecognition' in window)) {\r\n            alert('Voice not supported in this browser. Please use Chrome.');\r\n            return;\r\n        }\r\n\r\n        if (isTyping) return;\r\n\r\n        // @ts-ignore\r\n        const recognition = new (window as any).webkitSpeechRecognition();\r\n        recognition.lang = 'en-IN'; // Works well for Tanglish too\r\n        recognition.continuous = false;\r\n        recognition.interimResults = true;\r\n\r\n        recognition.onstart = () => setIsTyping(true); // Reuse typing state as a \"Listening\" indicator\r\n\r\n        recognition.onresult = (event: any) => {\r\n            const transcript = event.results[0][0].transcript;\r\n            setMessage(transcript);\r\n\r\n            if (event.results[0].isFinal) {\r\n                setTimeout(() => {\r\n                    handleSend(transcript);\r\n                }, 500);\r\n            }\r\n        };\r\n\r\n        recognition.onerror = () => setIsTyping(false);\r\n        recognition.onend = () => setIsTyping(false);\r\n\r\n        recognition.start();\r\n    };\r\n\r\n    return (\r\n        <>\r\n            {/* Floating Bubble */}\r\n            {!isOpen && (\r\n                <button\r\n                    onClick={() => setIsOpen(true)}\r\n                    className=\"fixed bottom-24 right-5 md:bottom-10 md:right-10 w-16 h-16 bg-gradient-to-tr from-[#0047AB] to-[#4F46E5] text-white rounded-full shadow-2xl flex items-center justify-center hover:scale-110 active:scale-95 transition-all z-50 group\"\r\n                >\r\n                    <div className=\"absolute inset-0 bg-white/20 rounded-full animate-ping group-hover:block hidden\"></div>\r\n                    <Bot size={28} className=\"relative z-10\" />\r\n                    <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-red-500 border-2 border-white rounded-full flex items-center justify-center\">\r\n                        <span className=\"text-[10px] font-bold\">AI</span>\r\n                    </div>\r\n                </button>\r\n            )}\r\n\r\n            {/* Chat Window */}\r\n            {isOpen && (\r\n                <div className=\"fixed inset-x-4 bottom-24 md:inset-auto md:bottom-10 md:right-10 md:w-[450px] h-[600px] bg-[#0f172a] border border-white/10 rounded-3xl shadow-2xl flex flex-col overflow-hidden animate-slide-up z-50\">\r\n                    {/* Header */}\r\n                    <div className=\"bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900 p-5 flex items-center justify-between border-b border-white/5\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-12 h-12 bg-blue-500/20 rounded-2xl flex items-center justify-center border border-blue-500/30\">\r\n                                <Bot className=\"text-blue-400\" size={28} />\r\n                            </div>\r\n                            <div>\r\n                                <h3 className=\"text-base font-black text-white uppercase tracking-tight flex items-center gap-2\">\r\n                                    Sarathi Pro <Sparkles size={14} className=\"text-yellow-400\" />\r\n                                </h3>\r\n                                <div className=\"flex items-center gap-1.5\">\r\n                                    <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></div>\r\n                                    <span className=\"text-[10px] text-slate-400 font-bold uppercase tracking-wider\">Voice Assistant Ready</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <button\r\n                            onClick={() => {\r\n                                setIsOpen(false);\r\n                                window.speechSynthesis.cancel();\r\n                            }}\r\n                            className=\"p-2 hover:bg-white/5 rounded-full text-slate-400 transition-colors\"\r\n                        >\r\n                            <X size={24} />\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Chat Body */}\r\n                    <div\r\n                        ref={scrollRef}\r\n                        className=\"flex-1 overflow-y-auto p-6 space-y-6 scroll-smooth bg-gradient-to-b from-[#0f172a] to-[#1e293b]\"\r\n                    >\r\n                        {chatHistory.length === 0 && (\r\n                            <div className=\"h-full flex flex-col items-center justify-center text-center p-6 space-y-6\">\r\n                                <div className=\"w-24 h-24 bg-blue-500/10 rounded-full flex items-center justify-center relative\">\r\n                                    <Bot size={48} className=\"text-blue-400 animate-bounce\" />\r\n                                    <div className=\"absolute inset-0 animate-ping bg-blue-500/20 rounded-full\"></div>\r\n                                </div>\r\n                                <div>\r\n                                    <h4 className=\"text-white font-black text-lg mb-2 uppercase tracking-tight\">Vanakkam Saravana!</h4>\r\n                                    <p className=\"text-sm text-slate-400 leading-relaxed font-bold\">\r\n                                        Eppadi help pannattum? <br />\r\n                                        Try saying: <span className=\"text-blue-400\">\"Add fuel expense\"</span> or <span className=\"text-blue-400\">\"Calculate fare\"</span>\r\n                                    </p>\r\n                                </div>\r\n                                <div className=\"grid grid-cols-1 gap-3 w-full max-w-[280px]\">\r\n                                    <button\r\n                                        onClick={() => handleSend(\"Calculate fare for 300km Sedan\")}\r\n                                        className=\"text-left p-4 rounded-2xl bg-white/5 border border-white/5 text-[11px] font-black text-slate-300 hover:bg-white/10 hover:border-blue-500/30 transition-all uppercase tracking-tight flex items-center gap-3\"\r\n                                    >\r\n                                         Calculate 300km Sedan Fare\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => handleSend(\"I want to add Diesel expense\")}\r\n                                        className=\"text-left p-4 rounded-2xl bg-white/5 border border-white/5 text-[11px] font-black text-slate-300 hover:bg-white/10 hover:border-blue-500/30 transition-all uppercase tracking-tight flex items-center gap-3\"\r\n                                    >\r\n                                         Log Fuel Expense\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {chatHistory.map((item, idx) => (\r\n                            <div\r\n                                key={idx}\r\n                                className={`flex ${item.role === 'user' ? 'justify-end' : 'justify-start'} animate-in slide-in-from-bottom-2 duration-300`}\r\n                            >\r\n                                <div className={`flex gap-3 max-w-[90%] ${item.role === 'user' ? 'flex-row-reverse' : ''}`}>\r\n                                    <div className={`w-8 h-8 rounded-xl flex-shrink-0 flex items-center justify-center shadow-lg ${item.role === 'user' ? 'bg-[#0047AB]' : 'bg-slate-800 border border-white/10'}`}>\r\n                                        {item.role === 'user' ? <User size={16} className=\"text-white\" /> : <Bot size={18} className=\"text-blue-400\" />}\r\n                                    </div>\r\n                                    <div className={`p-4 rounded-2xl text-[14px] leading-relaxed font-bold shadow-xl ${item.role === 'user' ? 'bg-blue-600 text-white rounded-tr-none' : 'bg-slate-800/80 text-slate-100 border border-white/10 rounded-tl-none'}`}>\r\n                                        {item.text}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n\r\n                        {isTyping && (\r\n                            <div className=\"flex justify-start\">\r\n                                <div className=\"flex gap-3\">\r\n                                    <div className=\"w-8 h-8 rounded-xl bg-slate-800 border border-white/10 flex items-center justify-center\">\r\n                                        <Loader2 size={16} className=\"text-blue-400 animate-spin\" />\r\n                                    </div>\r\n                                    <div className=\"bg-slate-800/80 border border-white/10 p-4 rounded-2xl rounded-tl-none flex items-center gap-2\">\r\n                                        <span className=\"text-[10px] font-black text-blue-400 uppercase tracking-widest animate-pulse\">Sarathi is thinking...</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Footer / Input */}\r\n                    <div className=\"p-5 bg-slate-900/50 border-t border-white/5 backdrop-blur-md\">\r\n                        <div className=\"relative flex items-center bg-slate-800/80 border border-white/10 rounded-[24px] px-5 py-3 group focus-within:border-blue-500/50 transition-all shadow-inner\">\r\n                            <input\r\n                                type=\"text\"\r\n                                value={message}\r\n                                onChange={(e) => setMessage(e.target.value)}\r\n                                onKeyDown={(e) => e.key === 'Enter' && handleSend()}\r\n                                placeholder=\"Speak or Type in Tamil/English...\"\r\n                                className=\"flex-1 bg-transparent border-none outline-none text-white text-sm py-2 placeholder:text-slate-500 font-bold\"\r\n                            />\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <button\r\n                                    onClick={toggleVoiceInput}\r\n                                    className={`p-3 rounded-full transition-all ${isTyping ? 'bg-red-500 text-white animate-pulse shadow-[0_0_15px_rgba(239,68,68,0.5)]' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}`}\r\n                                    title=\"Voice Assistant\"\r\n                                >\r\n                                    <Mic size={20} />\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => handleSend()}\r\n                                    disabled={!message.trim() || isTyping}\r\n                                    className=\"p-3 bg-blue-600 text-white rounded-full shadow-lg shadow-blue-600/20 disabled:opacity-50 disabled:bg-slate-700 disabled:shadow-none hover:bg-blue-500 active:scale-90 transition-all\"\r\n                                >\r\n                                    <Send size={20} />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                        <p className=\"text-[10px] text-center text-slate-600 font-black uppercase tracking-[0.2em] mt-4 flex items-center justify-center gap-2\">\r\n                            AI Driver Assistant <MoveHorizontal size={10} /> v2.0\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\nexport default SarathiAI;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\SideNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\TariffPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\TermsOfService.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\TrendingRoutes.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[295,298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[295,298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[821,824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[821,824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1855,1858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1855,1858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1863,1866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1863,1866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\r\nimport { supabase } from '../utils/supabase';\r\nimport { Car, ArrowRight, RotateCcw } from 'lucide-react';\r\nimport SEOHead from './SEOHead';\r\n\r\nconst TrendingRoutes: React.FC = () => {\r\n    const [trendingRoutes, setTrendingRoutes] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const fetchTrends = async () => {\r\n            try {\r\n                const { data, error } = await supabase\r\n                    .from('route_searches')\r\n                    .select('*')\r\n                    .order('created_at', { ascending: false })\r\n                    .limit(100);\r\n\r\n                if (error) throw error;\r\n\r\n                if (data && data.length > 0) {\r\n                    const counts: Record<string, any> = {};\r\n\r\n                    data.forEach(row => {\r\n                        const key = `${row.pickup_location?.trim()}-${row.drop_location?.trim()}`;\r\n                        if (!row.pickup_location || !row.drop_location) return;\r\n\r\n                        if (!counts[key]) {\r\n                            counts[key] = {\r\n                                from: row.pickup_location,\r\n                                to: row.drop_location,\r\n                                type: row.trip_type === 'roundtrip' ? 'Round Trip' : 'One Way',\r\n                                mode: row.trip_type,\r\n                                dist: row.distance_km,\r\n                                fare: row.estimated_fare,\r\n                                veh: row.vehicle_type,\r\n                                count: 0\r\n                            };\r\n                        }\r\n                        counts[key].count++;\r\n                    });\r\n\r\n                    const sorted = Object.values(counts)\r\n                        .sort((a: any, b: any) => b.count - a.count);\r\n\r\n                    setTrendingRoutes(sorted);\r\n                }\r\n            } catch (err) {\r\n                console.error('Error fetching trending routes:', err);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchTrends();\r\n    }, []);\r\n\r\n    const slugify = (str: string) => {\r\n        return str.split(',')[0].trim().toLowerCase().replace(/\\s+/g, '-');\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 pb-24 animate-fade-in\">\r\n            <SEOHead\r\n                title=\"Most Calculated Cab Routes | Popular Taxi Fares India\"\r\n                description=\"View the most popular cab routes and taxi fare estimates in India. Check prices for trending outstation and local trips.\"\r\n            />\r\n\r\n            <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-slate-200\">\r\n                <div className=\"flex items-center gap-3 mb-6\">\r\n                    <div className=\"w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-[#0047AB]\">\r\n                        <RotateCcw size={20} />\r\n                    </div>\r\n                    <div>\r\n                        <h2 className=\"text-lg font-black text-slate-800 uppercase tracking-wide\">Most Calculated Routes</h2>\r\n                        <p className=\"text-xs text-slate-500 font-medium\">Top trending routes searched by other users</p>\r\n                    </div>\r\n                </div>\r\n\r\n                {loading ? (\r\n                    <div className=\"space-y-4\">\r\n                        {[1, 2, 3, 4, 5].map(i => (\r\n                            <div key={i} className=\"h-20 bg-slate-50 rounded-xl animate-pulse\" />\r\n                        ))}\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                        {trendingRoutes.map((route, idx) => (\r\n                            <a\r\n                                key={idx}\r\n                                href={`/${slugify(route.from)}-to-${slugify(route.to)}-taxi`}\r\n                                className=\"bg-white border border-slate-200 rounded-xl p-4 flex flex-col justify-between shadow-sm hover:shadow-md hover:border-blue-400 transition-all cursor-pointer active:scale-[0.99] group block\"\r\n                            >\r\n                                <div className=\"space-y-3\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <h4 className=\"font-bold text-slate-800 text-sm truncate flex-1\">\r\n                                            {route.from}\r\n                                        </h4>\r\n                                        <ArrowRight size={14} className=\"text-slate-400 group-hover:text-blue-500 transition-colors\" />\r\n                                        <h4 className=\"font-bold text-slate-800 text-sm truncate flex-1 text-right\">\r\n                                            {route.to}\r\n                                        </h4>\r\n                                    </div>\r\n\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-slate-100 text-slate-600 text-[10px] font-bold uppercase tracking-wider\">\r\n                                                <Car size={10} />\r\n                                                {route.veh}\r\n                                            </span>\r\n                                            <span className={`inline-flex items-center px-2 py-1 rounded-md text-[10px] font-bold uppercase tracking-wider ${route.mode === 'roundtrip' ? 'bg-purple-50 text-purple-700' : 'bg-blue-50 text-blue-700'\r\n                                                }`}>\r\n                                                {route.mode === 'roundtrip' ? 'Round Trip' : 'Drop Trip'}\r\n                                            </span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"mt-4 pt-3 border-t border-slate-50 flex justify-between items-end\">\r\n                                    <span className=\"text-[10px] font-medium text-slate-400\">{route.dist} km approx</span>\r\n                                    <div className=\"text-right\">\r\n                                        <span className=\"text-lg font-black text-slate-900 block leading-none\">{route.fare.toLocaleString()}</span>\r\n                                    </div>\r\n                                </div>\r\n                            </a>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"mt-8 text-center pb-8\">\r\n                <a href=\"/routes\" className=\"inline-flex items-center gap-2 text-sm font-black text-blue-600 hover:text-blue-800 transition-colors uppercase tracking-wider bg-blue-50 px-6 py-3 rounded-full hover:bg-blue-100\">\r\n                    View Full Routes Directory <ArrowRight size={16} />\r\n                </a>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default TrendingRoutes;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\TripForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":227,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":227,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9945,9948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9945,9948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":236,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10239,10242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10239,10242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'performCalculation'. Either include it or remove the dependency array.","line":512,"column":8,"nodeType":"ArrayExpression","endLine":512,"endColumn":261,"suggestions":[{"desc":"Update the dependencies array to be: [mode, selectedVehicleId, distanceOverride, days, localPackageHours, hourlyPackage, customRate, toll, parking, permit, driverBatta, nightCharge, hillStationCharge, petCharge, extraItems, includeGst, manualDriverBatta, manualHillStation, customLineItems, performCalculation]","fix":{"range":[22875,23128],"text":"[mode, selectedVehicleId, distanceOverride, days, localPackageHours, hourlyPackage, customRate, toll, parking, permit, driverBatta, nightCharge, hillStationCharge, petCharge, extraItems, includeGst, manualDriverBatta, manualHillStation, customLineItems, performCalculation]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":609,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":609,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27625,27628],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27625,27628],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":709,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":709,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32985,32988],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32985,32988],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":768,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":768,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36323,36326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36323,36326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef, useMemo, Suspense } from 'react';\r\nimport { useSettings } from '../contexts/SettingsContext';\r\nimport { Analytics } from '../utils/monitoring';\r\nimport { calculateFareAsync } from '../utils/fareWorkerWrapper';\r\nimport { TARIFFS, TRIP_LIMITS } from '../config/tariff_config';\r\nimport { Trip } from '../utils/fare';\r\nimport { estimateParkingCharge } from '../utils/parking';\r\nimport { estimatePermitCharge } from '../utils/permits';\r\nimport PlacesAutocomplete from './PlacesAutocomplete';\r\nimport MapPicker from './MapPicker';\r\n// import { useAdProtection } from '../hooks/useAdProtection';\r\nimport {\r\n    MoveRight, MapPin, Plus, CheckCircle2,\r\n    Repeat, Clock, UserCheck,\r\n    Car, ChevronLeft,\r\n    RotateCcw, Trash2, PenLine,\r\n    StickyNote, Check, Share2,\r\n    Camera, Eye\r\n} from 'lucide-react';\r\nimport { generateId } from '../utils/uuid';\r\nimport { generateReceiptPDF, SavedQuotation, shareReceipt } from '../utils/pdf';\r\nimport { saveToHistory } from '../utils/history';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport PDFPreviewModal from './PDFPreviewModal';\r\nimport { calculateDistance } from '../utils/googleMaps';\r\nimport { calculateAdvancedRoute } from '../utils/routesApi';\r\nimport { performOcr, parseOdometer } from '../utils/visionApi';\r\nimport { calculateGST, GSTRate, GSTBreakdown, getFinancialYear } from '../utils/gstUtils';\r\n\r\n// --- Types ---\r\n\r\n\r\n// --- Types ---\r\ntype TripMode = 'drop' | 'outstation' | 'local' | 'custom' | null;\r\n\r\ninterface CalculationResult {\r\n    total: number;\r\n    gst: number;\r\n    fare: number;\r\n    distance: number;\r\n    effectiveDistance: number;\r\n    rateUsed: number;\r\n    distanceCharge: number;\r\n    waitingCharges: number;\r\n    waitingHours: number;\r\n    hillStationCharges: number;\r\n    petCharges: number;\r\n    driverBatta: number;\r\n    nightStay: number;\r\n    gstBreakdown?: GSTBreakdown;\r\n    breakdown: string[];\r\n}\r\n\r\ninterface TripFormProps {\r\n    onSaveTrip: (trip: Trip) => Promise<void> | void;\r\n    onStepChange?: (step: number) => void;\r\n    invoiceTemplate?: SavedQuotation | null;\r\n    trips?: Trip[];\r\n}\r\n\r\nconst DEFAULT_TERMS = [\r\n    \"Kms and Time are calculated on a Garage-to-Garage basis.\",\r\n    \"Reimbursable expenses like Toll and Parking have been added as per actuals.\",\r\n    \"Payment is due immediately upon completion of the trip.\",\r\n    \"Driver Batta/Allowance covers food and accommodation for the driver.\",\r\n    \"All disputes are subject to our registered office jurisdiction.\",\r\n    \"This is a computer-generated invoice and requires no physical signature.\"\r\n];\r\n\r\nconst TripForm: React.FC<TripFormProps> = ({ onSaveTrip, onStepChange, invoiceTemplate, trips }) => {\r\n    const { settings } = useSettings();\r\n    const { user } = useAuth();\r\n    // const { triggerAction } = useAdProtection();\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    // Track if this session has already saved a trip to prevent duplicates\r\n    const sessionTripId = useRef<string | null>(null);\r\n    const sessionInvoiceNo = useRef<string | null>(null);\r\n\r\n    // Reset session refs when component unmounts or explicitly reset (if we had a reset function)\r\n    useEffect(() => {\r\n        sessionTripId.current = null;\r\n        sessionInvoiceNo.current = null;\r\n    }, []); // Only on mount, but actually we want to reset if user starts \"New\" trip? \r\n    // Since TripForm is likely remounted or step reset, for now relying on mount/unmount is okay \r\n    // BUT if the user clears the form without unmounting, we might have an issue. \r\n    // Given the current architecture (Wizard), a full reset usually reloads the component or resets state.\r\n    // Let's ensure we reset if 'invoiceTemplate' changes or some clear signal? \r\n    // Actually, just init is fine for now as per user flow.\r\n\r\n    // --- Wizard State ---\r\n    const [step, setStep] = useState(0);\r\n\r\n    // --- Form State ---\r\n    const [mode, setMode] = useState<TripMode>(null);\r\n    const [selectedVehicleId, setSelectedVehicleId] = useState('');\r\n\r\n    // Journey\r\n    const [fromLoc, setFromLoc] = useState('');\r\n    const [toLoc, setToLoc] = useState('');\r\n    const [pickupCoords, setPickupCoords] = useState<{ lat: number; lng: number } | null>(null);\r\n    const [dropCoords, setDropCoords] = useState<{ lat: number; lng: number } | null>(null);\r\n    const [startKm, setStartKm] = useState(0);\r\n    const [endKm, setEndKm] = useState(0);\r\n    const [distanceOverride, setDistanceOverride] = useState<string>('');\r\n    const [isOdometerMode, setIsOdometerMode] = useState(false);\r\n    const [isFetchingKM, setIsFetchingKM] = useState(false);\r\n    const [isScanning, setIsScanning] = useState<'start' | 'end' | null>(null);\r\n\r\n    // Details\r\n    const [days, setDays] = useState(1);\r\n\r\n    const [customRate, setCustomRate] = useState(0);\r\n    // Custom Table State for Invoice\r\n    const [customLineItems, setCustomLineItems] = useState<{ description: string; sac: string; qty: number; rate: number; amount: number }[]>([\r\n        { description: 'Service Charge', sac: '9966', qty: 1, rate: 0, amount: 0 }\r\n    ]);\r\n\r\n    // Local Package State\r\n    const [hourlyPackage, setHourlyPackage] = useState<string>('');\r\n    const [localPackageHours, setLocalPackageHours] = useState(0);\r\n    const [localPackageKm, setLocalPackageKm] = useState(0);\r\n\r\n    // Charges\r\n    const [toll, setToll] = useState('0');\r\n    const [parking, setParking] = useState('0');\r\n    const [permit, setPermit] = useState('0');\r\n    const [driverBatta, setDriverBatta] = useState('0');\r\n    const [nightCharge, setNightCharge] = useState('0');\r\n    const [hillStationCharge, setHillStationCharge] = useState('0');\r\n    const [petCharge, setPetCharge] = useState('0');\r\n    const [extraItems, setExtraItems] = useState<{ description: string; amount: number; qty?: number; rate?: number; sac?: string }[]>([]);\r\n\r\n    // Manual Overrides Flags\r\n    const [manualDriverBatta, setManualDriverBatta] = useState(false);\r\n    const [manualToll, setManualToll] = useState(false);\r\n    const [manualParking, setManualParking] = useState(false);\r\n    const [manualPermit, setManualPermit] = useState(false);\r\n    const [manualHillStation, setManualHillStation] = useState(false);\r\n\r\n    // Other Charges Helper State\r\n    const [selectedChargeType, setSelectedChargeType] = useState('');\r\n    const [customChargeName, setCustomChargeName] = useState('');\r\n    const [customChargeAmount, setCustomChargeAmount] = useState('');\r\n\r\n    // Customer\r\n    const [customerName, setCustomerName] = useState('');\r\n    const [customerPhone, setCustomerPhone] = useState('');\r\n    const [customerGst, setCustomerGst] = useState('');\r\n    const [billingAddress, setBillingAddress] = useState('');\r\n    const [includeGst, setIncludeGst] = useState(true);\r\n\r\n    // Auto-disable GST if not configured\r\n    useEffect(() => {\r\n        if (!settings?.gstin) {\r\n            setIncludeGst(false);\r\n        }\r\n    }, [settings?.gstin]);\r\n    const [rcmEnabled, setRcmEnabled] = useState(false);\r\n    const [terms, setTerms] = useState<string[]>([]);\r\n    const [newTerm, setNewTerm] = useState('');\r\n    const [invoiceDate, setInvoiceDate] = useState(new Date().toISOString().split('T')[0]);\r\n    const [invoiceNo, setInvoiceNo] = useState('');\r\n    const [customTripType, setCustomTripType] = useState('Taxi Service');\r\n    // 5% fixed as per requirement\r\n    const gstRate: GSTRate = 5;\r\n\r\n    // Results\r\n    const [showPreview, setShowPreview] = useState(false);\r\n    const [previewPdfUrl, setPreviewPdfUrl] = useState('');\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n\r\n\r\n\r\n    // Local Trip Log\r\n    const [startTimeLog, setStartTimeLog] = useState('');\r\n    const [endTimeLog, setEndTimeLog] = useState('');\r\n    const [showMap, setShowMap] = useState(false);\r\n\r\n    const handleMapSelect = (pickup: string, drop: string, dist: number, tollAmt?: number, pLat?: number, pLng?: number, dLat?: number, dLng?: number) => {\r\n        setFromLoc(pickup);\r\n        setToLoc(drop);\r\n        setDistanceOverride(dist.toString());\r\n        if (pLat && pLng) setPickupCoords({ lat: pLat, lng: pLng });\r\n        if (dLat && dLng) setDropCoords({ lat: dLat, lng: dLng });\r\n\r\n        if (tollAmt && tollAmt > 0) {\r\n            let finalToll = tollAmt;\r\n            if (mode === 'outstation') {\r\n                // Multi-day round trip logic for toll\r\n                finalToll = days > 1 ? tollAmt * 2 : Math.round(tollAmt * 1.6);\r\n            }\r\n            setToll(finalToll.toString());\r\n        }\r\n        setShowMap(false);\r\n    };\r\n\r\n    const handleSwapRoute = () => {\r\n        const tempLoc = fromLoc;\r\n        const tempCoords = pickupCoords;\r\n        setFromLoc(toLoc);\r\n        setPickupCoords(dropCoords);\r\n        setToLoc(tempLoc);\r\n        setDropCoords(tempCoords);\r\n    };\r\n\r\n    // --- Derived Values ---\r\n    const userVehicles = useMemo(() => settings.vehicles || [], [settings.vehicles]);\r\n\r\n    const vehicleCategory = useMemo(() => {\r\n        if (!selectedVehicleId) return null;\r\n\r\n        const userV = userVehicles.find(v => v.id === selectedVehicleId);\r\n        if (userV) {\r\n            const category = (userV.model || '').toLowerCase();\r\n            if (category.includes('hatchback')) return 'hatchback';\r\n            if (category.includes('innova crysta')) return 'premium_suv';\r\n            if (category.includes('suv') || category.includes('ertiga') || category.includes('innova')) return 'suv';\r\n            if (category.includes('tempo') || category.includes('traveller')) return 'tempo';\r\n            if (category.includes('mini bus') || category.includes('minibus')) return 'minibus';\r\n            if (category.includes('bus')) return 'bus';\r\n            return 'sedan';\r\n        }\r\n\r\n        // Handle case where selectedVehicleId is directly the category key (e.g. from templates)\r\n        if (selectedVehicleId && (TARIFFS.vehicles as any)[selectedVehicleId]) {\r\n            return selectedVehicleId;\r\n        }\r\n\r\n        return 'sedan';\r\n    }, [selectedVehicleId, userVehicles]);\r\n\r\n    const currentVehicleData = useMemo(() => {\r\n        if (!vehicleCategory) return null;\r\n        return (TARIFFS.vehicles as Record<string, any>)[vehicleCategory] || TARIFFS.vehicles.sedan;\r\n    }, [vehicleCategory]);\r\n\r\n    const nextInvoiceNo = useMemo(() => {\r\n        // Standard GST Format: INV/FY/SEQ vs Non-GST: BILL/FY/SEQ\r\n        const date = new Date(invoiceDate);\r\n        const fy = getFinancialYear(date);\r\n        \r\n        // Use separate prefixes to maintain respective ordering\r\n        // INV - for Valid GST Tax Invoices (Primary)\r\n        // BILL - for Non-GST / Bill of Supply\r\n        const prefix = includeGst ? `INV/${fy}/` : `BILL/${fy}/`;\r\n\r\n        if (!trips || trips.length === 0) return `${prefix}001`;\r\n\r\n        const sequences = trips\r\n            .map(t => t.invoiceNo)\r\n            .filter((n): n is string => !!n && n.startsWith(prefix))\r\n            .map(n => {\r\n                const parts = n.split('/');\r\n                return parseInt(parts[parts.length - 1]);\r\n            })\r\n            .filter(n => !isNaN(n));\r\n\r\n        const max = sequences.length > 0 ? Math.max(...sequences) : 0;\r\n        return `${prefix}${(max + 1).toString().padStart(3, '0')}`;\r\n    }, [invoiceDate, trips, includeGst]);\r\n\r\n    useEffect(() => {\r\n        setInvoiceNo(nextInvoiceNo);\r\n    }, [nextInvoiceNo]);\r\n\r\n    // --- Side Effects ---\r\n\r\n    useEffect(() => {\r\n        if (onStepChange) onStepChange(step);\r\n    }, [step, onStepChange]);\r\n\r\n    useEffect(() => {\r\n        if (invoiceTemplate) {\r\n            setCustomerName(invoiceTemplate.customerName);\r\n            if (invoiceTemplate.customerAddress) setBillingAddress(invoiceTemplate.customerAddress);\r\n            if (invoiceTemplate.customerGstin) setCustomerGst(invoiceTemplate.customerGstin);\r\n            // Re-map category correctly if template has specific vehicleType\r\n            if (invoiceTemplate.vehicleType) setSelectedVehicleId(invoiceTemplate.vehicleType);\r\n            if (invoiceTemplate.gstEnabled) setIncludeGst(true);\r\n            // If template has date use it, otherwise default to today\r\n            if (invoiceTemplate.date) setInvoiceDate(invoiceTemplate.date.split('T')[0]);\r\n            setMode('drop'); // Default from template if unknown\r\n            setStep(1);\r\n        }\r\n    }, [invoiceTemplate]);\r\n\r\n    // Auto Distance Calculation\r\n    useEffect(() => {\r\n        const autoCalculateTrip = async () => {\r\n            if (mode === 'local' || isOdometerMode) {\r\n                setIsFetchingKM(false);\r\n                return;\r\n            }\r\n            if (!fromLoc || !toLoc) return;\r\n\r\n            setIsFetchingKM(true);\r\n            try {\r\n                const origin = pickupCoords || fromLoc;\r\n                const destination = dropCoords || toLoc;\r\n\r\n                if (pickupCoords && dropCoords) {\r\n                    const advanced = await calculateAdvancedRoute(pickupCoords, dropCoords);\r\n                    if (advanced) {\r\n                        const multiplier = (mode === 'outstation' || (mode === 'custom' && customTripType === 'Round Trip')) ? 2 : 1;\r\n                        const distVal = advanced.distanceKm * multiplier;\r\n                        setDistanceOverride(distVal.toString());\r\n\r\n                        if (advanced.tollPrice > 0 && !manualToll) {\r\n                            let baseToll = advanced.tollPrice;\r\n                            if (selectedVehicleId.includes('tempo')) baseToll *= 1.6;\r\n                            const finalToll = mode === 'drop' ? baseToll : (days > 1 ? baseToll * 2 : Math.round(baseToll * 1.6));\r\n                            setToll(Math.round(finalToll).toString());\r\n                        }\r\n                    } else {\r\n                        const res = await calculateDistance(origin, destination);\r\n                        if (res && res.distance) {\r\n                            const multiplier = (mode === 'outstation' || (mode === 'custom' && customTripType === 'Round Trip')) ? 2 : 1;\r\n                            setDistanceOverride((res.distance * multiplier).toString());\r\n                        }\r\n                    }\r\n                } else {\r\n                    const res = await calculateDistance(fromLoc, toLoc);\r\n                    if (res && res.distance) {\r\n                        const multiplier = (mode === 'outstation' || (mode === 'custom' && customTripType === 'Round Trip')) ? 2 : 1;\r\n                        setDistanceOverride((res.distance * multiplier).toString());\r\n                    }\r\n                }\r\n\r\n                if (!manualPermit) {\r\n                    const permitEst = estimatePermitCharge(fromLoc, toLoc, selectedVehicleId);\r\n                    setPermit(permitEst ? permitEst.amount.toString() : '0');\r\n                }\r\n                if (!manualParking) {\r\n                    const pInfo = estimateParkingCharge(toLoc);\r\n                    setParking(pInfo ? pInfo.amount.toString() : '0');\r\n                }\r\n            } catch (error) {\r\n                console.error('Error calculating trip data:', error);\r\n            } finally {\r\n                setIsFetchingKM(false);\r\n            }\r\n        };\r\n\r\n        const timer = setTimeout(autoCalculateTrip, 1000);\r\n        return () => clearTimeout(timer);\r\n    }, [fromLoc, toLoc, pickupCoords, dropCoords, mode, isOdometerMode, selectedVehicleId, days, manualPermit, manualParking, manualToll, customTripType]);\r\n\r\n    // Odometer sync\r\n    useEffect(() => {\r\n        if (isOdometerMode) {\r\n            const dist = Math.max(0, endKm - startKm);\r\n            setDistanceOverride(dist.toString());\r\n        }\r\n    }, [isOdometerMode, startKm, endKm]);\r\n\r\n    // Odometer OCR Handler\r\n    const handleOdometerScan = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file || !isScanning) return;\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = async (event) => {\r\n            const base64 = event.target?.result as string;\r\n            try {\r\n                const { lines } = await performOcr(base64);\r\n                const { mileage } = parseOdometer(lines);\r\n                if (mileage) {\r\n                    if (isScanning === 'start') {\r\n                        setStartKm(mileage);\r\n                        // Auto-calculate End KM if distance exists and End KM is not yet set\r\n                        if (distanceOverride && (!endKm || endKm <= mileage)) {\r\n                            setEndKm(mileage + (parseFloat(distanceOverride) || 0));\r\n                        }\r\n                    }\r\n                    if (isScanning === 'end') setEndKm(mileage);\r\n                    setIsOdometerMode(true);\r\n                } else {\r\n                    alert('Could not detect odometer reading. Please enter manually.');\r\n                }\r\n            } catch (err) {\r\n                console.error('OCR Error:', err);\r\n                alert('Scan failed. Please type manually.');\r\n            } finally {\r\n                setIsScanning(null);\r\n            }\r\n        };\r\n        reader.readAsDataURL(file);\r\n    };\r\n\r\n    // Auto Charges\r\n    // Auto Rate Update\r\n    useEffect(() => {\r\n        const vehicle = currentVehicleData;\r\n        if (vehicle) {\r\n            setCustomRate(mode === 'outstation' ? vehicle.round_trip_rate : vehicle.one_way_rate);\r\n        } else if (!selectedVehicleId) {\r\n            setCustomRate(0);\r\n        }\r\n    }, [currentVehicleData, mode, selectedVehicleId]);\r\n\r\n    // Auto Batta Update\r\n    useEffect(() => {\r\n        const vehicle = currentVehicleData;\r\n        if (vehicle && !manualDriverBatta) {\r\n            let batta = 0;\r\n            const dist = parseFloat(distanceOverride) || 0;\r\n            if (mode === 'outstation') {\r\n                const estDays = Math.max(days, Math.ceil(dist / TRIP_LIMITS.max_km_per_day));\r\n                batta = vehicle.driver_bata * estDays;\r\n            } else if (mode === 'drop') {\r\n                const estDays = Math.max(1, Math.ceil(dist / TRIP_LIMITS.max_km_per_day));\r\n                batta = (dist > 40 || vehicle.is_heavy_vehicle) ? vehicle.driver_bata * estDays : 0;\r\n            }\r\n            setDriverBatta(batta.toString());\r\n        }\r\n    }, [selectedVehicleId, mode, days, distanceOverride, manualDriverBatta, currentVehicleData]);\r\n\r\n    // Simplified Odometer Sync\r\n    useEffect(() => {\r\n        if (isOdometerMode && endKm > startKm) {\r\n            const dist = endKm - startKm;\r\n            setDistanceOverride(dist.toString());\r\n            if (mode === 'local') setLocalPackageKm(dist);\r\n        }\r\n    }, [startKm, endKm, isOdometerMode, mode]);\r\n\r\n    useEffect(() => {\r\n        if (mode === 'local' && startTimeLog && endTimeLog) {\r\n            const start = new Date(`2000-01-01T${startTimeLog}`);\r\n            let end = new Date(`2000-01-01T${endTimeLog}`);\r\n            if (end < start) {\r\n                end = new Date(`2000-01-02T${endTimeLog}`);\r\n            }\r\n            const diffMs = end.getTime() - start.getTime();\r\n            const diffHrs = diffMs / (1000 * 60 * 60);\r\n            if (diffHrs > 0) {\r\n                const hours = parseFloat(diffHrs.toFixed(1));\r\n                setLocalPackageHours(hours);\r\n\r\n                // Auto-select package\r\n                if (hours <= 2) setHourlyPackage('2hr_20km');\r\n                else if (hours <= 4) setHourlyPackage('4hr_40km');\r\n                else if (hours <= 8) setHourlyPackage('8hr_80km');\r\n                else setHourlyPackage('12hr_120km');\r\n            }\r\n        }\r\n    }, [startTimeLog, endTimeLog, mode]);\r\n\r\n    const performCalculation = async (): Promise<CalculationResult | null> => {\r\n        if (mode !== 'custom' && (!selectedVehicleId || !vehicleCategory)) return null;\r\n        if (mode === 'local' && !hourlyPackage) return null;\r\n        try {\r\n            const serviceType = mode === 'outstation' ? 'round_trip' : (mode === 'local' ? 'local_hourly' : 'one_way');\r\n            const dist = mode === 'local' ? localPackageKm : (parseFloat(distanceOverride) || 0);\r\n            let calcExtraHours = 0;\r\n            if (mode === 'local') {\r\n                let base = 8;\r\n                if (hourlyPackage === '2hr_20km') base = 2;\r\n                if (hourlyPackage === '4hr_40km') base = 4;\r\n                if (hourlyPackage === '12hr_120km') base = 12;\r\n                calcExtraHours = Math.max(0, localPackageHours - base);\r\n            }\r\n\r\n            let customBaseTotal = 0;\r\n            if (mode === 'custom') {\r\n                customBaseTotal = customLineItems.reduce((acc, item) => acc + item.amount, 0);\r\n            }\r\n\r\n            const overrideRate = (customRate && customRate > 0) ? customRate : undefined;\r\n            const finalDist = dist;\r\n\r\n            const res = await calculateFareAsync(\r\n                serviceType,\r\n                vehicleCategory || 'sedan',\r\n                finalDist,\r\n                mode === 'outstation' ? days : 1,\r\n                calcExtraHours,\r\n                manualHillStation && parseFloat(hillStationCharge) > 0,\r\n                mode === 'custom' ? undefined : overrideRate,\r\n                manualDriverBatta ? parseFloat(driverBatta) : undefined,\r\n                manualHillStation ? parseFloat(hillStationCharge) : undefined,\r\n                parseFloat(petCharge) || 0,\r\n                parseFloat(nightCharge) || 0,\r\n                hourlyPackage\r\n            );\r\n\r\n            const otherExtras = (parseFloat(permit) || 0) + (parseFloat(parking) || 0) + (parseFloat(toll) || 0) + extraItems.reduce((a, b) => a + b.amount, 0);\r\n            const subtotal = (mode === 'custom' ? customBaseTotal : res.totalFare) + otherExtras;\r\n\r\n            const gstRes = calculateGST(subtotal, gstRate, settings.gstin, customerGst);\r\n            const gstCalculated = includeGst ? gstRes.totalTax : 0;\r\n            const total = subtotal + gstCalculated;\r\n\r\n            const calcRes: CalculationResult = {\r\n                total, gst: gstCalculated, gstBreakdown: includeGst ? gstRes : undefined,\r\n                fare: subtotal, distance: dist, breakdown: res.breakdown,\r\n                effectiveDistance: res.effectiveDistance || dist, rateUsed: res.rateUsed || 0, distanceCharge: res.details.fare,\r\n                waitingCharges: 0, waitingHours: mode === 'local' ? localPackageHours : 0,\r\n                hillStationCharges: res.details.hillStation, petCharges: res.details.petCharge, driverBatta: res.details.driverBatta, nightStay: 0\r\n            };\r\n            return calcRes;\r\n        } catch (err) {\r\n            console.error(err); return null;\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        const timer = setTimeout(performCalculation, 300);\r\n        return () => clearTimeout(timer);\r\n    }, [mode, selectedVehicleId, distanceOverride, days, localPackageHours, hourlyPackage, customRate, toll, parking, permit, driverBatta, nightCharge, hillStationCharge, petCharge, extraItems, includeGst, manualDriverBatta, manualHillStation, customLineItems]);\r\n\r\n    const handleNext = () => {\r\n        if (step === 1 && mode === 'custom') {\r\n            setStep(3);\r\n        } else {\r\n            setStep(s => Math.min(3, s + 1));\r\n        }\r\n    };\r\n    const handleBack = () => {\r\n        if (step === 3 && mode === 'custom') {\r\n            setStep(1);\r\n        } else if (step === 1) {\r\n            setMode(null);\r\n            setStep(0);\r\n        } else {\r\n            setStep(s => Math.max(0, s - 1));\r\n        }\r\n    };\r\n\r\n    const handlePreview = async () => {\r\n        const res = await performCalculation();\r\n        if (!res) return;\r\n        const currentV = userVehicles.find(v => v.id === selectedVehicleId);\r\n\r\n        // Use existing session ID/Invoice if available, or generate purely for preview (don't set session yet? or should we?)\r\n        // For preview, we don't necessarily want to \"lock in\" the invoice number unless saved.\r\n        // But to be consistent with what WILL be saved:\r\n        const previewId = sessionTripId.current || generateId();\r\n        const previewInvoiceNo = invoiceNo || nextInvoiceNo;\r\n\r\n\r\n\r\n        // Construct items for Consistent PDF Format\r\n        const pdfItems = [];\r\n\r\n        // 1. Base Fare or Custom Invoice Items\r\n        if (mode === 'custom') {\r\n            customLineItems.forEach(i => pdfItems.push({\r\n                description: i.description,\r\n                amount: i.amount,\r\n                rate: i.rate.toString(),\r\n                quantity: i.qty,\r\n                sac: i.sac\r\n            }));\r\n        } else {\r\n            const baseRate = res.rateUsed;\r\n            const baseDist = res.effectiveDistance || res.distance;\r\n            let baseDesc = mode === 'local' ? `Local Rental` : (mode === 'outstation' ? `Round Trip` : `One Way Drop`);\r\n\r\n            if (mode === 'local') {\r\n                if (hourlyPackage === '8hr_80km') {\r\n                    baseDesc += ` [8 Hrs / 80 KM Package]`;\r\n                } else if (hourlyPackage === '12hr_120km') {\r\n                    baseDesc += ` [12 Hrs / 120 KM Package]`;\r\n                } else if (hourlyPackage === '4hr_40km') {\r\n                    baseDesc += ` [4 Hrs / 40 KM Package]`;\r\n                } else if (hourlyPackage === '2hr_20km') {\r\n                    baseDesc += ` [2 Hrs / 20 KM Package]`;\r\n                } else {\r\n                    baseDesc += ` [${localPackageHours} Hrs / ${localPackageKm} KM Package]`;\r\n                }\r\n            } else if (baseRate > 0) {\r\n                baseDesc += ` [${baseDist} KM * ${baseRate}/KM]`;\r\n            }\r\n\r\n            pdfItems.push({\r\n                description: baseDesc,\r\n                amount: res.distanceCharge,\r\n                rate: baseRate > 0 ? `${baseRate}/KM` : `${res.distanceCharge}`,\r\n                quantity: 1\r\n            });\r\n        }\r\n\r\n        // 2. Add Additional Charges (Batta, Tolls, etc.)\r\n        if (res.driverBatta > 0) {\r\n            const dist = res.effectiveDistance || res.distance;\r\n            let daysUsed = mode === 'outstation' ? Math.max(days, Math.ceil(dist / TRIP_LIMITS.max_km_per_day)) : 1;\r\n            if (mode === 'drop') {\r\n                daysUsed = Math.max(1, Math.ceil(dist / TRIP_LIMITS.max_km_per_day));\r\n            }\r\n            const battaRate = res.driverBatta / daysUsed;\r\n            pdfItems.push({\r\n                description: `Driver Batta [${daysUsed} Day${daysUsed > 1 ? 's' : ''} * ${battaRate}/Day]`,\r\n                amount: res.driverBatta,\r\n                rate: `${battaRate}/Day`,\r\n                quantity: daysUsed\r\n            });\r\n        }\r\n        if (parseFloat(toll) > 0) pdfItems.push({ description: 'Toll Charges', amount: parseFloat(toll), rate: toll, quantity: 1 });\r\n        if (parseFloat(parking) > 0) pdfItems.push({ description: 'Parking Charges', amount: parseFloat(parking), rate: parking, quantity: 1 });\r\n        if (parseFloat(permit) > 0) pdfItems.push({ description: 'Permit Charges', amount: parseFloat(permit), rate: permit, quantity: 1 });\r\n        if (res.hillStationCharges > 0) pdfItems.push({ description: 'Hill Station Charges', amount: res.hillStationCharges, rate: res.hillStationCharges.toString(), quantity: 1 });\r\n        if (parseFloat(nightCharge) > 0) pdfItems.push({ description: 'Night Charges', amount: parseFloat(nightCharge), rate: nightCharge, quantity: 1 });\r\n\r\n        extraItems.forEach(i => pdfItems.push({ description: i.description, amount: i.amount, rate: i.amount.toString(), quantity: 1 }));\r\n\r\n        const tripData: any = {\r\n            id: previewId, invoiceNo: previewInvoiceNo, customerName: customerName || 'Valued Customer',\r\n            customerPhone, customerGst, billingAddress, from: fromLoc, to: toLoc, date: invoiceDate,\r\n            mode: 'custom',\r\n            customTripType: mode === 'custom' ? customTripType : undefined,\r\n            totalFare: res.total, fare: res.fare, gst: res.gst,\r\n            extraItems: pdfItems,\r\n            previewStep: step,\r\n            vehicleNumber: currentV?.number,\r\n            vehicleModel: currentV?.model,\r\n            gstRate: includeGst ? gstRate : 0,\r\n            gstType: includeGst ? (res.gstBreakdown?.type || 'CGST_SGST') : undefined,\r\n            rcmEnabled: rcmEnabled,\r\n            terms: terms,\r\n            waitingHours: res.waitingHours, days, vehicleType: vehicleCategory,\r\n            startKm, endKm, distance: res.effectiveDistance || res.distance\r\n        };\r\n        const doc = await generateReceiptPDF(tripData, { ...settings, gstEnabled: includeGst, rcmEnabled, userId: user?.id, vehicleNumber: currentV?.number || settings.vehicles?.[0]?.number || 'N/A' });\r\n        setPreviewPdfUrl(URL.createObjectURL(doc.output('blob')));\r\n        setShowPreview(true);\r\n    };\r\n\r\n    const handleShare = async (calcRes?: CalculationResult) => {\r\n        const res = calcRes || await performCalculation();\r\n        if (!res) return;\r\n\r\n        // Ensure we have a session ID/Invoice if not already saved\r\n        if (!sessionTripId.current) sessionTripId.current = generateId();\r\n        // if (!sessionInvoiceNo.current) sessionInvoiceNo.current = nextInvoiceNo; // Use state now\r\n\r\n        const currentV = userVehicles.find(v => v.id === selectedVehicleId);\r\n\r\n        // Construct items for Consistent PDF Format (Same as Quotation)\r\n        const pdfItems = [];\r\n\r\n        // 1. Base Fare or Custom Invoice Items\r\n        if (mode === 'custom') {\r\n            customLineItems.forEach(i => pdfItems.push({\r\n                description: i.description,\r\n                amount: i.amount,\r\n                rate: i.rate.toString(),\r\n                quantity: i.qty,\r\n                sac: i.sac\r\n            }));\r\n        } else {\r\n            const baseRate = res.rateUsed;\r\n            const baseDist = res.effectiveDistance || res.distance;\r\n            let baseDesc = mode === 'local' ? `Local Rental` : (mode === 'outstation' ? `Round Trip` : `One Way Drop`);\r\n\r\n            if (mode === 'local') {\r\n                if (hourlyPackage === '8hr_80km') {\r\n                    baseDesc += ` [8 Hrs / 80 KM Package]`;\r\n                } else if (hourlyPackage === '12hr_120km') {\r\n                    baseDesc += ` [12 Hrs / 120 KM Package]`;\r\n                } else if (hourlyPackage === '4hr_40km') {\r\n                    baseDesc += ` [4 Hrs / 40 KM Package]`;\r\n                } else if (hourlyPackage === '2hr_20km') {\r\n                    baseDesc += ` [2 Hrs / 20 KM Package]`;\r\n                } else {\r\n                    baseDesc += ` [${localPackageHours} Hrs / ${localPackageKm} KM Package]`;\r\n                }\r\n                // Append actual usage\r\n                if (localPackageHours > 0 || localPackageKm > 0) {\r\n                    baseDesc += ` (Journey: ${localPackageHours}hrs/${localPackageKm}km)`;\r\n                }\r\n            } else if (baseRate > 0) {\r\n                baseDesc += ` [${baseDist} KM * ${baseRate}/KM]`;\r\n            }\r\n\r\n            pdfItems.push({\r\n                description: baseDesc,\r\n                amount: res.distanceCharge,\r\n                rate: baseRate > 0 ? `${baseRate}/KM` : `${res.distanceCharge}`,\r\n                quantity: 1\r\n            });\r\n        }\r\n\r\n        // 2. Add Additional Charges (Batta, Tolls, etc.)\r\n        if (res.driverBatta > 0) {\r\n            const dist = res.effectiveDistance || res.distance;\r\n            let daysUsed = mode === 'outstation' ? Math.max(days, Math.ceil(dist / TRIP_LIMITS.max_km_per_day)) : 1;\r\n            if (mode === 'drop') {\r\n                daysUsed = Math.max(1, Math.ceil(dist / TRIP_LIMITS.max_km_per_day));\r\n            }\r\n            const battaRate = res.driverBatta / daysUsed;\r\n            pdfItems.push({\r\n                description: `Driver Batta [${daysUsed} Day${daysUsed > 1 ? 's' : ''} * ${battaRate}/Day]`,\r\n                amount: res.driverBatta,\r\n                rate: `${battaRate}/Day`,\r\n                quantity: daysUsed\r\n            });\r\n        }\r\n        if (parseFloat(toll) > 0) pdfItems.push({ description: 'Toll Charges', amount: parseFloat(toll), rate: toll, quantity: 1 });\r\n        if (parseFloat(parking) > 0) pdfItems.push({ description: 'Parking Charges', amount: parseFloat(parking), rate: parking, quantity: 1 });\r\n        if (parseFloat(permit) > 0) pdfItems.push({ description: 'Permit Charges', amount: parseFloat(permit), rate: permit, quantity: 1 });\r\n        if (res.hillStationCharges > 0) pdfItems.push({ description: 'Hill Station Charges', amount: res.hillStationCharges, rate: res.hillStationCharges.toString(), quantity: 1 });\r\n        if (parseFloat(nightCharge) > 0) pdfItems.push({ description: 'Night Charges', amount: parseFloat(nightCharge), rate: nightCharge, quantity: 1 });\r\n\r\n        extraItems.forEach(i => pdfItems.push({ description: i.description, amount: i.amount, rate: i.amount.toString(), quantity: 1 }));\r\n\r\n        const tripData: any = {\r\n            id: sessionTripId.current, invoiceNo: invoiceNo, customerName: customerName || 'Valued Customer',\r\n            customerPhone, customerGst, billingAddress, from: fromLoc, to: toLoc, date: invoiceDate,\r\n            startTime: mode === 'local' ? startTimeLog : undefined,\r\n            endTime: mode === 'local' ? endTimeLog : undefined,\r\n            mode: 'custom',\r\n            customTripType: mode === 'custom' ? customTripType : undefined,\r\n            totalFare: res.total, fare: res.fare, gst: res.gst,\r\n            extraItems: pdfItems,\r\n            vehicleNumber: currentV?.number,\r\n            vehicleModel: currentV?.model,\r\n            gstRate: includeGst ? gstRate : 0,\r\n            gstType: includeGst ? (res.gstBreakdown?.type || 'CGST_SGST') : undefined,\r\n            rcmEnabled: rcmEnabled,\r\n            terms: terms,\r\n            waitingHours: res.waitingHours, days, vehicleType: vehicleCategory,\r\n            startKm, endKm, distance: res.effectiveDistance || res.distance\r\n        };\r\n\r\n        try {\r\n            await shareReceipt(tripData, { ...settings, gstEnabled: includeGst, rcmEnabled, userId: user?.id, vehicleNumber: currentV?.number || settings.vehicles?.[0]?.number || 'N/A' });\r\n        } catch (err) {\r\n            console.error('Sharing failed, falling back to preview', err);\r\n            handlePreview();\r\n        }\r\n    };\r\n\r\n\r\n    // ... (existing helper imports) ...\r\n\r\n    const handleSave = async (calcRes?: CalculationResult) => {\r\n        const res = calcRes || await performCalculation();\r\n        if (!res) return null;\r\n        if (customerName) saveToHistory('customer_name', customerName);\r\n        if (customerPhone) saveToHistory('customer_phone', customerPhone);\r\n        if (fromLoc) saveToHistory('location', fromLoc);\r\n        if (toLoc) saveToHistory('location', toLoc);\r\n        const currentV = userVehicles.find(v => v.id === selectedVehicleId);\r\n\r\n        // LOCK IN the ID and Invoice Number for this session\r\n        if (!sessionTripId.current) sessionTripId.current = generateId();\r\n        // if (!sessionInvoiceNo.current) sessionInvoiceNo.current = nextInvoiceNo; // Use state now\r\n\r\n        // Log to Admin Analytics (Non-blocking)\r\n        Analytics.logActivity('invoice_created', {\r\n            invoiceNo: invoiceNo,\r\n            customer: customerName,\r\n            amount: res.total,\r\n            mode: mode\r\n        }, user?.id);\r\n\r\n        Analytics.generateInvoice('invoice', res.total);\r\n\r\n        const tripData: Trip = {\r\n            id: sessionTripId.current, invoiceNo: invoiceNo, customerName: customerName || 'Cash Guest', customerPhone, customerGst,\r\n            from: fromLoc, to: toLoc, billingAddress, startKm: isOdometerMode ? startKm : 0, endKm: isOdometerMode ? endKm : (parseFloat(distanceOverride) || 0),\r\n            startTime: '', endTime: '', toll: parseFloat(toll) || 0, parking: parseFloat(parking) || 0, nightBata: parseFloat(nightCharge) || 0,\r\n            baseFare: settings.baseFare, ratePerKm: res.rateUsed, totalFare: res.total, fare: res.fare, distanceCharge: res.distanceCharge,\r\n            distance: res.distance, effectiveDistance: res.effectiveDistance, gst: res.gst, date: invoiceDate ? (invoiceDate.includes('T') ? invoiceDate : `${invoiceDate}T12:00:00Z`) : new Date().toISOString(),\r\n            mode: mode as any, notes: '', waitingHours: res.waitingHours, waitingCharges: 0, hillStationCharges: res.hillStationCharges,\r\n            petCharges: res.petCharges, permit: parseFloat(permit) || 0, days, driverBatta: res.driverBatta, extraItems,\r\n            rcmEnabled, // Save RCM status\r\n            terms, // Save Terms\r\n            gstRate: includeGst ? gstRate : 0, // Save Rate\r\n            gstType: includeGst ? (res.gstBreakdown?.type || 'CGST_SGST') : undefined,\r\n            vehicleId: selectedVehicleId,\r\n            vehicleNumber: currentV?.number,\r\n            vehicleModel: currentV?.model\r\n        };\r\n\r\n        await onSaveTrip(tripData);\r\n        return tripData;\r\n    };\r\n\r\n    const handleSaveAndShare = async () => {\r\n        if (isSubmitting) return;\r\n        setIsSubmitting(true);\r\n\r\n        try {\r\n            const res = await performCalculation();\r\n            if (!res) {\r\n                setIsSubmitting(false);\r\n                return;\r\n            }\r\n\r\n            // Lock IDs now so they are ready for background save/share\r\n            if (!sessionTripId.current) sessionTripId.current = generateId();\r\n            // if (!sessionInvoiceNo.current) sessionInvoiceNo.current = nextInvoiceNo; // Use state now\r\n\r\n            // Pre-warm PDF dependencies\r\n            import('jspdf');\r\n\r\n            // Direct execution instead of nested triggerAction for reliability\r\n            try {\r\n                // Start saving and wait for it\r\n                await handleSave(res);\r\n\r\n                // Immediately trigger share (more likely to succeed on gesture)\r\n                await handleShare(res);\r\n\r\n                // RESET SESSION REFS so next trip gets new ID\r\n                sessionTripId.current = null;\r\n                sessionInvoiceNo.current = null;\r\n\r\n                setStep(0);\r\n                setMode(null);\r\n                if (onStepChange) onStepChange(0);\r\n            } catch (error) {\r\n                console.error('Save & Share operation failed:', error);\r\n                alert('An error occurred while saving or sharing. Please check your connection.');\r\n            } finally {\r\n                setIsSubmitting(false);\r\n            }\r\n        } catch (error) {\r\n            console.error('Save & Share setup failed:', error);\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n\r\n\r\n    // --- Helper Functions ---\r\n    const handleAddCharge = () => {\r\n        const desc = selectedChargeType === 'Custom' ? customChargeName : selectedChargeType;\r\n        const amount = parseFloat(customChargeAmount);\r\n        if (desc && amount > 0) {\r\n            setExtraItems(prev => [...prev, { description: desc, amount }]);\r\n            setCustomChargeName('');\r\n            setCustomChargeAmount('');\r\n            setSelectedChargeType('');\r\n        }\r\n    };\r\n\r\n    const renderStep1 = () => (\r\n        <div className=\"space-y-2 animate-in fade-in slide-in-from-right-4 duration-500\">\r\n            <h2 className=\"text-xs font-black text-slate-800 uppercase tracking-tight px-1\">\r\n                Create Invoice\r\n            </h2>\r\n            <div className=\"grid grid-cols-2 gap-2 px-0.5\">\r\n                {(['custom', 'local', 'drop', 'outstation'] as const).map((m) => (\r\n                    <button key={m} onClick={() => {\r\n                        if (mode !== m) {\r\n                            setMode(m);\r\n                            // Reset Data on Mode Switch\r\n                            setFromLoc(''); setToLoc('');\r\n                            setStartKm(0); setEndKm(0); setDistanceOverride('');\r\n                            setDays(1); setLocalPackageHours(8);\r\n                            setExtraItems([]);\r\n                            setToll('0'); setParking('0'); setPermit('0'); setDriverBatta('0');\r\n                            setNightCharge('0'); setHillStationCharge('0'); setPetCharge('0');\r\n                            setCustomLineItems([{ description: 'Service Charge', sac: '9966', qty: 1, rate: 0, amount: 0 }]);\r\n                            setIsOdometerMode(false);\r\n                            setManualDriverBatta(false); setManualToll(false); setManualParking(false);\r\n                            setManualPermit(false); setManualHillStation(false);\r\n                        }\r\n                        setStep(1);\r\n                    }} className={`flex flex-col items-center gap-1.5 p-2.5 rounded-xl border transition-all text-center ${mode === m ? 'bg-blue-600 border-blue-600 shadow-md ring-2 ring-blue-100' : 'bg-white border-slate-100 hover:border-blue-200 shadow-sm'}`}>\r\n                        <div className={`w-8 h-8 rounded-lg flex items-center justify-center shrink-0 ${mode === m ? 'bg-white text-blue-600' : 'bg-blue-50 text-blue-600'}`}>\r\n                            {m === 'drop' && <MoveRight size={16} />}\r\n                            {m === 'outstation' && <Repeat size={16} />}\r\n                            {m === 'local' && <Clock size={16} />}\r\n                            {m === 'custom' && <PenLine size={16} />}\r\n                        </div>\r\n                        <div className=\"flex flex-col items-center gap-0.5 min-w-0\">\r\n                            <span className={`text-[10px] font-black uppercase tracking-wider leading-tight ${mode === m ? 'text-white' : 'text-slate-800'}`}>\r\n                                {m === 'drop' ? 'One Way' : m === 'outstation' ? 'Outstation' : m === 'local' ? 'Local' : 'Manual'}\r\n                            </span>\r\n                            <span className={`text-[8px] font-bold uppercase tracking-wide ${mode === m ? 'text-white/70' : 'text-slate-400'}`}>\r\n                                {m === 'drop' && 'Drop'}\r\n                                {m === 'outstation' && 'Round Trip'}\r\n                                {m === 'local' && 'Rental'}\r\n                                {m === 'custom' && 'Editor'}\r\n                            </span>\r\n                        </div>\r\n                    </button>\r\n                ))}\r\n            </div>\r\n        </div >\r\n    );\r\n\r\n    const renderStep2 = () => (\r\n        <div className=\"space-y-4 animate-in fade-in slide-in-from-right-4 duration-500\">\r\n            {mode === 'custom' ? (\r\n                <>\r\n                    {/* 1. Primary Focus: Invoice Items (The \"Excel/Word\" feel) */}\r\n                    {/* 1. Invoice Meta Details - Separated for clarity */}\r\n                    <div className=\"p-2.5 bg-white rounded-xl border border-slate-200 shadow-sm space-y-2.5\">\r\n                        <div className=\"flex justify-between items-center\">\r\n                            <h3 className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2\">\r\n                                <StickyNote size={12} className=\"text-blue-600\" /> Invoice Details\r\n                            </h3>\r\n                            <div className={`flex items-center gap-2 px-2 py-1.5 rounded-lg border transition-all ${includeGst ? 'bg-blue-50 border-blue-200 shadow-sm' : 'bg-slate-50 border-slate-200'}`}>\r\n                                <span className={`text-[9px] font-black uppercase tracking-wider ${includeGst ? 'text-blue-700' : 'text-slate-400'}`}>\r\n                                    {includeGst ? 'GST Invoice' : 'Non-GST Bill'}\r\n                                </span>\r\n                                <button onClick={() => {\r\n                                    if (!settings.gstin) {\r\n                                        alert('Please add your GSTIN in Settings to enable Forward Charge GST.');\r\n                                        return;\r\n                                    }\r\n                                    const newState = !includeGst;\r\n                                    setIncludeGst(newState);\r\n                                    if (newState) setRcmEnabled(false);\r\n                                }} className={`w-9 h-5 rounded-full relative transition-colors ${includeGst ? 'bg-blue-600' : 'bg-slate-300'}`}>\r\n                                    <div className={`absolute top-1 w-3 h-3 bg-white rounded-full transition-all shadow-sm ${includeGst ? 'left-5' : 'left-1'}`} />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex gap-2\">\r\n                            <div className=\"flex-1 space-y-0.5\">\r\n                                <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Invoice No</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    value={invoiceNo}\r\n                                    onChange={(e) => setInvoiceNo(e.target.value)}\r\n                                    className=\"tn-input h-8 w-full bg-slate-50 border-slate-200 text-xs font-bold text-center uppercase rounded-lg\"\r\n                                    placeholder=\"INV-001\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"flex-1 space-y-0.5\">\r\n                                <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Date</label>\r\n                                <input\r\n                                    type=\"date\"\r\n                                    value={invoiceDate}\r\n                                    onChange={(e) => setInvoiceDate(e.target.value)}\r\n                                    className=\"tn-input h-8 w-full bg-slate-50 border-slate-200 text-xs font-bold text-center rounded-lg\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"pt-2 border-t border-slate-50 mt-2 space-y-0.5\">\r\n                             <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Trip Description</label>\r\n                             <select \r\n                                 value={customTripType} \r\n                                 onChange={(e) => {\r\n                                     setCustomTripType(e.target.value);\r\n                                     // Optional: Auto-update the first line item description if it's generic\r\n                                     if (customLineItems.length > 0 && (customLineItems[0].description === 'Service Charge' || customLineItems[0].description.includes('Charges'))) {\r\n                                         const newItems = [...customLineItems];\r\n                                         newItems[0].description = `${e.target.value} Charges`;\r\n                                         setCustomLineItems(newItems);\r\n                                     }\r\n                                 }}\r\n                                 className=\"tn-input h-9 w-full bg-slate-50 border-slate-200 text-xs font-bold rounded-lg px-2\"\r\n                             >\r\n                                 <option value=\"Taxi Service\">General Taxi Service</option>\r\n                                 <option value=\"One Way Drop\">One Way Drop</option>\r\n                                 <option value=\"Round Trip\">Round Trip</option>\r\n                                 <option value=\"Local Rental\">Local Rental</option>\r\n                                 <option value=\"Airport Transfer\">Airport Transfer</option>\r\n                                 <option value=\"Corporate Duty\">Corporate Duty</option>\r\n                                 <option value=\"Wedding Event\">Wedding Event</option>\r\n                             </select>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* 2. Billable Items List */}\r\n                    <div className=\"p-3 bg-white rounded-2xl border border-slate-200 shadow-sm space-y-3\">\r\n                        <div className=\"flex justify-between items-center mb-0.5\">\r\n                            <div className=\"flex flex-col\">\r\n                                <h3 className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2\">\r\n                                    <PenLine size={12} className=\"text-blue-600\" /> Billable Items\r\n                                </h3>\r\n                            </div>\r\n                            <div className=\"bg-slate-100 px-2 py-0.5 rounded-md\">\r\n                                <span className=\"text-[9px] font-black text-slate-500 uppercase tracking-wider\">\r\n                                    {customLineItems.length} Item{customLineItems.length !== 1 ? 's' : ''}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2.5\">\r\n                            {customLineItems.map((item, idx) => (\r\n                                <div key={idx} className=\"p-2.5 bg-slate-50 rounded-xl border border-slate-200/60 shadow-sm flex flex-col gap-2 group\">\r\n                                    {/* Top Row: Description & SAC */}\r\n                                    <div className=\"flex gap-2\">\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            placeholder=\"Item Description\"\r\n                                            value={item.description}\r\n                                            onChange={(e) => {\r\n                                                const newItems = [...customLineItems];\r\n                                                newItems[idx].description = e.target.value;\r\n                                                setCustomLineItems(newItems);\r\n                                            }}\r\n                                            className=\"flex-1 h-8 bg-white border-slate-200 rounded-lg px-2.5 text-xs font-bold focus:border-blue-500 focus:ring-1 focus:ring-blue-500/20 transition-all placeholder:text-slate-300\"\r\n                                        />\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            placeholder=\"SAC\"\r\n                                            value={item.sac}\r\n                                            onChange={(e) => {\r\n                                                const newItems = [...customLineItems];\r\n                                                newItems[idx].sac = e.target.value;\r\n                                                setCustomLineItems(newItems);\r\n                                            }}\r\n                                            className=\"w-14 h-8 bg-white border-slate-200 rounded-lg px-1 text-[10px] text-center font-bold placeholder:text-slate-300\"\r\n                                            title=\"SAC Code\"\r\n                                        />\r\n                                    </div>\r\n\r\n                                    {/* Bottom Row: Qty x Rate = Amount */}\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <div className=\"relative w-14 group/input shrink-0\">\r\n                                            <span className=\"absolute left-2 top-1/2 -translate-y-1/2 text-[8px] text-slate-400 font-bold uppercase pointer-events-none group-focus-within/input:text-blue-500\">Qty</span>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                placeholder=\"0\"\r\n                                                value={item.qty === 0 ? '' : item.qty}\r\n                                                onChange={(e) => {\r\n                                                    const rawVal = e.target.value;\r\n                                                    const val = parseFloat(rawVal) || 0;\r\n                                                    const newItems = [...customLineItems];\r\n                                                    newItems[idx].qty = rawVal === '' ? 0 : val;\r\n                                                    newItems[idx].amount = (rawVal === '' ? 0 : val) * newItems[idx].rate;\r\n                                                    setCustomLineItems(newItems);\r\n                                                }}\r\n                                                className=\"w-full h-8 bg-white border-slate-200 rounded-lg pl-6 pr-1 text-xs font-bold text-center focus:border-blue-500 transition-colors\"\r\n                                            />\r\n                                        </div>\r\n\r\n                                        <span className=\"text-slate-300 font-bold text-xs shrink-0\"></span>\r\n\r\n                                        <div className=\"relative w-18 group/input shrink-0\">\r\n                                            <span className=\"absolute left-2 top-1/2 -translate-y-1/2 text-[8px] text-slate-400 font-bold uppercase pointer-events-none group-focus-within/input:text-blue-500\"></span>\r\n                                            <input\r\n                                                type=\"number\"\r\n                                                placeholder=\"Rate\"\r\n                                                value={item.rate === 0 ? '' : item.rate}\r\n                                                onChange={(e) => {\r\n                                                    const rawVal = e.target.value;\r\n                                                    const val = parseFloat(rawVal) || 0;\r\n                                                    const newItems = [...customLineItems];\r\n                                                    newItems[idx].rate = rawVal === '' ? 0 : val;\r\n                                                    newItems[idx].amount = newItems[idx].qty * (rawVal === '' ? 0 : val);\r\n                                                    setCustomLineItems(newItems);\r\n                                                }}\r\n                                                className=\"w-full h-8 bg-white border-slate-200 rounded-lg pl-3 pr-1 text-xs font-bold text-center focus:border-blue-500 transition-colors\"\r\n                                            />\r\n                                        </div>\r\n\r\n                                        <div className=\"h-4 w-px bg-slate-300 mx-1 shrink-0\" />\r\n\r\n                                        <div className=\"flex-1 min-w-[50px] text-right font-black text-slate-900 text-sm\">\r\n                                            {item.amount.toLocaleString()}\r\n                                        </div>\r\n\r\n                                        <button\r\n                                            onClick={() => {\r\n                                                const newItems = customLineItems.filter((_, i) => i !== idx);\r\n                                                setCustomLineItems(newItems);\r\n                                            }}\r\n                                            className=\"h-8 w-8 flex items-center justify-center text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all shrink-0\"\r\n                                            title=\"Remove Item\"\r\n                                        >\r\n                                            <Trash2 size={14} />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                            <button\r\n                                onClick={() => setCustomLineItems([...customLineItems, { description: '', sac: '9966', qty: 1, rate: 0, amount: 0 }])}\r\n                                className=\"w-full py-2.5 flex items-center justify-center gap-2 text-[9px] font-black text-blue-600 bg-blue-50/50 rounded-xl border-2 border-dashed border-blue-200 hover:bg-blue-50 hover:border-blue-300 transition-all uppercase tracking-widest mt-2\"\r\n                            >\r\n                                <Plus size={12} strokeWidth={3} /> Add Another Line Item\r\n                            </button>\r\n\r\n                            <div className=\"flex justify-between items-center px-3 py-3 bg-slate-50 border border-slate-200 rounded-xl mt-2\">\r\n                                <span className=\"text-[9px] font-black uppercase tracking-widest text-slate-500\">Total Amount</span>\r\n                                <span className=\"text-xl font-black tracking-tight text-slate-900\">\r\n                                    {customLineItems.reduce((acc, item) => acc + item.amount, 0).toLocaleString()}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* 2. Optional: Journey Section for Record */}\r\n                    <div className=\"p-3 bg-white rounded-xl border border-slate-200 shadow-sm space-y-3\">\r\n                        <div className=\"flex justify-between items-center mb-0.5\">\r\n                            <h3 className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2\"><MapPin size={12} className=\"text-blue-600\" /> Route (Optional)</h3>\r\n                            <div className=\"flex bg-slate-100 p-0.5 rounded-lg border border-slate-200\">\r\n                                <button\r\n                                    onClick={() => setIsOdometerMode(false)}\r\n                                    className={`px-1.5 py-0.5 text-[8px] font-black uppercase rounded-md transition-all ${!isOdometerMode ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-400'}`}\r\n                                >\r\n                                    Address\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => setIsOdometerMode(true)}\r\n                                    className={`px-1.5 py-0.5 text-[8px] font-black uppercase rounded-md transition-all ${isOdometerMode ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-400'}`}\r\n                                >\r\n                                    Odometer\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"space-y-2 relative\">\r\n                            <PlacesAutocomplete\r\n                                label=\"From\"\r\n                                value={fromLoc}\r\n                                onChange={setFromLoc}\r\n                                onPlaceSelected={(p) => { setFromLoc(p.address); setPickupCoords({ lat: p.lat, lng: p.lng }); }}\r\n                                onMapClick={() => setShowMap(true)}\r\n                            />\r\n\r\n                            {/* Swap Button */}\r\n                            <div className=\"absolute right-10 top-9 z-10\">\r\n                                <button\r\n                                    onClick={handleSwapRoute}\r\n                                    className=\"w-7 h-7 bg-white border border-slate-200 rounded-full shadow-sm flex items-center justify-center text-blue-600 hover:bg-blue-50 transition-colors\"\r\n                                    title=\"Swap Route\"\r\n                                >\r\n                                    <Repeat size={12} className=\"rotate-90\" />\r\n                                </button>\r\n                            </div>\r\n\r\n                            <PlacesAutocomplete\r\n                                label=\"To\"\r\n                                value={toLoc}\r\n                                onChange={setToLoc}\r\n                                onPlaceSelected={(p) => { setToLoc(p.address); setDropCoords({ lat: p.lat, lng: p.lng }); }}\r\n                                onMapClick={() => setShowMap(true)}\r\n                            />\r\n                        </div>\r\n\r\n                        {!isOdometerMode && (\r\n                            <div className=\"pt-2 border-t border-slate-50 space-y-0.5\">\r\n                                <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Distance Travelled (KM)</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    value={distanceOverride}\r\n                                    onChange={(e) => setDistanceOverride(e.target.value)}\r\n                                    className=\"tn-input h-9 w-full bg-slate-50 border-slate-200 text-xs text-slate-900 font-bold rounded-lg\"\r\n                                    placeholder=\"e.g. 120\"\r\n                                />\r\n                            </div>\r\n                        )}\r\n\r\n                        {isOdometerMode && (\r\n                            <div className=\"grid grid-cols-2 gap-2.5 pt-2 border-t border-slate-50\">\r\n                                <div className=\"space-y-0.5\">\r\n                                    <p className=\"text-[8px] font-bold text-slate-400 uppercase ml-1 flex justify-between items-center\">Start KM <button onClick={() => { setIsScanning('start'); fileInputRef.current?.click(); }} className=\"text-blue-600\"><Camera size={10} /></button></p>\r\n                                    <input type=\"number\" value={startKm || ''} onChange={(e) => setStartKm(parseFloat(e.target.value) || 0)} className=\"tn-input h-9 w-full bg-slate-50 border-slate-200 text-xs text-slate-950 font-bold rounded-lg\" placeholder=\"0\" />\r\n                                </div>\r\n                                <div className=\"space-y-0.5\">\r\n                                    <p className=\"text-[8px] font-bold text-slate-400 uppercase ml-1 flex justify-between items-center\">End KM <button onClick={() => { setIsScanning('end'); fileInputRef.current?.click(); }} className=\"text-blue-600\"><Camera size={10} /></button></p>\r\n                                    <input type=\"number\" value={endKm || ''} onChange={(e) => setEndKm(parseFloat(e.target.value) || 0)} className=\"tn-input h-9 w-full bg-slate-50 border-slate-200 text-xs text-slate-950 font-bold rounded-lg\" placeholder=\"0\" />\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </>\r\n            ) : (\r\n                <>\r\n                    {/* Standard Journey Details for Automated Modes */}\r\n                    <div className=\"p-3 bg-white rounded-xl border border-slate-200 shadow-sm space-y-3\">\r\n                        <h3 className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2\"><MapPin size={12} className=\"text-blue-600\" /> Journey Details</h3>\r\n                        <div className=\"space-y-2 relative\">\r\n                            <PlacesAutocomplete\r\n                                label=\"Pickup\"\r\n                                value={fromLoc}\r\n                                onChange={setFromLoc}\r\n                                onPlaceSelected={(p) => { setFromLoc(p.address); setPickupCoords({ lat: p.lat, lng: p.lng }); }}\r\n                                onMapClick={() => setShowMap(true)}\r\n                            />\r\n\r\n                            {mode !== 'local' && (\r\n                                <>\r\n                                    {/* Swap Button */}\r\n                                    <div className=\"absolute right-10 top-9 z-10\">\r\n                                        <button\r\n                                            onClick={handleSwapRoute}\r\n                                            className=\"w-7 h-7 bg-white border border-slate-200 rounded-full shadow-sm flex items-center justify-center text-blue-600 hover:bg-blue-50 transition-colors\"\r\n                                            title=\"Swap Route\"\r\n                                        >\r\n                                            <Repeat size={12} className=\"rotate-90\" />\r\n                                        </button>\r\n                                    </div>\r\n                                    <PlacesAutocomplete\r\n                                        label=\"Drop\"\r\n                                        value={toLoc}\r\n                                        onChange={setToLoc}\r\n                                        onPlaceSelected={(p) => { setToLoc(p.address); setDropCoords({ lat: p.lat, lng: p.lng }); }}\r\n                                        onMapClick={() => setShowMap(true)}\r\n                                    />\r\n                                </>\r\n                            )}\r\n                        </div>\r\n\r\n                        {mode !== 'local' && (\r\n                            <div className=\"flex justify-end -mt-1\">\r\n                                <div className=\"flex bg-slate-100 p-0.5 rounded-lg border border-slate-200\">\r\n                                    <button\r\n                                        onClick={() => setIsOdometerMode(false)}\r\n                                        className={`px-1.5 py-0.5 text-[8px] font-black uppercase rounded-md transition-all ${!isOdometerMode ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-400'}`}\r\n                                    >\r\n                                        Direct KM\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => setIsOdometerMode(true)}\r\n                                        className={`px-1.5 py-0.5 text-[8px] font-black uppercase rounded-md transition-all ${isOdometerMode ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-400'}`}\r\n                                    >\r\n                                        Odometer\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"pt-0.5 border-t border-slate-50 space-y-2\">\r\n                            {!isOdometerMode && mode !== 'local' && (\r\n                                <div className=\"space-y-0.5\">\r\n                                    <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Trip Distance (KM)</label>\r\n                                    <input type=\"number\"\r\n                                        value={isFetchingKM ? '' : distanceOverride}\r\n                                        onChange={(e) => setDistanceOverride(e.target.value)}\r\n                                        className=\"tn-input h-9 w-full bg-slate-50 border-slate-200 text-xs text-slate-900 font-bold rounded-lg\"\r\n                                        placeholder={isFetchingKM ? \"Calculating...\" : \"0\"}\r\n                                    />\r\n                                </div>\r\n                            )}\r\n                            {(isOdometerMode || (mode === 'outstation' || (mode === 'drop' && parseFloat(distanceOverride) > 30))) && mode !== 'local' && (\r\n                                <div className=\"grid grid-cols-2 gap-2.5\">\r\n                                    <div className=\"space-y-0.5\">\r\n                                        <p className=\"text-[8px] font-bold text-slate-400 uppercase ml-1 flex justify-between items-center\">Start KM <button onClick={() => { setIsScanning('start'); fileInputRef.current?.click(); }} className=\"text-blue-600\"><Camera size={10} /></button></p>\r\n                                        <input type=\"number\" value={startKm || ''} onChange={(e) => setStartKm(parseFloat(e.target.value) || 0)} className=\"tn-input h-9 w-full bg-slate-50 border-slate-200 text-xs text-slate-900 font-bold rounded-lg\" placeholder=\"0\" />\r\n                                    </div>\r\n                                    <div className=\"space-y-0.5\">\r\n                                        <p className=\"text-[8px] font-bold text-slate-400 uppercase ml-1 flex justify-between items-center\">End KM <button onClick={() => { setIsScanning('end'); fileInputRef.current?.click(); }} className=\"text-blue-600\"><Camera size={10} /></button></p>\r\n                                        <input type=\"number\" value={endKm || ''} onChange={(e) => setEndKm(parseFloat(e.target.value) || 0)} className=\"tn-input h-9 w-full bg-slate-50 border-slate-200 text-xs text-slate-900 font-bold rounded-lg\" placeholder=\"0\" />\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {mode === 'local' && (\r\n                            <div className=\"pt-2 border-t border-slate-50 space-y-2.5\">\r\n                                <div className=\"grid grid-cols-2 gap-2.5\">\r\n                                    <div className=\"space-y-0.5\">\r\n                                        <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Start Time</label>\r\n                                        <input type=\"time\" value={startTimeLog} onChange={e => setStartTimeLog(e.target.value)} className=\"tn-input h-9 w-full font-bold text-xs bg-slate-50 border-slate-100 rounded-lg px-2\" />\r\n                                    </div>\r\n                                    <div className=\"space-y-0.5\">\r\n                                        <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">End Time</label>\r\n                                        <input type=\"time\" value={endTimeLog} onChange={e => setEndTimeLog(e.target.value)} className=\"tn-input h-9 w-full font-bold text-xs bg-slate-50 border-slate-100 rounded-lg px-2\" />\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center justify-between px-2.5 py-1.5 bg-blue-50/50 rounded-lg border border-blue-100/50\">\r\n                                    <span className=\"text-[9px] uppercase font-black text-slate-400 tracking-wider\">Calculated:</span>\r\n                                    <div className=\"flex gap-4\">\r\n                                        <span className=\"text-xs font-black text-blue-700\">{localPackageHours} Hrs</span>\r\n                                        <span className=\"text-xs font-black text-blue-700\">{localPackageKm} KM</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </>\r\n            )}\r\n\r\n            {showMap && (\r\n                <MapPicker\r\n                    onLocationSelect={handleMapSelect}\r\n                    onClose={() => setShowMap(false)}\r\n                />\r\n            )}\r\n\r\n            {/* Vehicle Section */}\r\n            <div className=\"p-3 bg-white rounded-xl border border-slate-200 shadow-sm space-y-3\">\r\n                <h3 className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2\"><Car size={12} className=\"text-slate-600\" /> Vehicle Branding</h3>\r\n\r\n                <div className=\"space-y-2.5\">\r\n                    <div className=\"space-y-0.5\">\r\n                        <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Select Cab</label>\r\n                        <select\r\n                            value={selectedVehicleId}\r\n                            onChange={(e) => setSelectedVehicleId(e.target.value)}\r\n                            className=\"tn-input h-9 w-full bg-slate-50 border-slate-100 text-xs text-slate-900 font-bold rounded-lg px-2\"\r\n                        >\r\n                            <option value=\"\">Choose from Fleet</option>\r\n                            {userVehicles.map((v) => (\r\n                                <option key={v.id} value={v.id}>{v.model} - {v.number}</option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 gap-3 pt-1\">\r\n                        {mode === 'outstation' ? (\r\n                            <div className=\"space-y-0.5\">\r\n                                <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Trip Days</label>\r\n                                <input type=\"number\" value={days} onChange={e => setDays(parseFloat(e.target.value) || 1)} className=\"tn-input h-9 w-full bg-slate-50 border-slate-100 text-xs text-slate-900 font-bold rounded-lg px-3\" placeholder=\"1\" />\r\n                            </div>\r\n                        ) : mode === 'local' ? (\r\n                            <div className=\"space-y-2\">\r\n                                <div className=\"space-y-1\">\r\n                                    <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Rental Package</label>\r\n                                    <div className=\"flex gap-2 overflow-x-auto pb-1 -mx-0.5 px-0.5 scrollbar-none snap-x\">\r\n                                        {[\r\n                                            { id: '2hr_20km', hr: '2 Hr', km: '20 Km' },\r\n                                            { id: '4hr_40km', hr: '4 Hr', km: '40 Km' },\r\n                                            { id: '8hr_80km', hr: '8 Hr', km: '80 Km', label: 'Std' },\r\n                                            { id: '12hr_120km', hr: '12 Hr', km: '120 Km' },\r\n                                            { id: 'custom', hr: 'Custom', km: 'Trip' }\r\n                                        ].map(pkg => (\r\n                                            <button\r\n                                                key={pkg.id}\r\n                                                onClick={() => {\r\n                                                    setHourlyPackage(pkg.id);\r\n                                                    if (pkg.id === '8hr_80km') {\r\n                                                        setLocalPackageHours(8); setLocalPackageKm(80); setDistanceOverride('80');\r\n                                                    } else if (pkg.id === '12hr_120km') {\r\n                                                        setLocalPackageHours(12); setLocalPackageKm(120); setDistanceOverride('120');\r\n                                                    } else if (pkg.id === '4hr_40km') {\r\n                                                        setLocalPackageHours(4); setLocalPackageKm(40); setDistanceOverride('40');\r\n                                                    } else if (pkg.id === '2hr_20km') {\r\n                                                        setLocalPackageHours(2); setLocalPackageKm(20); setDistanceOverride('20');\r\n                                                    }\r\n                                                }}\r\n                                                className={`min-w-[64px] shrink-0 flex flex-col items-center justify-center py-1.5 px-1 rounded-lg border transition-all snap-start\r\n                                                        ${hourlyPackage === pkg.id\r\n                                                        ? 'bg-blue-600 border-blue-600 text-white shadow-md shadow-blue-100'\r\n                                                        : 'bg-white border-slate-100 text-slate-500 hover:border-blue-200 active:bg-slate-50'}\r\n                                                        ${!selectedVehicleId ? 'opacity-40 grayscale cursor-not-allowed' : ''}\r\n                                                    `}\r\n                                                disabled={!selectedVehicleId}\r\n                                            >\r\n                                                {pkg.label && (\r\n                                                    <span className={`text-[7px] font-black uppercase tracking-wider mb-0.5 ${hourlyPackage === pkg.id ? 'text-blue-100' : 'text-blue-600'}`}>\r\n                                                        {pkg.label}\r\n                                                    </span>\r\n                                                )}\r\n                                                <span className=\"text-[10px] font-black uppercase tracking-wider leading-none\">{pkg.hr}</span>\r\n                                                <span className={`text-[8px] font-bold uppercase tracking-wider leading-none mt-0.5 ${hourlyPackage === pkg.id ? 'text-blue-200' : 'text-slate-400'}`}>\r\n                                                    {pkg.km}\r\n                                                </span>\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                                {hourlyPackage !== 'custom' ? (\r\n                                    <div className=\"flex items-center gap-3 p-2 bg-slate-50/50 rounded-lg border border-slate-100 mt-1\">\r\n                                        <div className=\"flex-1 text-center border-r border-slate-100\">\r\n                                            <p className=\"text-[7px] text-slate-400 uppercase font-black tracking-widest mb-0.5\">Includes</p>\r\n                                            <p className=\"text-xs font-black text-slate-700 uppercase tracking-tight\">{hourlyPackage === '8hr_80km' ? 80 : hourlyPackage === '12hr_120km' ? 120 : hourlyPackage === '4hr_40km' ? 40 : 20} KM</p>\r\n                                        </div>\r\n                                        <div className=\"flex-1 text-center\">\r\n                                            <p className=\"text-[7px] text-slate-400 uppercase font-black tracking-widest mb-0.5\">Duration</p>\r\n                                            <p className=\"text-xs font-black text-slate-700 uppercase tracking-tight\">{hourlyPackage === '8hr_80km' ? 8 : hourlyPackage === '12hr_120km' ? 12 : hourlyPackage === '4hr_40km' ? 4 : 2} HRS</p>\r\n                                        </div>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"p-2 bg-slate-50 rounded-lg border border-slate-100 mt-1 text-center\">\r\n                                        <p className=\"text-[9px] text-slate-400 font-bold uppercase tracking-wider italic\">Input Time & KM in Journey Details</p>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        ) : null}\r\n                    </div>\r\n                </div>\r\n            </div >\r\n\r\n            <div className=\"flex gap-2\">\r\n                <button onClick={handleBack} className=\"flex-1 h-11 border border-slate-200 text-slate-500 font-black rounded-xl uppercase text-[9px] tracking-widest flex items-center justify-center gap-1.5 active:bg-slate-50 transition-colors\"><ChevronLeft size={14} /> Back</button>\r\n                <div className=\"flex-[2.5] flex gap-2\">\r\n                    {mode === 'custom' && (\r\n                        <button onClick={handlePreview} disabled={customLineItems.length === 0} className=\"flex-1 h-11 border-2 border-indigo-600 text-indigo-600 font-black rounded-xl uppercase text-[9px] tracking-widest flex items-center justify-center gap-2 active:bg-indigo-50 disabled:opacity-30 transition-colors\">\r\n                            <Eye size={14} strokeWidth={2.5} /> PREVIEW\r\n                        </button>\r\n                    )}\r\n                    <button onClick={handleNext} disabled={(mode !== 'custom' && (!selectedVehicleId || (!distanceOverride && mode !== 'local'))) || (mode === 'custom' && customLineItems.length === 0)} className=\"flex-1 tn-button-primary h-11 text-[10px] tracking-widest font-black uppercase shadow-lg shadow-blue-100 disabled:opacity-50\">CONTINUE</button>\r\n                </div>\r\n            </div>\r\n        </div >\r\n    );\r\n\r\n    const renderStep3 = () => (\r\n        <div className=\"space-y-3 animate-in fade-in slide-in-from-right-4 duration-500\">\r\n            <h2 className=\"text-[10px] font-black text-slate-800 uppercase tracking-widest flex items-center gap-2 px-1\">\r\n                <Plus className=\"text-blue-600\" size={14} strokeWidth={3} /> Extra Charges\r\n            </h2>\r\n\r\n            <div className=\"p-3 bg-white rounded-xl border border-slate-200 shadow-sm space-y-3\">\r\n                {/* Main Charges Grid */}\r\n                <div className=\"grid grid-cols-2 gap-2.5\">\r\n                    <div className=\"space-y-0.5\">\r\n                        <div className=\"flex justify-between items-center px-1\">\r\n                            <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Batta</label>\r\n                            {manualDriverBatta && <button onClick={() => setManualDriverBatta(false)} className=\"text-blue-600\"><RotateCcw size={10} /></button>}\r\n                        </div>\r\n                        <input type=\"number\" value={driverBatta} onChange={e => { setDriverBatta(e.target.value); setManualDriverBatta(true); }} className={`tn-input h-9 w-full bg-slate-50 border-slate-200 text-xs text-slate-900 font-bold rounded-lg ${manualDriverBatta ? 'bg-blue-50 text-blue-700' : ''}`} placeholder=\"0\" />\r\n                    </div>\r\n                    <div className=\"space-y-0.5\">\r\n                        <div className=\"flex justify-between items-center px-1\">\r\n                            <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Tolls</label>\r\n                            {manualToll && <button onClick={() => setManualToll(false)} className=\"text-blue-600\"><RotateCcw size={10} /></button>}\r\n                        </div>\r\n                        <input type=\"number\" value={toll} onChange={e => { setToll(e.target.value); setManualToll(true); }} className={`tn-input h-9 w-full bg-slate-50 border-slate-200 text-xs text-slate-900 font-bold rounded-lg ${manualToll ? 'bg-blue-50 text-blue-700' : ''}`} placeholder=\"0\" />\r\n                    </div>\r\n                    <div className=\"space-y-0.5\">\r\n                        <div className=\"flex justify-between items-center px-1\">\r\n                            <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Parking</label>\r\n                            {manualParking && <button onClick={() => setManualParking(false)} className=\"text-blue-600\"><RotateCcw size={10} /></button>}\r\n                        </div>\r\n                        <input type=\"number\" value={parking} onChange={e => { setParking(e.target.value); setManualParking(true); }} className={`tn-input h-9 w-full bg-slate-50 border-slate-200 text-xs text-slate-900 font-bold rounded-lg ${manualParking ? 'bg-blue-50 text-blue-700' : ''}`} placeholder=\"0\" />\r\n                    </div>\r\n                    <div className=\"space-y-0.5\">\r\n                        <div className=\"flex justify-between items-center px-1\">\r\n                            <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Permit</label>\r\n                            {manualPermit && <button onClick={() => setManualPermit(false)} className=\"text-blue-600\"><RotateCcw size={10} /></button>}\r\n                        </div>\r\n                        <input type=\"number\" value={permit} onChange={e => { setPermit(e.target.value); setManualPermit(true); }} className={`tn-input h-9 w-full bg-slate-50 border-slate-200 text-xs text-slate-900 font-bold rounded-lg ${manualPermit ? 'bg-blue-50 text-blue-700' : ''}`} placeholder=\"0\" />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"h-px bg-slate-50 my-0.5\" />\r\n\r\n                <div className=\"grid grid-cols-2 gap-2.5\">\r\n                    <div className=\"space-y-0.5\">\r\n                        <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Hill Station</label>\r\n                        <input type=\"number\" value={hillStationCharge} onChange={e => { setHillStationCharge(e.target.value); setManualHillStation(true); }} className=\"tn-input h-9 w-full bg-slate-50 border-slate-200 text-xs text-slate-900 font-bold rounded-lg\" placeholder=\"0\" />\r\n                    </div>\r\n                    <div className=\"space-y-0.5\">\r\n                        <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Pet Charge</label>\r\n                        <input type=\"number\" value={petCharge} onChange={e => setPetCharge(e.target.value)} className=\"tn-input h-9 w-full bg-slate-50 border-slate-200 text-xs text-slate-900 font-bold rounded-lg\" placeholder=\"0\" />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-0.5\">\r\n                    <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Night Drive (11 PM - 5 AM)</label>\r\n                    <input type=\"number\" value={nightCharge} onChange={e => setNightCharge(e.target.value)} className=\"tn-input h-9 w-full bg-slate-50 border-slate-200 text-xs text-slate-900 font-bold rounded-lg\" placeholder=\"0\" />\r\n                </div>\r\n\r\n                <div className=\"pt-3 border-t border-slate-50 space-y-2.5\">\r\n                    <label className=\"text-[9px] font-black text-slate-400 uppercase tracking-widest ml-1\">Misc Charges</label>\r\n                    <div className=\"flex gap-2\">\r\n                        <select className=\"tn-input h-9 flex-1 bg-slate-100 border-none text-[10px] text-slate-900 font-black uppercase tracking-wider rounded-lg\" value={selectedChargeType} onChange={(e) => { setSelectedChargeType(e.target.value); if (e.target.value !== 'Custom') setCustomChargeName(''); }}>\r\n                            <option value=\"\">Select Type</option>\r\n                            <option value=\"Custom\">Custom</option>\r\n                            <option value=\"Cleaning Fee\">Cleaning</option>\r\n                            <option value=\"Driver Allowance\">Allowance</option>\r\n                            <option value=\"Guide Fee\">Guide</option>\r\n                            <option value=\"Luggage Charge\">Luggage</option>\r\n                            <option value=\"Airport Entry\">Airport</option>\r\n                            <option value=\"FastTag Recharge\">FastTag</option>\r\n                            <option value=\"Decoration\">Decoration</option>\r\n                            <option value=\"Waiting Charge\">Waiting</option>\r\n                        </select>\r\n                    </div>\r\n\r\n                    {selectedChargeType && (\r\n                        <div className=\"flex gap-2 animate-in slide-in-from-top-2\">\r\n                            {selectedChargeType === 'Custom' && <input placeholder=\"Name\" className=\"tn-input h-9 flex-2 bg-white border-slate-200 font-bold text-xs rounded-lg\" value={customChargeName} onChange={e => setCustomChargeName(e.target.value)} autoFocus />}\r\n                            <input type=\"number\" placeholder=\"Amt\" className=\"tn-input h-9 flex-1 bg-white border-slate-200 font-bold text-xs rounded-lg text-center\" value={customChargeAmount} onChange={e => setCustomChargeAmount(e.target.value)} />\r\n                            <button onClick={handleAddCharge} className=\"w-9 h-9 bg-slate-900 text-white rounded-lg shadow-lg shadow-slate-200 flex items-center justify-center shrink-0\">\r\n                                <Plus size={16} strokeWidth={3} />\r\n                            </button>\r\n                        </div>\r\n                    )}\r\n\r\n                    {extraItems.length > 0 && (\r\n                        <div className=\"space-y-1.5 pt-1\">\r\n                            {extraItems.map((item, idx) => (\r\n                                <div key={idx} className=\"flex items-center justify-between p-2 bg-slate-50 rounded-lg group/item border border-slate-100\">\r\n                                    <span className=\"text-[10px] font-black text-slate-600 uppercase tracking-tight\">{item.description}</span>\r\n                                    <div className=\"flex items-center gap-2.5\">\r\n                                        <span className=\"text-[11px] font-black text-slate-900\">{item.amount.toLocaleString()}</span>\r\n                                        <button onClick={() => setExtraItems(prev => prev.filter((_, i) => i !== idx))} className=\"text-slate-300 hover:text-red-500 transition-colors\">\r\n                                            <Trash2 size={14} />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"flex gap-2\">\r\n                <button onClick={handleBack} className=\"flex-1 h-11 border border-slate-200 text-slate-500 font-black rounded-xl uppercase text-[9px] tracking-widest flex items-center justify-center gap-1.5 active:bg-slate-50\"><ChevronLeft size={14} /> Back</button>\r\n                <div className=\"flex-[2.5] flex gap-2\">\r\n                    <button onClick={handlePreview} className=\"flex-1 border-2 border-[#0047AB] text-[#0047AB] h-11 rounded-xl text-[9px] uppercase font-black tracking-widest flex items-center justify-center gap-2 hover:bg-blue-50 transition-colors\"><Eye size={14} strokeWidth={2.5} /> PREVIEW</button>\r\n                    <button onClick={handleNext} className=\"flex-1 tn-button-primary h-11 text-[9px] tracking-widest font-black uppercase rounded-xl\">CONTINUE</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    const renderStep4 = () => (\r\n        <div className=\"space-y-3 animate-in fade-in slide-in-from-right-4 duration-500\">\r\n            {/* Customer Section */}\r\n            <div className=\"p-3 bg-white rounded-xl border border-slate-200 shadow-sm space-y-3\">\r\n                <div className=\"flex justify-between items-center\">\r\n                    <h3 className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2\"><UserCheck size={12} className=\"text-blue-600\" /> Client Details</h3>\r\n                </div>\r\n                <div className=\"space-y-2.5\">\r\n                    <div className=\"grid grid-cols-2 gap-2.5\">\r\n                        <div className=\"space-y-0.5\">\r\n                            <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Client Name</label>\r\n                            <input placeholder=\"Name\" className=\"tn-input h-9 w-full bg-slate-50 border-slate-100 text-xs text-slate-900 font-bold rounded-lg px-2.5\" value={customerName} onChange={e => setCustomerName(e.target.value)} />\r\n                        </div>\r\n                        <div className=\"space-y-0.5\">\r\n                            <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Phone</label>\r\n                            <input \r\n                                placeholder=\"10-digit Mobile Number\" \r\n                                className={`tn-input h-9 w-full bg-slate-50 border-slate-100 text-xs text-slate-900 font-bold rounded-lg px-2.5 ${customerPhone && customerPhone.length !== 10 ? 'border-red-300 focus:border-red-400' : ''}`} \r\n                                value={customerPhone} \r\n                                type=\"tel\"\r\n                                maxLength={10}\r\n                                onChange={e => {\r\n                                    const val = e.target.value.replace(/\\D/g, '');\r\n                                    setCustomerPhone(val);\r\n                                }} \r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"space-y-0.5\">\r\n                        <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Business Address</label>\r\n                        <textarea placeholder=\"Line 1, City, State...\" className=\"tn-input h-14 w-full py-2 resize-none bg-slate-50 border-slate-100 text-xs text-slate-900 font-bold rounded-lg px-2.5 leading-snug\" value={billingAddress} onChange={e => setBillingAddress(e.target.value)} />\r\n                    </div>\r\n                    <div className=\"space-y-0.5\">\r\n                        <label className=\"text-[8px] font-bold text-slate-500 uppercase ml-1\">Client GSTIN (For B2B Credit)</label>\r\n                        <input \r\n                            placeholder=\"Leave empty for B2C/Consumer\" \r\n                            className={`tn-input h-9 w-full uppercase bg-slate-50 border-slate-100 text-xs text-slate-900 font-bold rounded-lg px-2.5 ${customerGst && customerGst.length !== 15 ? 'border-red-300 focus:border-red-400' : ''}`} \r\n                            value={customerGst} \r\n                            maxLength={15}\r\n                            onChange={e => {\r\n                                const val = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');\r\n                                setCustomerGst(val);\r\n                            }} \r\n                        />\r\n                        {customerGst && customerGst.length > 0 && customerGst.length !== 15 && (\r\n                            <p className=\"text-[9px] text-red-500 font-bold px-1\">GSTIN must be 15 characters</p>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n\r\n            </div>\r\n\r\n            {/* Terms Section */}\r\n            <div className=\"p-3 bg-white rounded-xl border border-slate-200 shadow-sm space-y-3\">\r\n                <div className=\"flex justify-between items-center\">\r\n                    <h3 className=\"text-[10px] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2\"><StickyNote size={12} className=\"text-slate-600\" /> INVOICE TERMS</h3>\r\n                    <span className=\"text-[9px] font-black text-blue-600 uppercase bg-blue-50 px-2 py-0.5 rounded-full\">{terms.length} Active</span>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                    <div className=\"flex gap-2 p-1 bg-slate-50 rounded-lg max-h-60 overflow-y-auto custom-scrollbar flex-col\">\r\n                        {DEFAULT_TERMS.map((term, idx) => {\r\n                            const isSelected = terms.includes(term);\r\n                            return (\r\n                                <button\r\n                                    key={idx}\r\n                                    onClick={() => {\r\n                                        if (isSelected) {\r\n                                            setTerms(t => t.filter(x => x !== term));\r\n                                        } else {\r\n                                            setTerms(t => [...t, term]);\r\n                                        }\r\n                                    }}\r\n                                    className={`flex items-start gap-2 p-2 rounded-md transition-all text-left text-[10px] font-bold leading-tight ${isSelected\r\n                                        ? 'bg-white shadow-sm border border-blue-50 text-blue-900'\r\n                                        : 'text-slate-500 hover:bg-slate-100'\r\n                                        }`}\r\n                                >\r\n                                    <div className={`mt-0.5 w-3.5 h-3.5 rounded border flex items-center justify-center shrink-0 transition-all ${isSelected\r\n                                        ? 'bg-blue-600 border-blue-600 text-white'\r\n                                        : 'bg-white border-slate-200'\r\n                                        }`}>\r\n                                        {isSelected && <Check size={8} strokeWidth={5} />}\r\n                                    </div>\r\n                                    <span className=\"flex-1\">{term}</span>\r\n                                </button>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex gap-2 pt-1 border-t border-slate-50\">\r\n                    <input\r\n                        placeholder=\"Add manual term...\"\r\n                        className=\"tn-input h-8 flex-1 text-[10px] font-bold rounded-lg border-slate-100 bg-slate-50 px-2.5\"\r\n                        value={newTerm}\r\n                        onChange={e => setNewTerm(e.target.value)}\r\n                        onKeyDown={e => { if (e.key === 'Enter' && newTerm) { setTerms([...terms, newTerm]); setNewTerm(''); } }}\r\n                    />\r\n                    <button\r\n                        onClick={() => { if (newTerm) { setTerms([...terms, newTerm]); setNewTerm(''); } }}\r\n                        className=\"w-8 h-8 bg-slate-900 text-white rounded-lg flex items-center justify-center active:scale-95 transition-all\"\r\n                    >\r\n                        <Plus size={14} strokeWidth={3} />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"flex gap-2 h-11 mt-4\">\r\n                <button \r\n                    onClick={handleBack} \r\n                    className=\"w-20 bg-white border border-slate-200 text-slate-500 font-black rounded-xl uppercase text-[9px] tracking-widest hover:bg-slate-50 active:scale-95 transition-all text-center\"\r\n                >\r\n                    BACK\r\n                </button>\r\n                <div className=\"flex-1 flex gap-2\">\r\n                    <button \r\n                        onClick={handlePreview} \r\n                        disabled={isSubmitting} \r\n                        className=\"flex-1 border-2 border-[#0047AB] text-[#0047AB] bg-white rounded-xl text-[9px] uppercase font-black tracking-widest flex items-center justify-center gap-2 hover:bg-blue-50 active:scale-95 transition-all disabled:opacity-50\"\r\n                    >\r\n                        <Eye size={14} strokeWidth={2.5} /> PREVIEW\r\n                    </button>\r\n                    <button\r\n                        onClick={handleSaveAndShare}\r\n                        disabled={isSubmitting}\r\n                        className=\"flex-[1.5] bg-[#0047AB] text-white font-black text-[9px] uppercase tracking-widest rounded-xl shadow-lg shadow-blue-100 flex items-center justify-center gap-2 active:scale-95 transition-all disabled:opacity-50 hover:bg-blue-700\"\r\n                    >\r\n                        {isSubmitting ? (\r\n                            <div className=\"w-4 h-4 rounded-full border-2 border-white/30 border-t-white animate-spin\" />\r\n                        ) : (\r\n                            <>\r\n                                <Share2 size={14} strokeWidth={2.5} />\r\n                                SAVE & SHARE\r\n                            </>\r\n                        )}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    return (\r\n        <div className=\"max-w-xl mx-auto space-y-4 pb-32 px-2 sm:px-0\">\r\n            {/* Progress Header - Only show if mode selected */}\r\n            {mode && (\r\n                <div className=\"flex items-center justify-between mb-4 px-6 bg-white py-3 rounded-2xl border border-slate-100 shadow-sm mx-1\">\r\n                    {(mode === 'custom' ? [1, 3] : [1, 2, 3]).map((s, idx, arr) => (\r\n                        <div key={s} className=\"flex items-center gap-2\">\r\n                            <div className={`w-6 h-6 rounded-full flex items-center justify-center text-[9px] font-black transition-all ${step === s ? 'bg-blue-600 text-white shadow-lg shadow-blue-200 ring-2 ring-blue-100' : (step > s ? 'bg-green-500 text-white' : 'bg-slate-100 text-slate-300')}`}>\r\n                                {step > s ? <CheckCircle2 size={12} strokeWidth={3} /> : idx + 1}\r\n                            </div>\r\n                            {idx < arr.length - 1 && <div className={`h-0.5 w-8 sm:w-16 rounded-full transition-colors ${step > s ? 'bg-green-500' : 'bg-slate-100'}`} />}\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n\r\n            {!mode && renderStep1()}\r\n            {mode && step === 1 && renderStep2()}\r\n            {mode && step === 2 && renderStep3()}\r\n            {mode && step === 3 && renderStep4()}\r\n\r\n            {/* Hidden Cloud Vision Input */}\r\n            <input type=\"file\" ref={fileInputRef} onChange={handleOdometerScan} accept=\"image/*\" className=\"hidden\" capture=\"environment\" />\r\n\r\n\r\n\r\n            <Suspense fallback={null}>\r\n                {showPreview && <PDFPreviewModal isOpen={showPreview} onClose={() => setShowPreview(false)} pdfUrl={previewPdfUrl} title=\"Invoice Preview\" />}\r\n            </Suspense>\r\n\r\n\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default TripForm;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\components\\UpdateWatcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\config\\affiliates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\config\\permitRates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\config\\tariff_config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\config\\vehicleRates.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\contexts\\AuthContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":288,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":288,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport type { User } from '@supabase/supabase-js';\r\nimport { supabase } from '../utils/supabase';\r\n\r\ninterface AuthContextType {\r\n    user: User | null;\r\n    loading: boolean;\r\n    isAdmin: boolean;\r\n    originalUser: User | null;\r\n    signInWithGoogle: () => Promise<void>;\r\n    signInWithIdToken: (token: string) => Promise<void>;\r\n    signOut: () => Promise<void>;\r\n    impersonateUser: (userId: string) => Promise<void>;\r\n    stopImpersonation: () => void;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [originalUser, setOriginalUser] = useState<User | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Sync profile to database\r\n    const ensureProfile = async (user: User) => {\r\n        try {\r\n            await supabase.from('profiles').upsert({\r\n                id: user.id,\r\n                email: user.email,\r\n                name: user.user_metadata.full_name || user.email?.split('@')[0],\r\n                avatar_url: user.user_metadata.avatar_url,\r\n                updated_at: new Date().toISOString(),\r\n            }, { onConflict: 'id' });\r\n        } catch (err) {\r\n            console.error('Profile sync failed:', err);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        // Initial session check\r\n        const initAuth = async () => {\r\n            try {\r\n                console.log('Auth: Initializing session check...');\r\n                const { data: { session }, error } = await supabase.auth.getSession();\r\n                if (error) {\r\n                    console.error('Auth: Session fetch error:', error);\r\n                    return;\r\n                }\r\n                const current = session?.user ?? null;\r\n                console.log('Auth: Initial user state:', current ? current.email : 'Guest');\r\n                \r\n                // Handle impersonation recovery on refresh\r\n                const impersonatedId = localStorage.getItem('impersonated_user_id');\r\n                const isAdmin = current?.email && ['swa.taxioffice@gmail.com', 'customercare@swataxioffice.com'].includes(current.email);\r\n\r\n                if (impersonatedId && isAdmin) {\r\n                    console.log('Auth: Recovering impersonation for user:', impersonatedId);\r\n                    const { data: profile } = await supabase.from('profiles').select('*').eq('id', impersonatedId).single();\r\n                    if (profile) {\r\n                        const impersonated: User = {\r\n                            id: profile.id,\r\n                            aud: 'authenticated',\r\n                            role: 'authenticated',\r\n                            email: profile.email,\r\n                            email_confirmed_at: new Date().toISOString(),\r\n                            phone: profile.phone,\r\n                            confirmation_sent_at: '',\r\n                            confirmed_at: new Date().toISOString(),\r\n                            last_sign_in_at: new Date().toISOString(),\r\n                            app_metadata: { provider: 'email' },\r\n                            user_metadata: {\r\n                                full_name: profile.name,\r\n                                avatar_url: profile.avatar_url,\r\n                                ...profile\r\n                            },\r\n                            created_at: profile.created_at || new Date().toISOString(),\r\n                            updated_at: new Date().toISOString(),\r\n                            is_anonymous: false\r\n                        };\r\n                        setOriginalUser(current);\r\n                        setUser(impersonated);\r\n                    } else {\r\n                        localStorage.removeItem('impersonated_user_id');\r\n                        setUser(current);\r\n                    }\r\n                } else {\r\n                    setUser(current);\r\n                }\r\n\r\n                if (current) ensureProfile(current);\r\n            } catch (err) {\r\n                console.error('Auth: Critical init failure:', err);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        // Safety timeout: Ensure loading is never true for more than 10 seconds\r\n        const timeout = setTimeout(() => {\r\n            setLoading(current => {\r\n                if (current) console.warn('Auth: Loading stuck for 10s, forcing false');\r\n                return false;\r\n            });\r\n        }, 10000);\r\n\r\n        initAuth();\r\n\r\n        // Auth state listener\r\n        const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session) => {\r\n            console.log('Auth: State Change Event ->', event);\r\n            \r\n            // If we sign out the TRUE user, clear impersonation\r\n            if (event === 'SIGNED_OUT') {\r\n                localStorage.removeItem('impersonated_user_id');\r\n                setOriginalUser(null);\r\n                setUser(null);\r\n                setLoading(false);\r\n                return;\r\n            }\r\n\r\n            // Ignore auth state changes if we are currently impersonating\r\n            if (localStorage.getItem('impersonated_user_id')) return;\r\n\r\n            const current = session?.user ?? null;\r\n\r\n            if (event === 'SIGNED_IN') {\r\n                console.log('Auth: User signed in:', current?.email);\r\n                setUser(current);\r\n                if (current) ensureProfile(current); \r\n            } else if (event === 'USER_UPDATED') {\r\n                setUser(current);\r\n            }\r\n\r\n            setLoading(false);\r\n        });\r\n\r\n        return () => {\r\n            clearTimeout(timeout);\r\n            subscription.unsubscribe();\r\n        };\r\n    }, []);\r\n\r\n    const signInWithGoogle = async () => {\r\n        try {\r\n            console.log('Auth: Starting Google OAuth flow with origin:', window.location.origin);\r\n            const { error } = await supabase.auth.signInWithOAuth({\r\n                provider: 'google',\r\n                options: {\r\n                    redirectTo: window.location.origin,\r\n                    queryParams: { prompt: 'select_account' }\r\n                }\r\n            });\r\n            if (error) {\r\n                console.error('Auth: Google OAuth Error:', error.message);\r\n                throw error;\r\n            }\r\n        } catch (err: unknown) {\r\n            const error = err as Error;\r\n            console.error('Auth: Google Sign-In failed:', err);\r\n            // Check for common redirect errors\r\n            if (error.message?.includes('redirect_uri')) {\r\n                alert(`Auth Error: This URL (${window.location.origin}) might not be whitelisted in your Supabase Auth settings.`);\r\n            } else {\r\n                alert('Google Sign-In failed: ' + (error.message || 'Unknown error'));\r\n            }\r\n            throw err;\r\n        }\r\n    };\r\n\r\n    const signInWithIdToken = async (token: string) => {\r\n        const { error } = await supabase.auth.signInWithIdToken({\r\n            provider: 'google',\r\n            token: token,\r\n        });\r\n        if (error) throw error;\r\n    };\r\n\r\n    const signOut = async () => {\r\n        if (originalUser || localStorage.getItem('impersonated_user_id')) {\r\n            // If impersonating, just stop impersonating\r\n            stopImpersonation();\r\n            return;\r\n        }\r\n        setUser(null);\r\n        try {\r\n            await supabase.auth.signOut();\r\n        } catch (error) {\r\n            console.error('Sign out error:', error);\r\n        }\r\n        window.location.href = '/';\r\n    };\r\n\r\n    const impersonateUser = async (userId: string) => {\r\n        // Security check: Must assume current actual user is admin\r\n        const currentUser = originalUser || user;\r\n        const currentIsAdmin = !!(currentUser?.email && ['swa.taxioffice@gmail.com', 'customercare@swataxioffice.com'].includes(currentUser.email));\r\n\r\n        if (!currentIsAdmin) {\r\n            console.error(\"Unauthorized impersonation attempt\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Fetch target profile\r\n            const { data: profile, error } = await supabase.from('profiles').select('*').eq('id', userId).single();\r\n\r\n            if (error) throw error;\r\n            if (!profile) throw new Error(\"User profile not found\");\r\n\r\n            // Store original user if not already stored\r\n            if (!originalUser) {\r\n                setOriginalUser(user);\r\n            }\r\n            \r\n            // Persist impersonation\r\n            localStorage.setItem('impersonated_user_id', userId);\r\n\r\n            // Construct valid User object\r\n            const impersonated: User = {\r\n                id: profile.id,\r\n                aud: 'authenticated',\r\n                role: 'authenticated',\r\n                email: profile.email,\r\n                email_confirmed_at: new Date().toISOString(),\r\n                phone: profile.phone,\r\n                confirmation_sent_at: '',\r\n                confirmed_at: new Date().toISOString(),\r\n                last_sign_in_at: new Date().toISOString(),\r\n                app_metadata: { provider: 'email' },\r\n                user_metadata: {\r\n                    full_name: profile.name,\r\n                    avatar_url: profile.avatar_url,\r\n                    ...profile // Access to other profile fields if needed\r\n                },\r\n                created_at: profile.created_at || new Date().toISOString(),\r\n                updated_at: new Date().toISOString(),\r\n                is_anonymous: false\r\n            };\r\n\r\n            setUser(impersonated);\r\n            console.log(`Impersonating user: ${profile.email}`);\r\n            // Force reload to refresh data\r\n            window.location.href = '/dashboard';\r\n\r\n        } catch (err: unknown) {\r\n            const error = err as Error;\r\n            console.error(\"Impersonation failed:\", err);\r\n            alert(\"Failed to impersonate user: \" + error.message);\r\n        }\r\n    };\r\n\r\n    const stopImpersonation = () => {\r\n        localStorage.removeItem('impersonated_user_id');\r\n        if (originalUser) {\r\n            console.log(\"Stopping impersonation, reverting to:\", originalUser.email);\r\n            setUser(originalUser);\r\n            setOriginalUser(null);\r\n            window.location.href = '/admin';\r\n        } else {\r\n            // Fallback if originalUser was lost from state but localStorage was present\r\n            window.location.href = '/admin';\r\n        }\r\n    };\r\n\r\n    // Admin check looks at ORIGINAL user if impersonating\r\n    const checkUser = originalUser || user;\r\n    const isAdmin = !!(checkUser?.email && ['swa.taxioffice@gmail.com', 'customercare@swataxioffice.com'].includes(checkUser.email));\r\n\r\n    const value = {\r\n        user,\r\n        loading,\r\n        isAdmin,\r\n        originalUser,\r\n        signInWithGoogle,\r\n        signInWithIdToken,\r\n        signOut,\r\n        impersonateUser,\r\n        stopImpersonation\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={value}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useAuth = () => {\r\n    const context = useContext(AuthContext);\r\n    if (!context) throw new Error('useAuth must be used within an AuthProvider');\r\n    return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\contexts\\NotificationContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":28,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":28,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2575,2578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2575,2578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3050,3053],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3050,3053],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useCallback, useEffect } from 'react';\r\nimport { generateId } from '../utils/uuid';\r\n\r\nimport { supabase } from '../utils/supabase';\r\nimport { useAuth } from './AuthContext';\r\n\r\nexport interface Notification {\r\n    id: string;\r\n    title: string;\r\n    message: string;\r\n    type: 'info' | 'success' | 'warning' | 'error';\r\n    timestamp: number;\r\n    read: boolean;\r\n}\r\n\r\ninterface NotificationContextType {\r\n    notifications: Notification[];\r\n    unreadCount: number;\r\n    addNotification: (title: string, message: string, type?: Notification['type']) => void;\r\n    markAsRead: (id: string) => void;\r\n    markAllAsRead: () => void;\r\n    clearAll: () => void;\r\n    removeNotification: (id: string) => void;\r\n}\r\n\r\nconst NotificationContext = createContext<NotificationContextType | undefined>(undefined);\r\n\r\nexport const useNotifications = () => {\r\n    const context = useContext(NotificationContext);\r\n    if (!context) {\r\n        throw new Error('useNotifications must be used within a NotificationProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\nexport const NotificationProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const [notifications, setNotifications] = useState<Notification[]>([]);\r\n    const { user } = useAuth();\r\n\r\n    const addNotification = useCallback((title: string, message: string, type: Notification['type'] = 'info') => {\r\n        const id = generateId();\r\n\r\n        const newNotification: Notification = {\r\n            id,\r\n            title,\r\n            message,\r\n            type,\r\n            timestamp: Date.now(),\r\n            read: false,\r\n        };\r\n        setNotifications((prev) => [newNotification, ...prev]);\r\n\r\n        // Trigger native browser notification if permitted\r\n        if ('Notification' in window && Notification.permission === 'granted') {\r\n            new window.Notification(title, {\r\n                body: message,\r\n                icon: '/logo.png'\r\n            });\r\n        }\r\n    }, []);\r\n\r\n    // Subscribe to real-time notifications from Supabase\r\n    useEffect(() => {\r\n        if (!user) return;\r\n\r\n        const channel = supabase\r\n            .channel('public:notifications')\r\n            .on(\r\n                'postgres_changes',\r\n                {\r\n                    event: 'INSERT',\r\n                    schema: 'public',\r\n                    table: 'notifications',\r\n                    filter: `user_id=eq.${user.id}`,\r\n                },\r\n                (payload) => {\r\n                    const newNotif = payload.new as any;\r\n                    addNotification(newNotif.title, newNotif.message, newNotif.type);\r\n                }\r\n            )\r\n            .on(\r\n                'postgres_changes',\r\n                {\r\n                    event: 'INSERT',\r\n                    schema: 'public',\r\n                    table: 'notifications',\r\n                    filter: 'user_id=is.null',\r\n                },\r\n                (payload) => {\r\n                    const newNotif = payload.new as any;\r\n                    addNotification(newNotif.title, newNotif.message, newNotif.type);\r\n                }\r\n            )\r\n            .subscribe();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [user, addNotification]);\r\n\r\n    useEffect(() => {\r\n        // Request notification permission on first load\r\n        if ('Notification' in window && Notification.permission === 'default') {\r\n            Notification.requestPermission();\r\n        }\r\n    }, []);\r\n\r\n    const markAsRead = useCallback((id: string) => {\r\n        setNotifications((prev) =>\r\n            prev.map((n) => (n.id === id ? { ...n, read: true } : n))\r\n        );\r\n    }, []);\r\n\r\n    const markAllAsRead = useCallback(() => {\r\n        setNotifications((prev) => prev.map((n) => ({ ...n, read: true })));\r\n    }, []);\r\n\r\n    const clearAll = useCallback(() => {\r\n        setNotifications([]);\r\n    }, []);\r\n\r\n    const removeNotification = useCallback((id: string) => {\r\n        setNotifications((prev) => prev.filter((n) => n.id !== id));\r\n    }, []);\r\n\r\n    const unreadCount = notifications.filter((n) => !n.read).length;\r\n\r\n    return (\r\n        <NotificationContext.Provider\r\n            value={{\r\n                notifications,\r\n                unreadCount,\r\n                addNotification,\r\n                markAsRead,\r\n                markAllAsRead,\r\n                clearAll,\r\n                removeNotification,\r\n            }}\r\n        >\r\n            {children}\r\n        </NotificationContext.Provider>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\contexts\\SettingsContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":183,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5941,5944],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5941,5944],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":185,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6065,6068],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6065,6068],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":318,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11748,11751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11748,11751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":370,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":370,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14276,14279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14276,14279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":500,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":500,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19635,19638],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19635,19638],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":501,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":501,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19714,19717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19714,19717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":502,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":502,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19788,19791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19788,19791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":512,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":512,"endColumn":25}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect, useRef } from 'react';\r\nimport { safeJSONParse } from '../utils/storage';\r\nimport { supabase } from '../utils/supabase';\r\n\r\ntype Language = 'en' | 'ta' | 'kn' | 'hi';\r\n\r\ninterface Vehicle {\r\n    id: string;\r\n    number: string;\r\n    model: string;\r\n    categoryId?: string;\r\n    expiryDate?: string;\r\n    mileage?: string;\r\n    fuelType?: 'petrol' | 'diesel' | 'cng' | 'ev';\r\n}\r\n\r\ninterface Settings {\r\n    language: Language;\r\n    gstEnabled: boolean;\r\n    baseFare: number;\r\n    ratePerKm: number;\r\n    hourlyRate: number;\r\n    nightBata: number;\r\n    companyName: string;\r\n    companyAddress: string;\r\n    driverPhone: string;\r\n    secondaryPhone?: string;\r\n    companyEmail?: string;\r\n    contactPerson?: string;\r\n    gstin: string;\r\n    vehicles: Vehicle[];\r\n    currentVehicleId: string;\r\n    theme: 'light' | 'dark';\r\n    websiteUrl?: string;\r\n    bankName?: string;\r\n    accountNumber?: string;\r\n    ifscCode?: string;\r\n    branchName?: string;\r\n    holderName?: string;\r\n    upiId?: string;\r\n    appColor?: string;\r\n    secondaryColor?: string;\r\n    logoUrl?: string;\r\n    showWatermark: boolean;\r\n    isPremium?: boolean;\r\n    plan?: 'free' | 'pro' | 'super';\r\n    services?: string[];\r\n    signatureUrl?: string;\r\n\r\n    // --- Staff & Salary Management (Pro) ---\r\n    staff: Staff[];\r\n    defaultSalaryConfig: SalaryConfig;\r\n    preferredPaymentMethod?: 'upi' | 'bank';\r\n    showUpiOnPdf?: boolean;\r\n    showBankOnPdf?: boolean;\r\n}\r\n\r\nexport interface SalaryConfig {\r\n    dutyPay: number;     // Daily Rate when generating revenue\r\n    standbyPay: number;  // Daily Rate when idle\r\n    pfDeduction: number; // Flat monthly deduction (smart default: 0 or 1800)\r\n    advanceLimit: number; // Max advance allowed\r\n    isPfEnabled?: boolean;\r\n    isEsiEnabled?: boolean;\r\n}\r\n\r\nexport interface Staff {\r\n    id: string;\r\n    name: string;\r\n    phone: string;\r\n    role: 'driver' | 'manager';\r\n    salaryConfig: SalaryConfig;\r\n    joinDate: string;\r\n    status: 'active' | 'inactive';\r\n    balance: number; // Ledger Balance (Positive = Company owes Driver, Negative = Driver owes Company)\r\n    designation?: string;\r\n    employeeId?: string;\r\n    panNumber?: string;\r\n    bankName?: string;\r\n    accountNumber?: string;\r\n    ifscCode?: string;\r\n    uan?: string;\r\n    esiNumber?: string;\r\n    attendance: Record<string, AttendanceStatus>; // Key: YYYY-MM-DD\r\n    deductions: DeductionRecord[];\r\n}\r\n\r\nexport type AttendanceStatus = 'duty' | 'standby' | 'leave' | 'holiday';\r\n\r\nexport interface DeductionRecord {\r\n    id: string;\r\n    date: string;\r\n    amount: number;\r\n    reason: string;\r\n    type: 'advance' | 'fine' | 'other';\r\n}\r\n\r\ninterface SettingsContextType {\r\n    settings: Settings;\r\n    updateSettings: (newSettings: Partial<Settings>) => void;\r\n    currentVehicle: Vehicle | undefined;\r\n    t: (key: string) => string;\r\n    saveSettings: (newSettings?: Settings) => Promise<boolean>;\r\n    docStats: { hasFullVehicle: boolean; hasFullDriver: boolean };\r\n    setDocStats: React.Dispatch<React.SetStateAction<{ hasFullVehicle: boolean; hasFullDriver: boolean }>>;\r\n    driverCode: number | null;\r\n}\r\n\r\nconst translations = {\r\n    en: {\r\n        title: 'Swa Taxi Office',\r\n        dashboard: 'Dashboard',\r\n        trips: 'Invoices',\r\n        expenses: 'Expenses',\r\n        docs: 'Documents',\r\n        profile: 'Profile',\r\n        startTrip: 'Start Trip',\r\n        endTrip: 'End Trip',\r\n        customer: 'Customer Name',\r\n        startKm: 'Start KM',\r\n        endKm: 'End KM',\r\n        startTime: 'Start Time',\r\n        endTime: 'End Time',\r\n        toll: 'Toll',\r\n        parking: 'Parking',\r\n        nightBata: 'Driver Batta',\r\n        calculate: 'Calculate Fare',\r\n        saveTrip: 'Save Invoice',\r\n        total: 'Total',\r\n        receipt: 'Receipt',\r\n        share: 'Share Invoice',\r\n        dailySummary: 'Daily Summary',\r\n        dailyProfit: 'Daily Profit',\r\n        income: 'Total Income',\r\n        spending: 'Total Spent',\r\n        gst: 'Enable GST (5%)',\r\n        companyName: 'Company Name',\r\n        companyAddress: 'Address',\r\n        gstin: 'GSTIN (Optional)',\r\n        vehicleNumber: 'Vehicle Number',\r\n        phone: 'Phone Number',\r\n        addExpense: 'Add Expense',\r\n        fuel: 'Fuel',\r\n        maintenance: 'Maintenance',\r\n        food: 'Food',\r\n        other: 'Other',\r\n        docVault: 'Document Vault',\r\n        expiring: 'Days Remaining',\r\n        qrTitle: 'Booking Engine',\r\n        qrSub: 'Manage bookings via external portal',\r\n        voiceNotes: 'Voice Note',\r\n        outstation: 'Round Trip',\r\n        hourly: 'Hourly Rental',\r\n        distance: 'Local Trip',\r\n        drop: 'One Way Drop',\r\n        addVehicle: 'Add Vehicle',\r\n        vehicles: 'My Fleet',\r\n        selectVehicle: 'Select Active Car',\r\n        carModel: 'Car Model (e.g. Swift, Dzire)',\r\n        waitingHours: 'Waiting Time (Hrs)',\r\n        hillStation: 'Hill Station Trip',\r\n        petCharge: 'Carrying Pets',\r\n        billingAddress: 'Billing Address (optional)',\r\n        partner: 'Partner',\r\n        package: 'Tour Package',\r\n        packageName: 'Package Name',\r\n        numPersons: 'No. of Persons',\r\n        packageRate: 'Package Rate'\r\n    }\r\n};\r\n\r\nconst SettingsContext = createContext<SettingsContextType | undefined>(undefined);\r\n\r\nexport const SettingsProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const [docStats, setDocStats] = useState(() => safeJSONParse('doc-stats', { hasFullVehicle: false, hasFullDriver: false }));\r\n    const [driverCode, setDriverCode] = useState<number | null>(null);\r\n    const isInitialized = useRef(false);\r\n\r\n    const [settings, setSettings] = useState<Settings>(() => {\r\n        const parsed = safeJSONParse<Settings | null>('namma-cab-settings', null);\r\n        if (parsed) {\r\n            if (!parsed.vehicles) {\r\n                parsed.vehicles = [{ id: 'v1', number: (parsed as any).vehicleNumber || '', model: '' }];\r\n                parsed.currentVehicleId = 'v1';\r\n                delete (parsed as any).vehicleNumber;\r\n            }\r\n            if (!parsed.theme) {\r\n                parsed.theme = 'light';\r\n            }\r\n            parsed.appColor = parsed.appColor || '#0047AB';\r\n            parsed.secondaryColor = parsed.secondaryColor || '#6366F1';\r\n            parsed.showWatermark = parsed.showWatermark ?? true;\r\n            // Force English to fix corrupted state\r\n            parsed.language = 'en';\r\n\r\n            // Ensure services array exists if missing\r\n            if (!parsed.services) parsed.services = undefined;\r\n\r\n            // Migration: Staff & Salary\r\n            if (!parsed.staff) parsed.staff = [];\r\n            parsed.staff = parsed.staff.map((s: Staff) => ({\r\n                ...s,\r\n                attendance: s.attendance || {},\r\n                deductions: s.deductions || []\r\n            }));\r\n            if (parsed.defaultSalaryConfig) {\r\n                parsed.defaultSalaryConfig.isPfEnabled = parsed.defaultSalaryConfig.isPfEnabled ?? true;\r\n                parsed.defaultSalaryConfig.isEsiEnabled = parsed.defaultSalaryConfig.isEsiEnabled ?? false;\r\n            } else {\r\n                parsed.defaultSalaryConfig = {\r\n                    dutyPay: 800,\r\n                    standbyPay: 400,\r\n                    pfDeduction: 0,\r\n                    advanceLimit: 5000,\r\n                    isPfEnabled: true,\r\n                    isEsiEnabled: false\r\n                };\r\n            }\r\n            if (!parsed.preferredPaymentMethod) parsed.preferredPaymentMethod = 'upi';\r\n            if (parsed.showUpiOnPdf === undefined) parsed.showUpiOnPdf = true;\r\n            if (parsed.showBankOnPdf === undefined) parsed.showBankOnPdf = false;\r\n\r\n            // Sync isPremium with plan (Legacy support)\r\n            if (parsed.plan && parsed.plan !== 'free') {\r\n                parsed.isPremium = true;\r\n            } else if (parsed.isPremium && !parsed.plan) {\r\n                parsed.plan = 'pro';\r\n            }\r\n\r\n            return parsed;\r\n        }\r\n        return {\r\n            language: 'en',\r\n            gstEnabled: false,\r\n            baseFare: 100,\r\n            ratePerKm: 13,\r\n            hourlyRate: 150,\r\n            nightBata: 400,\r\n            companyName: '',\r\n            companyAddress: '',\r\n            driverPhone: '',\r\n            secondaryPhone: '',\r\n            companyEmail: '',\r\n            gstin: '',\r\n            vehicles: [],\r\n            currentVehicleId: '',\r\n            theme: 'light',\r\n            websiteUrl: '',\r\n            bankName: '',\r\n            accountNumber: '',\r\n            ifscCode: '',\r\n            branchName: '',\r\n            holderName: '',\r\n            upiId: '',\r\n            appColor: '#0047AB',\r\n            secondaryColor: '#6366F1',\r\n            showWatermark: true,\r\n            isPremium: false,\r\n            plan: 'free',\r\n            services: ['Local', 'Outstation', 'Tours'], // Default Services\r\n            staff: [],\r\n            defaultSalaryConfig: {\r\n                dutyPay: 800,\r\n                standbyPay: 400,\r\n                pfDeduction: 0,\r\n                advanceLimit: 5000,\r\n                isPfEnabled: true,\r\n                isEsiEnabled: false\r\n            },\r\n            preferredPaymentMethod: 'upi',\r\n            showUpiOnPdf: true,\r\n            showBankOnPdf: false\r\n        };\r\n    });\r\n\r\n    const settingsRef = useRef(settings);\r\n    useEffect(() => {\r\n        settingsRef.current = settings;\r\n    }, [settings]);\r\n\r\n    // Cloud Sync Logic\r\n    useEffect(() => {\r\n        const syncSettings = async () => {\r\n            try {\r\n                const { data: { session } } = await supabase.auth.getSession();\r\n                if (session?.user) {\r\n                    // 1. Fetch Cloud Settings\r\n                    const { data, error } = await supabase.from('profiles').select('settings, driver_code').eq('id', session.user.id).single();\r\n                    if (error) {\r\n                        console.error('Error fetching cloud settings:', error);\r\n                    } else if (data) {\r\n                        if (data.settings) {\r\n                            const cloudSettings = data.settings;\r\n                            // Dual-direction sync for legacy support\r\n                            if (cloudSettings.plan && cloudSettings.plan !== 'free') {\r\n                                cloudSettings.isPremium = true;\r\n                            } else if (cloudSettings.isPremium && (!cloudSettings.plan || cloudSettings.plan === 'free')) {\r\n                                cloudSettings.plan = 'pro';\r\n                            }\r\n                            setSettings(prev => ({ ...prev, ...cloudSettings }));\r\n                        }\r\n                        if (data.driver_code) setDriverCode(data.driver_code);\r\n                    }\r\n\r\n                    // 2. Fetch Document Stats\r\n                    const { data: docs } = await supabase.from('user_documents').select('type').eq('user_id', session.user.id);\r\n                    if (docs) {\r\n                        const types = new Set(docs.map(d => d.type));\r\n                        const hasFullVehicle = ['Insurance', 'Permit', 'Fitness', 'Pollution'].every(t => types.has(t));\r\n                        const hasFullDriver = ['License'].every(t => types.has(t));\r\n                        setDocStats({ hasFullVehicle, hasFullDriver });\r\n                    }\r\n                } else {\r\n                    // Local Storage Fallback for Stats\r\n                    const saved = localStorage.getItem('cab-docs');\r\n                    if (saved) {\r\n                        const docs = JSON.parse(saved);\r\n                        const types = new Set(docs.map((d: any) => d.type));\r\n                        const hasFullVehicle = ['Insurance', 'Permit', 'Fitness', 'Pollution'].every(t => types.has(t));\r\n                        const hasFullDriver = ['License'].every(t => types.has(t));\r\n                        setDocStats({ hasFullVehicle, hasFullDriver });\r\n                    }\r\n                }\r\n            } catch (err) {\r\n                console.error('Settings sync failed:', err);\r\n            } finally {\r\n                isInitialized.current = true;\r\n            }\r\n        };\r\n\r\n        syncSettings();\r\n\r\n        // Listen for Auth Changes to switch profiles\r\n        const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session) => {\r\n            if (event === 'SIGNED_IN' && session?.user) {\r\n                try {\r\n                    const { data, error } = await supabase.from('profiles').select('settings, driver_code').eq('id', session.user.id).single();\r\n                    if (error) {\r\n                        console.error('Error fetching settings on sign in:', error);\r\n                    } else if (data) {\r\n                        if (data.settings) {\r\n                            const cloudSettings = data.settings;\r\n                            if (cloudSettings.plan && cloudSettings.plan !== 'free') {\r\n                                cloudSettings.isPremium = true;\r\n                            }\r\n                            setSettings(prev => ({ ...prev, ...cloudSettings }));\r\n                        }\r\n                        if (data.driver_code) setDriverCode(data.driver_code);\r\n                    }\r\n\r\n                    // Fetch Docs on Sign In\r\n                    const { data: docs } = await supabase.from('user_documents').select('type').eq('user_id', session.user.id);\r\n                    if (docs) {\r\n                        const types = new Set(docs.map(d => d.type));\r\n                        const hasFullVehicle = ['Insurance', 'Permit', 'Fitness', 'Pollution'].every(t => types.has(t));\r\n                        const hasFullDriver = ['License'].every(t => types.has(t));\r\n                        setDocStats({ hasFullVehicle, hasFullDriver });\r\n                    }\r\n                } catch (err) {\r\n                    console.error('Settings fetch on sign in failed:', err);\r\n                }\r\n            }\r\n        });\r\n\r\n        return () => subscription.unsubscribe();\r\n    }, []);\r\n\r\n    // 5. Real-time Settings Sync for Simultaneous Devices\r\n    useEffect(() => {\r\n        let channel: any = null;\r\n\r\n        const initRealtime = async () => {\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            if (!session?.user) return;\r\n\r\n            channel = supabase\r\n                .channel('public:profiles')\r\n                .on(\r\n                    'postgres_changes',\r\n                    {\r\n                        event: 'UPDATE',\r\n                        schema: 'public',\r\n                        table: 'profiles',\r\n                        filter: `id=eq.${session.user.id}`,\r\n                    },\r\n                    (payload) => {\r\n                        console.log('Real-time settings sync:', payload);\r\n                        if (payload.new && payload.new.settings) {\r\n                            const newCloudSettings = payload.new.settings;\r\n                            setSettings(prev => {\r\n                                // Prevent infinite loops if local state is same as cloud\r\n                                if (JSON.stringify(prev) === JSON.stringify(newCloudSettings)) return prev;\r\n                                return { ...prev, ...newCloudSettings };\r\n                            });\r\n                        }\r\n                        if (payload.new && payload.new.driver_code) {\r\n                            setDriverCode(payload.new.driver_code);\r\n                        }\r\n                    }\r\n                )\r\n                .subscribe();\r\n        };\r\n\r\n        initRealtime();\r\n\r\n        const { data: { subscription } } = supabase.auth.onAuthStateChange((event) => {\r\n            if (event === 'SIGNED_IN') initRealtime();\r\n            if (event === 'SIGNED_OUT' && channel) {\r\n                supabase.removeChannel(channel);\r\n                channel = null;\r\n            }\r\n        });\r\n\r\n        return () => {\r\n            if (channel) supabase.removeChannel(channel);\r\n            subscription.unsubscribe();\r\n        };\r\n    }, []);\r\n\r\n    // Save to Cloud on Change (Debounced)\r\n    // Manual Save Function\r\n    const saveSettings = async (manualSettings?: Settings): Promise<boolean> => {\r\n        try {\r\n            const { data: { session } } = await supabase.auth.getSession();\r\n            if (session?.user) {\r\n                console.log('Saving settings to cloud...');\r\n                const currentSettings = manualSettings || settingsRef.current;\r\n                const { error, data } = await supabase\r\n                    .from('profiles')\r\n                    .update({ settings: currentSettings, updated_at: new Date().toISOString() })\r\n                    .eq('id', session.user.id)\r\n                    .select();\r\n\r\n                if (error) {\r\n                    console.error('Error saving settings to cloud:', error);\r\n                    return false;\r\n                }\r\n\r\n                if (data && data.length === 0) {\r\n                    console.warn('No profile row found to update. Attempting upsert...');\r\n                    // Fallback to upsert if update failed to find row\r\n                    const { error: upsertError } = await supabase.from('profiles').upsert({\r\n                        id: session.user.id,\r\n                        settings: currentSettings,\r\n                        updated_at: new Date().toISOString(),\r\n                        email: session.user.email\r\n                    }).select();\r\n\r\n                    if (upsertError) {\r\n                        console.error('Upsert failed:', upsertError);\r\n                        return false;\r\n                    }\r\n                }\r\n                return true;\r\n            }\r\n            return false;\r\n        } catch (err) {\r\n            console.error('Unexpected error saving settings:', err);\r\n            return false;\r\n        }\r\n    };\r\n\r\n    // Save to Cloud on Change (Debounced)\r\n    useEffect(() => {\r\n        localStorage.setItem('namma-cab-settings', JSON.stringify(settings));\r\n        localStorage.setItem('doc-stats', JSON.stringify(docStats));\r\n        // Force Light Theme - User Request\r\n        // if (settings.theme === 'dark') {\r\n        //     document.documentElement.classList.add('dark');\r\n        // } else {\r\n            document.documentElement.classList.remove('dark');\r\n        // }\r\n\r\n        // Apply Color Theme\r\n        if (settings.appColor) {\r\n            document.documentElement.style.setProperty('--primary', settings.appColor);\r\n            // Also update safe-area/meta theme color if possible\r\n            const metaThemeColor = document.querySelector('meta[name=\"theme-color\"]');\r\n            if (metaThemeColor) metaThemeColor.setAttribute('content', settings.appColor);\r\n        }\r\n\r\n        // Debounced Cloud Save\r\n        // Prevent saving to cloud until we have verified/synced with cloud at least once to avoid overwriting with empty defaults\r\n        if (!isInitialized.current) return;\r\n\r\n        const saveToCloud = setTimeout(async () => {\r\n            await saveSettings();\r\n        }, 2000);\r\n\r\n        return () => clearTimeout(saveToCloud);\r\n    }, [settings, docStats]);\r\n\r\n    const updateSettings = (newSettings: Partial<Settings>) => {\r\n        setSettings(prev => ({ ...prev, ...newSettings }));\r\n    };\r\n\r\n    const currentVehicle = settings.vehicles.find(v => v.id === settings.currentVehicleId);\r\n\r\n    const t = (key: string) => {\r\n        const langData = (translations as any)[settings.language];\r\n        if (!langData) return (translations['en'] as any)[key] || key;\r\n        return langData[key] || (translations['en'] as any)[key] || key;\r\n    };\r\n\r\n    return (\r\n        <SettingsContext.Provider value={{ settings, updateSettings, currentVehicle, t, saveSettings, docStats, setDocStats, driverCode }}>\r\n            {children}\r\n        </SettingsContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useSettings = () => {\r\n    const context = useContext(SettingsContext);\r\n    if (!context) throw new Error('useSettings must be used within SettingsProvider');\r\n    return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\contexts\\UpdateContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":48,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":48,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext } from 'react';\r\nimport { useRegisterSW } from 'virtual:pwa-register/react';\r\n\r\ninterface UpdateContextType {\r\n    needRefresh: boolean;\r\n    setNeedRefresh: (val: boolean) => void;\r\n    updateServiceWorker: (reloadPage?: boolean) => Promise<void>;\r\n    offlineReady: boolean;\r\n}\r\n\r\nconst UpdateContext = createContext<UpdateContextType | undefined>(undefined);\r\n\r\nexport const UpdateProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const {\r\n        needRefresh: [needRefresh, setNeedRefresh],\r\n        updateServiceWorker,\r\n        offlineReady: [offlineReady],\r\n    } = useRegisterSW({\r\n        onRegistered(r) {\r\n            console.log('SW Registered: ' + r);\r\n            if (r) {\r\n                // Check for updates every 15 minutes\r\n                setInterval(() => {\r\n                    console.log('Checking for SW update...');\r\n                    r.update();\r\n                }, 15 * 60 * 1000);\r\n            }\r\n        },\r\n        onRegisterError(error) {\r\n            console.log('SW registration error', error);\r\n        },\r\n    });\r\n\r\n    return (\r\n        <UpdateContext.Provider\r\n            value={{\r\n                needRefresh,\r\n                setNeedRefresh,\r\n                updateServiceWorker,\r\n                offlineReady,\r\n            }}\r\n        >\r\n            {children}\r\n        </UpdateContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useUpdate = () => {\r\n    const context = useContext(UpdateContext);\r\n    if (context === undefined) {\r\n        throw new Error('useUpdate must be used within an UpdateProvider');\r\n    }\r\n    return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\hooks\\useAdProtection.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\services\\gst.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\db.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[150,153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[150,153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[293,296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[293,296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[361,364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[361,364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { openDB, DBSchema, IDBPDatabase } from 'idb';\r\n\r\ninterface CabDriverDB extends DBSchema {\r\n    trips: {\r\n        key: string;\r\n        value: any; // Using any for now to match the flexible Trip type, but should be Trip\r\n    };\r\n    quotations: {\r\n        key: string;\r\n        value: any;\r\n    };\r\n    settings: {\r\n        key: string;\r\n        value: any;\r\n    };\r\n}\r\n\r\nconst DB_NAME = 'sarathi-book-db';\r\nconst DB_VERSION = 1;\r\n\r\nlet dbPromise: Promise<IDBPDatabase<CabDriverDB>>;\r\n\r\nexport const initDB = () => {\r\n    if (!dbPromise) {\r\n        dbPromise = openDB<CabDriverDB>(DB_NAME, DB_VERSION, {\r\n            upgrade(db) {\r\n                if (!db.objectStoreNames.contains('trips')) {\r\n                    db.createObjectStore('trips', { keyPath: 'id' });\r\n                }\r\n                if (!db.objectStoreNames.contains('quotations')) {\r\n                    db.createObjectStore('quotations', { keyPath: 'id' });\r\n                }\r\n                if (!db.objectStoreNames.contains('settings')) {\r\n                    db.createObjectStore('settings');\r\n                }\r\n            },\r\n        });\r\n    }\r\n    return dbPromise;\r\n};\r\n\r\nexport const dbRequest = {\r\n    async getAll<T>(storeName: 'trips' | 'quotations'): Promise<T[]> {\r\n        const db = await initDB();\r\n        return db.getAll(storeName) as Promise<T[]>;\r\n    },\r\n\r\n    async get<T>(storeName: 'trips' | 'quotations', id: string): Promise<T | undefined> {\r\n        const db = await initDB();\r\n        return db.get(storeName, id) as Promise<T | undefined>;\r\n    },\r\n\r\n    async put<T>(storeName: 'trips' | 'quotations', value: T): Promise<void> {\r\n        const db = await initDB();\r\n        await db.put(storeName, value);\r\n    },\r\n\r\n    async delete(storeName: 'trips' | 'quotations', id: string): Promise<void> {\r\n        const db = await initDB();\r\n        await db.delete(storeName, id);\r\n    },\r\n\r\n    // Settings (Key-Value store within 'settings' object store?)\r\n    // Actually, for simple key-value like 'namma-cab-trips' array which was in localStorage,\r\n    // we are migrating to individual items in an object store for better performance/querying?\r\n    // The user said \"Switch all trip data... to IndexedDB\".\r\n    // The previous code stored the ENTIRE array in one localStorage key.\r\n    // It is better to store individual items.\r\n    // BUT to minimize refactoring, I might store the whole array as one key in a 'keyval' store if I wanted to be lazy.\r\n    // The Prompt says \"IndexedDB is asynchronous and won't block... during heavy write operations\".\r\n    // Writing 1000 items as one blob is still heavy. Writing individual items is better.\r\n    // I will implement `getAll` which returns the array, mimicking the current load behavior.\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\fare.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\fare.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'totalFare' is assigned a value but never used.","line":294,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":294,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TARIFFS, TRIP_LIMITS } from '../config/tariff_config';\r\n\r\n// Keep types for compatibility\r\nexport type FareMode = 'distance' | 'hourly' | 'outstation' | 'drop' | 'package' | 'fixed' | 'custom';\r\n\r\nexport interface Trip {\r\n    id: string;\r\n    invoiceNo?: string;\r\n    customerName: string;\r\n    customerPhone?: string;\r\n    customerGst?: string;\r\n    vehicleId?: string;\r\n    passengers?: number;\r\n    startKm: number;\r\n    endKm: number;\r\n    startTime: string; // ISO String\r\n    endTime: string;   // ISO String\r\n    toll: number;\r\n    parking: number;\r\n    baseFare: number;\r\n    ratePerKm: number;\r\n    nightBata: number;\r\n    totalFare: number;\r\n    date: string;\r\n    mode: FareMode;\r\n    hourlyRate?: number;\r\n    durationHours?: number;\r\n    gst?: number;\r\n    gstRate?: number; // 5 or 12\r\n    gstType?: 'IGST' | 'CGST_SGST';\r\n    fare?: number; // Subtotal before GST (Taxable Amount)\r\n    distanceCharge?: number; // Base trip charge (distance/pkg)\r\n    distance?: number; // Actual KM travelled\r\n    effectiveDistance?: number; // KM charged (Distance or Min KM)\r\n    waitingCharges?: number;\r\n    waitingHours?: number;\r\n    hillStationCharges?: number;\r\n    petCharges?: number;\r\n    extraItems?: { description: string, amount: number, qty?: number, rate?: number, sac?: string }[];\r\n    driverBatta?: number;\r\n    nightStay?: number;\r\n    from?: string;\r\n    to?: string;\r\n    billingAddress?: string;\r\n    notes?: string;\r\n    packageName?: string;\r\n    numberOfPersons?: number;\r\n    packagePrice?: number;\r\n    permit?: number;\r\n    days?: number;\r\n    rcmEnabled?: boolean;\r\n    terms?: string[];\r\n    vehicleNumber?: string; // Snapshot\r\n    vehicleModel?: string;  // Snapshot\r\n}\r\n\r\nexport interface Expense {\r\n    id: string;\r\n    category: 'fuel' | 'maintenance' | 'food' | 'toll' | 'permit' | 'parking' | 'other';\r\n    amount: number;\r\n    date: string;\r\n    description: string;\r\n}\r\n\r\nexport interface Document {\r\n    id: string;\r\n    name: string;\r\n    expiryDate: string;\r\n    type: 'RC' | 'Insurance' | 'Permit' | 'License';\r\n    imageUrl?: string;\r\n}\r\n\r\nexport const calculateFare = (\r\n    serviceType: string, // 'one_way', 'round_trip', 'local_hourly'\r\n    vehicleType: string, // 'hatchback', 'sedan', 'suv', 'tempo'\r\n    distance: number,\r\n    durationDays: number = 1,\r\n    extraHours: number = 0, // For Local Hourly\r\n    isHillStation: boolean = false,\r\n    overrideRate?: number, // NEW: Allows UI to dictate the rate per km\r\n    overrideBata?: number, // NEW: Allows UI to dictate total driver bata\r\n    overrideHillStation?: number,\r\n    petCharge?: number,\r\n    nightCharge?: number,\r\n    hourlyPackage?: string // NEW: '4hr_40km', '8hr_80km', '12hr_120km'\r\n) => {\r\n\r\n    const vehicle = TARIFFS.vehicles[vehicleType as keyof typeof TARIFFS.vehicles];\r\n\r\n    // Safety Fallback\r\n    if (!vehicle) {\r\n        return {\r\n            totalFare: 0,\r\n            breakdown: [\"Error: Invalid Vehicle Type\"],\r\n            distance: distance,\r\n            mode: serviceType,\r\n            details: {\r\n                fare: 0,\r\n                driverBatta: 0,\r\n                hillStation: 0,\r\n                petCharge: 0,\r\n                nightCharge: 0\r\n            }\r\n        };\r\n    }\r\n\r\n    let totalFare = 0;\r\n    const breakdown: string[] = [];\r\n    let effectiveKm = distance;\r\n    let rateUsed = 0;\r\n    let distanceCharge = 0;\r\n    let calculatedBata = 0;\r\n\r\n    // ============================================================\r\n    // SCENARIO 1: LOCAL HOURLY (Rentals)\r\n    // ============================================================\r\n    if (serviceType === 'local_hourly') {\r\n        let pkgPrice = vehicle.local_8hr_pkg;\r\n        let baseKm = 80;\r\n        let pkgName = \"8 Hr / 80 Km\";\r\n\r\n        if (hourlyPackage === '4hr_40km') {\r\n            pkgPrice = vehicle.local_4hr_pkg;\r\n            baseKm = 40;\r\n            pkgName = \"4 Hr / 40 Km\";\r\n        } else if (hourlyPackage === '12hr_120km') {\r\n            pkgPrice = vehicle.local_12hr_pkg;\r\n            baseKm = 120;\r\n            pkgName = \"12 Hr / 120 Km\";\r\n        } else if (hourlyPackage === '2hr_20km') {\r\n            pkgPrice = vehicle.local_2hr_pkg;\r\n            baseKm = 20;\r\n            pkgName = \"2 Hr / 20 Km\";\r\n        }\r\n\r\n        distanceCharge = pkgPrice;\r\n        breakdown.push(`Base Package (${pkgName}): ${pkgPrice}`);\r\n\r\n        if (distance > baseKm) {\r\n            const extraKm = distance - baseKm;\r\n            const eRate = overrideRate || vehicle.one_way_rate;\r\n            const extraKmCost = extraKm * eRate;\r\n            distanceCharge += extraKmCost;\r\n            breakdown.push(`Extra Distance (${extraKm} km x ${eRate}): ${extraKmCost.toLocaleString()}`);\r\n        }\r\n\r\n        if (extraHours > 0) {\r\n            const extraHrCost = extraHours * vehicle.extra_hr_rate;\r\n            distanceCharge += extraHrCost;\r\n            breakdown.push(`Extra Time (${extraHours} hrs x ${vehicle.extra_hr_rate}): ${extraHrCost.toLocaleString()}`);\r\n        }\r\n        totalFare = distanceCharge;\r\n    }\r\n\r\n    // ============================================================\r\n    // SCENARIO 2: ROUND TRIP (Outstation)\r\n    // ============================================================\r\n    else if (serviceType === 'round_trip') {\r\n        const minKm = vehicle.min_km_per_day;\r\n        // Apply maximum trip distance per day limit to determine actual billable days\r\n        const estDays = Math.max(durationDays, Math.ceil(distance / TRIP_LIMITS.max_km_per_day));\r\n        const minBillable = minKm * estDays;\r\n\r\n        effectiveKm = Math.max(distance, minBillable);\r\n        rateUsed = overrideRate || vehicle.round_trip_rate;\r\n\r\n        distanceCharge = effectiveKm * rateUsed;\r\n\r\n        breakdown.push(`Trip Charge (${effectiveKm} km x ${rateUsed}): ${distanceCharge.toLocaleString()}`);\r\n\r\n        if (overrideBata !== undefined) {\r\n            calculatedBata = overrideBata;\r\n            breakdown.push(`Driver Bata (Manual): ${calculatedBata.toLocaleString()}`);\r\n        } else {\r\n            calculatedBata = vehicle.driver_bata * estDays;\r\n            breakdown.push(`Driver Bata [${estDays} Day${estDays > 1 ? 's' : ''} * ${vehicle.driver_bata}/Day]: ${calculatedBata.toLocaleString()}`);\r\n        }\r\n\r\n        totalFare = distanceCharge + calculatedBata;\r\n\r\n        if (effectiveKm > distance) {\r\n            breakdown.push(`Note: Min ${minKm} km/day applied for ${estDays} days`);\r\n        }\r\n    }\r\n\r\n    // ============================================================\r\n    // SCENARIO 3: ONE WAY (Drops)\r\n    // ============================================================\r\n    else {\r\n        // Heavy Vehicle Rule: Always calculated as Round Trip\r\n        if (vehicle.is_heavy_vehicle) {\r\n            const roundDist = distance * 2;\r\n            const minKmDay = vehicle.min_km_per_day;\r\n\r\n            const estDays = Math.max(durationDays, Math.ceil(roundDist / minKmDay));\r\n            const minBillable = minKmDay * estDays;\r\n\r\n            effectiveKm = Math.max(roundDist, minBillable);\r\n            rateUsed = overrideRate || vehicle.round_trip_rate;\r\n\r\n            distanceCharge = effectiveKm * rateUsed;\r\n\r\n            breakdown.push(`Trip Charge (${effectiveKm} km x ${rateUsed}): ${distanceCharge.toLocaleString()}`);\r\n\r\n            if (overrideBata !== undefined) {\r\n                calculatedBata = overrideBata;\r\n                breakdown.push(`Driver Bata (Manual): ${calculatedBata.toLocaleString()}`);\r\n            } else {\r\n                calculatedBata = vehicle.driver_bata * estDays;\r\n                breakdown.push(`Driver Bata [${estDays} Day${estDays > 1 ? 's' : ''} * ${vehicle.driver_bata}/Day]: ${calculatedBata.toLocaleString()}`);\r\n            }\r\n\r\n            totalFare = distanceCharge + calculatedBata;\r\n\r\n            breakdown.push(`Note: One-Way is charged as Round-Trip for this vehicle`);\r\n        }\r\n        // Local Short Drop Rule (< 40km)\r\n        else if (distance <= 40) {\r\n            const baseKm = 10;\r\n            let basePrice = 300; // Default (Sedan)\r\n            if (vehicleType === 'hatchback') basePrice = 250;\r\n            if (vehicleType === 'suv') basePrice = 500;\r\n            if (vehicleType === 'premium_suv') basePrice = 700;\r\n\r\n            if (distance <= baseKm) {\r\n                distanceCharge = basePrice;\r\n                breakdown.push(`Local Minimum Fare (upto 10km): ${basePrice}`);\r\n            } else {\r\n                const extraKm = distance - baseKm;\r\n                rateUsed = overrideRate || vehicle.one_way_rate;\r\n                const extraCost = extraKm * rateUsed;\r\n                distanceCharge = basePrice + extraCost;\r\n                breakdown.push(`Base Fare (10km): ${basePrice}`);\r\n                breakdown.push(`Extra Distance: ${extraKm} km x ${rateUsed} = ${extraCost}`);\r\n            }\r\n            totalFare = distanceCharge;\r\n        }\r\n        // Outstation Drop\r\n        else {\r\n            const minDrop = vehicle.min_drop_km || 130;\r\n            effectiveKm = Math.max(distance, minDrop);\r\n            rateUsed = overrideRate || vehicle.one_way_rate;\r\n\r\n            distanceCharge = effectiveKm * rateUsed;\r\n\r\n            breakdown.push(`Trip Charge (${effectiveKm} km x ${rateUsed}): ${distanceCharge.toLocaleString()}`);\r\n\r\n            if (overrideBata !== undefined) {\r\n                calculatedBata = overrideBata;\r\n                breakdown.push(`Driver Bata (Manual): ${calculatedBata.toLocaleString()}`);\r\n            } else {\r\n                // Calculate estimated days for drop trip based on safe driving limits\r\n                const estDays = Math.max(1, Math.ceil(distance / TRIP_LIMITS.max_km_per_day));\r\n                calculatedBata = vehicle.driver_bata * estDays;\r\n\r\n                breakdown.push(`Driver Bata [${estDays} Day${estDays > 1 ? 's' : ''} * ${vehicle.driver_bata}/Day]: ${calculatedBata.toLocaleString()}`);\r\n            }\r\n\r\n            totalFare = distanceCharge + calculatedBata;\r\n\r\n            if (effectiveKm > distance) {\r\n                breakdown.push(`Note: Minimum ${minDrop} km applies for drop trips`);\r\n            }\r\n        }\r\n    }\r\n\r\n    // ============================================================\r\n    // FINAL ADDITIONS (Applied to all scenarios)\r\n    // ============================================================\r\n\r\n    // Hill Station Logic\r\n    let hillStationAmt = 0;\r\n    if (overrideHillStation !== undefined && overrideHillStation > 0) {\r\n        hillStationAmt = overrideHillStation;\r\n    } else if (isHillStation) {\r\n        hillStationAmt = (vehicleType === 'tempo' || vehicleType === 'minibus' || vehicleType === 'bus') ? 1000 : 500;\r\n    }\r\n\r\n    if (hillStationAmt > 0) {\r\n        totalFare += hillStationAmt;\r\n        breakdown.push(`Hill Station Charge: ${hillStationAmt}`);\r\n    }\r\n\r\n    // Pet Charge\r\n    const petAmt = petCharge || 0;\r\n    if (petAmt > 0) {\r\n        totalFare += petAmt;\r\n        breakdown.push(`Pet Charge: ${petAmt}`);\r\n    }\r\n\r\n    // Night Charge\r\n    const nightAmt = nightCharge || 0;\r\n    if (nightAmt > 0) {\r\n        totalFare += nightAmt;\r\n        breakdown.push(`Night Charge: ${nightAmt}`);\r\n    }\r\n\r\n    const roundedFare = Math.round(distanceCharge);\r\n    const roundedBatta = Math.round(calculatedBata);\r\n    const roundedHill = Math.round(hillStationAmt);\r\n    const roundedPet = Math.round(petAmt);\r\n    const roundedNight = Math.round(nightAmt);\r\n\r\n    return {\r\n        totalFare: roundedFare + roundedBatta + roundedHill + roundedPet + roundedNight,\r\n        breakdown,\r\n        effectiveDistance: effectiveKm,\r\n        rateUsed,\r\n        distance: distance,\r\n        mode: serviceType,\r\n        details: {\r\n            fare: roundedFare,\r\n            driverBatta: roundedBatta,\r\n            hillStation: roundedHill,\r\n            petCharge: roundedPet,\r\n            nightCharge: roundedNight\r\n        }\r\n    };\r\n};\r\n\r\n/**\r\n * Fallback heuristic to estimate tolls in India based on distance and vehicle type.\r\n * NHAI rates are roughly 100-150 per 60km (i.e. ~2/km) for cars.\r\n */\r\nexport const estimateTolls = (distanceKm: number, vehicleType: string): number => {\r\n    if (distanceKm < 50) return 0; // Likely no major tolls for short city trips\r\n\r\n    // Base rates per KM (Association market estimates)\r\n    let rate = 1.8; // Hatchback/Sedan\r\n    if (vehicleType === 'suv' || vehicleType === 'premium_suv') rate = 2.4;\r\n    if (vehicleType === 'tempo') rate = 3.8;\r\n    if (vehicleType === 'minibus' || vehicleType === 'bus') rate = 7.5;\r\n\r\n    return Math.round(distanceKm * rate);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\fareWorkerWrapper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\firebase.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[859,862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[859,862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { initializeApp } from \"firebase/app\";\r\nimport { getMessaging, getToken, onMessage } from \"firebase/messaging\";\r\n\r\nconst firebaseConfig = {\r\n    apiKey: import.meta.env.VITE_FIREBASE_API_KEY,\r\n    authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,\r\n    projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,\r\n    storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,\r\n    messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,\r\n    appId: import.meta.env.VITE_FIREBASE_APP_ID,\r\n};\r\n\r\nconsole.log('Firebase Config:', { ...firebaseConfig, apiKey: '***' }); // Log for debugging, hide API key\r\n\r\n// Initialize Firebase\r\nconst app = initializeApp(firebaseConfig);\r\n\r\n// Initialize Firebase Cloud Messaging and get a reference to the service\r\n// Initialize Firebase Cloud Messaging and get a reference to the service\r\nlet messaging: any = null;\r\ntry {\r\n    messaging = getMessaging(app);\r\n} catch (error) {\r\n    console.warn('Firebase Messaging not supported in this environment:', error);\r\n}\r\n\r\nexport { messaging, getToken, onMessage };\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\geminiApi.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3002,3005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3002,3005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { GoogleGenerativeAI } from \"@google/generative-ai\";\r\n\r\nconst SYSTEM_PROMPT = `\r\nYou are \"Sarathi AI\", a specialized Voice Assistant for Indian cab drivers using the Sarathi Book app.\r\nYou are native to Tamil Nadu/South India. You understand English and Tamil perfectly and you should reply in a helpful \"Tanglish\" (Tamil + English) or simple English as preferred by the user.\r\n\r\nYOUR CORE TASKS:\r\n1. FARE CALCULATION: Use provided data to help drivers estimate fares. Hatchback (12), Sedan (14), SUV (18-20). Driver Batta (400-600).\r\n2. EXPENSE LOGGING: Help users track Fuel, EMI, and Maintenance.\r\n3. NAVIGATION: Direct users to parts of the app to complete actions.\r\n4. VOICE-FIRST: Keep responses concise and easy to understand when spoken.\r\n\r\nINTERACTIVE COMMANDS:\r\nYou MUST append these tags to trigger app actions:\r\n- [[NAVIGATE:dashboard]] -> Go Home\r\n- [[NAVIGATE:trips]] -> View Invoices/Add Trip\r\n- [[NAVIGATE:calculator]] -> Open Fare Calculator\r\n- [[NAVIGATE:expenses]] -> Open Expense Tracker (to add Fuel/EMI)\r\n- [[NAVIGATE:notes]] -> Open Quick Notes\r\n- [[NAVIGATE:profile]] -> Edit Profile/Vehicle\r\n\r\nTONE:\r\nProfessional, friendly, and street-smart. Like a co-driver.\r\nIf the user speaks in Tamil, respond in helpful Tanglish.\r\nExample: \"I want to add fuel expense\" -> \"Sure! I'm opening the Expense Tracker for you. Neenga anga fuel details fill pannikalam. [[NAVIGATE:expenses]]\"\r\n`;\r\n\r\nexport async function chatWithSarathi(message: string, history: { role: \"user\" | \"model\", parts: { text: string }[] }[] = [], context: string = \"\"): Promise<string> {\r\n    const currentKey = (import.meta.env.VITE_GEMINI_API_KEY || \"\").trim();\r\n\r\n    // Force the SDK to use the stable 'v1' instead of 'v1beta' to avoid 404s\r\n    const activeGenAI = currentKey ? new GoogleGenerativeAI(currentKey) : null;\r\n\r\n    if (!activeGenAI) {\r\n        return \" Setup Required: Please add VITE_GEMINI_API_KEY to your .env file.\";\r\n    }\r\n\r\n    const contextPrompt = context\r\n        ? `\\nCURRENT SITE DATA: \\n${context}\\nUse this data to answer user questions.`\r\n        : \"\";\r\n\r\n    // Models ordered by stability and availability\r\n    const modelsToTry = [\r\n        \"gemini-1.5-flash\",\r\n        \"gemini-1.5-flash-8b\",\r\n        \"gemini-pro\"\r\n    ];\r\n\r\n    for (const modelName of modelsToTry) {\r\n        try {\r\n            console.log(` Sarathi AI: Connecting to ${modelName} (v1)...`);\r\n            const model = activeGenAI.getGenerativeModel({ model: modelName }, { apiVersion: 'v1' });\r\n\r\n            const chat = model.startChat({\r\n                history: [\r\n                    { role: \"user\", parts: [{ text: SYSTEM_PROMPT + contextPrompt }] },\r\n                    { role: \"model\", parts: [{ text: \"Understood. I am Sarathi AI.\" }] },\r\n                    ...history\r\n                ],\r\n            });\r\n\r\n            const result = await chat.sendMessage(message);\r\n            const response = await result.response;\r\n            return response.text();\r\n        } catch (error: any) {\r\n            console.warn(` Model ${modelName} failed:`, error.message);\r\n\r\n            // Handle Quota/Enablement Error (The 429 'limit: 0' issue)\r\n            if (error.message?.includes('429') || error.message?.includes('quota')) {\r\n                return \" AI Quota Error: Your API key has '0' limit. Please ENABLE 'Generative Language API' in Google Cloud Console for this project.\";\r\n            }\r\n\r\n            if (error.message?.includes('API key')) {\r\n                return \" API Key Error: Please ensure your key in .env is correct and has Gemini permissions.\";\r\n            }\r\n\r\n            if (modelName === modelsToTry[modelsToTry.length - 1]) {\r\n                return ` AI Error: ${error.message || 'Connection failed'}. Please check your Google AI project settings.`;\r\n            }\r\n            continue;\r\n        }\r\n    }\r\n\r\n    return \" AI Error: All connection attempts failed.\";\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\googleMaps.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\gstUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\history.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\locationUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\monitoring.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[216,219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[216,219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[252,255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[252,255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":109,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3327,3330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3327,3330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from './supabase';\r\n\r\n// Wrapper for Google Analytics 4 (GA4)\r\n// This ensures type safety and centralizes all analytics logic\r\n\r\ndeclare global {\r\n    interface Window {\r\n        gtag: (...args: any[]) => void;\r\n        dataLayer: any[];\r\n    }\r\n}\r\n\r\nexport const initMonitoring = () => {\r\n    // GA4 is initialized in index.html\r\n    console.log('Analytics initialized');\r\n};\r\n\r\nexport const trackEvent = (\r\n    eventName: string,\r\n    params?: Record<string, string | number | boolean>\r\n) => {\r\n    if (typeof window.gtag === 'function') {\r\n        window.gtag('event', eventName, params);\r\n    } else {\r\n        console.warn('GA4 not loaded, event missed:', eventName, params);\r\n    }\r\n};\r\n\r\nexport const trackError = (\r\n    errorDescription: string,\r\n    fatal: boolean = false\r\n) => {\r\n    trackEvent('exception', {\r\n        description: errorDescription,\r\n        fatal: fatal\r\n    });\r\n};\r\n\r\n// Specific Business Events (Use these in components)\r\nexport const Analytics = {\r\n    // 1. Core Actions\r\n    calculateFare: async (mode: string, vehicle: string, distance: number, pickup: string, drop: string, fare: number) => {\r\n        // 1. Track in Google Analytics\r\n        trackEvent('calculate_fare', {\r\n            trip_mode: mode,\r\n            vehicle_type: vehicle,\r\n            distance_km: distance,\r\n            origin: pickup,\r\n            destination: drop,\r\n            value: fare,\r\n            currency: 'INR'\r\n        });\r\n\r\n        // 2. Save to Supabase for \"Trending Routes\"\r\n        try {\r\n            const { error } = await supabase.from('route_searches').insert({\r\n                pickup_location: pickup,\r\n                drop_location: drop,\r\n                vehicle_type: vehicle,\r\n                trip_type: mode,\r\n                distance_km: distance,\r\n                estimated_fare: fare,\r\n                created_at: new Date().toISOString()\r\n            });\r\n\r\n            if (error) {\r\n                console.warn('Failed to log route search to Supabase:', error.message);\r\n            }\r\n        } catch (e) {\r\n            console.error('Error logging search:', e);\r\n        }\r\n\r\n        // 3. Log to Admin Analytics for Activity Feed\r\n        Analytics.logActivity('fare_calculated', {\r\n            mode, vehicle, distance, pickup, drop, fare\r\n        });\r\n    },\r\n\r\n\r\n    generateInvoice: (type: 'invoice' | 'quotation', amount: number) => {\r\n        trackEvent('generate_pdf', {\r\n            document_type: type,\r\n            value: amount,\r\n            currency: 'INR'\r\n        });\r\n    },\r\n\r\n    shareApp: (location: 'header' | 'sidenav' | 'mobile_menu') => {\r\n        trackEvent('share_app', {\r\n            source_location: location\r\n        });\r\n    },\r\n\r\n    // 2. Engagement\r\n    copyQuote: () => trackEvent('copy_whatsapp_quote'),\r\n\r\n    // 3. User Journey\r\n    viewPage: (pageName: string) => {\r\n        trackEvent('screen_view', {\r\n            screen_name: pageName\r\n        });\r\n    },\r\n\r\n    // 4. Admin Analytics (Supabase)\r\n    logActivity: (\r\n        type: 'invoice_created' | 'quotation_created' | 'fare_calculated' | 'login' | 'share' |\r\n            'expense_logged' | 'expense_deleted' | 'document_uploaded' | 'document_deleted' |\r\n            'staff_added' | 'payslip_generated' | 'ai_query' | 'note_created' | 'note_updated',\r\n        details: any,\r\n        userId?: string\r\n    ) => {\r\n        // Fire and forget in a truly async block\r\n        (async () => {\r\n            try {\r\n                const { error } = await supabase.from('admin_analytics').insert({\r\n                    event_type: type,\r\n                    details: details,\r\n                    user_id: userId || null,\r\n                    created_at: new Date().toISOString()\r\n                });\r\n                if (error) console.warn('Analytics Log Error:', error.message);\r\n            } catch (err) {\r\n                console.error('Analytics Log Exception:', err);\r\n            }\r\n        })();\r\n    }\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\numberToWords.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\parking.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\payment.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[556,559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[556,559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1396,1399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1396,1399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1707,1710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1707,1710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export const loadRazorpay = (): Promise<boolean> => {\r\n    return new Promise((resolve) => {\r\n        const script = document.createElement('script');\r\n        script.src = 'https://checkout.razorpay.com/v1/checkout.js';\r\n        script.onload = () => resolve(true);\r\n        script.onerror = () => resolve(false);\r\n        document.body.appendChild(script);\r\n    });\r\n};\r\n\r\ninterface RazorpayOptions {\r\n    key: string;\r\n    amount: number;\r\n    currency: string;\r\n    name: string;\r\n    description: string;\r\n    image?: string;\r\n    handler: (response: any) => void;\r\n    prefill: {\r\n        name: string;\r\n        email: string;\r\n        contact: string;\r\n    };\r\n    notes?: Record<string, string>;\r\n    theme: {\r\n        color: string;\r\n    };\r\n}\r\n\r\nexport const initializePayment = async (options: Partial<RazorpayOptions>) => {\r\n    const res = await loadRazorpay();\r\n\r\n    if (!res) {\r\n        alert('Razorpay SDK failed to load. Are you online?');\r\n        return;\r\n    }\r\n\r\n    const razorpayOptions: RazorpayOptions = {\r\n        key: import.meta.env.VITE_RAZORPAY_KEY_ID || 'rzp_test_placeholder', // User needs to provide this\r\n        amount: options.amount || 99900, // in paise\r\n        currency: 'INR',\r\n        name: 'Sarathi Book Pro',\r\n        description: options.description || 'Yearly Subscription',\r\n        image: '/logo.png',\r\n        handler: options.handler || ((res: any) => console.log(res)),\r\n        prefill: {\r\n            name: options.prefill?.name || '',\r\n            email: options.prefill?.email || '',\r\n            contact: options.prefill?.contact || ''\r\n        },\r\n        theme: {\r\n            color: '#0047AB'\r\n        }\r\n    };\r\n\r\n    const rzp = new (window as any).Razorpay(razorpayOptions);\r\n    rzp.open();\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\pdf.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[463,466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[463,466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":121,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":124,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2304,2307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2304,2307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":228,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7615,7618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7615,7618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":228,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7642,7645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7642,7645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":229,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7687,7690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7687,7690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":229,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7712,7715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7712,7715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":229,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7736,7739],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7736,7739],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":229,"column":106,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":109,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7762,7765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7762,7765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":252,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":252,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8588,8591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8588,8591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":253,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8649,8652],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8649,8652],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":272,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9415,9418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9415,9418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":272,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9440,9443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9440,9443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":273,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":273,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9500,9503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9500,9503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":273,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":273,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9522,9525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9522,9525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":274,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9582,9585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9582,9585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":274,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9608,9611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9608,9611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":275,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9679,9682],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9679,9682],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":275,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9705,9708],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9705,9708],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":316,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":316,"endColumn":16,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[11071,11072],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":322,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":322,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11308,11311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11308,11311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":331,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11670,11673],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11670,11673],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":331,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11718,11721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11718,11721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":351,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":351,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12333,12336],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12333,12336],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":355,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":355,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12575,12578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12575,12578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":406,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":406,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14318,14321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14318,14321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":407,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":407,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14368,14371],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14368,14371],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":407,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":407,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14407,14410],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14407,14410],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":408,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":408,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14513,14516],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14513,14516],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":411,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":411,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14671,14674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14671,14674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":415,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":415,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14829,14832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14829,14832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":422,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":422,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15118,15121],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15118,15121],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":423,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":423,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15184,15187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15184,15187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":423,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":423,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15208,15211],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15208,15211],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":424,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":424,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15283,15286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15283,15286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":427,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":427,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15503,15506],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15503,15506],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":441,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":441,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16339,16342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16339,16342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":441,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":441,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16366,16369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16366,16369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":450,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":450,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16900,16903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16900,16903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":450,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":450,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16927,16930],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16927,16930],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":502,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":502,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20136,20139],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20136,20139],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":563,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":563,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22159,22162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22159,22162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":563,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":563,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22194,22197],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22194,22197],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":575,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":575,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22660,22663],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22660,22663],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":576,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":576,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22712,22715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22712,22715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":592,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":592,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23559,23562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23559,23562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":637,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":637,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25254,25257],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25254,25257],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":637,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":637,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25277,25280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25277,25280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":646,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":646,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25571,25574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25571,25574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":723,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":723,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28428,28431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28428,28431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":744,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":744,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29185,29188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29185,29188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":816,"column":45,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":816,"endColumn":46,"suggestions":[{"messageId":"removeEscape","fix":{"range":[32689,32690],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[32689,32689],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\/.","line":847,"column":47,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":847,"endColumn":48,"suggestions":[{"messageId":"removeEscape","fix":{"range":[33737,33738],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[33737,33737],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":876,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":876,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34578,34581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34578,34581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1023,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1023,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39765,39768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39765,39768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1071,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1071,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41500,41503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41500,41503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":712,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":712,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28022,28025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28022,28025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1372,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1372,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[53595,53598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[53595,53598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":55,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { type Trip } from './fare';\r\nimport { numberToWords } from './numberToWords';\r\nimport { toTitleCase, formatAddress } from './stringUtils';\r\n\r\nimport { getFinancialYear } from './gstUtils';\r\nimport { type Staff } from '../contexts/SettingsContext';\r\n\r\n\r\nexport interface PDFSettings {\r\n    companyName: string;\r\n    companyAddress: string;\r\n    driverPhone: string;\r\n    gstin: string;\r\n    vehicleNumber: string;\r\n    gstEnabled: boolean;\r\n    vehicles?: any[];\r\n    driverCode?: number;\r\n    signatureUrl?: string;\r\n    userId?: string;\r\n    bankName?: string;\r\n    accountNumber?: string;\r\n    ifscCode?: string;\r\n    holderName?: string;\r\n    branchName?: string;\r\n    upiId?: string;\r\n    preferredPaymentMethod?: 'upi' | 'bank';\r\n    appColor?: string;\r\n    logoUrl?: string;\r\n    showWatermark?: boolean;\r\n    rcmEnabled?: boolean;\r\n    showUpiOnPdf?: boolean;\r\n    showBankOnPdf?: boolean;\r\n    secondaryPhone?: string;\r\n    companyEmail?: string;\r\n}\r\n\r\nexport interface QuotationItem {\r\n    description: string;\r\n    package: string;\r\n    vehicleType: string;\r\n    rate: string;\r\n    quantity?: number; // Added for auto-calculation\r\n    amount: string;\r\n    taxable?: boolean;\r\n    sac?: string;\r\n}\r\n\r\nexport interface QuotationData {\r\n    customerName: string;\r\n    customerAddress?: string;\r\n    customerGstin?: string;\r\n    subject: string;\r\n    pickup?: string;\r\n    drop?: string;\r\n    startTime?: string; // Added for Local Package\r\n    endTime?: string;   // Added for Local Package\r\n    date: string;\r\n    items: QuotationItem[];\r\n    gstEnabled?: boolean;\r\n    gstRate?: number; // Added\r\n    gstType?: 'IGST' | 'CGST_SGST'; // Added\r\n    rcmEnabled?: boolean;\r\n    quotationNo?: string;\r\n    terms?: string[];\r\n}\r\n\r\nexport interface SavedQuotation {\r\n    id: string;\r\n    quotationNo: string;\r\n    customerName: string;\r\n    customerAddress?: string; // Added\r\n    customerGstin?: string;   // Added\r\n    subject: string;\r\n    date: string;\r\n    items: QuotationItem[];\r\n    vehicleType: string;\r\n    gstEnabled?: boolean;\r\n    gstRate?: number; // Added\r\n    gstType?: 'IGST' | 'CGST_SGST'; // Added\r\n    rcmEnabled?: boolean;\r\n    terms?: string[];\r\n}\r\n\r\nexport const generateReceiptPDF = async (trip: Trip, settings: PDFSettings, isQuotation: boolean = false, existingDoc?: any) => {\r\n    // Dynamic Import for Code Splitting\r\n    const { jsPDF } = await import('jspdf');\r\n\r\n    let doc = existingDoc;\r\n    if (!doc) {\r\n        doc = new jsPDF({ unit: 'mm', format: 'a4', compress: true });\r\n    }\r\n\r\n    const margin = 15;\r\n    let y = 0;\r\n\r\n    // Safety checks for settings\r\n    const companyName = String(settings?.companyName || 'SARATHI BOOK OWNER');\r\n    const driverPhone = String(settings?.driverPhone || '');\r\n    const gstin = settings?.gstin ? String(settings.gstin).toUpperCase() : '';\r\n    const vehicleNumber = String(trip.vehicleNumber || settings?.vehicleNumber || 'N/A');\r\n    const gstEnabled = !!settings?.gstEnabled;\r\n    const themeColor = settings?.appColor || '#0047AB';\r\n    const rgb = hexToRgb(themeColor);\r\n\r\n    // Helper to apply theme color\r\n    const setThemeColor = () => doc.setTextColor(rgb.r, rgb.g, rgb.b);\r\n    const setDrawThemeColor = () => doc.setDrawColor(rgb.r, rgb.g, rgb.b);\r\n\r\n    // --- ZONE 1: HEADER (Minimal / Sustainable) ---\r\n    if (settings?.logoUrl) {\r\n        try {\r\n            // Add custom logo if available\r\n            doc.addImage(settings.logoUrl, 'PNG', margin, 12, 18, 18, undefined, 'FAST');\r\n\r\n            setThemeColor();\r\n            doc.setFont('helvetica', 'bold');\r\n            doc.setFontSize(22);\r\n            doc.text(companyName.toUpperCase(), margin + 22, 22);\r\n            doc.setTextColor(0, 0, 0);\r\n        } catch (e) {\r\n            console.error('Failed to add custom logo to PDF', e);\r\n            // Fallback to text header\r\n            setThemeColor();\r\n            doc.setFont('helvetica', 'bold');\r\n            doc.setFontSize(24);\r\n            doc.text(companyName.toUpperCase(), margin, 20);\r\n            doc.setTextColor(0, 0, 0);\r\n        }\r\n    } else {\r\n        setThemeColor();\r\n        doc.setFont('helvetica', 'bold');\r\n        doc.setFontSize(24);\r\n        doc.text(companyName.toUpperCase(), margin, 20);\r\n        doc.setTextColor(0, 0, 0); // Reset for others\r\n    }\r\n\r\n\r\n    doc.setFontSize(9);\r\n\r\n    doc.setFontSize(9);\r\n    doc.setFont('helvetica', 'normal');\r\n    const companyAddress = String(settings?.companyAddress || '');\r\n\r\n    // Dynamic height calculation for Address\r\n    const addressY = 28;\r\n    const addressLines = doc.splitTextToSize(companyAddress, 100);\r\n    doc.text(addressLines, margin, addressY);\r\n\r\n    // Position Contact info below address\r\n    const contactY = addressY + (addressLines.length * 4.5) + 1; // 4.5mm per line + 1mm gap\r\n\r\n    doc.setFontSize(10);\r\n    doc.text(`Contact: ${driverPhone}${gstin ? `  |  GSTIN: ${gstin}` : ''}`, margin, contactY);\r\n    if (settings?.driverCode) {\r\n        doc.text(`Driver ID: #${settings.driverCode}`, 195, contactY, { align: 'right' });\r\n    }\r\n\r\n    // Divider Line\r\n    const dividerY = contactY + 3;\r\n    setDrawThemeColor();\r\n    doc.setLineWidth(0.6);\r\n    doc.line(margin, dividerY, 195, dividerY);\r\n    doc.setDrawColor(200, 200, 200); // Reset\r\n\r\n    // --- ZONE 2: INVOICE DETAILS & CUSTOMER INFO (Merged) ---\r\n    y = dividerY + 8; // Margin after divider\r\n\r\n    // 1. Center Title\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.setFontSize(14);\r\n    doc.setFont('helvetica', 'bold');\r\n    if (isQuotation) {\r\n        doc.text('QUOTATION / PROFORMA', 105, y, { align: 'center' });\r\n    } else {\r\n        const isRegistered = !!gstin;\r\n        const title = (isRegistered && gstEnabled) ? 'TAX INVOICE' : (trip.mode === 'custom' ? 'INVOICE' : 'TRIP RECEIPT');\r\n        doc.text(title, 105, y, { align: 'center' });\r\n    }\r\n\r\n    // Move Y down for content\r\n    y += 10;\r\n    const contentStartY = y;\r\n\r\n    // LEFT COLUMN: BILL TO & JOURNEY (Now moved up)\r\n    const leftColX = margin;\r\n\r\n    // BILL TO Section\r\n    doc.setFontSize(10);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('BILL TO:', leftColX, y);\r\n    y += 5;\r\n\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.setFont('helvetica', 'normal');\r\n    // doc.text(toTitleCase(String(trip.customerName || 'Customer')), leftColX, y);\r\n    const billToName = toTitleCase(String(trip.customerName || 'Customer'));\r\n    const billToLines = doc.splitTextToSize(billToName, 90);\r\n    doc.text(billToLines, leftColX, y);\r\n    y += (billToLines.length * 5); // Dynamic gap\r\n\r\n    if (trip.billingAddress) {\r\n        doc.setFontSize(9);\r\n        const addrText = formatAddress(String(trip.billingAddress));\r\n        // Split by comma for cleaner lines, limit to 2 lines max here to save space\r\n        const parts = addrText.split(',').map(p => p.trim());\r\n        const displayAddr = parts.join(', ');\r\n        const addrLines = doc.splitTextToSize(displayAddr, 90); // 90mm width\r\n        doc.text(addrLines.slice(0, 2), leftColX, y);\r\n        y += (Math.min(addrLines.length, 2) * 5) + 2;\r\n    }\r\n\r\n    if (trip.customerPhone) {\r\n        doc.setFontSize(9);\r\n        doc.text(`Ph: ${trip.customerPhone}`, leftColX, y);\r\n        y += 5;\r\n    }\r\n\r\n    if (trip.customerGst) {\r\n        doc.setFont('helvetica', 'bold');\r\n        doc.setFontSize(9);\r\n        doc.text(`GSTIN: ${String(trip.customerGst).toUpperCase()}`, leftColX, y);\r\n        y += 6;\r\n    }\r\n\r\n    // PICKUP & DROP Section (Stretched, One line each)\r\n    const hasFrom = trip.from && trip.from !== 'N/A';\r\n    const hasTo = trip.to && trip.to !== 'N/A';\r\n    const hasTime = (trip as any).startTime || (trip as any).endTime;\r\n    const hasDist = ((trip as any).startKm && (trip as any).endKm) || (trip as any).distance || (trip as any).effectiveDistance;\r\n\r\n    if (hasFrom || hasTo || hasTime || hasDist) {\r\n        y += 4; // Gap between Bill To and Trip Details\r\n        doc.setFontSize(10);\r\n        doc.setFont('helvetica', 'bold');\r\n        doc.text('JOURNEY DETAILS:', leftColX, y);\r\n        y += 5;\r\n\r\n        doc.setFont('helvetica', 'normal');\r\n        doc.setFontSize(9);\r\n\r\n        // 2. Pickup\r\n        if (hasFrom) {\r\n            const fromAddr = String(trip.from).replace(/, India$/, '').replace(/, Tamil Nadu$/, '');\r\n            const pickupText = `Pickup: ${fromAddr}`;\r\n            const pickupLines = doc.splitTextToSize(pickupText, 95);\r\n            doc.text(pickupLines, leftColX, y);\r\n            y += (pickupLines.length * 5);\r\n        }\r\n\r\n        // 3. Drop / Time logic\r\n        if (hasTime) {\r\n            const sTime = (trip as any).startTime || 'N/A';\r\n            const eTime = (trip as any).endTime || 'N/A';\r\n\r\n            const sLines = doc.splitTextToSize(`Start Time: ${sTime}`, 95);\r\n            doc.text(sLines, leftColX, y);\r\n            y += (sLines.length * 5);\r\n\r\n            const eLines = doc.splitTextToSize(`End Time:   ${eTime}`, 95);\r\n            doc.text(eLines, leftColX, y);\r\n            y += (eLines.length * 5);\r\n        } else if (hasTo) {\r\n            const toAddr = String(trip.to).replace(/, India$/, '').replace(/, Tamil Nadu$/, '');\r\n            const dropText = `Drop:   ${toAddr}`;\r\n            const dropLines = doc.splitTextToSize(dropText, 95);\r\n            doc.text(dropLines, leftColX, y);\r\n            y += (dropLines.length * 5);\r\n        }\r\n\r\n        // 4. Distance\r\n        let distStr = '';\r\n        if ((trip as any).startKm && (trip as any).endKm) {\r\n            distStr = `Distance: ${((trip as any).endKm - (trip as any).startKm).toFixed(1)} km`;\r\n        } else if ((trip as any).distance || (trip as any).effectiveDistance) {\r\n            distStr = `Distance: ${(trip as any).distance || (trip as any).effectiveDistance} km`;\r\n        }\r\n\r\n        if (distStr) {\r\n            doc.text(distStr, leftColX, y);\r\n            y += 5;\r\n        }\r\n    }\r\n\r\n    const leftEndY = y + 2;\r\n\r\n\r\n    // RIGHT COLUMN: INVOICE DATA (Kept on Right, parallel to Left Col)\r\n    y = contentStartY; // Reset Y to top of section for right column rendering\r\n    const rightAlignX = 195;\r\n\r\n    doc.setFontSize(9);\r\n    doc.setFont('helvetica', 'normal');\r\n\r\n    // Standard GST Format: INV/FY/SEQ (e.g., INV/25-26/001)\r\n    const date = new Date(trip.date || Date.now());\r\n    const fy = getFinancialYear(date);\r\n    const prefix = `INV/${fy}/`;\r\n\r\n    let invoiceNo = '';\r\n    if (trip.invoiceNo && (trip.invoiceNo.includes('/') || trip.invoiceNo.startsWith('INV-'))) {\r\n        invoiceNo = trip.invoiceNo; // Use valid pre-existing sequence directly\r\n    } else {\r\n        const serialPart = (trip.id || '000').substring(0, 3).toUpperCase();\r\n        invoiceNo = isQuotation\r\n            ? (trip.invoiceNo || `QTN/${fy}/${serialPart}`)\r\n            : `${prefix}${serialPart}`;\r\n    }\r\n\r\n    doc.text(`${isQuotation ? 'Quotation' : 'Invoice'} No: ${invoiceNo}`, rightAlignX, y, { align: 'right' });\r\n\r\n    y += 5;\r\n    let dateStr = 'N/A';\r\n    try {\r\n        const d = new Date(trip.date);\r\n        dateStr = isNaN(d.getTime()) ? 'N/A' : d.toLocaleDateString('en-IN');\r\n    } catch { }\r\n    doc.text(`Date: ${dateStr}`, rightAlignX, y, { align: 'right' });\r\n\r\n    y += 5;\r\n    if (isQuotation) {\r\n        // For Quotation, show \"Valid Until\" or \"Vehicle Class\" instead of specific Number\r\n        const vType = (trip as any).vehicleType || 'Any'; // Cast for Quotation field\r\n        doc.text(`Vehicle Class: ${vType}`, rightAlignX, y, { align: 'right' });\r\n    } else {\r\n        doc.text(`Vehicle No: ${vehicleNumber}`, rightAlignX, y, { align: 'right' });\r\n    }\r\n    y += 5;\r\n    // RCM Check\r\n    let isRcm = false;\r\n    if (settings.rcmEnabled) isRcm = true;\r\n    if ((trip as any).rcmEnabled !== undefined) isRcm = (trip as any).rcmEnabled;\r\n\r\n    if (gstEnabled || isRcm) {\r\n        doc.text(`Place of Supply: Tamil Nadu (33)`, rightAlignX, y, { align: 'right' });\r\n        y += 5;\r\n    }\r\n\r\n    if (isRcm && !gstEnabled) {\r\n        doc.text(`Tax Payable on Reverse Charge: YES`, rightAlignX, y, { align: 'right' });\r\n    } else {\r\n        doc.text(`Tax Payable on Reverse Charge: NO`, rightAlignX, y, { align: 'right' });\r\n    }\r\n\r\n    const rightEndY = y + 5;\r\n\r\n\r\n    // Set Y to the max of both columns for the table to start\r\n    y = Math.max(leftEndY, rightEndY) + 5;\r\n\r\n    // Subject Line (Centered above table)\r\n    if ((trip as any).subject) {\r\n        doc.setFont('helvetica', 'bold');\r\n        doc.setFontSize(10);\r\n        // doc.text(`Subject: ${(trip as any).subject}`, 105, y, { align: 'center', maxWidth: 180 });\r\n        const subjectText = `Subject: ${(trip as any).subject}`;\r\n        const subjectLines = doc.splitTextToSize(subjectText, 180);\r\n        doc.text(subjectLines, 105, y, { align: 'center' });\r\n\r\n        doc.setFont('helvetica', 'normal');\r\n        doc.setFontSize(9);\r\n        y += (subjectLines.length * 5) + 3; // Dynamic height + padding\r\n    }\r\n\r\n    // --- ZONE 4: TABLE (Clean Lines) ---\r\n    // Header Line Top\r\n    doc.setDrawColor(0, 0, 0);\r\n    doc.setLineWidth(0.1);\r\n    doc.line(margin, y, 195, y);\r\n\r\n    y += 5;\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.setFontSize(9);\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.text('DESCRIPTION', margin + 2, y);\r\n    doc.text('SAC', 95, y); // NEW COLUMN\r\n    doc.text('QTY', 115, y);\r\n    doc.text('RATE', 145, y);\r\n    doc.text('AMOUNT', 195, y, { align: 'right' });\r\n\r\n    y += 3;\r\n    // Header Line Bottom\r\n    doc.line(margin, y, 195, y);\r\n    y += 8;\r\n\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.setFont('helvetica', 'normal');\r\n\r\n    let runningSubtotal = 0;\r\n    const addTableRow = (label: string, qty: string, rate: string, amount: number, sac: string = '9966') => {\r\n        const safeAmount = isNaN(amount) ? 0 : amount;\r\n\r\n        // Description wrapping\r\n        const descLines = doc.splitTextToSize(label, 75); // Reduced width for Desc to fit SAC\r\n        doc.text(descLines, margin + 2, y);\r\n\r\n        doc.text(sac, 95, y); // SAC Code Fixed\r\n        doc.text(qty, 115, y);\r\n        doc.text(rate, 145, y);\r\n        doc.text(`${safeAmount.toLocaleString('en-IN', { minimumFractionDigits: 2 })}`, 195, y, { align: 'right' });\r\n\r\n        runningSubtotal += safeAmount;\r\n        y += Math.max(8, descLines.length * 5); // Dynamic height\r\n    };\r\n\r\n    // --- PRINT PRE-CALCULATED ITEMS ---\r\n    const pStep = (trip as any).previewStep || 4;\r\n    const dist = (trip as any).distance !== undefined ? (trip as any).distance : Math.max(0, (trip.endKm || 0) - (trip.startKm || 0));\r\n    const effectiveDist = (trip as any).effectiveDistance || dist;\r\n\r\n    // Logic: distanceCharge is the basic trip/KM cost. fare is the total taxable subtotal.\r\n    let mainAmount = (trip as any).distanceCharge;\r\n    const hasExplicitDistanceCharge = mainAmount !== undefined;\r\n\r\n    if (!hasExplicitDistanceCharge) {\r\n        mainAmount = (trip as any).fare || 0;\r\n    }\r\n\r\n    if (pStep >= 2 || (trip.mode === 'custom' && pStep >= 1)) {\r\n        if (trip.mode === 'custom') {\r\n            if (trip.extraItems && trip.extraItems.length > 0) {\r\n                trip.extraItems.forEach(item => {\r\n                    const iQty = (item as any).quantity || '1';\r\n                    const iRate = (item as any).rate ? `${(item as any).rate}` : `${item.amount}`;\r\n                    const iSac = (item as any).sac || '9966';\r\n                    addTableRow(item.description || 'Service Charge', String(iQty), iRate, item.amount || 0, iSac);\r\n                });\r\n            } else if (hasExplicitDistanceCharge || (trip as any).fare) {\r\n                addTableRow('Custom Invoice', '1', `${mainAmount}`, mainAmount);\r\n            }\r\n        } else if (trip.mode === 'hourly') {\r\n            const hrs = trip.waitingHours || 8;\r\n            // Hourly usually has fixed package price, rate is package price\r\n            addTableRow(`Local Rental / Hourly Package (${hrs} Hrs)`, '1', `${mainAmount}`, mainAmount);\r\n        } else if (trip.mode === 'package') {\r\n            addTableRow(String(trip.packageName || 'TOUR PACKAGE').toUpperCase(), '1', `${trip.packagePrice}`, trip.packagePrice || 0);\r\n        } else if (trip.mode === 'drop') {\r\n            if (dist <= 40) {\r\n                addTableRow(`Local Drop Trip`, '1', `${mainAmount}`, mainAmount);\r\n            } else {\r\n                // Determine rate used\r\n                const rateUsed = (trip as any).rateUsed || ((trip as any).ratePerKm) || (mainAmount / (effectiveDist || 1));\r\n                const pRate = isNaN(rateUsed) ? '-' : `${parseFloat(rateUsed).toFixed(1)}/KM`;\r\n\r\n                // For Outstation Drop, it's min dist * rate\r\n                const calcDesc = `${effectiveDist} KM * ${pRate}`;\r\n                addTableRow(`Outstation Drop Trip [${calcDesc}]`, `${effectiveDist} KM`, pRate, mainAmount);\r\n            }\r\n        } else if (trip.mode === 'outstation') {\r\n            // Determine rate used\r\n            const rateUsed = (trip as any).rateUsed || ((trip as any).ratePerKm) || (mainAmount / (effectiveDist || 1));\r\n            const pRate = isNaN(rateUsed) ? '-' : `${parseFloat(rateUsed).toFixed(1)}/KM`;\r\n            const calcDesc = `${effectiveDist} KM * ${pRate}`;\r\n            addTableRow(`Round Trip [${calcDesc}]`, `${effectiveDist} KM`, pRate, mainAmount);\r\n        }\r\n    }\r\n\r\n    if (pStep >= 3) {\r\n        // Only add these IF they weren't already bundled into 'mainAmount' (legacy fallback case)\r\n        const shouldAddIndividual = hasExplicitDistanceCharge;\r\n\r\n        if (shouldAddIndividual) {\r\n            // Night Batta\r\n            if ((trip.nightBata || 0) > 0) {\r\n                const payDays = (trip.mode === 'outstation' ? trip.days : 1) || 1;\r\n                const perNightBatta = (trip.nightBata || 0) / payDays;\r\n                const nLabel = payDays > 1 ? `Night Allowance (${payDays} Nights * ${perNightBatta}/Night)` : 'Night Allowance';\r\n                addTableRow(nLabel, `${payDays}`, `${perNightBatta}`, trip.nightBata || 0);\r\n            }\r\n\r\n            // Driver Batta\r\n            if ((trip.driverBatta || 0) > 0) {\r\n                const payDays = (trip.mode === 'outstation' ? trip.days : 1) || 1;\r\n                const perDayBatta = (trip.driverBatta || 0) / payDays;\r\n                const bLabel = payDays > 1 ? `Driver Batta (${payDays} Days * ${perDayBatta}/Day)` : `Driver Batta`;\r\n                addTableRow(bLabel, `${payDays}`, `${perDayBatta}`, trip.driverBatta || 0);\r\n            }\r\n\r\n            // Night Stay\r\n            if ((trip.nightStay || 0) > 0) {\r\n                // If we have days, maybe we can calc rate? usually night stay is bulk or per night?\r\n                // Trip form doesn't strictly track # of night stays separately from days, but usually 1-to-1 or manually entered total.\r\n                // Use total as rate if single, else just total.\r\n                addTableRow('Night Stay Charge', '1', `${trip.nightStay}`, trip.nightStay || 0);\r\n            }\r\n\r\n            if ((trip.waitingCharges || 0) > 0) {\r\n                const wRate = (trip.waitingCharges || 0) / (trip.waitingHours || 1);\r\n                addTableRow(`Waiting Charges (${trip.waitingHours} Hrs * ${wRate}/Hr)`, `${trip.waitingHours} Hrs`, `${wRate}/Hr`, trip.waitingCharges || 0);\r\n            }\r\n            if ((trip.hillStationCharges || 0) > 0) addTableRow('Hill Station Charges', '1', `${trip.hillStationCharges}`, trip.hillStationCharges || 0);\r\n            if ((trip.petCharges || 0) > 0) addTableRow('Pet Carrying Charges', '1', `${trip.petCharges}`, trip.petCharges || 0);\r\n        }\r\n\r\n        // Tolls/Permits/Parking are ALWAYS separate even in legacy? No, usually they were separate fields.\r\n        if ((trip.permit || 0) > 0) addTableRow('Permit Charges', '1', `${trip.permit}`, trip.permit || 0);\r\n        if ((trip.parking || 0) > 0) addTableRow('Parking Charges', '1', `${trip.parking}`, trip.parking || 0);\r\n        if ((trip.toll || 0) > 0) addTableRow('Toll Charges', '1', `${trip.toll}`, trip.toll || 0);\r\n\r\n        // Custom extra items from step 3\r\n        if (trip.extraItems && trip.mode !== 'custom') {\r\n            trip.extraItems.forEach(item => {\r\n                const iSac = (item as any).sac || '9966';\r\n                if (item.amount > 0) addTableRow(item.description || 'Extra Item', '1', '-', item.amount, iSac);\r\n            });\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    // --- TOTALS & PAYMENT SECTION (Side-by-Side) ---\r\n    // Reimbursements are now 0 as they are included in Taxes\r\n    const reimbursements = 0;\r\n\r\n    y += 5;\r\n    doc.setDrawColor(200, 200, 200);\r\n    doc.line(margin, y, 195, y); // Start of new section\r\n    y += 8;\r\n\r\n    const sectionsStartY = y;\r\n\r\n    // 1. Render Payment Details (Left Side)\r\n    let paymentY = sectionsStartY;\r\n    if (settings.holderName || settings.upiId || settings.accountNumber) {\r\n        doc.setFontSize(9);\r\n        setThemeColor();\r\n        doc.setFont('helvetica', 'bold');\r\n        doc.text('PAYMENT DETAILS:', margin, paymentY);\r\n        doc.setTextColor(0, 0, 0);\r\n\r\n        doc.setFontSize(8);\r\n        doc.setFont('helvetica', 'normal');\r\n        paymentY += 5;\r\n\r\n        const isBank = !!settings.showBankOnPdf;\r\n        const isUpi = !!settings.showUpiOnPdf;\r\n\r\n        if (isBank && settings.bankName) {\r\n            doc.text(`Bank Name    : ${settings.bankName}`, margin, paymentY);\r\n            paymentY += 4;\r\n        }\r\n        if (isBank && settings.accountNumber) {\r\n            doc.text(`Account No   : ${settings.accountNumber}`, margin, paymentY);\r\n            paymentY += 4;\r\n        }\r\n        if (isBank && settings.ifscCode) {\r\n            doc.text(`IFSC Code    : ${settings.ifscCode}`, margin, paymentY);\r\n            paymentY += 4;\r\n        }\r\n        if (isUpi && settings.upiId) {\r\n            doc.text(`UPI ID       : ${settings.upiId}`, margin, paymentY);\r\n            paymentY += 4;\r\n        }\r\n        if ((isBank || isUpi) && settings.holderName) {\r\n            doc.text(`A/C Holder   : ${settings.holderName}`, margin, paymentY);\r\n            paymentY += 4;\r\n        }\r\n    }\r\n\r\n    // 2. Render Totals (Right Side) - USE VALUES FROM ENGINE DIRECTLY\r\n    let totalsY = sectionsStartY;\r\n    const taxableValue = (trip as any).fare !== undefined ? (trip as any).fare : runningSubtotal;\r\n    const gstValue = pStep >= 4 ? (trip.gst || 0) : 0;\r\n\r\n    doc.setFontSize(10);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text('Taxable Amount:', 135, totalsY);\r\n    doc.text(`${taxableValue.toLocaleString('en-IN', { minimumFractionDigits: 2 })}`, 195, totalsY, { align: 'right' });\r\n    totalsY += 8;\r\n\r\n    const isDriverRegistered = !!gstin;\r\n\r\n    if (isDriverRegistered && gstValue > 0) {\r\n        const rate = (trip as any).gstRate || 5;\r\n        const isIgst = (trip as any).gstType === 'IGST';\r\n\r\n        if (isIgst) {\r\n            doc.text(`IGST (${rate}%):`, 135, totalsY);\r\n            doc.text(`${gstValue.toLocaleString('en-IN', { minimumFractionDigits: 2 })}`, 195, totalsY, { align: 'right' });\r\n            totalsY += 8;\r\n        } else {\r\n            const halfRate = rate / 2;\r\n            const halfGst = gstValue / 2;\r\n            doc.text(`CGST (${halfRate}%):`, 135, totalsY);\r\n            doc.text(`${halfGst.toLocaleString('en-IN', { minimumFractionDigits: 2 })}`, 195, totalsY, { align: 'right' });\r\n            totalsY += 6;\r\n            doc.text(`SGST (${halfRate}%):`, 135, totalsY);\r\n            doc.text(`${halfGst.toLocaleString('en-IN', { minimumFractionDigits: 2 })}`, 195, totalsY, { align: 'right' });\r\n            totalsY += 8;\r\n        }\r\n    } else if ((settings.rcmEnabled || (trip as any).rcmEnabled) && !gstEnabled) {\r\n        doc.setFontSize(9);\r\n        doc.setFont('helvetica', 'bold');\r\n        doc.text('Tax Payable on Reverse Charge:', 135, totalsY);\r\n        doc.text('YES', 195, totalsY, { align: 'right' });\r\n        doc.setFont('helvetica', 'normal');\r\n        doc.setFontSize(10);\r\n        totalsY += 8;\r\n    } else if (isDriverRegistered && gstValue === 0 && gstEnabled) {\r\n        doc.setFontSize(8);\r\n        doc.setTextColor(100, 100, 100);\r\n        doc.text('Tax: 0.00 (Nil Rated)', 135, totalsY);\r\n        doc.setTextColor(0, 0, 0);\r\n        totalsY += 8;\r\n        doc.setFont('helvetica', 'normal');\r\n        doc.setFontSize(10);\r\n    }\r\n\r\n    const finalTotal = trip.totalFare !== undefined ? trip.totalFare : (taxableValue + gstValue + reimbursements);\r\n\r\n    // Grand Total Box\r\n    totalsY += 2;\r\n    doc.setDrawColor(0, 0, 0);\r\n    doc.setLineWidth(0.3);\r\n    doc.line(130, totalsY - 6, 195, totalsY - 6);\r\n    doc.line(130, totalsY + 4, 195, totalsY + 4);\r\n\r\n    setThemeColor();\r\n    doc.setFontSize(12);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('GRAND TOTAL', 135, totalsY);\r\n    doc.text(`Rs. ${finalTotal.toLocaleString('en-IN', { minimumFractionDigits: 2 })}`, 195, totalsY, { align: 'right' });\r\n    doc.setTextColor(0, 0, 0);\r\n    totalsY += 12;\r\n\r\n    y = Math.max(paymentY, totalsY) + 5;\r\n\r\n    doc.setFontSize(9);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.setTextColor(31, 41, 55);\r\n    // Center the Rupees in Words\r\n    doc.text(`RUPEES IN WORDS: ${numberToWords(finalTotal).toUpperCase()}`, 105, y, { align: 'center', maxWidth: 180 });\r\n    doc.setTextColor(0, 0, 0);\r\n\r\n    // --- TERMS & CONDITIONS ---\r\n    if ((trip as any).terms && (trip as any).terms.length > 0) {\r\n        y += 10;\r\n        doc.setFontSize(10);\r\n        doc.setFont('helvetica', 'bold');\r\n        doc.text('TERMS & CONDITIONS:', margin, y);\r\n        y += 5;\r\n        doc.setFont('helvetica', 'normal');\r\n        doc.setFontSize(8);\r\n\r\n        const terms = (trip as any).terms as string[];\r\n        terms.forEach((term: string) => {\r\n            const bullet = '';\r\n            const cleanTerm = term.replace(/^\\s*/, ''); // Remove existing bullet if any\r\n            const termLines = doc.splitTextToSize(`${bullet} ${cleanTerm}`, 180);\r\n            doc.text(termLines, margin + 2, y);\r\n            y += (termLines.length * 4) + 1;\r\n        });\r\n    }\r\n\r\n    y = 252;\r\n    doc.setFontSize(9);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('For ' + companyName.toUpperCase(), 195, y, { align: 'right' });\r\n\r\n    if (settings?.signatureUrl) {\r\n        try {\r\n            // Positioned clearly between lines (For @ 252, Auth @ 268)\r\n            doc.addImage(settings.signatureUrl, 'PNG', 160, 253, 35, 14, undefined, 'FAST');\r\n        } catch (e) {\r\n            console.error('Failed to add signature image', e);\r\n        }\r\n    }\r\n\r\n    // Removed blue line as requested\r\n\r\n    y = 268;\r\n    doc.setFontSize(9);\r\n    doc.setTextColor(31, 41, 55);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('Receiver\\'s Signature', margin, y);\r\n    doc.text('Authorized Signatory', 195, y, { align: 'right' });\r\n\r\n    // Footer Disclaimer - Centered\r\n    y = 276;\r\n    doc.setFontSize(8);\r\n    doc.setTextColor(150, 150, 150);\r\n    doc.setFont('helvetica', 'italic');\r\n    doc.text('Computer generated invoice, no signature required.', 105, y, { align: 'center' }); // Centered\r\n\r\n    y = 278;\r\n    setDrawThemeColor();\r\n    doc.setLineWidth(0.5);\r\n    doc.line(margin, y, 195, y);\r\n    y += 3; // Adjusted for logo\r\n\r\n    // Only show watermark if enabled\r\n    if (settings.showWatermark !== false) {\r\n        try {\r\n            // Brand Logo and Name in Footer\r\n            doc.addImage('/logo.png', 'PNG', margin, y, 10, 10, undefined, 'FAST');\r\n\r\n            doc.setFont('times', 'bold');\r\n            doc.setFontSize(10);\r\n            setThemeColor();\r\n            doc.text('SARATHI BOOK', margin + 12, y + 4.5);\r\n\r\n            doc.setFont('helvetica', 'normal');\r\n            doc.setFontSize(6);\r\n            doc.setTextColor(100, 100, 100);\r\n            doc.text('Your digital office on car', margin + 12, y + 8);\r\n\r\n            doc.setFontSize(8);\r\n            setThemeColor();\r\n            doc.setFont('helvetica', 'bold');\r\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n            doc.text('sarathibook.com', 195, y + 6, { align: 'right', url: 'https://sarathibook.com' } as any);\r\n            doc.link(175, y, 20, 10, { url: 'https://sarathibook.com' });\r\n        } catch {\r\n            // Fallback if logo fails\r\n            doc.setFontSize(7);\r\n            setThemeColor();\r\n            doc.setFont('helvetica', 'bold');\r\n\r\n            doc.text('SARATHIBOOK.COM', 105, y + 2, {\r\n                align: 'center',\r\n                url: 'https://sarathibook.com'\r\n            } as any);\r\n\r\n            doc.setFontSize(4);\r\n            doc.setTextColor(150, 150, 150);\r\n            doc.setFont('helvetica', 'normal');\r\n            doc.text('PROFESSIONAL CAB BUSINESS SUITE | AUTOMATE YOUR GROWTH', 105, y + 5, { align: 'center' });\r\n\r\n            doc.link(90, y, 30, 5, { url: 'https://sarathibook.com' });\r\n        }\r\n    } else {\r\n        // Just show nothing or a very small spacer if needed, but the request is to remove it.\r\n    }\r\n\r\n    return doc;\r\n};\r\n\r\n\r\n\r\n// Sustainable Quotation Design (Refactored to match Professional Letterhead Standard)\r\nexport const generateQuotationPDF = async (data: QuotationData, settings: PDFSettings) => {\r\n    // Map QuotationData to Trip format to reuse the Receipt Generator\r\n    const tripData: any = {\r\n        id: 'QUOTATION',\r\n        invoiceNo: data.quotationNo,\r\n        date: data.date,\r\n        customerName: data.customerName,\r\n        customerAddress: data.customerAddress, // mapped to billingAddress logic if needed\r\n        billingAddress: data.customerAddress,\r\n        customerGst: data.customerGstin,\r\n        from: data.pickup, // Correctly mapped\r\n        to: data.drop,     // Correctly mapped\r\n        startTime: data.startTime, // Map Start Time\r\n        endTime: data.endTime,     // Map End Time\r\n        subject: data.subject, // Passed for separate rendering\r\n        // Better: Let's put Subject as the main \"Description\" line in the items table or as a specialized field.\r\n        // Actually, generateReceiptPDF displays 'from' and 'to' in Journey Details.\r\n        // For Quotation, 'to' (Client) is already in Bill To.\r\n        // 'from' usually is empty or meaningless.\r\n        // Let's repurpose 'from' to show 'Subject' if it's a quote?\r\n        // In generateReceiptPDF: \"Pickup: {trip.from}\"\r\n        // So it will show: \"Pickup: Subject: ...\". A bit weird.\r\n        // Maybe we leave 'from/to' empty or dashed?\r\n\r\n        // Let's set 'from' to the Subject directly, so it shows \"Pickup: <Subject>\" -> User might not like \"Pickup:\" label.\r\n        // Limitation: generateReceiptPDF hardcodes \"Pickup:\" and \"Drop:\".\r\n        // Use blank for now, relying on the Bill To section.\r\n        // Removed override of 'to' property to allow data.drop mapping\r\n\r\n        mode: 'custom',\r\n\r\n        // Map items to extraItems so they appear in table\r\n        extraItems: data.items.map(item => ({\r\n            description: `${item.description} ${item.package ? `(${item.package})` : ''}`,\r\n            amount: parseFloat(item.amount) || 0,\r\n            rate: item.rate,\r\n            quantity: item.quantity || 1,\r\n            sac: item.sac || '9966'\r\n        })),\r\n\r\n        // Sum up total fare\r\n        totalFare: data.items.reduce((sum, item) => sum + (parseFloat(item.amount) || 0), 0) + (data.gstEnabled ? (data.items.reduce((sum, item) => sum + (parseFloat(item.amount) || 0), 0) * ((data.gstRate || 5) / 100)) : 0),\r\n        fare: data.items.reduce((sum, item) => sum + (parseFloat(item.amount) || 0), 0),\r\n\r\n        gst: data.gstEnabled ? (data.items.reduce((sum, item) => sum + (parseFloat(item.amount) || 0), 0) * ((data.gstRate || 5) / 100)) : 0,\r\n        gstRate: data.gstRate || 5,\r\n        gstType: data.gstType || 'CGST_SGST',\r\n\r\n        // Pass specific Quotation fields\r\n        vehicleType: data.items[0]?.vehicleType || 'Any',\r\n        terms: data.terms,\r\n        previewStep: 4 // Ensure full render\r\n    };\r\n\r\n    // Call the master generator with isQuotation = true\r\n    return generateReceiptPDF(tripData, { ...settings, gstEnabled: !!data.gstEnabled, rcmEnabled: !!data.rcmEnabled }, true);\r\n};\r\n// --- HELPER ---\r\nconst hexToRgb = (hex: string) => {\r\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n    return result ? {\r\n        r: parseInt(result[1], 16),\r\n        g: parseInt(result[2], 16),\r\n        b: parseInt(result[3], 16)\r\n    } : { r: 0, g: 71, b: 171 }; // Default blue\r\n};\r\n\r\nexport const shareReceipt = async (trip: Trip, settings: PDFSettings) => {\r\n    const doc = await generateReceiptPDF(trip, settings);\r\n    const pdfBlob = doc.output('blob');\r\n\r\n    // Use Invoice Number for filename if available\r\n    let fileName = 'Invoice';\r\n    if (trip.invoiceNo) {\r\n        fileName = trip.invoiceNo.replace(/[\\/\\\\:*?\"<>|]/g, '-');\r\n    } else {\r\n        fileName = `Invoice_${trip.customerName?.replace(/\\s/g, '_') || 'Trip'}`;\r\n    }\r\n    const fullFileName = `${fileName}.pdf`;\r\n\r\n    const file = new File([pdfBlob], fullFileName, { type: 'application/pdf' });\r\n\r\n    if (navigator.share) {\r\n        try {\r\n            await navigator.share({\r\n                files: [file],\r\n                title: 'Trip Invoice',\r\n                text: `Invoice for trip by ${trip.customerName}`\r\n            });\r\n        } catch (err) {\r\n            console.error('Error sharing invoice:', err);\r\n            // Fallback to save if user cancels or share fails\r\n            doc.save(fullFileName);\r\n        }\r\n    } else {\r\n        doc.save(fullFileName);\r\n    }\r\n};\r\n\r\nexport const shareQuotation = async (data: QuotationData, settings: PDFSettings) => {\r\n    const doc = await generateQuotationPDF(data, settings);\r\n    const pdfBlob = doc.output('blob');\r\n\r\n    let fileName = 'Quotation';\r\n    if (data.quotationNo) {\r\n        fileName = data.quotationNo.replace(/[\\/\\\\:*?\"<>|]/g, '-');\r\n    } else {\r\n        const qLabel = new Date().getTime();\r\n        fileName = `Quotation_${data.customerName.replace(/\\s/g, '_')}_${qLabel}`;\r\n    }\r\n    const fullFileName = `${fileName}.pdf`;\r\n\r\n    const file = new File([pdfBlob], fullFileName, { type: 'application/pdf' });\r\n\r\n    if (navigator.share) {\r\n        try {\r\n            await navigator.share({\r\n                files: [file],\r\n                title: 'Trip Quotation',\r\n                text: `Quotation for ${data.customerName} - ${data.subject}`\r\n            });\r\n        } catch (err) {\r\n            console.error('Error sharing quotation:', err);\r\n            doc.save(fullFileName);\r\n        }\r\n    } else {\r\n        doc.save(fullFileName);\r\n    }\r\n};\r\n\r\n\r\nexport interface Expense {\r\n    category: string;\r\n    amount: number;\r\n    [key: string]: any;\r\n}\r\n\r\nexport const generateFinancialReportPDF = async (trips: Trip[], expenses: Expense[], settings: PDFSettings, periodLabel: string) => {\r\n    const { jsPDF } = await import('jspdf');\r\n    const doc = new jsPDF({ compress: true });\r\n    const margin = 15;\r\n    let y = 15;\r\n    const themeColor = settings?.appColor || '#0047AB';\r\n    const rgb = hexToRgb(themeColor);\r\n    const setThemeColor = () => doc.setTextColor(rgb.r, rgb.g, rgb.b);\r\n    const setDrawColor = () => doc.setDrawColor(rgb.r, rgb.g, rgb.b);\r\n\r\n    // --- HEADER ---\r\n    setThemeColor();\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.setFontSize(22);\r\n    doc.text((settings?.companyName || 'MY BUSINESS').toUpperCase(), margin, 20);\r\n\r\n    doc.setFontSize(9);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.setTextColor(100, 100, 100);\r\n    doc.text(`Generated: ${new Date().toLocaleDateString('en-IN')}`, 195, 20, { align: 'right' });\r\n\r\n    // --- QR CODE (Business Profile) ---\r\n    if (settings.userId) {\r\n        try {\r\n            const QRCode = await import('qrcode'); // Dynamic Import\r\n            const publicUrl = `${window.location.origin}/?u=${settings.userId}`;\r\n            const qrDataUrl = await QRCode.toDataURL(publicUrl, { margin: 1, width: 100 });\r\n            doc.addImage(qrDataUrl, 'PNG', 170, 8, 18, 18, undefined, 'FAST');\r\n        } catch (e) {\r\n            console.error('QR Generation failed', e);\r\n        }\r\n    }\r\n\r\n    y = 30;\r\n    setDrawColor();\r\n    doc.setLineWidth(0.6);\r\n    doc.line(margin, y, 195, y);\r\n\r\n    y += 10;\r\n    setThemeColor();\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.setFontSize(16);\r\n    doc.text('STATEMENT OF ACCOUNTS', 105, y, { align: 'center' });\r\n    doc.setFontSize(10);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.setTextColor(80, 80, 80);\r\n    doc.text(`Period: ${periodLabel}`, 105, y + 6, { align: 'center' });\r\n\r\n    // --- FINANCIAL SUMMARY ---\r\n    y += 20;\r\n    const totalIncome = trips.reduce((sum, t) => sum + t.totalFare, 0);\r\n    const totalExpense = expenses.reduce((sum, e) => sum + e.amount, 0);\r\n    const netProfit = totalIncome - totalExpense;\r\n\r\n    doc.setFillColor(rgb.r, rgb.g, rgb.b, 0.05);\r\n    doc.rect(margin, y, 180, 40, 'F');\r\n    setDrawColor();\r\n    doc.rect(margin, y, 180, 40, 'S');\r\n\r\n    y += 10;\r\n    setThemeColor();\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('FINANCIAL SUMMARY', margin + 5, y);\r\n\r\n    y += 10;\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.setFontSize(11);\r\n    doc.text('Total Income (Revenue)', margin + 10, y);\r\n    doc.text(`${totalIncome.toLocaleString('en-IN', { style: 'currency', currency: 'INR' })}`, 185, y, { align: 'right' });\r\n\r\n    y += 8;\r\n    doc.text('Total Expenses', margin + 10, y);\r\n    doc.text(`- ${totalExpense.toLocaleString('en-IN', { style: 'currency', currency: 'INR' })}`, 185, y, { align: 'right' });\r\n\r\n    y += 10;\r\n    doc.setLineWidth(0.3);\r\n    doc.line(margin + 5, y - 5, 185, y - 5);\r\n    setThemeColor();\r\n    doc.setFontSize(12);\r\n    doc.text('NET PROFIT / (LOSS)', margin + 10, y);\r\n    doc.text(`${netProfit.toLocaleString('en-IN', { style: 'currency', currency: 'INR' })}`, 185, y, { align: 'right' });\r\n\r\n    // --- INCOME BREAKDOWN (Simplified) ---\r\n    y += 25;\r\n    setThemeColor();\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.setFontSize(12);\r\n    doc.text('INCOME STATISTICS', margin, y);\r\n    doc.line(margin, y + 2, 195, y + 2);\r\n\r\n    y += 10;\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.setFontSize(10);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Total Trips Completed: ${trips.length}`, margin, y);\r\n    y += 6;\r\n    const totalKms = trips.reduce((sum, t) => sum + (t.endKm - t.startKm), 0);\r\n    doc.text(`Total Distance Covered: ${totalKms.toLocaleString()} KM`, margin, y);\r\n\r\n    // --- EXPENSE BREAKDOWN ---\r\n    y += 15;\r\n    setThemeColor();\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.setFontSize(12);\r\n    doc.text('EXPENSE BREAKDOWN', margin, y);\r\n    doc.line(margin, y + 2, 195, y + 2);\r\n    y += 10;\r\n\r\n    // Group expenses properly\r\n    const catTotals: Record<string, number> = {};\r\n    expenses.forEach(e => {\r\n        catTotals[e.category] = (catTotals[e.category] || 0) + e.amount;\r\n    });\r\n\r\n    const categories = Object.keys(catTotals);\r\n    if (categories.length === 0) {\r\n        doc.setTextColor(150, 150, 150);\r\n        doc.setFont('helvetica', 'italic');\r\n        doc.text('No expenses recorded for this period.', margin, y);\r\n    } else {\r\n        doc.setTextColor(0, 0, 0);\r\n        doc.setFontSize(10);\r\n        doc.setFont('helvetica', 'normal');\r\n        categories.forEach(cat => {\r\n            doc.text(cat.toUpperCase(), margin, y);\r\n            doc.text(`${catTotals[cat].toLocaleString('en-IN', { style: 'currency', currency: 'INR' })}`, 195, y, { align: 'right' });\r\n            y += 6;\r\n        });\r\n    }\r\n\r\n    // --- FOOTER ---\r\n    y = 278;\r\n    setDrawColor();\r\n    doc.setLineWidth(0.5);\r\n    doc.line(margin, y, 195, y);\r\n    y += 4;\r\n\r\n    doc.setFontSize(7);\r\n    setThemeColor();\r\n    doc.setFont('helvetica', 'bold');\r\n\r\n    doc.text('SARATHIBOOK.COM', 105, y + 2, {\r\n        align: 'center',\r\n        url: 'https://sarathibook.com'\r\n    } as any);\r\n\r\n    doc.setFontSize(4);\r\n    doc.setTextColor(150, 150, 150);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text('PROFESSIONAL CAB BUSINESS SUITE | AUTOMATE YOUR GROWTH', 105, y + 5, { align: 'center' });\r\n\r\n    doc.link(90, y, 30, 5, { url: 'https://sarathibook.com' });\r\n\r\n    return doc;\r\n};\r\n\r\nexport const shareFinancialReport = async (trips: Trip[], expenses: Expense[], settings: PDFSettings, periodLabel: string) => {\r\n    const doc = await generateFinancialReportPDF(trips, expenses, settings, periodLabel);\r\n    const pdfBlob = doc.output('blob');\r\n    const filename = `Financial_Report_${periodLabel.replace(/\\s/g, '_')}_${new Date().getTime()}.pdf`;\r\n    const file = new File([pdfBlob], filename, { type: 'application/pdf' });\r\n\r\n    if (navigator.share) {\r\n        try {\r\n            await navigator.share({\r\n                files: [file],\r\n                title: 'Business Financial Report',\r\n                text: `Find attached the financial statement for ${periodLabel}`\r\n            });\r\n        } catch (err) {\r\n            console.error('Error sharing report:', err);\r\n            doc.save(filename);\r\n        }\r\n    } else {\r\n        doc.save(filename);\r\n    }\r\n};\r\n\r\n// Bulk Generation Logic\r\nexport const generateBulkReceiptsPDF = async (trips: Trip[], settings: PDFSettings) => {\r\n    // Dynamic Import\r\n    const { jsPDF } = await import('jspdf');\r\n    const doc = new jsPDF({ unit: 'mm', format: 'a4', compress: true });\r\n\r\n    for (let i = 0; i < trips.length; i++) {\r\n        const trip = trips[i];\r\n        if (i > 0) doc.addPage();\r\n        await generateReceiptPDF(trip, settings, false, doc);\r\n    }\r\n    return doc;\r\n};\r\n\r\nexport const generatePayslipPDF = async (staff: Staff, payroll: any, month: Date, settings: PDFSettings) => {\r\n    const { jsPDF } = await import('jspdf');\r\n    const doc = new jsPDF({ unit: 'mm', format: 'a4', compress: true });\r\n    const margin = 15;\r\n    let y = 15;\r\n    const themeColor = settings?.appColor || '#0047AB';\r\n    const rgb = hexToRgb(themeColor);\r\n    const setThemeColor = () => doc.setTextColor(rgb.r, rgb.g, rgb.b);\r\n    const setDrawColor = () => doc.setDrawColor(rgb.r, rgb.g, rgb.b);\r\n\r\n    // --- HELPER: Draw Table Cell ---\r\n    const drawCell = (x: number, y: number, w: number, h: number, text: string, align: 'left' | 'center' | 'right' = 'left', isBold = false) => {\r\n        doc.rect(x, y, w, h);\r\n        doc.setFont('helvetica', isBold ? 'bold' : 'normal');\r\n        let textX = x + 2;\r\n        if (align === 'center') textX = x + (w / 2);\r\n        if (align === 'right') textX = x + w - 2;\r\n        doc.text(text, textX, y + (h / 2) + 1.5, { align });\r\n    };\r\n\r\n    // --- 1. COMPANY LETTERHEAD ---\r\n    setThemeColor();\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.setFontSize(22);\r\n    doc.text((settings?.companyName || 'SARATHI BOOK').toUpperCase(), margin, 20);\r\n    \r\n    doc.setFontSize(9);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.setTextColor(80, 80, 80);\r\n    const companyAddress = settings?.companyAddress || 'No Address Provided';\r\n    const splitAddress = doc.splitTextToSize(companyAddress, 80);\r\n    doc.text(splitAddress, margin, 26);\r\n    \r\n    doc.setTextColor(100, 100, 100);\r\n    doc.text(`Contact: ${settings?.driverPhone || 'N/A'}`, margin, 26 + (splitAddress.length * 4));\r\n    if (settings?.gstin) {\r\n        doc.text(`GSTIN: ${settings.gstin}`, margin, 30 + (splitAddress.length * 4));\r\n    }\r\n\r\n    // Right side meta\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('PAY SLIP', 195, 20, { align: 'right' });\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(`Month: ${new Date(month).toLocaleDateString('en-IN', { month: 'long', year: 'numeric' }).toUpperCase()}`, 195, 26, { align: 'right' });\r\n    doc.text(`Dated: ${new Date().toLocaleDateString('en-IN')}`, 195, 31, { align: 'right' });\r\n\r\n    y = 45;\r\n    setDrawColor();\r\n    doc.setLineWidth(0.8);\r\n    doc.line(margin, y, 195, y);\r\n\r\n    // --- 2. EMPLOYEE DETAILS GRID ---\r\n    y += 8;\r\n    doc.setFontSize(10);\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('EMPLOYEE INFORMATION', margin, y);\r\n    \r\n    y += 4;\r\n    doc.setLineWidth(0.1);\r\n    doc.setFontSize(8.5);\r\n    \r\n    const rowH = 7;\r\n    const colW = 45;\r\n\r\n    // Row 1\r\n    drawCell(margin, y, colW, rowH, 'Employee Name', 'left', true);\r\n    drawCell(margin + colW, y, colW, rowH, staff.name);\r\n    drawCell(margin + (colW * 2), y, colW, rowH, 'Employee ID', 'left', true);\r\n    drawCell(margin + (colW * 3), y, colW, rowH, staff.employeeId || 'SB-' + staff.id.slice(0, 4).toUpperCase());\r\n    \r\n    y += rowH;\r\n    // Row 2\r\n    drawCell(margin, y, colW, rowH, 'Designation', 'left', true);\r\n    drawCell(margin + colW, y, colW, rowH, staff.designation || 'Driver');\r\n    drawCell(margin + (colW * 2), y, colW, rowH, 'Date of Joining', 'left', true);\r\n    drawCell(margin + (colW * 3), y, colW, rowH, staff.joinDate ? new Date(staff.joinDate).toLocaleDateString('en-IN') : 'N/A');\r\n\r\n    y += rowH;\r\n    // Row 3\r\n    drawCell(margin, y, colW, rowH, 'PAN Number', 'left', true);\r\n    drawCell(margin + colW, y, colW, rowH, staff.panNumber || 'N/A');\r\n    drawCell(margin + (colW * 2), y, colW, rowH, 'Phone Number', 'left', true);\r\n    drawCell(margin + (colW * 3), y, colW, rowH, staff.phone);\r\n\r\n    y += rowH;\r\n    // Row 4 (Bank)\r\n    drawCell(margin, y, colW, rowH, 'Bank Name', 'left', true);\r\n    drawCell(margin + colW, y, colW, rowH, staff.bankName || 'N/A');\r\n    drawCell(margin + (colW * 2), y, colW, rowH, 'Account Number', 'left', true);\r\n    drawCell(margin + (colW * 3), y, colW, rowH, staff.accountNumber || 'N/A');\r\n\r\n    y += rowH;\r\n    // Row 5 (Bank 2)\r\n    drawCell(margin, y, colW, rowH, 'IFSC Code', 'left', true);\r\n    drawCell(margin + colW, y, colW, rowH, staff.ifscCode || 'N/A');\r\n    drawCell(margin + (colW * 2), y, colW, rowH, 'Payment Mode', 'left', true);\r\n    drawCell(margin + (colW * 3), y, colW, rowH, settings.preferredPaymentMethod?.toUpperCase() || 'BANK TRANSFER');\r\n\r\n    y += rowH;\r\n    // Row 6 (Compliance)\r\n    drawCell(margin, y, colW, rowH, 'UAN Number', 'left', true);\r\n    drawCell(margin + colW, y, colW, rowH, staff.uan || 'N/A');\r\n    drawCell(margin + (colW * 2), y, colW, rowH, 'ESI IP Number', 'left', true);\r\n    drawCell(margin + (colW * 3), y, colW, rowH, staff.esiNumber || 'N/A');\r\n\r\n    // --- 3. SALARY CALCULATION TABLE ---\r\n    y += 15;\r\n    doc.setFontSize(10);\r\n    setThemeColor();\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('SALARY BREAKDOWN', margin, y);\r\n    \r\n    y += 4;\r\n    doc.setTextColor(255, 255, 255);\r\n    doc.setFillColor(rgb.r, rgb.g, rgb.b);\r\n    doc.rect(margin, y, 90, 8, 'F');\r\n    doc.rect(margin + 90, y, 90, 8, 'F');\r\n    \r\n    doc.text('EARNINGS', margin + 45, y + 5.5, { align: 'center' });\r\n    doc.text('DEDUCTIONS', margin + 135, y + 5.5, { align: 'center' });\r\n\r\n    y += 8;\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.setFontSize(9);\r\n    \r\n    const itemsH = 8;\r\n\r\n    // Earnings Column\r\n    let earnY = y;\r\n    drawCell(margin, earnY, 60, itemsH, `Duty Pay (${payroll.dutyDays} Days)`);\r\n    drawCell(margin + 60, earnY, 30, itemsH, payroll.dutyTotal.toLocaleString('en-IN'), 'right');\r\n    earnY += itemsH;\r\n    \r\n    if (payroll.standbyTotal > 0) {\r\n        drawCell(margin, earnY, 60, itemsH, `Standby/Waiting (${payroll.standbyDays} Days)`);\r\n        drawCell(margin + 60, earnY, 30, itemsH, payroll.standbyTotal.toLocaleString('en-IN'), 'right');\r\n        earnY += itemsH;\r\n    }\r\n    \r\n    // Fill empty earnings rows to sync with deductions if needed\r\n    while (earnY < y + (itemsH * 5)) {\r\n        drawCell(margin, earnY, 60, itemsH, '');\r\n        drawCell(margin + 60, earnY, 30, itemsH, '', 'right');\r\n        earnY += itemsH;\r\n    }\r\n\r\n    // Deductions Column\r\n    let dedY = y;\r\n    drawCell(margin + 90, dedY, 60, itemsH, 'EPF (12%)');\r\n    drawCell(margin + 150, dedY, 30, itemsH, payroll.pf > 0 ? payroll.pf.toLocaleString('en-IN') : '0', 'right');\r\n    dedY += itemsH;\r\n\r\n    drawCell(margin + 90, dedY, 60, itemsH, 'ESI (0.75%)');\r\n    drawCell(margin + 150, dedY, 30, itemsH, payroll.esi > 0 ? payroll.esi.toLocaleString('en-IN') : '0', 'right');\r\n    dedY += itemsH;\r\n\r\n    drawCell(margin + 90, dedY, 60, itemsH, 'Sal. Advances / Deductions');\r\n    drawCell(margin + 150, dedY, 30, itemsH, (payroll.advances + payroll.fines).toLocaleString('en-IN'), 'right');\r\n    dedY += itemsH;\r\n\r\n    drawCell(margin + 90, dedY, 60, itemsH, 'Other Deductions');\r\n    drawCell(margin + 150, dedY, 30, itemsH, '0', 'right');\r\n    dedY += itemsH;\r\n\r\n    y = Math.max(earnY, dedY);\r\n    \r\n    // Totals Row\r\n    doc.setFont('helvetica', 'bold');\r\n    drawCell(margin, y, 60, itemsH, 'GROSS EARNINGS', 'left', true);\r\n    drawCell(margin + 60, y, 30, itemsH, payroll.gross.toLocaleString('en-IN'), 'right', true);\r\n    \r\n    const totalDeductions = payroll.pf + payroll.esi + payroll.advances + payroll.fines;\r\n    drawCell(margin + 90, y, 60, itemsH, 'TOTAL DEDUCTIONS', 'left', true);\r\n    drawCell(margin + 150, y, 30, itemsH, totalDeductions.toLocaleString('en-IN'), 'right', true);\r\n\r\n    // --- 4. NET PAY ---\r\n    y += itemsH + 10;\r\n    doc.setFillColor(245, 247, 250);\r\n    doc.rect(margin, y, 180, 15, 'F');\r\n    setDrawColor();\r\n    doc.rect(margin, y, 180, 15, 'S');\r\n\r\n    setThemeColor();\r\n    doc.setFontSize(12);\r\n    doc.text('NET SALARY PAYABLE', margin + 5, y + 9);\r\n    doc.setFontSize(16);\r\n    doc.text(`Rs. ${payroll.net.toLocaleString('en-IN')}`, 185, y + 10, { align: 'right' });\r\n\r\n    y += 22;\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.setFontSize(9);\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('Amount in Words:', margin, y);\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.text(numberToWords(payroll.net), margin + 35, y);\r\n\r\n    // --- 5. SIGNATURES ---\r\n    y += 30;\r\n    doc.setFont('helvetica', 'normal');\r\n    doc.setFontSize(9);\r\n    doc.text('__________________________', margin, y);\r\n    doc.text('Employee Signature', margin, y + 5);\r\n\r\n    doc.text('__________________________', 195, y, { align: 'right' });\r\n    doc.text(`For ${(settings?.companyName || 'SARATHI BOOK').toUpperCase()}`, 195, y + 5, { align: 'right' });\r\n    doc.setFont('helvetica', 'bold');\r\n    doc.text('Authorised Signatory', 195, y + 15, { align: 'right' });\r\n\r\n    // --- 6. FOOTER ---\r\n    y = 275;\r\n    doc.setFont('helvetica', 'italic');\r\n    doc.setFontSize(8);\r\n    doc.setTextColor(150, 150, 150);\r\n    doc.text('This is a highly confidential document. Any unauthorized reproduction is prohibited.', 105, y, { align: 'center' });\r\n    doc.text('Generated via Sarathi Book - Your Digital Fleet Office', 105, y + 4, { align: 'center' });\r\n\r\n    return doc;\r\n};\r\n\r\nexport const generateLetterheadPDF = async (settings: PDFSettings) => {\r\n    // Dynamic Import\r\n    const { jsPDF } = await import('jspdf');\r\n    const doc = new jsPDF({ unit: 'mm', format: 'a4', compress: true });\r\n    \r\n    const margin = 15;\r\n    const themeColor = settings?.appColor || '#0047AB';\r\n    const rgb = hexToRgb(themeColor);\r\n    const setThemeColor = () => doc.setTextColor(rgb.r, rgb.g, rgb.b);\r\n    const setDrawThemeColor = () => doc.setDrawColor(rgb.r, rgb.g, rgb.b);\r\n\r\n    // --- HEADER ---\r\n    if (settings?.logoUrl) {\r\n        try {\r\n            doc.addImage(settings.logoUrl, 'PNG', margin, 12, 18, 18, undefined, 'FAST');\r\n            setThemeColor();\r\n            doc.setFont('helvetica', 'bold');\r\n            doc.setFontSize(22);\r\n            doc.text((settings.companyName || 'SARATHI BOOK').toUpperCase(), margin + 22, 22);\r\n            doc.setTextColor(0, 0, 0);\r\n        } catch {\r\n            setThemeColor();\r\n            doc.setFont('helvetica', 'bold');\r\n            doc.setFontSize(24);\r\n            doc.text((settings.companyName || 'SARATHI BOOK').toUpperCase(), margin, 20);\r\n            doc.setTextColor(0, 0, 0);\r\n        }\r\n    } else {\r\n        setThemeColor();\r\n        doc.setFont('helvetica', 'bold');\r\n        doc.setFontSize(24);\r\n        doc.text((settings.companyName || 'SARATHI BOOK').toUpperCase(), margin, 20);\r\n        doc.setTextColor(0, 0, 0);\r\n    }\r\n    \r\n    doc.setFontSize(9);\r\n    doc.setFont('helvetica', 'normal');\r\n    const companyAddress = settings?.companyAddress || '';\r\n    const addressY = 28;\r\n    const addressLines = doc.splitTextToSize(companyAddress, 100);\r\n    doc.text(addressLines, margin, addressY);\r\n    \r\n    // Contact Rendering\r\n    const contactY = addressY + (addressLines.length * 4.5) + 2;\r\n    doc.setFontSize(9);\r\n    \r\n    // Line 1: Phones\r\n    const phoneText = `Phone: ${settings?.driverPhone || ''}${settings?.secondaryPhone ? `, ${settings?.secondaryPhone}` : ''}`;\r\n    doc.text(phoneText, margin, contactY);\r\n    \r\n    // Line 2: Email and GSTIN\r\n    const cEmail = settings?.companyEmail || '';\r\n    const cGst = settings?.gstin ? String(settings.gstin).toUpperCase() : '';\r\n    let line2 = '';\r\n    if (cEmail) line2 += `Email: ${cEmail}`;\r\n    if (cEmail && cGst) line2 += '  |  ';\r\n    if (cGst) line2 += `GSTIN: ${cGst}`;\r\n    \r\n    if (line2) {\r\n        doc.text(line2, margin, contactY + 5);\r\n    }\r\n    \r\n    // Divider\r\n    const dividerY = contactY + (line2 ? 9 : 4);\r\n    setDrawThemeColor();\r\n    doc.setLineWidth(0.6);\r\n    doc.line(margin, dividerY, 195, dividerY);\r\n    \r\n    // Branding Footer (Simple)\r\n    let y = 278;\r\n    setDrawThemeColor();\r\n    doc.setLineWidth(0.5);\r\n    doc.line(margin, y, 195, y);\r\n    y += 4;\r\n    \r\n    if (settings.showWatermark !== false) {\r\n        doc.setFontSize(8);\r\n        setThemeColor();\r\n        doc.setFont('helvetica', 'bold');\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        doc.text('sarathibook.com', 195, y + 2, { align: 'right', url: 'https://sarathibook.com' } as any);\r\n        \r\n        doc.setFont('times', 'bold');\r\n        doc.setFontSize(10);\r\n        doc.text('SARATHI BOOK', margin, y + 2);\r\n    }\r\n    \r\n    return doc;\r\n};\r\n\r\nexport const downloadLetterhead = async (settings: PDFSettings) => {\r\n    const doc = await generateLetterheadPDF(settings);\r\n    const filename = `Letterhead_${(settings.companyName || 'Company').replace(/[^a-z0-9]/gi, '_')}.pdf`;\r\n    doc.save(filename);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\permits.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\push.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\routesApi.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\seoSchema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\storage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\stringUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\supabase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\uuid.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\verify_scenarios.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\utils\\visionApi.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\src\\workers\\fare.worker.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[285,288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[285,288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { calculateFare } from '../utils/fare';\r\n\r\nself.onmessage = (e: MessageEvent) => {\r\n    const { id, args } = e.data;\r\n    try {\r\n        const result = calculateFare(...(args as Parameters<typeof calculateFare>));\r\n        self.postMessage({ id, result });\r\n    } catch (error: any) {\r\n        self.postMessage({ id, error: error.message });\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\test-production.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\verify_acting_driver.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\verify_calculator.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\verify_others.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\verify_relocation.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\verify_roundtrip.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\websites\\cab driver\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
